YUI.add("minty_module_toolbar_fragments_reply_group_conv",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_fragments_reply_group_conv={base:"{{reply_group}}",reply_group:'<button id="btn-reply-sender" class="btn onemsg reply" aria-label="{{str_reply_sender}}" title="{{str_reply_sender}} [{{str_menu_accel_shift_r}}]" data-action="reply_sender" tabindex="-1"> <i class="icon-reply"></i> </button> <button id="btn-reply-all" class="btn onemsg reply-all" aria-label="{{str_reply_all}}" title="{{str_reply_all}} [{{str_menu_accel_shift_a}}]" data-action="reply_all" tabindex="-1"> <i class="icon-reply-all"></i> </button> <button id="btn-forward" class="btn onemsg forward" aria-label="{{str_forward}}" title="{{str_forward}} [{{str_menu_accel_shift_f}}]" data-action="forward" tabindex="-1"> <i class="icon-forward"></i> </button>'};},"1.0.0");YUI.add("minty_module_toolbar_inbox_message_thread",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_toolbar_inbox_message_thread={base:'<div id="pagetoolbar" class="{{msgliststate}} threadtoolbar {{toolbarStyleClass}}" data-acctid="{{toolbar_acct_id}}"> {{from_search}} {{minty_module_toolbar_fragments_reply_group_conv}} {{archiveEnabled}} {{archiveEnabled_else}} {{has_spam_button}} <button id="btn-actions" class="btn multimsg" aria-label="{{str_more_actions_attr}}" title="{{str_more_actions_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-more"></i><span class="icon-text">{{str_more}}</span><b class="icon icon-chevron-down"></b> </button> {{msg_nav_arrows}} <button id="btn-togglethread" class="btn onemsg thread-cards-expanded hidden" aria-label="{{str_collapse_all_attr}}" title="{{str_collapse_all_attr}}" data-action="thread-toggle" tabindex="-1"> <i class="icon-collapse-list"></i><span class="icon-text">{{str_collapse_all}}</span> </button> {{cancellable}}</div>',from_search:'<button id="btn-back-to-search" class="btn" aria-label="{{str_srch_back}}" title="{{str_srch_back}}" data-action="closemsg" tabindex="-1"> <i class="icon-arrow-left"></i><span class="icon-text">{{str_srch_result}}</span> </button> ',showArchive:'<button id="btn-archive" class="btn multimsg" aria-label="{{str_archive_convs_attr}}" title="{{str_archive_convs_attr}}" data-action="archive" tabindex="-1"> <i class="icon-archive"></i><span class="icon-text">{{str_archive}}</span> </button> ',showRestore:'<button id="btn-restore" class="btn multimsg" aria-label="{{str_restore_conv_attr}}" title="{{str_restore_conv_attr}}" data-action="restore" tabindex="-1"> <i class="icon-restore-inbox"></i><span class="icon-text">{{strRestore}}</span> </button> ',archiveEnabled:'{{showArchive}} {{showRestore}} <button id="btn-move" class="btn multimsg" aria-label="{{str_move_convs_attr}}" title="{{str_move_convs_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-move"></i><span class="icon-text">{{str_move}}</span><b class="icon icon-chevron-down"></b> </button> <button id="btn-delete" class="btn multimsg" aria-label="{{str_delete_conv_attr}}" title="{{str_delete_conv_attr}}" data-action="delete" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> ',archiveEnabled_else:'<button id="btn-delete" class="btn multimsg" aria-label="{{str_delete_conv_attr}}" title="{{str_delete_conv_attr}}" data-action="delete" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> <button id="btn-move" class="btn multimsg" aria-label="{{str_move_convs_attr}}" title="{{str_move_convs_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-move"></i><span class="icon-text">{{str_move}}</span><b class="icon icon-chevron-down"></b> </button> ',spam_menu:'<button id="main-btn-spam" class="btn multimsg collapse-end-space" aria-label="{{str_mspam_conv_attr}}" title="{{str_mspam_conv_attr}}" data-action="{{spam_data_action}}" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> <button id="btn-spam" class="btn multimsg" aria-label="{{str_menu_spam_toggle_attr}}" title="{{str_menu_spam_toggle_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <b class="icon icon-chevron-down"></b> </button> ',spam_menu_else:'<button id="main-btn-spam" class="btn multimsg" aria-label="{{str_spam_attr}}" title="{{str_spam_attr}}" data-action="{{spam_data_action}}" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> ',has_spam_button:"{{spam_menu}} {{spam_menu_else}} ",msg_nav_arrows:'<button id="btn-prev-msg" class="btn btn-absolute btn-prev-msg hidden" aria-label="{{str_prev_conv_attr}}" title="{{str_prev_conv_attr}}" data-action="prev" tabindex="-1"> <i></i> </button> <button id="btn-next-msg" class="btn btn-absolute btn-next-msg hidden" aria-label="{{str_nxt_conv_attr}}" title="{{str_nxt_conv_attr}}" data-action="next" tabindex="-1"> <i></i> </button> ',cancellable:'<button id="btn-closemsg" class="btn btn-absolute btn-close-msg hidden" aria-label="{{str_close}}" title="{{str_close}}" data-action="closemsg" tabindex="-1"> <i></i> </button> '}},"1.0.0",{requires:["minty_module_toolbar_fragments_reply_group_conv"]});
YUI.add("contacts-api-config",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n={1:"asc",2:"desc"},r={1:"first",3:"last",6:"email"},i=e.common.Utils,s=i.settings.value("contactsV2Limit"),o;o=function(){var t=this,i=function(e){return!!e},o={baseHost:{validator:i},uri:{},headers:{},wssid:{},guid:{},requestFn:{},wspath:{value:"/ws/sd",validator:i},start:{},count:{value:s,validator:i},sortfields:{},out:{value:"name,email,nickname,yahooid,phone,otherid,image"},prefs:{value:null},sort:{},fields:{},view:{value:["compact"]},rev:{value:0,validator:i},reloadOnUpdate:{value:!0},fieldsToProcess:{value:["name","nickname","email","yahooid","image"],validator:function(t){return e.Lang.isArray(t)}},minimumFields:{value:["name","email","phone","nickname","yahooid","otherids","company"],validator:function(t){return e.Lang.isArray(t)}}};t.addAttrs(o),t.setSortField=function(e){return t.set("sortfields",r[e]),t.get("sortfields")},t.setSortOrder=function(e){return t.set("sort",n[e]),t.get("sort")}},e.augment(o,e.Attribute),t.config=new o;if(t.clientConfig)t.config.setAttrs(t.clientConfig);else if(NeoConfig){var u={guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,wspath:NeoConfig.socdirProxyPath,sortfields:"first",sort:"asc"};e.Object.getValue(e,["common","net","SessionMgr"])&&(u.requestFn=e.common.net.SessionMgr.requestProxy),t.config.setAttrs(u)}},"1.0.0",{requires:["attribute","mail-common-utils-features","mail-common-utils-settings"]});
YUI.add("contacts-api-cache",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=e.contacts.config,r,i=e.Lang,s={CONTACT_CHANGED:"contacts:api:contactChanged",CONTACTS_LOADED:"contacts:api:loaded",CONTACT_IMAGE_UPDATED:"contacts:api:imageUpdated"};t.EVENTS=s,r=function(){var t=this,r=!1,o=0,u,a={},f={},l={},c={},h=[],p=[],d=null,v,m,g,y,b,w;v=function(e,t){var n,r;t||(c={});for(n in e)e.hasOwnProperty(n)&&(r=e[n],typeof r=="object"&&(c[r.id]=c[r.id]||r,t&&(c[r.id].contacts=c[r.id].contacts||[],c[r.id].contacts.push(t.id))))},b=function(t,n){var r=a[t.id]={typedFields:{},typedFieldValues:{}},i,s,o,u,f,l;n=n||[],i=n.length>0,t.fields=t.fields||[];for(f in t){if(f==="fields")continue;if(t.hasOwnProperty(f)){s=t[f],f=w(f,s);if(i&&n.indexOf(f)===-1)continue;r.typedFields[f]||(r.typedFields[f]=[]),r.typedFieldValues[f]||(r.typedFieldValues[f]=[]);if(Array.isArray(s))for(l in s)o=s[l],u=o.ep,o&&u&&(o.value=u,o.type=f,r.typedFields[f].push(o),r.typedFieldValues[f].push(u),t.fields.push(o));else if(typeof s=="object"){if(f==="name"){if(!s.familyName||s.familyName.indexOf("<")!==-1)s.familyName="";if(!s.givenName||s.givenName.indexOf("<")!==-1)s.givenName="";if(!s.middleName||s.middleName.indexOf("<")!==-1)s.middleName=""}u=e.clone(s),s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u)}else typeof s=="string"&&(u=s,s={},s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u))}}},w=function(e,t){switch(e){case"emails":e="email";break;case"messengers":t&&t.flags&&t.flags[0]&&t.flags[0]!=="YID"?e="otherid":e="yahooid";break;case"phones":e="phone"}return e},t.loadSortPrefs=function(e,t){d||(d={}),d.sort_order=e,d.sort_field=t},t.setSortPrefs=function(n,r){t.loadSortPrefs(n,r),e.later(10,t,e.contacts.api.load,[1])},t.getSortPrefs=function(){return d},t.load=function(i){var o,p,d=n.get("fieldsToProcess"),g,y={},w=[];g=i.contacts||[],y={contacts:{},count:i.count,status:i.status,statusText:i.statusText,total:i.total},l={},h=[],f={},c={},a={};for(p=0;p<g.length;p++)o=g[p],w.push(o),b(o,d),h[p]=o.id,l[o.id]=o,m(o),v(o.categories,o);u=y,u.contacts.contact=w,u.contacts.count=u.contacts.total=w.length,r=!0,e.later(10,t,t.fire,[s.CONTACTS_LOADED])},t.removeFromCategories=function(t){var n=t.categories||[],r=n.length,i,s,o;for(i=0;i<r;i++)s=n[i].id,o=c[s].contacts,o&&o.splice(e.Array.indexOf(o,t.id),1)},t.update=function(r){var u,a,f,c,p=n.get("fieldsToProcess"),d=[],y=[],w=[],E=[],S=[],x=[],T=[],N,C;r.syncresult?(o=r.syncresult.rev,u=r.syncresult.diff.contacts,T=r.syncresult.results.contacts):i.isArray(r)?u=r:typeof r=="object"&&!r.contact?u=[r]:u=[r.contact];for(C=0;C<T.length;C+=1){a=T[C],c=a.op,f=l[a.id];switch(c){case"remove":x.push(f);break;case"add":E.push(a);break;case"update":S.push(a)}}for(C=0;C<u.length;C+=1){a=u[C],c=a.op||"add",f=l[a.id];switch(c){case"remove":f&&(g(f),h.splice(e.Array.indexOf(h,f.id),1),t.removeFromCategories(f),w.push(f));break;default:f?(g(f),y.push(a)):d.push(a),b(a,p),v(a.categories,a),l[a.id]=a,m(a)}}return N={created:d,modified:y,removed:w,createdCurrent:E,modifiedCurrent:S,removedCurrent:x},d.length||y.length?n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]):e.later(10,t,t.fire,[s.CONTACTS_LOADED]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,N]),N},t.updateCategories=function(){var r={categories:c};n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,r])},t.restoreObject=function(t){p[t]&&(l[t]=e.clone(p[t]))},m=function(e){var t,n,r,i;t=a[e.id].typedFieldValues.email;if(!t||t.length===0)return;for(i in t)t.hasOwnProperty(i)&&(n=t[i],r=n.toLowerCase(),f[r]=f[r]||[],f[r].push(e))},g=function(e){var t,n,r,i,s,o;t=a[e.id].typedFieldValues.email||[],s=e.id;for(o in t)t.hasOwnProperty(o)&&(n=t[o],i=n.toLowerCase(),r=f[i],r&&r[s]&&(r[s]=undefined))},t.isLoaded=function(){return r},t.getResponseObject=function(){return u},t.getContactsData=function(){return a},t.getContacts=function(){return l},t.getEmails=function(){return f},t.getCategories=function(){return c},t.getContactOrder=function(){return h},t.getUpdatedContacts=function(){return p},t.setUpdatedContacts=function(t){p[t]=e.clone(l[t])},t.getCurrentRevision=function(){return o},t.setCurrentRevision=function(e){o=e},t.loadTinyUserCard=function(r){var i=r.contacts.contact,o,u=n.get("fieldsToProcess"),a=[],f;for(f in i)i.hasOwnProperty(f)&&(o=i[f],b(o,u),l[o.id]=o,m(o),a.push(o));return e.later(10,t,t.fire,[s.CONTACT_IMAGE_UPDATED,a]),a},t.getContactsByBucket=function(e,t,n){var r,i=[],s,o=e+t,u,a=[];n?(s=c[n],s&&(i=s.contacts||[])):i=h||[];for(u=e;u<o;u++){r=i[u];if(!r)break;a.push(l[r])}return{contacts:a,total:i.length}},t.removeFlatContact=function(e,t){var n=a[e].flatContacts,r,i=n.length,s;for(r=0;r<i;r++){s=n[r];if(s.emailField&&s.emailField.id===t){n.splice(r,1);break}}},t.removeField=function(e,n){var r=l[e];if(r){var i=r.fields,s,o=i.length,u;for(s=0;s<o;s++){u=i[s];if(u.id===n){i.splice(s,1),u.type==="email"&&t.removeFlatContact(e,n);break}}}},y=function(){var e={broadcast:1,emitFacade:!0};t.publish(s.CONTACT_CHANGED,e),t.publish(s.CONTACTS_LOADED,e),t.publish(s.CONTACT_IMAGE_UPDATED,e)}()},e.augment(r,e.EventTarget),t.cache=new r},"1.0.0",{requires:["contacts-api-config","common-utils-stats"]});
YUI.add("contacts-api-utils",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.cache,r=function(){var t=this;t.getContactsByEmail=function(e){return!e||e===""?null:n.getEmails()[e.toLowerCase()]},t.isEmailKnown=function(e,n){var r,i;return r=t.getContactsByEmail(e),r?1:0},t.getContactById=function(e){var t;return t=n.getContacts()[e],t},t.getContactsByIds=function(e){var n,r;n=[];for(r in e)e.hasOwnProperty(r)&&n.push(t.getContactById(e[r]));return n},t.getCategoryById=function(e){var t;return t=n.getCategories()[e],t},t.areContactsLoaded=function(){return n.isLoaded()},t.getResponseObject=function(){return n.getResponseObject()},t.getContacts=function(e){var t,r={},i=n.getContacts();if(!e)return i;for(t in i)i.hasOwnProperty(t)&&i[t].id>=0&&(r[t]=i[t]);return r},t.getSmartContacts=function(){var e,t={};for(e in n.getContacts())n.getContacts().hasOwnProperty(e)&&n.getContacts()[e].id<0&&(t[e]=n.getContacts()[e]);return t},t.getAllContacts=function(){return n.getContacts()},t.getCategories=function(){return n.getCategories()},t.getContactsClone=function(e){var r={},i,s,o,u;if(e){i=n.getContactsByBucket(0,n.getContactOrder().length,e).contacts,o=i.length;while(o--)r[i[o].id]=i[o]}else{s=t.getContacts();for(u in s)r[u]=s[u]}return r},t.getFlatContacts=function(){var e=t.getContacts(),n=[],r,i,s;for(i in e)if(e.hasOwnProperty(i)){r=t.getBasicFlatContacts(e[i]);for(s in r)r.hasOwnProperty(s)&&n.push(r[s])}return n},t.getFieldsByType=function(e,t){var r=e[t];return r=r&&!Array.isArray(r)?[r]:r,n.getContactsData()[e.id].typedFields[t]||r},t.getFieldValues=function(r,i,s){var o,u,a;if(!r||!i)return null;if(s){u=t.getFieldsByType(r,i);if(u){o=[];for(a in u)u.hasOwnProperty(a)&&e.Array.indexOf(a.flags,s)&&o.push(a.value)}return o}return n.getContactsData()[r.id].typedFieldValues[i]},t.getShownContactName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i){i=i.familyName+" "+i.givenName;if(s(i))return i}}return o||u},t.getName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i&&i.givenName){i=i.givenName;if(s(i))return i}else if(i&&i.familyName){i=i.familyName;if(s(i))return i}return o}},t.getFirstFieldValue=function(e,n,r){return!e||!n?null:(t.getFieldValues(e,n,r)||[])[0]},t.getHigherPrecedenceFieldByType=function(e,n){function r(e,t){return e.id-t.id}if(!e)return null;var i=t.getFieldsByType(e,n)||[];return i.sort(r)[0]?i.sort(r)[0].value:null},t.getBasicFlatContacts=function(e){var r=n.getContactsData()[e.id].flatContacts,i,s,o,u;if(!r){r=[],s=t.getFieldsByType(e,"email")||[],i=t.getHigherPrecedenceFieldByType(e,"name")||{},o=s.length&&s[0]||{value:""};for(u in s)s.hasOwnProperty(u)&&r.push({firstname:i.givenName,lastname:i.familyName,middlename:i.middleName,nickname:t.getFirstFieldValue(e,"nickname"),image:t.getFirstFieldValue(e,"image"),email:s[u].value,emailField:s[u],id:e.id,isPrimary:s[u].value===o.value});n.getContactsData()[e.id].flatContacts=r}return r},t.getContactImage=function(e){var r=n.getContactsData()[e.id].image,i;return r||(i=t.getFirstFieldValue(e,"guid"),i&&(r=i.image),n.getContactsData()[e.id].image=r),r},t.getSortedFlatContacts=function(e){return t.sortFlatContacts(t.getFlatContacts(),e)},t.sortFlatContacts=function(e,t){function r(e){var t=0,n,r=e.matches,i;if(r)for(n in r)r[n].length===1&&(i=r[n][0],i.endIndex-i.startIndex===e[n].length&&t++);return t}function i(e,t,n){var r=e[n],i=t[n];return r&&i?r===i?null:r<i?-1:1:!r&&!i?null:r?-1:1}function s(e,t){var r,s;for(s in n)if(n.hasOwnProperty(s)){r=i(e,t,n[s]);if(r)return r}return 0}var n=t||["firstname","lastname","email"];return e.sort(s),e},t.getContactsCacheBucket=function(e,t,r){return n.getContactsByBucket(e,t,r)},t.getContactOrder=function(){return n.getContactOrder()},t.loadSortPrefs=function(e,t){n.loadSortPrefs(e,t)},t.getSortPrefs=function(){return n.getSortPrefs()},t.getSortedContacts=function(){var e=t.getContacts(),n=t.getContactOrder(),r=n.length,i=[],s;for(s=0;s<r;s++)i.push(e[n[s]]);return i},t.getTotalContacts=function(){return n.getContactOrder().length}};t.utils=new r},"1.0.0",{requires:["contacts-api-cache","common-utils-stats"]});
YUI.add("contacts-api-urigenerator",function(e){"use strict";function b(e,t,n){var r=e.split(" "),i,s="",o=r.length;while(o--)i=r[o],i&&(s&&(s+=";"),s+=p.replace("{field}",t).replace("{condition}",n).replace("{query}",encodeURIComponent(i.replace(/,/g,"\\,"))));return s}function w(t,n){var i={id:t.id,op:"update",fields:[],categories:[]},s=i.fields,o=t.fields||[],u=n.fields||[],a={},f,l,c,h,p;t=e.clone(t,!0),n=e.clone(n,!0),p=o.length;while(p--)a[parseInt(o[p].id,10)]=o[p];p=u.length;while(p--){c=u[p],f=parseInt(c.id,10),h=c.categories,l=a[f];if(!l)s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h);else{if(c.type!==l.type||!r.congruent(c.value,l.value,!1)||!r.congruent(c.flags,l.flags,!1)||!r.congruent(h,l.categories,!1))c.type==="yahooid"&&!r.congruent(h,l.categories,!1)?(s.push({op:"remove",id:l.id}),s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[],categories:h})):c.type!=="Image"&&(s.push({op:"update",id:f,value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h));delete a[f]}}for(p in a)a.hasOwnProperty(p)&&s.push({op:"remove",id:p});return i}function E(e,t){e=e||[],t=t||[];var n=[],r={},i,s,o,u;u=e.length;while(u--)r[parseInt(e[u].id,10)]=e[u];u=t.length;while(u--)i=t[u],o=i.id,s=r[o],s?delete r[o]:n.push({op:"addTo",id:o});for(u in r)r.hasOwnProperty(u)&&n.push({op:"removeFrom",id:e[u].id});return n}function S(t){var n=S.METHODS;t.path=t.wspath||"ws/sd",t.baseHost=t.baseHost||e.config.win.location.host,this.params=undefined,this.method="GET",this.rev=t.rev,this.uri=g,this.guid=t.guid,this.ymreqid=this.getYmReqId();if(!t.prefs&&!t.contactImport)switch(t.type){case n.SAVE:this.uri+=f;break;case n.REMOVE_FIELD:this.uri+=h.replace("{cid}",t.contactId);break;case n.DELETE:this.uri+=l;break;default:this.uri+=t.singleContact?h.replace("{cid}",t.id):a}else this.uri+=t.singleContact?c.replace("{guid}",t.guid).replace("{cid}",t.id):u.replace("{guid}",t.guid),t.prefs&&(this.uri+="/preferences;"),t.contactImport&&(this.uri+="/import");t.wssid=t.wssid||NeoConfig.wssid,this.init(t)}var t=e.contacts,n=t.utils,r=e.common.Utils,i=e.contacts.config,s=e.common.net.Session,o=e.Lang,u="v1/user/{guid}/contacts",a="v2/contacts/",f="v2/contact/",l="v2/contacts/trash/",c="v1/user/{guid}/contact/{cid}",h="v2/contact/{cid}",p="{field}.{condition}={query}",d="NO_YMREQID_LOADED",v={asc:1,desc:2,1:1,2:2},m={first:-10001,last:-10003,email:4,"-10001":"first","-10003":"last",4:"email",1:-10001,3:-10003,6:4},g=r.settings.value("contactProgrssURL"),y=r.getMailBoxQueryParams("array");r.features.enabled("contactsUE")?g=r.settings.value("unifiedEdgeURL")+r.settings.value("contactsUEPath")+"/":g=r.settings.value("contactProgrssURL"),S.prototype={init:function(e){var t=S.METHODS,n=e.type||t.DEFAULT;this.method="POST",e.contacts&&(e.contacts=this.getFormatedContacts(e.contacts));switch(n){case t.SAVE:this.setPOSTParams(e),this.setPOSTUri(e);break;case t.DELETE:this.setDeleteParams(e),this.setPOSTUri(e);break;case t.REMOVE_FIELD:this.setRemoveFieldParams(e);if(e.type===t.DELETE)break;this.setPOSTUri(e);break;case t.SAVE_PREFS:this.method="POST",this.setPOSTPrefsParams(e),this.setPOSTUri(e);break;case t.IMPORT_CONTACT:this.method="POST",this.setPOSTImportParams(e),this.setPOSTUri(e);break;default:this.method="GET",this.setGETUri(e)}},getYmReqId:function(){return s.genReqID?s.genReqID():d},getFormatedContacts:function(e){var t=[],n={},r,i,s,o,u;for(s in e){r=e[s];if(r.fields)for(i in r.fields)o=r.fields[i],o.type&&(o.type==="yahooid"&&!o.flags&&(o.flags=["YID"]),u=this.getFieldType(o.type),this.getFormatedContact(n,u,o));typeof r.categories=="object"&&(n.categories=r.categories),r.id&&(n.id=r.id),t.push(n)}return t},getFormatedContact:function(e,t,n){switch(t){case"emails":case"phones":case"messengers":case"links":case"addresses":e[t]=e[t]?e[t]:[],e[t].push(this.getFormatedField(t,n));break;default:e[t]=this.getFormatedField(t,n)}},getFieldType:function(e){switch(e){case"email":e="emails";break;case"yahooid":case"otherid":e="messengers";break;case"phone":e="phones"}return e},getFormatedField:function(e,t){var n={};switch(e){case"emails":case"phones":case"messengers":case"links":n.ep=t.value,t.flags&&(n.flags=t.flags),t.id&&(n.id=t.id);break;default:n=t.value}return n},getURI:function(){return this.uri},getMethod:function(){return this.method},setMethod:function(e){this.method=e},getHeaders:function(){return{"Content-Type":"text/plain; chaset=utf-8"}},setHeaders:function(e){this.headers=e},getParams:function(){return this.params},stripContact:function(e){e._data&&(e._data=undefined)},setPOSTImportParams:function(e){var t=e.contactImport;this.params={},t&&(this.params=t)},setPOSTPrefsParams:function(e){var t=e.prefs,n={},r=t.sort_order,i=t.sort_field;this.params={},t&&(r&&(n.sort_order=v[r]),i&&(n.sort_type=m[i]),this.params.preferences=n)},setPOSTParams:function(e){var t={};this.params={},e.contacts&&o.isArray(e.contacts)&&!o.isUndefined(e.contacts[0])&&(t=e.contacts[0]),this.stripContact(t),this.params=t},setPOSTUri:function(e,t){this.uri+=t===!0?"/sync?format=json":"?format=json",this.uri+="&custId=ymail&wssid="+e.wssid+"&ymreqid="+this.ymreqid+"&"+y.join("&")},setCreateListParams:function(e){var t=e.newContacts,n=e.updateContacts,r={name:e.category,op:"add",refid:"01"},i=[{refid:"01",op:"addTo"}],s={rev:this.rev,categories:[],contacts:[]},o,u,a;s.categories.push(r),a=t.length;while(a--)o=t[a],u={op:"add",fields:[{value:{givenName:o.name},type:"name",op:"add"},{value:o.email,type:"email",op:"add"}],categories:i},s.contacts.push(u);a=n.length;while(a--)u={id:n[a].id,op:"update",categories:i},s.contacts.push(u);this.params={contactsync:s}},setPUTParams:function(t){var r=t.contacts||[],i=t.categories||[],s=[],u=[],a,f,l,c,h,p,d,v;this.params={contactsync:{rev:this.rev}},d=r.length;if(d>0){while(d--){a=e.clone(r[d]);if(o.isValue(a.id)){if(!a.op||a.op!=="remove")f=n.getContactById(a.id),c=a.categories,l=f.categories,a=w(f,a),a.categories=E(l,c)}else{a.op="add"
,p=a.fields||[],v=p.length;while(v--)p[v].op="add";p=a.categories||[],v=p.length;while(v--)p[v]={op:"addTo",id:p[v].id};this.stripContact(a)}s.push(a)}this.params.contactsync.contacts=s}d=i.length;if(d>0){while(d--){h=e.clone(i[d]);if(o.isValue(h.id))throw new Error("category modification not yet implemented");h.op="add",h.contacts=n.getContactsByIds(h.contacts),u.push(h)}this.params.contactsync.categories=u}},setPUTUri:function(e){this.setPOSTUri(e,!0)},updateWSSID:function(t){var n,r=this.uri.split("?"),i=r[0],s=r.slice(1).join("?");NeoConfig.wssid=t,n=e.QueryString.parse(s),n.wssid=NeoConfig.wssid,this.uri=i+"?"+e.QueryString.stringify(n)},setGETUri:function(e){var t,n=e.fields,r,i=this.uri;if(n)for(r in n)n.hasOwnProperty(r)&&(t=n[r],t.name&&t.condition&&t.value&&(i+=";"+t.name+"."+t.condition+"="+t.value));if(e.prefs||e.contactImport)e.searchQuery&&e.searchField&&e.searchCondition&&(i+=";"+b(e.searchQuery,e.searchField,e.searchCondition)),e.count&&(i+=";count="+e.count),e.out&&(i+=";out="+e.out),e.start&&(i+=";start="+e.start),e.sortfields&&!e.sortByBest&&(i+=";sort-fields="+e.sortfields),e.sort&&!e.sortByBest&&(i+=";sort="+e.sort);i+="?format=json",e.view&&(o.isArray(e.view)?i+="&view="+e.view.join("&view="):i+="&view="+e.view),o.isValue(e.rev)&&(i+="&rev="+e.rev),e.id&&(i+="&id="+e.id),e.sortByBest&&(i+="&sortBy=best"),!e.prefs&&!e.contactImport&&(e.count&&(i+="&count="+e.count),e.start&&(i+="&start="+e.start)),i+="&custId=ymail&wssid="+e.wssid+"&ymreqid="+this.ymreqid+"&"+y.join("&"),this.uri=i},setCategoriesParams:function(e){var t=e.categories||[],n={rev:this.rev,categories:[],contacts:[]},r=[],i={},s,o=t.length;while(o--)s=t[o],s.id?s.op==="remove"?i=s:i={op:"update","new":{name:s.name},old:{id:s.id}}:i={op:"add",name:s.name},r.push(i);n.categories=r,this.params={contactsync:n}},setUpdateCategoriesParams:function(t){var n=t.categories.addTo||[],r=n.length,i=t.categories.removeFrom||[],s=i.length,o=t.contacts,u=o.length,a=[],f=[],l=[],c=1,h={rev:this.rev,categories:[],contacts:[]},p,d;p=r;while(p--)d=n[p],e.Lang.isNumber(d)?f.push({id:n[p],op:"addTo"}):(l.push({name:d,op:"add",refid:c}),f.push({refid:c,op:"addTo"}),c++);p=s;while(p--)f.push({id:i[p],op:"removeFrom"});p=u;while(p--)a.push({id:o[p],op:"update",categories:f});h.contacts=a,h.categories=l,this.params={contactsync:h}},setRemoveFieldParams:function(e){var t=this,r=!1,s=e.fieldId,o=e.contactId,u=n.getContactById(o),a=i.get("minimumFields"),f={id:o},c,p,d,v,m,g,y;u=t.getFormatedContacts([u]),c=u[0];for(m in c){d=c[m];if(m==="fields"||m==="id")continue;if(Array.isArray(d)){v=f[m]=[];for(g=0,y=d.length;g<y;g++){p=d[g];if(!p.id||p.id!==s)v.push(p),a.indexOf(m)>-1&&(r=!0)}}else typeof d=="object"&&(!d.id||d.id!==s)&&(f[m]=d,a.indexOf(m)>-1&&(r=!0))}f.id=c.id;if(!r){e.type=S.METHODS.DELETE,t.uri=t.uri.replace(h.replace("{cid}",e.contactId),l),t.init(e);return}t.params=f},setDeleteParams:function(e){var t=this,n=e.contacts,r=e.contactId,i=[],s,o;r&&i.push(r);for(o in n)s=n[o],s.id&&i.push(s.id);t.params={ids:i}}},S.METHODS={DEFAULT:0,GETCONTACTS:1,SAVE:2,DELETE:3,SAVE_CATEGORIES:4,DELETE_CATEGORIES:5,SAVE_PREFS:6,UPDATE_CONTACTS_CATEGORIES:7,REMOVE_FIELD:8,IMPORT_CONTACT:9},e.namespace("contacts"),t.URIGenerator=S},"1.0.0",{requires:["contacts-api-config","contacts-api-utils","mail-common-utils-settings","common-net-session","mail-common-utils-features"]});
YUI.add("contacts-api-io",function(e){"use strict";function i(e,t){return function(n,r){var i={};return r&&(i=e.parseJSON(r,e,t)),i==={}||i.error||!e.isSuccess(r.status)?e.failure(i,r,t):e.success(i,r,t)}}function s(e){this.io=null,this.maxRetries=2,this.retryCount=0,this.uriGenerator=t.URIGenerator,this.onSuccess=function(){},this.onFailure=function(){},this.hook=e}e.namespace("contacts");var t=e.contacts,n=e.Lang,r=e.JSON;s.prototype={parseJSON:function(t,n,r){var i=e.common.Utils.json,s;return typeof t.responseText=="string"&&t.responseText!==""?s=i.tryParse(t.responseText,function(t,i){e.fire("SplunkLog","contacts_jsonparse_error",{errorMessage:i.message,requestParams:r,responseText:t,uri:n.uriGenerator.getURI()},NeoConfig.isCorpmail?"critical":"sample")}):e.fire("SplunkLog","contacts_jsonparse_error",{errorMessage:"Contacts API returned empty or unrecognized response",requestParams:r,responseText:t,uri:n.uriGenerator.getURI()},NeoConfig.isCorpmail?"critical":"sample"),s?(s.status=t.status,s.statusText=t.statusText,s):{}},isSuccess:function(e){switch(e){case 200:case 201:case 202:case 204:return!0}return!1},doRetry:function(e){switch(e.status){case 500:return!0;case 401:if(e.getResponseHeader("WSSIdReissue"))return this.uriGenerator.updateWSSID(e.getResponseHeader("WSSIdReissue")),!0}return!1},success:function(e,t,n){this.onSuccess(e,t,n),this.retryCount=0},failure:function(t,r,i){var s=t.error&&t.error.detail&&(t.error.detail.match?t.error.detail.match(/-\d+/):null);if(("-50304"===s||!r||this.doRetry(r))&&this.retryCount<this.maxRetries)return this.retryCount+=1,e.later(100,this,function(){this.send(i)});this.retryCount=0,t.errorCode=!n.isUndefined(s)&&!n.isNull(s)?s:"-99999",this.onFailure(t,r,i)},send:function(t){var n=i(this,t),s=this,o=this.uriGenerator.getURI(),u=this.uriGenerator.getMethod(),a={data:r.stringify(this.uriGenerator.getParams()),on:{success:n,failure:n},headers:this.uriGenerator.getHeaders(),method:u==="PUT"?"POST":u,xdr:{use:"native",credentials:!0},suppressWssid:o.match("&wssid=")!==null};s.io=e.io(o,a)},abort:function(){return this.io&&typeof this.io.abort=="function"?(this.io.abort(),!0):!1}},t.sendRequest=function(e,t,n,r,i){var o=new s(r,i);return t&&(o.onSuccess=t),n&&(o.onFailure=n),e&&(o.uriGenerator=e),o.send(),o},t.Request=s},"1.0.0",{requires:["contacts-api-urigenerator","common-utils-jsonparse","json"]});
YUI.add("contacts-api-adapter",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.URIGenerator,r=t.cache,i=e.Lang,s="CONTACTS",o,u;e.common&&e.common.Utils&&(o=e.common.Utils,u=new o.Stopwatch("ContactsRequest")),t.APIAdapter={},function(){function a(e,t,s,o,f,l){function d(n){s.push(n.contact||n);if(e.length===0){var u=r.update(s);f&&i.isFunction(f)&&f(u)}else a(e,t,s,o,f,l)}function v(n){if(e.length===0&&s.length>0)r.update(s);else if(e.length>0){a(e,t,s,o,f,l);return}l&&i.isFunction(l)&&l(n)}var c=t.requestFn||null,h,p={baseHost:t.baseHost,uri:t.uri,headers:t.headers,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,wssid:t.wssid};o?p.contacts=o:p.contacts=[e.shift()],h=new n(p),u(h,d,v,c,{contact:p.contacts})}function f(e,t,s,o){function c(e){var t=r.update(e);s&&i.isFunction(s)&&s(t,e)}function h(e){o&&i.isFunction(o)&&o(e)}var a=t.requestFn||null,f,l={baseHost:t.baseHost,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,uri:t.uri,headers:t.headers,rev:r.getCurrentRevision(),wssid:t.wssid};i.isArray(e)||(e=[e]),l.contacts=e,f=new n(l),u(f,c,h,a)}var s=this,o=!1,u=t.sendRequest;s.getContact=function(s,o,a,f){function v(e){o&&i.isFunction(o)&&o(e)}function m(e){a&&i.isFunction(a)&&a(e)}var l,c,h,p,d;if(r.isLoaded()&&!f){l=r.getContacts()[s],l&&o&&i.isFunction(o)&&o({contact:l});return}c=t.config.getAttrs(),h=c.requestFn||null,p={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,fields:c.fields,wspath:c.wspath,view:c.view,rev:c.rev,singleContact:!0,id:s},d=new n(p),u(d,v,m,h)},s.getContacts=function(s,a,f,l){function v(t){var n,r,i="NA";t&&(n=t.getResponseHeader("X-Yahoo-Social-Host")||t.getResponseHeader("x-yahoo-social-host"),n&&(r=n.match(/\.([^\.]+)\.yahoo.com$/i),r[1]&&(i=r[1]))),NeoConfig.ABOriginColo=i,e.fire("contacts:api:origincolo",{ABOriginColo:i})}function m(e,t){var n=t.responseHeaders,s;n&&(s=n["X-Yahoo-Social-ContactsRev"]||n["X-Yahoo-Social-Contactsrev"]||n["x-yahoo-social-contactsrev"],s&&r.setCurrentRevision(parseInt(s,10))),r.load(e),v(t),a&&i.isFunction(a)&&a(r.getContacts()),o=!1}function g(e,t){o=!1,v(t),f&&i.isFunction(f)&&f(e)}if(r.isLoaded()&&!s){a&&i.isFunction(a)&&a(r.getContacts());return}var c=t.config.getAttrs(),h=c.requestFn||null,p,d={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,sortByBest:!!l,fields:c.fields,wspath:c.wspath,view:c.view};o&&a&&i.isFunction(a)?e.once("contacts:api:loaded",function(){a(r.getContacts())}):(o=!0,p=new n(d),u(p,m,g,h))},s.createList=function(e,s,o,a,f){function d(e){var t=r.update(e);a&&i.isFunction(a)&&a(t,e)}function v(e){f&&i.isFunction(f)&&f(e)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,uri:l.uri,headers:l.headers,guid:l.guid,type:n.METHODS.SAVE,wspath:l.wspath,wssid:l.wssid,rev:r.getCurrentRevision(),newContacts:e,updateContacts:s,category:o,isCreateList:!0},p=new n(h);p.setMethod("PUT"),u(p,d,v,c)},s.deleteContacts=function(e,s,o){function d(e){o&&i.isFunction(o)&&o(e)}function v(e){var t,n,o,u;if(e.status===202){t=e.syncresult.results,n=t.contacts,o=n.length;while(o--)if(n[o].error){e.errorCode=n[o].error,d(!1,e);return}}u=r.update(e),s&&i.isFunction(s)&&s(u,e)}var a=t.config.getAttrs(),f=a.requestFn||null,l=[],c=e&&i.isArray(e)?e.length:0,h={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid},p;while(c--)l.push({id:e[c],op:"remove"});h.contacts=l,p=new n(h),u(p,v,d,f)},this.getPreferences=function(e,s){function c(e){s&&i.isFunction(s)&&s(e)}function h(t,n,r){var s=t.preferences||"";e&&i.isFunction(e)&&e(s)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,wspath:o.wspath,uri:o.uri,headers:o.headers,rev:r.getCurrentRevision(),wssid:o.wssid,prefs:!0},l;l=new n(f),u(l,h,c,a)},this.importContact=function(e,s,o){function h(e){o&&i.isFunction(o)&&o(e)}function p(e,t,n){var r=e.preferences||"";s&&i.isFunction(s)&&s(r)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid,type:n.METHODS.IMPORT_CONTACT,contactImport:e.contactImport},c;c=new n(l),u(c,p,h,f)},this.saveContacts=function(e,n,s){var o=t.config.getAttrs(),u=r.getCurrentRevision();u>0||!i.isArray(e)||e.length===1?f(e,o,n,s):a(e,o,[],n,s)},this.getContactsTinyUserCard=function(s,o,a){function p(e){var t=r.loadTinyUserCard(e)[0];o&&i.isFunction(o)&&o(t)}function d(e){a&&i.isFunction(a)&&a(e)}var f=t.config.getAttrs(),l=f.requestFn||null,c={baseHost:f.baseHost||e.config.win.location.host,uri:f.uri,headers:f.headers,guid:f.guid,wssid:f.wssid,type:n.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:s}],wspath:f.wspath,view:"tinyusercard"},h=new n(c);u(h,p,d,l)},this.saveCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n,o;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}o=e.syncresult.diff,r.updateCategories(e),s&&i.isFunction(s)&&s(o,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),categories:[e],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.deleteCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}r.updateCategories(e),s&&i.isFunction(s)&&s(e.syncresult.diff,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:
a.headers,rev:r.getCurrentRevision(),categories:[{id:e,op:"remove"}],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.updateContactsCategories=function(e,s,o,a,f){function d(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,v(!1,e);return}}r.updateCategories(e),a&&i.isFunction(a)&&a(e.syncresult.diff,e)}function v(e,t){f&&i.isFunction(f)&&f(t)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,guid:l.guid,type:n.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:l.wspath,uri:l.uri,headers:l.headers,rev:r.getCurrentRevision(),categories:{addTo:s,removeFrom:o},contacts:e,wssid:l.wssid},p=new n(h);u(p,d,v,c)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.setSortField=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_field:e}},c=new n(l);u(c,h,p,f)},this.restoreObject=function(e,n,i){var s=t.config.getAttrs(),o=r.getUpdatedContacts()[e];o&&f(o,s,n,i)},this.setSortOrder=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_order:e}},c=new n(l);u(c,h,p,f)},this.getSortPrefs=function(s,o){function h(e){var t=e.preferences;t&&t.sort_order&&t.sort_type&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}if(r.getSortPrefs()){s&&i.isFunction(s)&&s(r.getSortPrefs());return}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost||e.config.win.location.host,uri:a.uri,headers:a.headers,guid:a.guid,wssid:a.wssid,type:n.METHODS.DEFAULT,wspath:a.wspath,prefs:!0},c=new n(l);u(c,h,p,f)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.searchContacts=function(e,r,s){function c(e){var t=e.contacts.contact||[];r&&i.isFunction(r)&&r(t)}function h(e){s&&i.isFunction(s)&&s(e)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,type:n.METHODS.GETCONTACTS,wspath:o.wspath,uri:o.uri,headers:o.headers,wssid:o.wssid,out:o.out,fields:o.fields,search:o.search,searchField:"all",searchCondition:"contains",searchQuery:e},l=new n(f);u(l,c,h,a)},this.createEmptyContact=function(){return{fields:[],categories:[]}}}.apply(t.APIAdapter)},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils"]});
YUI.add("contacts-api",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.APIAdapter,r=t.cache,i=function(){var t=this;this.load=function(e,t,r){n.getContacts(e,t,r)},this.saveContacts=function(e,t,r){n.saveContacts(e,t,r)},this.deleteContacts=function(e,t,r){n.deleteContacts(e,t,r)},this.getPreferences=function(e,t){n.getPreferences(e,t)},this.importContact=function(e,t,r){n.importContact(e,t,r)},this.saveCategory=function(e,t,r){n.saveCategory(e,t,r)},this.deleteCategory=function(e,t,r){n.deleteCategory(e,t,r)},this.createList=function(e,t,r,i,s){n.createList(e,t,r,i,s)},this.getContacts=function(e,t,r,i){if(typeof e!="boolean")return;n.getContacts(e,t,r,i)},this.getContact=function(e,t,r,i){n.getContact(e,t,r,i)},this.createEmptyContact=function(e,t){return n.createEmptyContact(e,t)},this.getContactImage=function(e,t,r){n.getContactsTinyUserCard(e,t,r)},this.searchContacts=function(e,t,r){n.searchContacts(e,t,r)},e.on("contacts:contactChanged",function(){t.load(1)}),this.setSortOrder=function(e,t,r){n.setSortOrder(e,t,r)},this.setSortField=function(e,t,r){n.setSortField(e,t,r)},this.getSortPrefs=function(e,t){n.getSortPrefs(e,t)},this.updateContactsCategories=function(e,t,r,i,s){n.updateContactsCategories(e,t,r,i,s)},this.removeEmail=function(e,t,i,s){r.setUpdatedContacts(e),n.removeField(e,t,i,s)},this.restoreEmail=function(e,t,r){n.restoreObject(e,t,r)},this.removeEmail=function(t,i,s){r.setUpdatedContacts(t),r.removeField(t,i);var o=e.contacts.utils.getContactById(t);n.removeField(t,i),s&&s()}};t.api=new i},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});
YUI.add("mail-ui-convpane-bind",function(D){D.namespace("mail.ui");var A=D.mail.ui._ConvPane,C=A.prototype;var B=function(F,E){var G=this;D.use("mail-ui-proxyevents",function(){D.mail.ui.MailEventsProxy.handleUI({action:E},G.getMsgFid(F),null,[F]);});};C.handleUI=B;},"1.0.0");YUI.add("mail-ui-mailpane-read",function(e){function a(e,t,n){var r=this,i,s;n=n||r.message,s={fid:r.fid,mid:n.mid,pid:e},i=n.nonImgAttachments;for(var o=0;o<i.length;o++){var u=i[o];(u.type==="message"||u.type==="text")&&u.partId===e&&(s.filename=u.filename)}typeof t!="undefined"&&t!==""&&t!=="null"&&(s.tnefid=t),l([s])}function f(e,t,n){var r=this,i,s=[],o,u;n=n||r.message,o={image:n.imgAttachments,"non-image":n.nonImgAttachments,all:n.attachments},u=o[e]||[];for(var a=0;a<u.length;a++){var f=u[a],c={fid:r.fid,mid:n.mid,pid:f.partId},h=f.tnefId;if(f.type==="message"||f.type==="text")c.filename=f.filename;typeof h!="undefined"&&(c.tnefid=h),s.push(c)}t&&t.target&&(t.target.get("nodeName")==="A"?i={restoreFocusNode:t.target}:i={restoreFocusNode:t.target.ancestor("A")}),s.length&&l(s,i)}function l(n,r){e.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){t.common.downloader.render(n,r)})}function c(){e.fire("openOptions",{view:"security"})}function h(n,r,i){var s=this,o,u;i=i||s.fid,r=r||s.message;if(r&&!s.loading_slow&&!s.loading_error&&!s.loading_moved&&!r.flags.isRead){o=e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(o!=="999")return o=o?parseInt(o,10)*1e3:750,isNaN(o)&&(o=750),u=o===0,NeoConfig.yodaUpdateEnabled?NeoConfig.loadYodaController.then(function(){s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){e.mail.controller.v3.api.flagMessagesWithMid({messages:r,sourceFid:i,flags:{read:1},showTAE:!1,statTAE:!1})},o),n&&n(null)}):e.use("mail-controller-messages-ops",function(){var e=function(){var e=t.Controller.batch();return e.Messages.flag({fid:i,mid:r,setFlags:{read:1},enableRetry:!0},{suppressCodes:["*"]}),e};u||(s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){var t=e&&e();t&&t.execute()},o)),n&&n(u?e:null)}),!0}return!1}function p(t,n){var r={metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey};e.UA.ie>=12?window.open("/neo/rd?url="+window.encodeURIComponent(t.get("href"))+"&ncrumb="+NeoConfig.ncrumb):t.simulate("click",r)}function d(t){var n=t.target,r=n.get("parentNode"),i=null;n.hasAttribute("ymailto")?i=n.getAttribute("ymailto"):r.hasAttribute("ymailto")&&(i=r.getAttribute("ymailto")),i&&i.length>0&&(t.preventDefault(),e.use("mail-ui-shortcuts",function(e){e.mail.ui.ShortCuts.composeMailToMessage(i)})),NeoConfig.isWinApp||(n.test("a[rel=nofollow]")?(n.setAttribute("rel","noreferrer"),t.preventDefault(),p(n,t)):r.test("a[rel=nofollow]")&&(r.setAttribute("rel","noreferrer"),t.preventDefault(),p(r,t)))}e.namespace("mail.ui");var t=e.mail,n=e.common.Utils,r=n.settings.value("messageReadAdRotationInterval")||3e4,i=n.settings.value("messageReadAdRotationIdleInterval")||3e5,s=function(){},o=function(){var t=this;t.cancelAdRotationTimer(),t.lastActivityTime=Date.now(),t.adRotationTimer=e.later(r,t,function(){var n=Date.now();n>t.lastActivityTime+i?t.cancelAdRotationTimer():e.fire("darlaEvent",{action:t.fullView?"message_tabpane_timed_ad":"msgread_reading_pane_timed_ad"})},null,!0)},u=function(){var e=this;e.adRotationTimer&&(e.adRotationTimer.cancel(),e.adRotationTimer=null)};e.mix(s.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:a,downloadAllAttachments:f,loadOptions:c,markAsRead:h,handleBodyLinkClick:d,startAdRotationTimer:o,cancelAdRotationTimer:u}),e.mail.ui.MailPaneRead=s},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});
YUI.add("mail-ui-messagepane-warnings",function(e){function r(e,r){var i=window.confirm(t([n.str_warning_msg_read_form_part1,n.str_warning_msg_read_form_part2].join("  "),n));return i&&e.submit(),r&&typeof r=="function"&&r(i),!1}function i(e){return e.rel==="nofollow"?!0:strings.str_cfg_tog_exlink_alert_page?(window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(e),"new"),!1):(window.confirm(t([n.str_warning_msg_read_link_part1,n.str_warning_msg_read_link_part2,n.str_warning_msg_read_link_part3].join("  "),n))&&window.open(e.href),!1)}function s(e){e.warningShown||(window.alert(t([n.str_warning_msg_read_password_part1,n.str_warning_msg_read_password_part2].join("  "),n)),e.warningShown=1)}e.namespace("mail.ui");var t=e.common.Utils.substitute,n=strings;e.mail.ui.Warnings={showFormWarning:r,showLinkWarning:i,showPasswordWarning:s},window.theMainWindow=e.mail.ui.Warnings},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-deeplink-manager",function(e){function t(e){var t=["import_contacts","launch_compose","valentine"],r=t.map(function(e){return'[name="deeplink_'+e+'"]'}).join(",");return e.all(r).on("click",function(e){var t=e.currentTarget.get("name").replace("deeplink_","");e.halt(!0),n(t)})}function n(t){var n;NeoConfig.mrd=NeoConfig.mrd||{},NeoConfig.mrd.param=NeoConfig.mrd.param||{},t!=="valentine"&&(n=function(){e.fire("util:ymstats",{name:"deeplink",tags:{deeplinkActions:t}})});switch(t){case"launch_compose":e.fire("newMessage",{cbfn:n});break;case"import_contacts":e.fire("ws:onboarding",{type:"deeplink_import_contact",cbfn:n});break;case"valentine":n=function(){e.fire("util:ymstats",{name:"compose_valentine_autocompose",tags:{source:"deeplink"}})},e.fire("newMessage",{flavor:"autocompose",cbfn:n});break;default:}}e.namespace("mail.ui.deeplink"),e.mail.ui.deeplink.manager={attachEvents:t}},"0.1");
YUI.add("mail-ui-convpane-read",function(e){function tt(t,n){var r=[];return e.Array.each(t.slice(n,t.length),function(e){r.push(e.email)}),r.join(",")}function nt(e){var t={to:p.getName(e),rcpt_id:p.getAddress(e),rcpt_name:p.getName(e)};return t}function rt(e,t,n,i){var s=e&&e.header,o=f.recipient_list,u=f.more_recipients_str,a=f.hide_recipients_str,l="",c=["to","cc","bcc"],h,d,v,m,g,y,b;i=i||[];if(s){for(d=0;d<c.length;d++)v=c[d],b=s[v]||[],h=f[v+"_group"],g=i[v]||!1,y=g?"":n+1===b.length?b.length:n,b.length&&(m={recipients_built:p.createRecipientList(b,o,t,y,nt,""),hide:z&&g&&(!y||b.length>parseInt(y,10))?r(a,{data_field:v},0,0,strings):"",more_built:!g&&b.length>parseInt(y,10)?r(u,{num_more_recipients:b.length-y,data_address:tt(b,y),data_field:v},0,0,strings):""},l+=r(h,m,null,null,strings));return l}}function it(){e.fire("recalculateScrollToRepositionSend")}function st(e){var t=this,n=e.srvmap,r,i,s="";if(!n){i=t.inboxservices||[],e.srvmap=n={};for(r=i.length-1;r>=0;r--)n[i[r].name]=i[r].value}return!strings.str_cfg_tog_certified_icon&&n.crt&&delete n.crt,(I||!n.crt)&&(n[F]||n.siu||t.msgicon)&&(n&&n[F]?s=q[n[F]]||"":t.msgicon&&(s=t.msgicon)),NeoConfig.isSSL&&s==="certified"&&(s="certified-ssl"),!s&&_&&_[n.verifieddomain]&&(s=_[n.verifieddomain]),n.inboxService=s,s}function ot(t){var o=this,a=t.message,l=t.expand,c=o.message,h=a.flags.hasAttachment,d,v=o.getMsgFid(a),m=$.isDraftFid(v)?!0:!1;if(!a)return;if(!a.header)return;return d={from:function(){var e=a.header.from;if(e){var t={from_name:p.getName(e),from_id:p.getAddress(e),sender_email_address:p.displaySenderAddress(e)};return r(f.from,t,null,null,strings)}},super_collapsed:function(){return t.supercollapsed?f.super_collapsed:""},isFlagged:function(){return a.flags.isFlagged?f.isFlagged:""},isFlagged1:function(){return a.flags.isFlagged?r(f.isFlagged1,null,null,null,strings):""},isFlagged2:function(){return a.flags.isFlagged?r(f.isFlagged2,null,null,null,strings):""},isFlagged_else:function(){return a.flags.isFlagged?"":r(f.isFlagged_else,null,null,null,strings)},isFlagged_else1:function(){return a.flags.isFlagged?"":r(f.isFlagged_else1,null,null,null,strings)},isUnread:function(){return a.flags.isRead?"":f.isUnread},snippet:function(){var t;return typeof a.snippet=="string"?t=a.snippet:a.header&&typeof a.header.snippet=="string"?t=a.header.snippet:t="",s(u(e.Lang.trim(t)))},expanded:function(){return l?f.expanded:""},ariaExpanded:function(){return l?"true":"false"},expanded_else:function(){return l?"":f.expanded_else},date:function(){var e=a.header.receivedDate*1e3;return!e&&o.getMsgFid(a)==="Sent"&&(e=a.header&&a.header.sentDate*1e3),n.dateFormatter(new Date(e),Neo.getDateFormat(e,!1,!0))},received_date:function(){return a.header.receivedDate?n.dateFormatter(new Date(a.header.receivedDate*1e3),strings.str_tog_dateformat_header_long_l10n):""},hasAttachmentDownload:function(){return h?r(f.hasAttachmentDownload):""},thread_reply:function(){return r(f.thread_reply,null,d,null,strings)},mid:function(){return y(a.mid)||""},hasDraft:function(){return m?r(f.hasDraft,null,null,null,strings):""},hasDraft1:function(){return m?r(f.hasDraft1,null,null,null,strings):""},hasDraft2:function(){return m?r(f.hasDraft2,null,null,null,strings):""},hasDraft_else:function(){return m?"":r(f.hasDraft_else,null,d,null,strings)},hasAttachment:function(){return h?r(f.hasAttachment,null,null,null,strings):""},recipients:function(e,t){return a=e||a,rt(a,d,W,t)},ariaStr:function(t,n){var i=[],s=[],o=strings.str_thread_to_recipients,u,f,l=0,c;return a=t||a,a.header&&(i=a.header.to||[],i=i.concat(a.header.cc||[]),i=i.concat(a.header.bcc||[]),e.Array.each(i,function(e){s.push(p.getName(e))}),u=s.length,u&&(!n&&u>3&&(s=s.slice(0,3),l=u-3),f=s.join(strings.str_thread_to_concatenate_recipients_delimiter)),o=r(o,{recipients:f}),l&&(c=r(strings.str_thread_hdr_more_recipients_btn,{number:l}),o+=", "+c)),o},thread_attachments:function(){return h?r(f.thread_attachments,null,d):""},msg_blocked:function(){if(!l)return;return p.getBlockedMsgMarkup(a,f,d)},msg_has_photo_attachment:function(){var e=a,t=e?e.imgAttachments||[]:[];return t.length?r(f.msg_has_photo_attachment,e,d,null,strings):""},attached_photos:function(){return p.getAttPhotosMarkup(a,f,d)},msg_has_attachment:function(){var e=a,t=e?e.nonImgAttachments||[]:[];return!o.isChat(e)&&t.length?r(f.msg_has_attachment,e,d,null,strings):""},hide_attachments_else:function(){return r(f.hide_attachments_else,a,d,null,strings)},attached_files:function(){return p.getAttFilesMarkup(a,f,d)},msg_loading:function(){return a.loading_slow||a.loading_error||a.loading_moved?r(f.page_loading,null,d,null,strings):""},loading_error:function(){return a.loading_error?o.getFailureMarkup(a):""},msg_truncated:function(){return a.body&&a.isTruncated&&!o.msgTrucationStatus.disabled[a.mid]?r(f.msg_truncated,null,null,null,strings):""},isInternal:function(){return NeoConfig.showFeedback?r(f.isInternal,null,null,null,strings):""},unsubscribe:function(e){return n.Features.enabled("unsubscribr")?r(e.unsubscribe,0,0,0,strings):""},flag_info:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e?"info-"+e:"";return t},flag_info_hover:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?"info-"+e:"info-unread";return t},status_title:function(){var e=c&&c.srvmap&&c.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?r(strings.str_msg_list_info_verified_attr,strings):"";return t===""&&a&&a.flags&&(t=a.flags.isRead?strings.str_msg_list_click_mark_as_unread:strings.str_msg_list_click_mark_as_read),t},mark_unread:function(){var e="";return a&&a.flags&&(e=a.flags.isRead?strings.str_msg_list_read:strings.str_msg_list_unread),e},loadhide:function(){return t.hideCard?r(f.loadhide,null,d,null,strings):""},with_icons:function(){return NeoConfig.convBtmIcons?r(f.with_icons,null,d,null,strings):""},with_icons_else:function(){return NeoConfig.convBtmIcons?"":i(f.with_icons_else)},thread_date:function(){return r(f.thread_date
,null,d,null,strings)},unread_icon:function(){return r(f.unread_icon,null,d,null,strings)},flag_icon:function(){return r(f.flag_icon,null,d,null,strings)}},o.messageFormatter||(o.messageFormatter=d),o.getInboxService(c),t.replyOnly?r(f.thread_reply,null,d,null,strings):r(f.thread_item,null,d,null,strings)}function ut(){var t=this,n=function(e){var n=e.s||"",i=e.o||0,s=e.f||t.readFormatters,o=e.a||0,u=e.strs||strings;return r(n,i,s,o,u)};this.readFormatters={anyUnread:function(){var e=t.message;return e.totalUnread>0?f.anyUnread:""},anyFlagged:function(){var e=t.message;return e.totalFlagged>0?f.anyFlagged:""},anyFlagged1:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged1,null,null,null,strings):""},anyFlagged2:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged2,null,null,null,strings):""},anyFlagged_else:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else,null,null,null,strings):""},anyFlagged_else1:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else1,null,null,null,strings):""},ariaLabelStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_convUnread:strings.str_msg_list_convRead},titleStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_conv_click_mark_as_read:strings.str_msg_list_conv_click_mark_as_unread},qr_bar:function(){return r(f.qr_bar,{},t.readFormatters,null,strings,a)},squeezeToolbar:function(){return V?f.squeezeToolbar:""},newComposeAssitIcon:function(){return Y?f.newComposeAssitIcon:""},show_formatter_well:function(){return r(f.show_formatter_well,{},t.readFormatters,null,strings,a)},show_attachment_icon:function(){return r(f.show_attachment_icon,{attachMenuPlus:Y?r(f.attachMenuPlus,{},t.formatters,null,strings,a):"",attachMenuPlus_else:Y?"":r(f.attachMenuPlus_else,{},t.formatters,null,strings,a)},t.formatters,null,strings,a)},spellCheckEnabled:function(){return M.enabled("spellCheck")?r(f.spellCheckEnabled,{},t.readFormatters,null,strings,a):""},thread_item:function(){var r,i=t.message,s=!0,o="",u,a,l=!1,c=0,h=0,p=0,d=0,v=!1;if(t.loading_error||!i.cid)return"";u=i.msgs,a=u&&u.length;if(a!==i.totalMsgs)return"";for(r=0;r<a;r++){var m=u[r],g,b=y(m.mid);if(e.Lang.isUndefined(m.header))return;r!==0&&r!==a-1&&h++,g=m.body?!0:!1,t.midObjMap[b]=r,$.isSentFid(t.fid)?($.isSentFid(m.fid)&&r<D?(l=!1,d++):r>=D&&!l&&!$.isSentFid(m.fid)?l=!1:r>=D&&!d&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!d&&a>D&&(l=!0)):$.isDraftFid(t.fid)?($.isDraftFid(m.fid)&&r<D?(l=!1,p++):r>=D&&!l&&!$.isDraftFid(m.fid)&&u[r+1]&&!$.isDraftFid(u[r+1].fid)?l=!1:r>=D&&!p&&u[r+1]&&$.isDraftFid(u[r+1].fid)&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!p&&a>D&&(l=!0)):(!m.flags.isRead&&r<D?(l=!1,c++):r>=D&&!l&&m.flags.isRead?l=!1:r>=D&&!c&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!c&&a>D&&(l=!0)),l&&!t.submessage&&!t.midtocid&&!v&&(o+=n({s:f.super_collapsed_btn,o:{collapsed_msg_count:h}}),v=!0),o+=t.getMsgMarkUp({message:m,expand:g,supercollapsed:!1,hideCard:s})}return o},message_selection:function(){var e=t.numSelected>0&&!t.message?n({s:f.message_selection}):"";return e},message_selection_else:function(){return t.numSelected===1&&t.message?n({s:f.message_selection_else}):""},multiple_selected_msgs:function(){return t.numSelected>1?n({s:f.page_conversation_history,o:{num_selected_msgs:t.numSelected}}):""},num_selected_msgs:function(){return t.numSelected},multiple_selected_msgs_else:function(){return t.numSelected===1?n({s:f.page_conversation_history1}):""},folder_message:function(e){var r=e||t.message;if(t.loading_error||!r.cid)return;return n({s:f.folder_message,o:r})},folder_message1:function(e){var r=e||t.message,i=r&&r.header;return i&&(i.subject||i.to&&i.to[0]||i.from.name)?n({s:f.folder_message1,o:r}):""},expanded:function(){return""},mail_search_enabled:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled})},mail_search_enabled1:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled1})},msg_subject:function(){var n=e.mail.Tabs,r=p.getMsgSub(t.message),i,s;return t.loading_error&&(i=n.getActiveTab(),i&&i.prevTabId&&(s=n.getTabById(i.prevTabId),s&&s.widgetType==="search"&&(r=r.split("^_").join("")))),r},msg_subjectDir:function(){return p.getMsgSubDir(t.message)},page_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?n({s:f.page_loading}):""},conv_loading:function(){return t.loading_error?"":n({s:f.conv_loading})},nav_arrows:function(){return n({s:f.nav_arrows})},summary:function(){var e=t.message,n=e.totalMsgs;return n>1?"("+n+")":""},showAllReplyActions:function(){return M.enabled("messageReadPaneV2")?r(f.showAllReplyActions,null,null,null,strings):""},showAllReplyActions_else:function(){return M.enabled("messageReadPaneV2")?"":r(f.showAllReplyActions_else,null,null,null,strings)},plus_icon:function(){return M.enabled("messageReadPaneV2")?"":f.plus_icon},ca_icon:function(){return M.enabled("richcompose")&&!Y?r(f.ca_icon,{tooltip:"",tooltip_else:f.tooltip_else},null,null,strings):""},stationery_icon_placeholder:function(){return G&&Z?r(a._shared_module_rte_well_content_format_fresh.stationery_icon_placeholder,{},t.formatters,null,strings,a):""},show_delete_draft_icon:function(){return M.enabled("deleteDraftIcon")?r(a._shared_module_thread_thread_display_rollup.show_delete_draft_icon,{},null,null,strings,a):""}},t.setFull=1}function at(t,r,i,s){var u=this,a,l=n.Stopwatch.get("MsgInPreview")||u.stopwatch,c=t&&t.cid,h,d,v,g,w,E,S=!1,x=[];u.wasCached=r||"";try{l&&l.start(3,"OnSuccessLMTRender"),clearTimeout(u.loadingTimer);if(c&&u.message&&(u.message.cid&&b(u.message.cid)===b(c)||u.midtocid&&e.Lang.isValue(u.getMessageIdxByMidLookup(u.midtocid,t.msgs,!0)))){u.loading_moved=0,u.resetRequestLoadingState(!1),u.inboxservices=
u.message.inboxservices||u.message.msgs&&u.message.msgs[0]&&u.message.msgs[0].inboxservices,u.msgicon=u.message.msgicon,u.midtocid?(u.message=t,S=!0):(u.message=t,u.allMsgsInConvInfo=t.msgs),u.message.toggleState="expanded";if(s&&t.fullmsg.mid){v=u.getMessageIdxByMidLookup(t.fullmsg.mid,u.message.msgs),t.fullmsg=e.clone(t.fullmsg),t.fullmsg.cid=t.cid,t.fullmsg.header.snippet=t.msgs[v].header.snippet,t.fullmsg.fid=u.getMsgFid(t.msgs[v]),u.message.msgs[v]=t.fullmsg,u.primaryMid=t.fullmsg.mid,x.push(u.message.msgs[v]);for(d=0;d<x.length;d++)a=m.getQueryParams(x[d],"midRequest"),x[d].blockImages=a&&a.blockImages,E=u.midObjMap[y(x[d].mid)],p.extractQuotedText(x[d],f.quoted_text_collapse,f.quoted_text_expand,R,E)}u.setRefreshTimer(),u.fireEvent("getSuccess"),u.render(r);if(s&&v!==undefined&&v>=0){u.showMessages(v,[u.message.msgs[v]],!1,!1,l,S,!1,!1);if(!NeoConfig.hasConvV3)return}l&&l.start(1,"ThreadMsgRead"),w=u.submessage?u.submessage:u.midtocid?{mid:u.midtocid}:s&&t.fullmsg?t.fullmsg:u.message.msgs[u.message.msgs.length-1],v=u.getMessageIdxByMid(w.mid),g=u.getMsgNodeByMid(w.mid),$.isDraftFid(w.fid)?u.showMessages(v,[u.message.msgs[v]],!1,!1,l,!1,!1,!0):u.submessage?u.expandMessages(v,"adjacent","no",!0,{scroll_to_msg:!0},l,!0):u.midtocid?s||u.expandMessages(v,"one",!1,!0,{scroll_to_msg:!0},l,!0):u.fid==="Sent"?s?u.expandMessages(v,"other-send",!1,!0,null,l,!0):u.expandMessages(v,"send",!1,!0,null,l,!0):$.isDraftFid(u.fid)?u.expandMessages(v,"draft",!1,!0,null,l,!0):s?u.expandMessages(v,"other-unread",!1,!0,{no_focus:!0},l,!0):u.expandMessages(v,"unread",!1,!0,{no_focus:!0},l,!0),o.stat("convread","result=>success,env=>"+NeoConfig.mailEnv)}else t||u.loadExtra(function(){this.onFailure({msg:u.message,reason:h},i)},1)}catch(T){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1")}}function ft(){return this.activeComposeWidget.cv.view}function lt(t){var r=this,i,s,o;r.activeComposeWidget&&r.activeComposeWidget.cv.view!==t&&(r.activeComposeWidget.cv.view.set("active",!1),r.activeComposeWidget.cv.view.save()),r.activeComposeWidget=null;for(i in r.composeWidgets)o=r.composeWidgets[i].cv.view,s=r.getComposeNodeByMid(i),o===t&&(r.activeComposeWidget=r.composeWidgets[i],r.activeComposeWidget.cv.view.set("active",!0),s&&s.addClass("active"),e.fire("draftCardAdded"),it(),!NeoConfig.smartscroll&&r.composeAction&&s&&(r.listNode.set("scrollTop",s.get("offsetTop")-10),r.composeAction=!1),n.features.enabled("messageReadAdr")&&r.cancelAdRotationTimer())}function ct(e){var t=this,n,r,i,s,o,u=[],a=0;for(r in t.composeWidgets)i=t.composeWidgets[r].cv.view,i.get("dirty")&&u.push(i);if(u.length<=0)e&&e(!0);else{s=function(t,n){n.detach("compose:saveFail",o),n.dirty=!1,a--,a===0&&e&&e(!0)},o=function(t,n){n.detach("compose:saveSuccess",s),n.dirty=!0,e&&e(!1)},a=u.length;for(n=0;n<u.length;n++)i=u[n],i.once("compose:saveSuccess",s,null,i),i.once("compose:saveFail",o,null,i),i.save()}}function ht(){et.superclass.closeAllCompose.call(this,{})}function pt(e){return NeoConfig.yodaReadEnabled?!0:!e.flags.isRead}function dt(t,n){var r=this,i;if(r.convUserUnread||r.msgUserUnread&&r.msgUserUnread[y(n.mid)]||!r.get("active"))return;if(n&&!r.loading_slow&&!r.loading_error&&!r.loading_moved&&pt(n)){i=parseInt(A.get("cg.pref.general.markasreadinterval"),10);if(i!==999)return i=i?i*1e3:750,isNaN(i)&&(i=750),i===0&&(i=100),r.flagMsgList.push({fid:t,msg:n}),NeoConfig.yodaUpdateEnabled?NeoConfig.loadYodaController.then(function(){r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){var n=[];e.Array.forEach(r.flagMsgList,function(e){n.push(e.msg)}),n=e.mail.controller.v3.helper.store.filterUnreadMessages(n),e.mail.controller.v3.api.flagMessagesWithMid({messages:n,sourceFid:t,flags:{read:1},showTAE:!1,statTAE:!1,notifyStoreMsgByMsg:!0,success:function(){r.debouncedSyncFlagState()}}),r.flagMsgList=[]},i)}):e.use("mail-controller-messages-ops",function(){r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){e.Array.forEach(r.flagMsgList,function(e){r.markAsReadBatch(e.fid,e.msg)}),r.readBatch&&r.readBatch.execute({suppressCodes:["*"]}),r.readBatch=null,r.flagMsgList=[]},i)}),!0}return!1}function vt(e,t){var n=this;n.readBatch=n.readBatch||l.Controller.batch(),n.readBatch.Messages.flag({fid:e,mid:t,setFlags:{read:1},enableRetry:!0})}function mt(t,r,i){var s=this,o;try{r&&r.ancestor("body")?s.neoFire("rendered",[],t,r,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},i):s.once("convAddedToDOM",function(){r.ancestor("body")||(r=s.getMsgNodeByMid(t.mid)),s.neoFire("rendered",[],t,r,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},i)},r),r&&s.inspectMessageForBadContent(r,t)}catch(u){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2",u,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2")}M.enabled("selectToSearch")&&e.use("mail-ui-pane-utils-s2s",function(e){e.mail.ui.PaneUtils.handleS2S(s)}),n.features.enabled("messageReadAdr")&&s.startAdRotationTimer(),o=M.enabled("enhancrV2")&&!$.isDraftFid(t.fid),M.enabled("enhancrEmbedPlay")&&o&&e.use("mail-ui-enhancr",function(e){e.mail.ui.enhancr.enhancr.prepareEnhancrCards(s,r)}),M.enabled("readLinkEnhancr")&&o&&e.use("mail-ui-pane-utils-linkEnhancr",function(e){e.mail.ui.PaneUtils.initializeReadLinkEnhancr(s)}),M.enabled("deepLinkedMail")&&s.message.srvmap.inboxService==="certified-ssl"&&s._evts.push(e.mail.ui.deeplink.manager.attachEvents(r.one(".body")))}function gt
(t){var n=this,r=n.listNode,i,s,o,u=e.ACWidgetInst;if(!r)return;i=r.get("scrollTop"),s=r.get("offsetHeight"),o=r.all("."+x),!t&&u&&u.isVisible()&&u.hide(),o.size()>1&&n.checkAdsOnScroll(i,s),clearTimeout(n.markAsReadTimer),n.markAsReadTimer=setTimeout(function(){n.checkMsgCardsOnScroll(o,t)},200)}function yt(t,n){var r=this,i=window.DARLA,s,o,u=200;e.Lang.isNumber(r.prevY)||(r.prevY=t),r.scrollAdTimer&&clearTimeout(r.scrollAdTimer),i&&(i.inProgress()||(s=Math.abs(r.prevY-t),o=n*i.scrollThreshold,s>o&&(r.scrollAdTimer=setTimeout(function(){e.mail.ui.darla.fireDarlaOnScroll(),r.prevY=t},u))))}function bt(t,n){if(M.enabled("markExpandedAsRead"))return;var r=this,i,s,o,u;r.message&&(s=r.message.msgs);if(!t||!s)return;i=t.size();for(u=0;u<i;u++)o=t.item(u),o.hasClass(T)&&o.hasClass(N)&&o.inRegion(r.listNode)&&(r.markConvMsgAsRead(r.getMsgFid(s[u]),s[u]),n&&e.fire("MailLog",{m:"Marking message as read silently",cid:s[u].cid,mid:s[u].mid}))}function wt(){var e=this,t=e.listNode,n="has-scrolled";!M.enabled("messageReadPaneV2")&&t&&(t.get("scrollTop")>j?e.hdr.addClass(n):e.hdr.removeClass(n)),e.scrollTimer&&window.clearTimeout(e.scrollTimer),e.scrollTimer=window.setTimeout(function(){e.onPaneScroll()},200)}function Et(){var e=this,t=this.getRoot();e.listNode=t.one(".thread-item-list");if(!e.listNode||!e.message)return;e.listNode.on("scroll",wt,e)}function St(e){var t=null,n,r,i=!1;if(!e||!e.getDOMNode())return;t=e.one(".msg-truncated");if(!t)return;n=e.all(".thread-quoted-body"),r=n&&n.size()>0,r&&(i=n.item(0).hasClass("expanded")),r&&!i?t.hide():t.show()}function xt(e,t,n){var r=!1;if(!(t&&t.getDOMNode()&&e.isTruncated&&t.one(".body")))return;r=d.hasOnlyNonDisplayableContent(t.one(".body")),r&&!this.msgTrucationStatus.loading[e.mid]&&(this.msgTrucationStatus.loading[e.mid]=!0,this.viewFullMsg(e,n),t.one(".msg-truncated").hide(),t.one(".body").setContent('<div class="s-loader"></div>'))}function Tt(){var t=this,r=this.getRoot();t.listNode=r.one(".thread-item-list"),t.after("activeChange",function(e){var t=this;e.newVal||t.saveDraftAction(null,!0),t.activeComposeWidget&&t.activeComposeWidget.cv.view.set("active",!!e.newVal)}),t.on("activeChange",function(e){e.newVal&&t.refreshOnActive&&t.updatePaneContent(),n.features.enabled("messageReadAdr")&&(e.newVal?t.startAdRotationTimer():t.cancelAdRotationTimer())}),t.on("closeChange",function(e){e.newVal&&t.closeAllCompose(),n.features.enabled("messageReadAdr")&&t.cancelAdRotationTimer()}),t.threadHeaderHandler=r.delegate(["click","keydown"],function(r){if(r.type==="keydown"&&r.keyCode!==13)return;var i;r.stopPropagation();var s,o=n.getDataAction(r).action,u=t.message,a=r.target;i="";switch(o){case"thread-flag":s=u.totalFlagged?"unflagged":"flagged",i=u.totalFlagged?"unflag_thrd_hdr":"flag_thrd_hdr",t.handleUI(u,s);break;case"thread-unread":s=u.totalUnread?"read":"unread",i=u.totalUnread?"read_thrd_hdr":"unread_thrd_hdr",s==="unread"?(t.convUserUnread=!0,r.target.setAttribute("aria-label",strings.str_msg_list_convUnread),r.target.setAttribute("title",strings.str_msg_list_convRead_attr)):(r.target.setAttribute("aria-label",strings.str_msg_list_convRead),r.target.setAttribute("title",strings.str_msg_list_convUnread_attr)),t.handleUI(u,s);break;case"thread-toggle":s=u.toggleState==="expanded"?"collapse":"expandall",t.handleToggleAllMessageCards(a,s,u,t.getMsgFid(u));break;case"update":t.saveDraftAction(function(){t.loadPaneContent(7,null,{force:!0},null)})}i&&e.fire("mt:click",{action:i,append:{msgID:u.mid?[u.mid]:u.msgs.map(function(e){return e.mid})}})},w),t._evts.push(r.delegate(["focus","blur"],function(n){if(n.type==="focus"){if(n&&n.currentTarget&&!n.currentTarget.hasClass("thread-focus")){n.currentTarget.addClass("thread-focus");if(M.enabled("messagereadassist")){var r=t.getMsgFromNode(n.currentTarget);e.fire("MessagePane:msgReadData",r)}n.currentTarget.hasClass("thread-item")&&(t.selNode=n.currentTarget)}}else n.type==="blur"&&n&&n.currentTarget&&n.currentTarget.hasClass("thread-focus")&&(n.currentTarget.removeClass("thread-focus"),n.currentTarget.hasClass("thread-item")&&(t.selNode=null))},".thread-item, .add-to-conv, .supercollapsed")),t._evts.push(r.delegate("contextmenu",function(){e.fire("HoverCard:hideHoverCard")},".lozengfy.hcard")),t._evts.push(r.delegate("click",t.logLinkClicks,".thread-body a",t)),t.threadItemHandler=r.delegate(["click","keydown"],function(r){if(!(r.type!=="keydown"||r.keyCode===13&&!r.target.hasClass("recipients")))return;r.type==="keydown"&&r.stopPropagation(),r.target.getAttribute("href")==="#"&&r.halt(),e.fire("as:close-window-click",r);var i,s,o,u,a={t1:"thrdRdTb"},f=r.target,l=f.get("parentNode"),c=r.currentTarget,h=n.getDataAction(r).action,d=f.hasClass("thread-item")?f:f.ancestor(".thread-item",!0),v,m,g,y=t.message.msgs,b,w,E=r.type==="keydown";(l.get("nodeName")==="A"||f.get("nodeName")==="A")&&t.handleBodyLinkClick(r),d&&(g=d.getAttribute("data-mid"),g&&(v=t.getMessageIdxByMid(g),m=y[v],t.selNode=d)),h==="contact-card-menu"&&r.halt(),h==="contact-card-menu"&&!d.hasClass("expanded")&&(h="select-thread"),o="",e.fire("MailLog",{m:"Initializing Action from Conversation Pane",action:h});switch(h){case"thread-super-collapse":t.expandSuperCollapsedNodes();break;case"select-thread":window.getSelection?w=window.getSelection().toString():w=document.body.createTextRange().text;if(f.hasClass("thread-item")&&E||(f.hasClass("thread-item-header")||f.ancestor(".thread-item-header")||f.hasClass("thread-item")&&!d.hasClass("expanded"))&&!f.hasClass("more_recp")&&!f.hasClass("info-hover")&&!f.hasClass("flag")&&!e.Lang.trim(w))d.hasClass("expanded")?!d.hasClass("collapsing")&&!d.hasClass("expanding")&&(t.collapseMessage(d),o="collapse_thrd_msg_hdr",t.selNode=d,t.focusMessageCard()):(e.fire("MessagePane:expandClick",{cid:t.message.cid,mid:m.mid}),t.selNode!==d&&(t.selNode=d,t.focusMessageCard()),t.expandMessageTimers[g]=e.later(5e3,null,function(){var r={yid:NeoConfig.loginId,cid:t.message.cid,mid:m.mid};n.netError("Expand Message Failed:"+
e.JSON.stringify(r))}),t.expandMessages(v,"one","yes",!1),o="expand_thrd_msg_hdr");break;case"quoted-text":var S,x=d.all(".thread-quoted-body"),T,N,C=d.one(".thread-quoted-body");x&&x.size()>0&&(S=!x.item(0).hasClass("expanded"),o=S?"expand_qtd_thrd_msg":"collapse_qtd_thrd_msg",T=d.one(".thread-quoted-text"),T&&(T.one(".icon").toggleClass("icon-chevron-down"),T.one(".icon").toggleClass("icon-chevron-right"),T.one(".qtd-expansion-text").set("text",S?strings.str_qtd_collapse:strings.str_qtd_expand),T.one(".qtd-expansion-text").set("aria-label",S?strings.str_qtd_collapse:strings.str_qtd_expand),T.setAttribute("title",S?strings.str_qtd_collapse:strings.str_qtd_expand)),x.each(function(t){S?(M.enabled("onDemandFetchInlineImageInQuotedBody")&&p.switchInlineImageSrc(t,m,!0),t.addClass("no-transition"),t.setStyles({display:"block",transition:""}),N=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("height",0),t.removeClass("no-transition").addClass("expanded"),e.later(0,t,t.setStyle,["height",N]),e.later(200,null,function(e){it(),e.setStyles({transition:"none",height:"auto"})},[t])):(N=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("transition",""),t.setStyle("height",N),t.removeClass("expanded"),e.later(0,t,t.setStyle,["height",0]),e.later(200,null,function(e){it(),e.setStyles({display:"none",height:"auto"})},[t]))}),St(d),S?e.later(0,null,function(){C.setAttribute("role","gridcell"),C.setAttribute("tabindex","0"),C.focus()}):C.setAttribute("tabindex",-1));break;case"thread-item-flag":i=m.flags.isFlagged?"unflagged":"flagged",o=m.flags.isFlagged?"unflag_thrd_msg_hdr":"flag_thrd_msg_hdr",t.handleUI(m,i);break;case"thread-item-delete":i="delete",t.handleUI(m,i);break;case"thread-item-unread":i=m.flags.isRead?"unread":"read",i==="unread"&&(t.msgUserUnread||(t.msgUserUnread={}),t.msgUserUnread[g]=!0),o=m.flags.isRead?"unread_thrd_msg_hdr":"read_thrd_msg_hdr",t.handleUI(m,i);break;case"reply_all":case"reply_sender":case"forward":case"thread-item-replyall":s={},s.action=h==="thread-item-replyall"?"reply_all":h,e.fire("rc:flow",{name:h}),h==="thread-item-replyall"?o="quick_reply_all_thrd_msg":c.hasClass("add-to-conv")?o="quick_"+h+"_tlbr_thrd_msg":o=h+"_thrd_msg",m||(v=y.length-1,m=y[v]),t.composeAction=!0,t.initReplyForward(s.action,m),a.msgID=m.mid;break;case"edit-to":t.composeWidgets[g]&&(d.one(".thread-reply-to").setStyle("display","none"),d.one(".thread-reply-to-edit").setStyle("display","block"));break;case"menu":d.hasClass("quickReply")||(t.loadMenu(r,m,d,v),o="actnMnu_thrd_msg");break;case"show-images":t.unblockImages(m,v),o="show_images_thrd_msg";break;case"mail-options":t.loadOptions(),o="options_thrd_msg";break;case"attach-download-all":case"attach-download-all-photos":var k=h==="attach-download-all-photos"?"image":"non-image";t.downloadAllAttachments(k,r,m);break;case"attach-download":var L=0,A="";c&&(L=c.get("id"),A=c.getAttribute("tnefid")),t.downloadAttachment(L,A,m);break;case"retry-msg-load":t.expandMessages(v,"one","yes",!1),o="retry_thrd_msg";break;case"retry-conv-load":t.retryLoad(),o="retry_thrd_hdr";break;case"view-full-msg":t.viewFullMsg(m,v);break;case"thread-item-edit":s={},s.action="edit",e.fire("editMessage",e.mix(s,{fid:t.getMsgFid(m),oMsg:m}));break;case"hide":b=f.getAttribute("data-field"),X[b]=!1,d.one(".recipients").set("innerHTML",t.messageFormatter.recipients(m,X)),d.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(m,!0)),d.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(m,!0));break;case"more":b=f.getAttribute("data-field"),X[b]=!0,d.one(".recipients").set("innerHTML",t.messageFormatter.recipients(m,X)),d.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(m,!0)),d.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(m,!0)),e.later(0,null,function(){d.one(".recipients").focus()}),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.installReadGlass()}e.fire("ConvPane",h),u={action:o,append:a},o&&e.fire("mt:click",u)},".thread-item, .msg-attachments .file-attach li, .conv-loadingpane, .supercollapsed, .add-to-conv"),e.on("ds:conv:change",function(){}),e.on("ds:folder:rename",function(e,n){var r,i=0;if(t&&t.message&&t.message!==null){r=t.message.msgs;if(e.folderInfo.fid===t.message.fid){t.message.fid=n.folderInfo.fid;for(i=0;i<r.length;i++)e.folderInfo.fid===r[i].fid&&(r[i].fid=n.folderInfo.fid,r[i].folderInfo&&r[i].folderInfo.fid!==undefined&&(r[i].folderInfo.fid=n.folderInfo.fid),r[i].sourceFolderInfo&&r[i].sourceFolderInfo.fid!==undefined&&(r[i].sourceFolderInfo.fid=n.folderInfo.fid))}}}),t.refreshHandler=e.on("ds:conv:refresh",function(r,i,s){var o,u,a,f=!0,l,c;if(!t.message||!t.message.cid)return;t.debouncedSyncFlagState(),u=b(t.message.cid),r==="lft"?o=s[u]:r==="lmt"&&s[0]&&b(s[0].cid)===u&&(o=s[0],f=!1,a=o.checksum);if(o){l=t.lftCongruencyCheck(o,t.message);if(l)if(!t.fullView&&!t.get("active"))t.saveDraftAction(function(){try{t.loadPaneContent(8,null,{force:f,checksum:a},null)}catch(i){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3",i,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3"),e.use("common-utils-error",function(){n.error.report("loadpane convpanerefresherror "+r,i,1,1,1)})}});else{if(r!=="lmt"||!t.currentLmtContext||!(t.currentLmtContext.draftMID||t.currentLmtContext.newMsg&&$.isDraftFid(t.currentLmtContext.newMsg.fid)))c=t.getRoot().one(E)||t.getRoot().one(S),c&&c.replace('<span class="badge" data-action="update">'+l+"</span>"),t.isStale=!0;t.setRefreshTimer()}}}),t.newMessageHandler=e.on("newConvMessage",function(e){t.composeAction=!0,t.get("active")&&t.initReplyForward(e.action,e.oMsg)}),t.eventsBound=!0}function Nt(e,t){var n=!0;return e.totalMsgs>t.totalMsgs?(n=!1,e.totalMsgs-t.totalMsgs):0}function Ct(e,t,n){var r,i,s={oldIdx:-1,newIdx:-1,remainder:!0};r=i=0;while(r<e.msgs.length||
i<t.msgs.length)r<e.msgs.length&&n.draftMID&&y(e.msgs[r].mid)===y(n.draftMID)?(s.oldIdx=r,r++):i<t.msgs.length&&y(t.msgs[i].mid)===y(n.newMsg.mid)?(s.newIdx=i,i++):(i<t.msgs.length&&r<e.msgs.length&&y(e.msgs[r].mid)!==y(t.msgs[i].mid)&&(s.remainder=!1),r++,i++);if(r!==e.msgs.length||i!==t.msgs.length)s.remainder=!1;return s}function kt(){var e=this,t=e.listNode;t.all(".super-hidden").removeClass("super-hidden"),t.one(".supercollapsed")&&t.one(".supercollapsed").remove()}function Lt(t){var n=this,r,i=t||n.message,s=i.totalMsgs,o,u="",a,f,l,c,h,p,d=e.one("#inboxcontainer"),v=d.hasClass("prevPaneVisible")&&!d.hasClass("offscreen"),m=[],g,y,b;n.destroyRichCompose(),n.composeWidgets={};for(r=0;r<s;r++)g=i.msgs[r],g&&$.isDraftFid(g.fid)&&m.push(r);for(r=0;r<m.length;r++){b=m[r],a=i.msgs[b],c=!0;if(!a.oMsgMid){var w=n.getMessageIdxByMid(a.mid);if(w>0)for(var E=w-1;E>=0;E--){M.enabled("yodaConversationRead")?y=a.inReplyToRfc822&&a.inReplyToRfc822.indexOf(i.msgs[E].messageIdRfc822)>=0:y=a.inReplyTo===i.msgs[E].mimeMsgId;if(y){a.oMsgMid=i.msgs[E].mid;break}}}f=a,o=n.getMsgNodeByMid(a.mid),a.oMsgMid?(l=n.message.msgs[n.getMessageIdxByMid(a.oMsgMid)],h=n.getMsgNodeByMid(a.oMsgMid)):(l=a,h=n.getMsgNodeByMid(n.message.msgs[s-1].mid)),o&&b!==s-1&&(o.remove(),o=null),b===n.message.msgs.length-1&&n.quickReplyBox&&n.quickReplyBox.hide(),s>=D&&(u=b!==0&&b!==s-1&&h.hasClass("super-hidden")&&!$.isDraftFid(n.fid)?"super-hidden":"",b===s-1&&(h=n.listNode.one(".supercollapsed")?n.listNode.one(".supercollapsed"):h)),($.isDraftFid(n.fid)&&b===m[m.length-1]||b===s-1)&&!v&&(c=!1),a.cookedHeader&&a.cookedHeader.subject&&a.oMsgMid?p=!1:p=!0,l.fid||(l.fid=n.getMsgFid(a.fid)),n.initializeCompose({action:"edit",fid:n.getMsgFid(a),oMsg:a,parentMsg:l,showSubject:p},h,!0,c,u),o&&o.remove()}n.once("convAddedToDOM",function(){$.isDraftFid(n.fid)&&n.parentCW.msgList&&!a.oMsgMid&&s===1&&(n.subjectHandle=e.one("#subject-field").on("valueChange",n.updateSubject))})}function At(t,n,r,i,s){var o=this,u,a,f,l,c,h,p,d=typeof r!="undefined"?r:!1,v=t&&t.action==="forward",m=t&&t.showSubject,g,b=typeof s!="undefined"?s:"",w=typeof i!="undefined"?i:!1,E=y(t.parentMsg.mid),S="",x="quickReply";o.dirty=!0,u=o.composeWidgets[E];if(!d&&u)l=u.cv.draft.origin,f=l.action,f!==t.action?u.cv.view.header.switchReplyMode(t.action):u.cv.view.setFocus("body"),o.activeComposeWidget?o.setActiveCompose(u.cv.view):o.activeComposeWidget=u;else{d?(a=" loadhide active",S=' data-mid = "'+y(t.oMsg.mid)+'"'):(a=" active",S=""),n||(n=o.getMsgNodeByMid(o.message.msgs[o.message.msgs.length-1].mid)),n.insert('<div class = "thread-item '+x+" expanded"+a+" "+b+'" '+S+' tabIndex="-1" data-draftmid="'+E+'"> <div class="compose-loading-wrapper"><div class="cm-loadingpane"><div class="s-loader"></div></div></div></div>',"after"),g=n.next(),c={isQuickReply:!0,noFocus:w,containerNode:o.listNode,showSubject:m,maxHeightFn:function(){return o.listNode&&o.listNode.get("offsetHeight")-20||0}},h={setActiveCompose:function(t){t.cv.getDraftMID()&&(t.cv.scrollFocus=!1),t.noDelay?o.setActiveCompose(t.cv):e.later(0,o,o.setActiveCompose,[t.cv]),e.fire("compose:rte:active",{editor:t.editor,cv:t.cv})},closeAction:function(){var t=g&&g.one("#rtetext");e.UA.gecko>0&&t&&(t.focus(),t.blur()),p.view.closeCompose(),delete o.composeWidgets[E],o.activeComposeWidget&&o.activeComposeWidget.cv===p&&(o.activeComposeWidget=null,o.richcompose&&!o.hasDrafts()&&o.destroyRichCompose()),e.fire("draftCardRemoved"),g.remove(!0),o.message&&o.message.msgs.length>0&&!$.isDraftFid(o.message.msgs[o.message.msgs.length-1].fid)&&o.quickReplyBox&&(o.quickReplyBox.show(),o.quickReplyBox.removeClass("loadhide"),J||o.quickReplyBox.focus())},hideAction:function(e){o._transformComposeToCard(g,e)},showAction:function(){o._reverseTransformComposeToCard(g)},bindComplete:function(e){v&&o.expandReplyCard(g,e.ccv.view)},updateTitle:function(e){o.fullView&&o.parentCW&&(e.sending?o.parentCW.tab.elTab.addClass("sending"):(o.parentCW.tab.elTab.removeClass("sending"),o.setTitle()))},showDeleteDraftDialog:function(e){e&&e.sdcbk(!1)},qrCancel:function(){p.view.cancelCompose()},switchToTab:function(){o.parentCW&&o.parentCW.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(o.parentCW.tab)},darlaEvent:function(e){e.action=e.type,o.fire("darlaEvent",e)}};var T=["mail-ui-composeview-compose-loader"],N=function(){e.use(T,function(){var n={},r=new e.mail.ui.Compose.ComposeLoader(n);p=r.create_conv_compose_view(t,d,g,c,h),M.enabled("richcomposeInQuickReply")&&e.use("mail-ui-richcompose-view",function(e){o.richcompose?o.richcompose.addComposeView(p.view):o.richcompose=new e.mail.Views.RichCompose(o,p.view)}),o.composeWidgets[E]={cv:p}})};T.push("mail-controller-compose-v3"),T.push("mail-ui-rteview-v3"),T.push("mail-ui-rte-formatter-v3"),N()}}function Ot(){var e=!1,t;for(t in this.composeWidgets)e=!0;return e}function Mt(t,r,i){var s=this,o,u,a,f,l,c;if(r){o=s.getMessageIdxByMid(r.mid),u=s.getMsgNodeByMid(r.mid),c=y(r.mid);if(!u)return;f=e.one('[data-draftmid="'+c+'"]');if(i&&f){l=n.getVal(s.composeWidgets[c],"cv.view.focusNode"),l?l.focus():f.focus();return}t==="forward"?a=!0:a=!1,o===s.message.msgs.length-1&&s.quickReplyBox&&s.quickReplyBox.hide(),s.initializeCompose({action:t,fid:s.getMsgFid(r),oMsg:r,parentMsg:r,showSubject:a},u),e.fire("draftCardAdded"),it()}}function _t(t,n,r){function l(t){var l,c=o.ancestor("div"),h=c?c.one(".card-actions-menu"):null,p=["removeAddress","spam","notspam","notmymail","sendercompromised","phished","delete"],d=t.dataAction;if(t.dataAction==="conv-help")return;t.dataAction==="bug"?(u=encodeURI(r.getAttribute("data-mid")),a=u.lastIndexOf("_")+1,f="php/qtd_r.php?cid="+i.message.cid+"&mid="+(a?u.slice(a):u)+"&fid="+s,NeoConfig.isCorpmail&&(f+="&isCorpMail=1"),window.open(f,"_bug")):e.Array.indexOf(p,d)!==-1&&h&&h.menu&&h.menu.hide();if(NeoConfig.hasConvRefactor)if(t.dataAction==="reply_sender"||t.dataAction==="forward"){i.initReplyForward(t.dataAction,n);return}var v={action:t.dataAction,context:"msg",
id:r?r.get("id"):0,forwardAsAttachment:0,fid:s,item:t.item,hasMsgList:!1,tbAction:!1};e.mail.ui.MessageEvents.handleUI(v,s,null,[n?n:null]),l=t.dataAction+"_thrd_msg",l&&e.fire("mt:click",{action:l,append:{t1:"thrdRdTb"}})}var i=this,s=i.getMsgFid(n),o=t.target,u,a,f;t.preventDefault(),e.use("common-ui-menu-helper",function(e){var n=e.common.ui.MenuHelper,r=o.ancestor("div"),i=r.one(".card-actions-menu");i.addClass("pressed"),e.use("mail-ui-inboxmenu-base","mail-ui-messageevents",function(e){e.mail.ui.InboxMenu.insert("menu-bubble-actions",function(){var r=e.one("#menu-bubble-actions");n.create(i,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY],blur:!0},function(){r.on("menuSelected",l),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(i.removeClass("pressed"),i.unplug(e.Plugin.Menu),this.destroy(!0))})})},s,{fid:s})})})}function Dt(t,r,i,s,o,u,a){var l=this,h,d,v,g,b,w,E,S=l.message,x=null,T,N,C=o&&o.no_show_hidden_cards?!0:!1,k=o&&o.scroll_to_msg?!!o.scroll_to_msg:!1,L=o&&o.no_focus?!0:!1;l.messageFound=0,u&&u.start(2,"LoadMessageCard"),v=new n.Stopwatch("LoadMessageCard"),x=e.later(500,l,function(){l.loadExtra(function(){if(!l.messageFound)for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E&&(E.hasClass("expanded")||E.addClass("loading"))},1)}),g={success:function(n,s){e.fire("MessagePane:loadMessageSuccessStart",n);var o=g&&g.respProps&&g.respProps.wasCached?!0:!1,d=g&&g.respProps&&g.respProps.callPerf,b,w=0,T=0,N,A=new Date;u&&(u.start(1,"GDMFetchEnd"),u.YCMSGGetEnd2=A,u.wasCached2=o,u.BECallTime2=d),v&&(v.wasCached=o,v.YCMSGGetEnd=A,v.BECallTime=d,v.stop());if(!l.isConvActive(S.cid))return;for(T=0;T<r.length;T++){N=r[T];if(l.message.msgs&&l.message.msgs[N]){if(!l.message.msgs[N].flags||!l.message.msgs[N].header)l.message.msgs[N]=c.Messages.toMessage(l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]);n[w]&&(n[w]=e.clone(n[w]),n[w].header.snippet=l.message.msgs[N].header.snippet,n[w].fid=l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]=n[w],h=m.getQueryParams(n[w],"midRequest"),n[w].blockImages=h&&h.blockImages,b=l.midObjMap[y(n[w].mid)],p.extractQuotedText(n[w],f.quoted_text_collapse,f.quoted_text_expand,R,b))}w++}l.showMessages(t,n,!1,i,u,k,C,!1,L),s&&s.length&&(a==="one"||a==="all")&&l.showNotification(t,s),l.messageFound=1;if(x){x.cancel();for(w=0;w<r.length;w++)E=l.getMsgNodeByMid(S.msgs[r[w]].mid),E.removeClass("loading")}L||(l.selNode||(l.selNode=e.all(".thread-item").item(t)),l.focusMessageCard())},failure:function(e){l.loadExtra(function(){var n=S.msgs[t],r=l.getMsgNodeByMid(n);e.data=n,n.body={},n.body.display=l.onMsgFailure.apply(l,[e,!1]),u&&u.stop(l.fullView?"MsgInTabFailure":"MsgInPreviewFailure"),l.showMessage(n,0,r,!1,i)},1),l.messageFound=1,l.primaryMid=null;if(x){x.cancel();for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E.removeClass("loading")}},errorPosition:401,suppressCodes:["*"]},b=[];for(T=0;T<r.length;T++)b.push(S.msgs[r[T]]);if(b.length===1&&l.message.msgs.length>1){w=l.getMsgNodeByMid(b[0].mid),N=function(){var e=w.one(".thread-body"),t=w.one(".thread-body .body"),n=e&&e.getAttribute("original_content"),r=!$.isDraftFid(l.getMsgFid(b[0])),i=t&&t.get("children").size()>0;return n||!o&&r&&i};if(N()){l.messageFound=1,l.showMessage(b[0],r[0],w,!1,"yes"),l.listNode.all(".loadhide").removeClass("loadhide"),l.getRoot()&&l.getRoot().one(".conv-loading").addClass("hidden");return}}e.fire("MessagePane:loadMessageCardsStart",l.message,b),d=l.requestAllMessages(b,l.message.fid,g,o,{stopwatch:u,RSstopwatch:v}),l.abortRequests(),l.outboundReq&&(l.request=d,l.requestType="loadcard")}function Pt(t){var n=this,r=n.getMessageIdxByMid(t.mid),i=n.getMsgNodeByMid(t.mid),s=n.message.msgs[r];return!e.Lang.isValue(r)||!i||!s?!1:(i.hasClass("expanded")?n.scrollToMsg(s):(n.scrollOnExpansion=!0,n.expandMessages(r,"one","yes",!1)),!0)}function Ht(t){var n=this,r=n.getMsgNodeByMid(t.mid),i=n.getMessageIdxByMid(t.mid),s,o;i===0?n.listNode.set("scrollTop",0):(o=r.get("offsetTop")-12,e.use("anim",function(){var r=new e.Anim({node:n.listNode,duration:n.fullView?.2:0,to:{scroll:[0,o]}});r.run(),r.on("end",function(){s=n.getMsgFid(t),n.markConvMsgAsRead(s,t)})})),n.scrollOnExpansion=!1}function Bt(e,t,n){var r=this;r.toggleAllMessageCards(e,t,n)}function jt(e,t,n){var r=this,i,s={};r.expandSuperCollapsedNodes(),r.lastExpandedMsgIdx=0,t==="expandall"?(n.toggleState="expanded",i=r.getMessageIdxByMid(r.message.msgs[0].mid),s.no_focus=!0,r.expandMessages(i,"all",!1,"no",s),e&&e.removeClass("thread-cards-collapsed"),e&&e.addClass("thread-cards-expanded"),e.setAttribute("title",strings.str_collapse_all_attr),e.one(".icon-text").setContent(strings.str_collapse_all)):(n.toggleState="collapsed",r.collapseAllMessageCards(),e&&e.removeClass("thread-cards-expanded"),e&&e.addClass("thread-cards-collapsed"),e.setAttribute("title",strings.str_expand_all_attr),e.one(".icon-text").setContent(strings.str_expand_all))}function Ft(e){var t=this,n=t.lastExpandedMsgIdx;if(!(t.message.msgs.length>n)){t.fetchMoreTimer=null;return}t.fetchMoreTimer=setTimeout(function(){t.expandMessages(n,"all",!1,"no",e)},100)}function It(t,n,r,i,s,o,u){var a=this,f=a.message,l,c,h=null,p=[],d,v=0,m,g,y;switch(n){case"all":a.lastExpandedMsgIdx=a.lastExpandedMsgIdx?a.lastExpandedMsgIdx:0,u=!1,t=0,v=0;for(a.lastExpandedMsgIdx;a.lastExpandedMsgIdx<f.msgs.length;a.lastExpandedMsgIdx++){if(!(v<L)){a.fetchMoreMsgs(s);break}if($.isDraftFid(a.getMsgFid(f.msgs[a.lastExpandedMsgIdx])))continue;p.push(a.lastExpandedMsgIdx),v++}a.scrollLoad=!0,a.expandAllMode=!0;break;case"one":p.push(t);break;case"unread":case"other-unread":m=n==="other-unread"?t:0,u=u&&n==="unread",y=function(e){a.expandMessages(e+1,"other-unread",!1,!1,{scroll_to_msg:!1,no_show_hidden_cards:!0,no_focus:!0})};for(d=m;d<f.msgs.length;d++){if($.isDraftFid(a.getMsgFid(f.msgs[d]))||n==="other-unread"&&d===0)continue;if(!f.msgs[d].flags.isRead){if(!(v<k))break;if(h===null&&n==="unread"){h=d,t=h,p.push(d),g=d,a.fetchOther=e.Lang.later(H,a,y
,g);break}n==="other-unread"&&p.push(d),v++}}!p.length&&n!=="other-unread"&&(t=f.msgs.length-1,p.push(t));break;case"adjacent":l=t,t+C+1>f.msgs.length?c=f.msgs.length:c=t+C+1;for(l;l<c;l++)p.push(l);break;case"send":case"other-send":t=null;for(d=0;d<f.msgs.length;d++)a.getMsgFid(f.msgs[d])==="Sent"&&(p.push(d),t=d);n==="other-send"&&p.length&&p.pop();break;case"draft":t=null,u=!1,a.listNode.all(".loadhide").removeClass("loadhide"),a.getRoot()&&a.getRoot().one(".conv-loading").addClass("hidden")}a.selMsgIdx=t,u&&e.Lang.isNumber(t)&&(a.primaryMid=a.message.msgs[t].mid),a.loadMessageCards(t,p,r,i,s,o,n)}function qt(e){var t=this,r=parseInt(e.getComputedStyle("height"),10);e.setStyles({height:r+"px",overflow:"hidden"}),setTimeout(function(){e.setStyle("transition",""),e.setStyle("height",P+"px"),M.enabled("messageReadPaneV2")&&e.removeClass("expanded")},0),setTimeout(function(){e.removeClass("expanded"),e.setAttribute("aria-expanded","false"),e.one(".thread-body").setContent(""),t.fire("darlaEvent",{action:t.fullView?"message_tabpane":"msgread_reading_pane"}),n.features.enabled("messageReadAdr")&&t.startAdRotationTimer(),t.fire("MessagePane:unload",e),it()},200)}function Rt(t,r,i,s,o,u,a){function S(e,t){p=f.getMsgFid(e),t.inRegion(f.listNode)&&t.hasClass("expanded")&&t.hasClass("unread")&&f.markConvMsgAsRead(p,e)}var f=this,l,c=t.mid,h=this.getMsgMarkUp({message:t,expand:!0,replyMode:s}),p,v=o!==!1,m,g,b,w,E;try{if(i.hasClass("collapsing")||i.hasClass("expanding"))return;return i.hasClass("thread-focus")&&(E=!0),i.replace(h),i=f.getMsgNodeByMid(c),E&&(f.selNode=i,f.focusMessageCard()),i.removeClass("loadhide"),t.body&&(i.one(".body").setContent(d.processBodyMarkup(t.body.display||"")),St(i),f.autoLoadNonDisplaybleTruncMsg(t,i,r),v&&f.initialRender?(l=parseInt(i.getComputedStyle("height"),10),i.setStyles({transition:"none",height:P+"px"}),a&&f.scrollOnExpansion&&f.scrollToMsg(t),M.enabled("markExpandedAsRead")||S(t,i),f.fire("darlaEvent",{action:f.fullView?"message_tabpane":"msgread_reading_pane"}),setTimeout(function(){i.setStyle("transition",""),i.setStyle("height",l+"px")},0),e.later(200,i,i.setStyles,{height:"auto",overflow:"visible",transition:"none"})):i.setStyles({height:"auto",overflow:"visible",transition:"none"}),d.plainTextMessage(t.part)?(m=i.one(".thread-body .body"))!==null&&(w="addClass"):w="removeClass",w&&m&&m.parentNode&&(m[w]("plaintextMsg"),m.parentNode[w]("compose"),w=undefined),i.removeClass("loading"),f.scrollTop&&(b=f.get("rootNode").one(U),setTimeout(function(){b.set("scrollTop",f.scrollTop)},200))),t.loading_error||f.convMsgRenderComplete(t,i,u),g=f.expandMessageTimers[y(t.mid)],g&&g.cancel(),e.fire("MessagePane:messageExpandDone",{mid:t.mid,cid:f.message.cid}),it(),i}catch(x){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4",x,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4"),e.use("common-utils-error",function(){n.error.report("showMessage exception. previewPane mode:"+NeoConfig.previewPanePref,x,1,1,1)})}}function Ut(e,t){var n=this,r,i=t||[],s,o;for(o=0;o<i.length;o++)r=i[o],s=n.getMsgNodeByMid(r.mid),s&&(s.addClass("load-error"),s.one(".load-error-msg").setContent(r.msgPermDeleted?strings.str_msg_deleted_error:strings.str_msg_load_error_generic))}function zt(t,r,i,s,o,u,a,f,l){function b(){var n,r,i;if(e.Lang.isNull(t))return;n=e.Lang.isArray(t)?t[0]:t,r=c.getMsgNodeByMid(c.message.msgs[n].mid);if(!c.expandAllMode){l||(c.selNode=r);if(!a||y&&n>0)i=r,setTimeout(function(){a||(c.listNode&&c.listNode.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading")&&g.one(".conv-loading").addClass("hidden")),y&&n>0&&c.listNode&&c.listNode.set("scrollTop",i.get("offsetTop")-12)},0)}else c.selNode=null}var c=this,h=0,p,d,v,m,g=this.getRoot(),y=u===!0;o&&o.start(1,"MessageInDOM"),n.isQualifiedForCoupons()&&c.parentNode.one(".threadpane .toggle-button")&&c.parentNode.one(".threadpane .toggle-button").remove(!0);for(h=0;h<r.length;h++){p=r[h],d=c.getMessageIdxByMid(p.mid),v=c.getMsgNodeByMid(p.mid);if(!v&&!M.enabled("yodaConversationRead",!1))continue;f?(v.hasClass("expanded")||v.addClass("expanded"),c.convMsgRenderComplete(p,v,o)):$.isDraftFid(p.fid)||c.showMessage(p,d,v,i,s,o,y),M.enabled("markExpandedAsRead")&&c.markConvMsgAsRead(c.getMsgFid(p),p)}f&&(g.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading").addClass("hidden")),c.initialRender=!0,o&&(c.fire("renderConvComplete"),c.fullView&&c.fire("read-stat:renderCompleteOnUpdate"),NeoConfig.hasConvView&&setTimeout(function(){e.fire("tutorConvMsgPaneRendered")},200)),h=c.primaryMid?1:0,m=function(){var e=new n.Stopwatch(c.fullView?"MsgInTab":"MsgInPreview");e.wasCached=!0,e.stop()};for(;h<r.length;h++)setTimeout(m,(h+1)*250);c.primaryMid=null,c.parentNode&&c.parentNode.ancestor("body")?(b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)):c.once("activeChange",function(){b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)}),M.enabled("expiringCoupons")&&n.isQualifiedForCoupons(n.getVal(c,"message.msgs.0.header.sender",!1))&&e.use("mail-ui-coupons-tracking-option",function(e){e.mail.ui.couponsTrackingOption.subscribeTracking({mid:c.message.msgs[0].mid,srcNode:c.parentNode.one(".threadpane")})})}function Wt(){var e=[];this.message&&(e=this.message.msgs),e.forEach(function(e){pt(e)&&e.body&&this.markConvMsgAsRead(this.getMsgFid(e),e)},this)}function Xt(){var e=this;return e.listNode?e.listNode.all("."+x):null}function Vt(e,t){t.scrollFocus&&this.listNode.set("scrollTop",e.get("offsetTop")-5)}function $t(e,t){var n=this,r={truncateAt:null},i=n.get("rootNode").one(U);n.scrollTop=i.get("scrollTop"),n.msgTrucationStatus.disabled[e.mid]=!0,n.expandMessages(t,"one","yes",!1,r)}function Jt(e,t){var n=this,r={midRequest:{blockImages
:"none"}};n.expandMessages(t,"one","yes",!1,r)}function Kt(e,t,n){var r=this,i=r.message;t||(i.body=i.attachments=i.imgAttachments=i.nonImgAttachments=0),r.loadMessage(1,e,n)}function Qt(){var e=this,t=e.loading_slow?2:1;e.loading_slow=e.loading_error=e.loading_moved=0,t>0&&t<=6&&(e.numRetries=e.numRetries?e.numRetries+1:1,e.numRetries>=e.maxRetries),e.loading_slow=e.loading_error=e.loading_moved=0,e.fireEvent("retry"),e.loadPaneContent(6,t),e.set("transferFocus",1)}function Gt(t,n){var r=this,i=t||[],s,o,u=i.length;if(NeoConfig.enableMessagePrefetch){e.fire("prefetchConversations",{fid:r.fid,cids:i});return}for(o=0;o<u;o++)s||(s=v.batch()),s.setAsReadOp(!0),g.batchAddConvPrefetch(s,o,r.fid,i[o],n);s&&s.execute({suppressCodes:["*"],backgroundLogs:["*"]})}function Yt(){var t=this,n;!NeoConfig.backButtonFull&&t.fullView===!0&&e.fire("initPage"),t.quickReplyBox&&(t.quickReplyBox.one("#switchtext-plain").addClass("hidden"),t.quickReplyBox.one("#switchtext-rich").removeClass("hidden")),NeoConfig.hasConvPerf&&t.fid!=="%40B%40Bulk"&&t.fid!=="Trash"&&!t.midtocid&&setTimeout(function(){t.prefetch(t.neighbors,"Neighbors")},Math.min(H+50,B)),t.fullView?n="thread_tabpane":n="msgread_reading_pane",e.fire("mt:view",{action:n})}function Zt(){}function en(e){var t=this,n=e.insertObj,r,i,s,o,u,a,f,l,p;r=n.msg,s=n.replace||0;if(t.message){i=n.pos!==undefined?n.pos:t.message.msgs.length,a=r.fid,r.header||(r=c.Messages.toMessage(a,r)),t.message.msgs.splice(i,s,r),t.message.midMap.splice(i,s,{fid:r.fid,mid:r.mid}),t.message=h.Conversations.calcConvSummary(t.message),p=t.message.msgs,u=p.length;for(o=0;o<u;o++)l=y(p[o].mid),t.midObjMap[l]=o;e.render&&(f=t.getMsgMarkUp({message:r,expand:e.expand||!1}),t.quickReplyBox?t.listNode.insertBefore(f,t.quickReplyBox):t.listNode.append(f),J?t.expandMessages(t.message.msgs.length-1,"one",e.anim,undefined,e.ovparams):t.expandMessages(t.message.msgs.length-1,"one",!0)),t.updateCount()}}function tn(){var e=this,t,n=e.message.totalMsgs,r=e.getRoot().one(E);r&&(n>1?t="("+n+")":t="",r.set("innerHTML",t))}function nn(){var t=e.one("#subject-field"),n=e.one(w+" .thread-subject");t.get("value")!==""?(n.set("innerHTML",t.get("value")),n.set("title",t.get("value"))):(n.set("innerHTML",strings["str_msg-view_no_subject"]),n.set("title",strings["str_msg-view_no_subject"]))}function rn(e,t){e&&(t.hasTO===!1&&e.one(".cm-to-group").addClass("hidden"),t.hasCC===!1&&e.one(".cm-cc-group").addClass("hidden"),t.hasBCC===!1&&e.one(".cm-bcc-group").addClass("hidden"))}function sn(e){e&&(e.one(".cm-to-group").removeClass("hidden"),e.one(".cm-btn-show-cc.hidden")&&(e.one(".cm-cc-group").removeClass("hidden"),e.one(".cm-bcc-group").removeClass("hidden")))}function on(e,t){var n=this,r;e&&!e.hasClass("instant-quick-reply-card")&&(r=e.one(K),r&&(r.blur(),r.removeAttribute("contenteditable")),e.addClass("instant-quick-reply-card"),n._transformHeader(e,t),n._transformBody(e),n._transformFooter(e))}function un(e){var t,n,r,i,s,o;e&&(t=e.one(K),n=e.one(".custom-sender-info"),i=e.one(".custom-footer-info"),r=e.one(".custom-quoted-text"),s=e.one(Q),o=e.one(".cm-cc-group.hidden"),this._showRecipientsFields(e),n&&n.remove(),r&&r.remove(),i&&i.remove(),s&&(s.setStyle("min-height","180px"),o||s.setStyle("margin-top","0")),e.removeClass("instant-quick-reply-card"),t.focus(),t.setAttribute("contenteditable",!0))}function an(e,t){var n,r,i;e&&(n=e.one(K),r=e.one(".compose-header.fresh"),i=this._getHeaderTmpl(t.from),this._hideRecipientsWhenEmpty(e,t),n&&r&&i&&r.prepend(i))}function fn(e){var t,n,r,i,s;e&&(t=e.one(K),r=e.one(".yahoo_quoted"),n=e.one(Q),i=this._getCollapsedQuotedTmpl(),s=e.one(".cm-cc-group.hidden"),t&&(r&&i&&r.insert(i,"before"),n&&(n.setStyle("min-height","0"),s||n.setStyle("margin-top","-10px"))))}function ln(e){var t,n,r;e&&(t=e.one(K),n=e.one(".footer-separator"),r=this._getDisabledFooterTmpl(),t&&n&&r&&n.insert(r,"before"))}function cn(t){var i,o,u,a;return t&&(u="&lt;"+(s(t.email)||"")+"&gt;",i={from_name:s(t.name)||"",from_id:u,sender_email_address:u},o={received_date:new Date,date:strings.str_mail_today+n.substitute(strings.str_smw_date_time,{date:"",time:""})+n.dateFormatter(new Date,strings.str_smw_today_date)},a=e.Node.create('<div class="custom-sender-info">'+r(f.unread_icon,{flag_info_hover:"info-unread"})+r(f.from,i)+r(f.thread_date,o)+r(f.flag_icon)+"</div>"),a.all("*[data-action]").removeAttribute("data-action")),a}function hn(){var t={str_reply:strings.str_reply,str_reply_all:strings.str_reply_all,str_forward:strings.str_forward,str_more:strings.str_more},n=e.Node.create(r(f.with_icons,t));return n&&(n.all("*[data-action]").removeAttribute("data-action"),n.addClass("custom-footer-info")),n}function pn(){var t=e.Node.create(r(f.quoted_text_collapse,{str_qtd_expand:strings.str_qtd_expand}));return t&&(t.all("*[data-action]").removeAttribute("data-action"),t.addClass("custom-quoted-text")),t}e.namespace("mail.ui");var t=e.mail.ui._ConvPane,n=e.common.Utils,r=n.substitute,i=n.ezSub,s=n.escapeHtml,o=n.ymmastats,u=n.unescapeHtml,a=e.ui.Templates,f=a._shared_module_thread_thread_display_rollup,l=e.mail,c=l.model.DataStore,h=l.model.ConvStore,p=l.ui.PaneUtils,d=l.ui.MessagePaneUtils,v=l.Controller,m=l&&l.Controller?l.Controller.Messages:{},g=l&&l.Controller?l.Controller.Conversations:{},y=c.Messages.getPermMidPart,b=h.Conversations.getPermCidPart,w=".message-header",E=w+" .summary",S=w+" .badge",x="thread-item",T="expanded",N="unread",C=2,k=NeoConfig.convMsgsToOpenCount||5,L=NeoConfig.convMsgsToOpenCount||5,A=e.mail.persist.MetaData,O=n.settings,M=n.features,_=O.value("verifiedInboxServicesDomainsMap",{}),D=O.value("SUPER_COLLAPSE_THRESHOLD")||6,P=M.enabled("messageReadPaneV2")?24:21,H=10,B=175,j=5,F=strings.str_cfg_tog_hkr_siu===!0?"hkr_siu":"cg_siu",I=strings.str_cfg_tog_hkr_siu===!0,q={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},R=[],U=".thread-item-list",z=M.enabled("hideRecipients"),W=O.value("recipientThresholdVal"
)||5,X={to:!1,cc:!1,bcc:!1},V=M.enabled("squeezeToolbar"),$=e.mail.ui.FolderUtils,J=M.enabled("instantCloseOnSend"),K=".cm-rtetext",Q=".inner",G=M.enabled("attachMenuInOldToolbar",!1),Y=G?!0:!1,Z=M.enabled("stationeryIconPlaceholder",!1),et=function(e){var t=this;e=e||{},et.superclass.constructor.call(t,e)};e.extend(et,l.ui.MailPaneRead,{setFullFormatters:ut,onSuccess:at,bindPaneContent:Tt,retryLoad:Qt,unblockImages:Jt,viewFullMsg:$t,autoLoadNonDisplaybleTruncMsg:xt,changeRequest:Kt,searchRecipients:Zt,postRender:Yt,prefetch:Gt,getMsgMarkUp:ot,selectMessage:Pt,scrollToMsg:Ht,expandMessages:It,collapseMessage:qt,loadMessageCards:Dt,showMessage:Rt,showMessages:zt,showNotification:Ut,setActiveCompose:lt,getActiveCompose:ft,hasDrafts:Ot,saveDrafts:ct,insertMsgAtPos:en,loadMenu:_t,expandReplyCard:Vt,toggleAllMessageCards:jt,handleToggleAllMessageCards:Bt,lftCongruencyCheck:Nt,lftSendSaveCongruencyCheck:Ct,expandSuperCollapsedNodes:kt,initializeCompose:At,initializeAllDrafts:Lt,initReplyForward:Mt,updateCount:tn,updateSubject:nn,closeAllCompose:ht,markConvMsgAsRead:dt,convMsgRenderComplete:mt,bindContentUI:Et,fetchMoreMsgs:Ft,checkMsgCardsOnScroll:bt,checkAdsOnScroll:yt,scheduleScrollHandler:wt,onPaneScroll:gt,getAllCards:Xt,markAsReadBatch:vt,getInboxService:st,markExpandedMsgsAsRead:Wt,_getHeaderTmpl:cn,_getDisabledFooterTmpl:hn,_getCollapsedQuotedTmpl:pn,_transformComposeToCard:on,_reverseTransformComposeToCard:un,_transformHeader:an,_transformBody:fn,_transformFooter:ln,_hideRecipientsWhenEmpty:rn,_showRecipientsFields:sn}),e.mix(t.prototype,et.prototype),e.mix(t.prototype,l.ui.MailPaneRead.prototype)},"1.0.0",{requires:["_shared_module_thread_thread_display_rollup","common-persist-user-data","common-ui-tabs-base","common-utils-stats","contacts-api","contacts-api-utils","mail-persist-meta-data","mail-platform","mail-ui-convpane-base","mail-ui-convpane-bind","mail-ui-mailpane-read","mail-ui-messagepane-utils","mail-ui-messagepane-warnings","mod-conversation-history_css","mail-common-utils-features","mail-common-utils-settings","mail-ui-pane-utils","common-utils","mail-ui-folder-utils","mail-ui-deeplink-manager"]});
YUI.add("mail-common-precache-thread",function(e){e.namespace("mail.ui");var t=e.mail,n=t.ui.ConvList,r=t.model.ConvStore.Conversations,i="unreadConv";NeoConfig.preCacheAlgorithm=i,n.getNeighbors=function(e,t,n,i,s){function v(t){var n;return(n=e[t])&&(!r.isCached(i,n.cid)||NeoConfig.yodaReadEnabled)?(n&&n.totalUnread>0?u.push(n):a.push(n),1):0}if(!(e&&e.length&&t>=-1&&t<=e.length-1&&NeoConfig.hasConvView))return;var o=s||(NeoConfig.yodaReadEnabled?4:s),u=[],a=[],f=[],l=1,c=0,h=0,p=s||2,d=1;while(l){h<p&&!v(t-d)&&h++,c<p&&!v(t+d)&&c++,l=u.length+a.length<o&&(h!==p||c!==p),d++;if(d>100)break}f=u.concat(a),f=f.splice(0,f.length>=o?o:f.length);for(d=0;d<f.length;d++)NeoConfig.yodaReadEnabled?f[d].cid&&f[d].fid&&n.push({conversationId:f[d].cid,cfid:f[d].fid}):n.push(f[d])}},"1.0.0",{requires:["mail-ui-convlist-base"]});
