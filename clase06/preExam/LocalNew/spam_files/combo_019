YUI.add("_shared_module_imap_in_send_only",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_imap_in_send_only={base:' <div id="imapInUpsellWrapper"> <img src="{{upsellWrapperUrl}}" height="250"> <p class="upsell-header">{{str_imap_ob_upsell_send_only_wrapper_header}}</p> <p class="upsell-body">{{str_imap_ob_upsell_wrapper_body1}}</p> <p class="upsell-body">{{str_imap_ob_upsell_wrapper_body2}}</p> <div role="button" class="upsell-upgrade">{{str_imap_ob_upsell_wrapper_upgrade}}</div> <p class="upsell-no-thanks">{{str_no_thanks}}</p></div>'}},"1.0.0");
YUI.add("_shared_module_imap_in_alter",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_imap_in_alter={base:' <div id="imapInUpsellWrapper"> <img src="{{upsellWrapperUrl}}" height="250"> <p class="upsell-header">{{str_imap_ob_upsell_alter_wrapper_header}}</p> <p class="upsell-body">{{str_imap_ob_upsell_wrapper_body1}}</p> <p class="upsell-body">{{str_imap_ob_upsell_wrapper_body2}}</p> <div role="button" class="upsell-upgrade">{{str_imap_ob_upsell_wrapper_upgrade}}</div> <p class="upsell-no-thanks">{{str_no_thanks}}</p></div>'}},"1.0.0");
YUI.add("mail-ui-imap-in",function(e){var t,n=e.mail,r=e.common.Utils,i=n.persist.MetaData,s=r.features,o=n.ui.Onboarding,u=r.settings,a=u.value("imapProviderDomain"),f=r.substitute,l=n.Controller.ImapIn,c=r.escapeHtml,h=n.FoldersView,p=r.ezSub,d="invisible",v="#accountListnav",m="single-account",g="multiple-account",y=e.one("#shellcontent"),b=e.one(v),w=e.one("#imapNavWrapper"),E=e.one("body"),S=NeoConfig.accounts.imapInAccounts&&NeoConfig.accounts.imapInAccounts.length+1||1,x=e.one("#storm-listnav"),T=n.ui.FolderUtils,N=[];t=function(){function t(e,t,n){var r=e.id,i="unsynced",s=T.getInboxFid(r),o;switch(n){case"start":s||(N.push(r),t.addClass(i),t.one(".status-icon").set("title",p(NeoConfig.strings.str_nav_left_pending_title,{account_name:e.email})));break;case"done":o=N.indexOf(r),o>-1&&N.splice(o,1),t.removeClass(i),t.one(".status-icon").set("title",strings.str_nav_left_syncing_title);break;default:}}function n(t,r,i,s){var o=NeoConfig.imapSyncTime*6e4,u=s?"syncing":"pending";switch(i){case"start":r.addClass(u),s?setTimeout(e.bind(n,null,r,"done"),o):r.one(".account-status").set("title",p(NeoConfig.strings.str_nav_left_pending_title,{account_name:t.email}));break;case"done":r.removeClass(u);break;default:}}function v(r,i){var s=r.id,o=e.one('[data-fid="'+s+'"]');n(r,o,"start",i),i&&t(r,o,"start")}function C(t){var n=t.status==="ENABLED",r,i;S++,S===2&&E.replaceClass(m,g),t=t||{},r=t.description||t.email,i=t.email,e.use("minty_module_shell_navigation_pane_account_item",function(){var s=e.ui.Templates.minty_module_shell_navigation_pane_account_item;b.append(e.Node.create(p(s.base,{account_icon:"icon-mail-inbox",account_title:i,account_text:c(r),account_id:t.id,isSelected:t.isPrimary?!0:!1,isPrimary:t.isPrimary?!0:!1,account_action:"load-account"},s))),v(t,n)})}function k(t){var n='[data-fid="'+t.id+'"]',r=e.one(n),i=NeoConfig.strings,s,o;r&&(s=t.description,s||(t.isPrimary?s=i.str_branding:s=t.email),o=r.one(".foldername"),o&&o.setHTML(c(s)))}function L(t){t.preventDefault(),e.fire("openOptions",{view:"accounts"})}function A(e,t,n){var r=NeoConfig.upsellEmail,s=r&&r.accountType,u=s==="SENDAS",a=s==="ALTER",f,l,c,h;if(!r||!a&&!u)return;a?(f="neo.pref.imapInUpsellAlt",l="imapInUpsellAltNav",c="neo.pref.imapInUpsellAltNav",h="imapInUpsellAltSetting"):u&&(f="neo.pref.imapInUpsell",l="imapInUpsellSendOnlyNav",c="neo.pref.imapInUpsellSendOnlyNav",h="imapInUpsellSendOnlySetting"),n?(o.closeDefaultOnboarding(h),r=null):r.navStatus=null,i.set(f,1),i.set(c,1),o.closeDefaultOnboarding(l),w&&w.remove(!0),x.setStyle("display",""),y.removeClass("imapin-upsell"),t&&t.remove(!0)}function O(t,n,r,i,s,l){var c=NeoConfig.upsellEmail,h=c&&c.email,p=c&&c.accountType,d=c&&c.emailDomainBrand,v=p==="SENDAS",m=p==="ALTER",g=u.value("imap_in_upsell_poster_url"),w,E,S,T,N,C,k;if(m)E=e.ui.Templates._shared_module_imap_in_alter,w="imapInUpsellAltNav";else{if(!v)return;E=e.ui.Templates._shared_module_imap_in_send_only,w="imapInUpsellSendOnlyNav"}o.closeDefaultOnboarding(w),n=b.all(".account-item-li"),n.removeClass("selected"),r.addClass("selected"),x.setStyle("display","none"),y.addClass("imapin-upsell"),s?s.setStyle("display",""):(S=strings[a[d].strRid]||strings.str_email_cnt_one,T=g[d]||g.yahoo,i.insert(f(E.base,{mailProvider:S,upsellWrapperUrl:T},null,null,strings),"after"),s=e.one("#imapInUpsellWrapper"),N=s.one(".upsell-upgrade"),C=s.one(".upsell-no-thanks"),N.on("click",function(){e.fire("util:ymstats",{name:"imapInUpsellAction",tags:{type:p.toLowerCase(),button:"upgrade",position:"navwrapper"}}),e.on("removeUpsellAccount",function(){A(i,s,!0)}),e.fire("openOptions",{view:"accounts",subView:{sid:"upgradeUpsell",type:p,accId:l,domain:d,emailAddr:h},origin:"imapInUpsell"})}),C.on("click",function(){e.fire("util:ymstats",{name:"imapInUpsellAction",tags:{type:p.toLowerCase(),button:"nothanks",position:"navwrapper"}}),A(i,s,!1),k=function(t,n){n==="imapInSetting"&&e.fire("openOptions",{view:"accounts",subView:{sid:"upgradeUpsell",type:p,accId:l,domain:d,emailAddr:h}})},e.common.ui.NotificationV2.notify(f(strings.str_imap_ob_upsell_notification,null,null,null,strings),{type:"info",duration:1e4,cbk:k})}))}function M(t){var n=t.target,r=t.currentTarget,i=!r.hasClass("selected"),o=l.getCurrentAccountId(),u=r.getAttribute("data-fid"),a=e.one("#inboxcontainer"),f=e.one("#imapInUpsellWrapper"),c,h,p;if(r.hasClass("pending")||r.hasClass("unsynced")||n&&n.hasClass("renamer"))return;if(n&&n.getAttribute("data-action")==="reauth"){t.halt(),e.fire("openOptions",{view:"accounts",subView:{sid:"edit",accId:u}}),e.fire("util:ymstats",{name:"reauth_leftrail_click",include:{farm:!0}});return}s.enabled("reAuthAlerts")&&r.hasClass("reauth-alert")&&e.common.ui.NotificationV2.notify(strings.str_nav_left_reauth_alert_notification,{type:"error",cbk:function(t,n){n==="options"&&(e.fire("openOptions",{view:"accounts",subView:{sid:"edit",accId:u}}),e.fire("util:ymstats",{name:"reauth_notification_click",include:{farm:!0}}))},duration:1e4,speed:"fast"});if(NeoConfig.upsellEmail&&!NeoConfig.upsellEmail.navStatus){if(r.hasClass("imapfolder")&&r.hasClass("needSetup")){O(t,c,r,a,f,u);return}x.setStyle("display",""),y.removeClass("imapin-upsell"),f&&f.setStyle("display","none")}e.fire("accounts:select",{acctId:u,isPrimary:r.hasClass("primary"),switchAccount:i,prevAcctId:o}),e.fire("mt:click",{action:"account_switch_"+(u==="1"?"primary":"external")}),i?(l.setCurrentAccount(u),c=b.all(".account-item-li"),c.removeClass("selected"),r.addClass("selected")):(h=x.one(".in"),p=h.hasClass("selected"),p||(c=x.all(".sysfolder, .folder"),c.removeClass("selected"),h.addClass("selected")))}function _(e){var t=e.id,n='[data-fid="'+t+'"]',r=w.one(n),i=l.getCurrentAccountId(),s=w.one(".account-item-li.primary");t!==Neo.getPrimaryAccountId()&&r&&S>1&&(S--,r.remove(),t===i&&M({currentTarget:s}),S===1&&E.replaceClass(g,m))}function D(t){e.use("mail-ui-folderevents",function(e){t.isAccount=!0,e.mail.ui.FolderEvents.handle(t)})}function P(t){var n=b.menu.getContextTarget
(),r,i;if(n){t.target=n.ancestor(".account-item-li",!0),i=t.dataAction,r=t.target.getAttribute("data-fid");switch(i){case"account-new":e.fire("openOptions",{view:"accounts",subView:{sid:"providerList"}});break;case"account-rename":D(t);break;case"account-edit":e.fire("openOptions",{view:"accounts",subView:{sid:"edit",accId:r}})}e.fire("mt:click",{action:"cntxt_mnu_imap_acct_itm_"+i})}}function H(){var t=b.menu,n=t.getContextTarget().ancestor(".account-item-li"),r=e.one("#menu-account");r.setAttribute("data-context",n.hasClass("pending")||n.hasClass("unsynced")||n.hasClass("imapfolder")&&n.hasClass("needSetup")?"rclick-disabled":"")}function B(t){t.preventDefault(),e.use("common-ui-menu-helper","minty_module_shell_navigation_pane_account_menu",function(e){if(!b.menu){var n=e.common.ui.MenuHelper,r=e.ui.Templates.minty_module_shell_navigation_pane_account_menu,i=e.Node.create(p(r.base,{},r));E.append(i),n.create(b,{menu:i,isContext:!0,xy:[t.clientX,t.clientY],contextTarget:t.target,setVisibleCbk:H},function(){i.on("menuSelected",P)})}})}function j(t){var n=t.target,r=n.getAttribute("data-action");switch(r){case"manage-accounts":L(t);break;case"folder-search":e.use("mail-ui-folderevents",function(e){e.mail.ui.FolderEvents.handle({dataAction:"folder-search",target:t.currentTarget})});break;case"add-new-folder":e.fire("newfolder:pressed",n.getAttribute("id"));break;default:}}function F(t){var n,i,s,o,u;for(u in t)i=t[u],o=b.one('.account-item-li[data-fid="'+u+'"]'),o&&(s=o.one(".unread-count"),i.acctUnreadCount>0?(s.setHTML("("+r.getNormalizedMessageCount(i.acctUnreadCount)+")"),s.removeClass(d)):(s.addClass(d),s.setHTML("")),s.set("title",p(strings.str_nav_folder_unread_cnt,{unread_cnt:i.acctUnreadCount+""})));n=e.mail.model.DataStore.Accounts.getCurrentAccount(),n=n&&n.id||Neo.getPrimaryAccountId(),e.mail.FoldersView.updateFolderUnreadCountMarkup(t[n])}function I(){var t=w.one(".list-separator"),n="collapsed";w.hasClass(n)?(t.setAttribute("title",strings.str_nav_left_accounts_expanded),e.fire("mt:click",{action:"toggle_account_list_expand"})):(t.setAttribute("title",strings.str_nav_left_accounts_colapsed),e.fire("mt:click",{action:"toggle_account_list_collapse"})),w.toggleClass(n)}function q(){var n=window.Mousetrap;e.on("ds:account:add",C),e.on("ds:account:remove",_),e.on("ds:account:update",k),e.on("ds:folder:change",function(){var e=N.length,n,r,i,s;for(s=0;s<e;s++)n=N[s],T.getInboxFid(n)&&(r=b.one('[data-fid="'+n+'"]'),i={id:n},t(i,r,"done"))}),w.delegate("click",j,"a .btn-action"),b.delegate("click",M,"li"),b.delegate("contextmenu",B,"li"),b.delegate("dblclick",function(e){e.halt();if(e.currentTarget.hasClass("pending")||e.currentTarget.hasClass("unsynced"))return;h.handleFolderActions({dataAction:"account-rename",target:e.currentTarget,actionSource:"activeFolder",isAccount:!0})},"li"),w.one(".list-separator").on("click",I),n.bind(["command+shift+a","ctrl+shift+a"],L,"keydown"),e.once("ws:postLoad",function(){if(NeoConfig.isEmailOrPhoneReg){var t=l.getSelectedAccountId(),n;l.setCurrentAccount(t),n=b.one('[data-fid="'+t+'"]'),n.addClass("selected"),e.fire("accounts:select",{acctId:t,isPrimary:!1,switchAccount:!0,prevAcctId:Neo.getPrimaryAccountId()})}})}function R(){q()}R(),e.mix(this,{updateAccountsUnreadCount:F,addAccountItemMarkup:C,updateAccountItemMarkup:k,removeAccountItemMarkup:_,addSyncingMarkup:v,switchSyncingIcon:n,toggleAccounts:I,manageAccount:L,selectAccount:M,renameAccount:D,accountMenuSelected:P,accountContextMenu:B,handleImapNav:j,bindUI:q,init:R})},e.namespace("mail.ui").ImapIn=new t},"1.0.0",{requires:["common-utils","mail-controller-imapin","mail-ui-foldersview-base","mail-model-datastore","mail-ui-folder-utils","mail-common-utils-features","mail-ui-onboarding","mail-persist-meta-data","mail-common-utils-settings","common-ui-notification-v2","_shared_module_imap_in_send_only","_shared_module_imap_in_alter"]});
