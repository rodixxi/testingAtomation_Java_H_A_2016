YUI.add("mail-ui-desktop-notifications",function(e){function o(){return!!window.Notification&&!a()}function u(){return e.mail.persist.MetaData.get(t)}function a(){return e.one("#ynano_installed_YSet")||e.one("body").hasClass("yahoo_firefox_mail_jid1-kMGMgjmcncOBpw")}function f(n){e.mail.persist.MetaData.set(t,n)}function l(e,t){var n=e&&e.trim()||"";return n.length>t?n.substr(0,t)+"...":n}function c(t,i,s,o){return t||e.fire("util:ymstats",{name:"notifications_notify_noimage",tags:{agent:NeoConfig.browser},include:{bucket:!0}}),window.Notification.permission==="granted"||NeoConfig.isWinApp?new window.Notification(l(i,n),{body:l(s,r),icon:t,lang:NeoConfig.lang,tag:o}):null}function h(){var t=s.settings.value("yahooMailNotificationLogo"),n;if(e.UA.gecko)n=50;else{if(!e.UA.chrome)return"";n=80}return typeof window.devicePixelRatio!="undefined"&&window.devicePixelRatio>=2&&(n*=2),t+=n+"x"+n+"_2.png",t}function p(){return u()==="denied"?!1:u()==="granted"&&window.Notification.permission==="granted"?!1:!0}function d(){return!NeoConfig.isWinApp&&u()==="granted"&&window.Notification&&window.Notification.permission==="default"}function v(t,n,r,i,s){var a;if(NeoConfig.isWinApp||o()&&u()==="granted")a=c(s||h(),t,n,i),a&&(r?a.onclick=r:a.onclick=function(){a.close()},e.UA.chrome&&e.later(e.common.Utils.settings.value("notificationToastTimeOut",7e3),null,function(){a.close()}));return a}function m(e,t){o()&&p()&&(!i||t)&&(i=!0,window.Notification.requestPermission(function(t){e&&e(t)}))}function g(){var t=new window.Notification(strings.str_mail_notif_activated_hd,{body:strings.str_mail_notif_activated_bd,icon:h(),lang:NeoConfig.lang});e.fire("notificationSuccess"),t.onclick=t.close}function y(t){o()&&e.use("mail-ui-desktop-notifications-mail",function(e){e.mail.ui.mailDesktopNotifications.init(t)})}var t="neo.pref.desktopNotification",n=50,r=90,i=!1,s=e.common.Utils;e.namespace("mail.ui").desktopNotifications={notify:v,initNotifyModel:y,_getImageURL:h,_trimText:l,_needPermission:p,currentBrowserNeedsPermission:d,showIntroToast:g,getSavedPreference:u,setSavedPreference:f,getUserPermission:m,browserSupportNotification:o}},"1.0.0",{requires:["node","mail-persist-meta-data","common-utils"].concat(NeoConfig.isWinApp?["mail-ui-windows-helper"]:[])});
