YUI.add("mail-models-draft",function(e){function u(e){return!!r[e]}function a(e){var t={};return e.name&&(t.name="Doe"),e.email&&(t.email="doe@x.com"),t}function f(t,n){switch(t){case"simpleBody":n.html&&(n.html="<html-filtered>"),n.text&&(n.text="<text-filtered>");break;case"to":case"cc":case"bcc":case"from":case"replyTo":e.Lang.isArray(n)&&e.Array.each(n,function(e){n=a(e)})}return n}function l(){this.csid=null,this.mid=null,this.cid=null,this.state="uninitialized",this.captcha=null,this.to=[],this.cc=[],this.bcc=[],this.replyto={name:"",email:""},this.from={name:"",email:""},this.subject="",this.body={html:"",text:""},this.origin={action:null,fid:null,oMsg:null,yqtdPrefix:"",ctxReq:null,forwardAsAttachment:!1,errInfo:null},this.folder={id:""},this.attachments=[],this.inreplyto="",this.references=[],this.spame="U",this.draftModelId=s++,this.publish("stateChanged"),this.isRead=!0}var t=e.common.Utils.verify,n=e.common.Utils.guid,r=e.Array.hash(["uninitialized","saved","unsaved","saving","savingAndSending","sending","captchaing","sent","final"]),i={id:"GetDisplayMessage",uri:"/ws/mail/v2.0/jsonrpc",method:"POST",payloadType:"embedded",payload:{method:"GetDisplayMessage",params:{fid:"Sent",enableRetry:!0,textToHtml:!0,urlDetection:!0,emailDetection:!0,qtAnnotate:{enable:!0},emailComposeUrl:"mailto:%e%",truncateAt:1e5,charsetHint:"",annotateOption:{annotateText:"inline"},message:[{blockImages:"none",restrictCSS:!0,expandCIDReferences:!0,enableWarnings:!0,mid:"$(mid)"}]}}},s=1,o=e.Array.hash(["Y","N","C","U"]);e.mix(l.prototype,{fireEvent:function(t){try{this.fire.apply(this,arguments)}catch(n){e.fire("MailLog",{m:"ComposeV3: Draft: Exception occured while firing event : "+t,exp:n})}},addAttachment:function(e){this.attachments.push(e);if(!e.contentId()){var t="<"+n()+"@yahoo.com"+">";e.setContentId(t)}this.fireEvent("attachmentAdded",e)},removeAttachment:function(e){var t=0,n=this.attachments;for(t=0;t<n.length;t++)if(n[t].contentId()===e){n[t].setState("deleted");break}},isFresh:function(){var t=this.origin.oMsg&&this.origin.oMsg.sourceFolderInfo&&this.origin.oMsg.sourceFolderInfo.fid,n=e.mail.ui.FolderUtils;return!this.origin.oMsg||!n.isDraftFid(t)},generateCsid:function(){var e;this.hasCsid()||(e="000000000"+(Math.floor(Math.random()*1e9)+Date.now()%1e9).toString(),this.csid=e.substr(e.length-10))},hasCsid:function(){return!!this.csid},hasMid:function(){return!!this.mid},isInConv:function(){return e.common.Utils.getVal(this,"origin.oMsg.cid",null)!==null},isRejectedOnCaptcha:function(){return!!e.common.Utils.getVal(this,"captcha.captchaPayload")},isUploadingAttachments:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return e.state()==="uploading"||e.state()==="pending"}).length>0},hasPendingAttachments:function(){return this.attachments.filter(function(e){return e.state()==="pending"}).length>0},hasPendingOrUploadingAttachments:function(){return this.attachments.filter(function(e){return e.state()==="pending"||e.state()==="uploading"}).length>0},isUploadingInlineImages:function(){return(this.state==="saving"||this.state==="savingAndSending"||this.state==="unsaved")&&this.attachments.filter(function(e){return(e.state()==="uploading"||e.state()==="pending")&&e.isInline()&&e.isImage()}).length>0},getUploadedOrSavedAtt:function(){return this.attachments.filter(function(e){return e.state()==="uploaded"||e.state()==="saved"})},hasAttachmentsToReconcile:function(){return this.attachments.filter(function(e){return e.state()==="saved"||e.state()==="uploaded"||e.state()==="pending"&&e.size()!==0}).length>0},_createAttachJson:function(t,n,r){var i=[],s=2,o;return t=t||{},e.Array.each(n,function(e){var n=e.state(),u=e.size(),a={disposition:e.disposition()},f=n==="saved"||n==="uploaded",l=n==="pending"&&u!==0||r&&n==="uploading";if(f||l)f?(a.messageReference={id:e.mid(),pid:e.partId()},a.contentId=e.contentId()):l&&(o=e.getSourceType()+s,e.setPartId("multipart://"+o),t.iframeUpload&&e.setPartId("multipart://"+t.iframeUpload.multipartName),e.setMultiPartName(o),a.multipartName=e.partId(),a.contentId=e.contentId(),s++),i.push(a)}),i},jsonifyObj:function(t,n){var r=this,i,s=["subject","to","cc","bcc"],o=["folder"],u={actions:{responseMessage:!0,responseMessageV2:!0},message:{csid:r.csid,captcha:r.captchaAnswer,flags:{spam:!1,read:this.isRead},headers:{}},simpleBody:{}};return t=t||{},r.body.html!==""?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,this.attachments.length>0&&(u.simpleBody.attachments=this._createAttachJson(t,this.attachments,n)),r.body.html?u.simpleBody.html=r.body.html:u.simpleBody.text=r.body.text,e.Array.each(o,function(e){u.message[e]=r[e]}),e.Array.each(s,function(e){u.message.headers[e]=r[e]}),i=r.makeInReplyTo(),i?(u.message.inReplyTo=i,u.message.newMessage=!1):u.message.newMessage=!0,r.replyto.email&&(u.message.headers.replyTo=[r.replyto]),u.message.headers.from=[r.from],u},batchSaveJsonifyInfo:function(t,n){var r=this.jsonifyObj(t,n),i,s=[],o="",u,a=[],f=[];f=t.webAttachments;for(i=0;i<f.length;i++)u=f[i].getMultiPartName(),o=u,s.push({id:"id_"+u,uri:f[i].getWebUrl(),method:"GET",filters:{exportResponse:!0},suppressResponse:!0});return a.push({partName:"jsonString",contentType:"application/json",payload:r}),e.Array.each(t.uploads,function(e){if(e.size()===0)return;a.push(e.getPayLoadPartDefinitionForJediBatch())}),{payloadParts:a,webAttRequests:s}},batchJsonifyObject:function(e){var t=e&&e.saveUrl,n={responseType:"json",requests:[]},r=n,s=[],o={select:{mid:"$..message.immutableid"}},u={select:{mid:"$..message.id"}},a,f=e.doSave,l;e.doSend&&(s=[{id:"SendMessage",uri:"/ws/v3/mailboxes/@.id=="+e.mbid+"/messages/@.id=="+(f?"$(mid)":this.mid)+"/send",method:"POST",payloadType:"embedded"}],this.generateCsid(),s[0].payload={csid:this.csid},!f&&this.captchaAnswer&&(s[0].payload.captcha=this.captchaAnswer)),l=this.batchSaveJsonifyInfo(e);for(a=0;a<l.webAttRequests.length;a++)l.webAttRequests
[a].requests=[],n.requests.push(l.webAttRequests[a]),n=l.webAttRequests[a];return f?(n.requests=[{id:"SaveMessage",uri:t,method:"POST",payloadType:"multipart",payloadParts:l.payloadParts}],e.doSend&&(n.requests[0].filters=o,n.requests[0].requests=s,e.doGDM&&(n.requests[0].requests[0].filters=u,n.requests[0].requests[0].requests=[i]))):e.doSend&&(n.requests=s,e.doGDM&&(n.requests[0].filters=u,n.requests[0].requests=[i])),r},batchJsonify:function(t){return e.JSON.stringify(this.batchJsonifyObject(t),null,4)},setRead:function(e){this.isRead=e},jsonify:function(t){return e.JSON.stringify(this.jsonifyObj(t),null,4)},getLogInfo:function(t){var n=this.jsonifyObj(t,!0);return n.draftModelId=this.draftModelId,e.JSON.stringify(n,f)},setState:function(n,r){var i={prev:this.state,next:n};t(u(n),"Draft: Illegal model state: "+n);if(i.prev==="final"||i.prev==="sent"&&i.next!=="final")return;i.next!==i.prev&&e.fire("MailLog",{m:"v3 draft state change",info:"modelID: "+this.draftModelId+", next: "+i.next+", prev: "+i.prev}),this.state=n,r&&(i.err=r),this.fireEvent("stateChanged",i)},setSpame:function(e){t(!!o[e],"Draft: Illegal spame code: "+e),this.spame=e},setHeader:function(e){this.to=e.to||[],this.cc=e.cc||[],this.bcc=e.bcc||[],this.from=e.from||{},this.replyto=e.replyto||{},this.subject=e.subject||""},setOrigin:function(e){this.origin=e;var t=this.origin.oMsg,n,r;t&&(n=this.origin.action==="edit",r={from:t.from,subject:t.subject,cc:n?t.cc:this.cc,bcc:n?t.bcc:this.bcc},this.setHeader(r)),this.fireEvent("originChanged")},setBody:function(e,t){var n=this.body.text!==e||this.body.html!==t;n&&this.state==="saved"&&this.setState("unsaved"),this.body.text=e||"",this.body.html=t||""},notifyBodyChanged:function(e){this.fireEvent("bodyChanged",e)},notifyHeaderChanged:function(e){this.fireEvent("headerChanged",e)},isSaved:function(){return this.state==="saved"},isSpame:function(){return this.spame==="N"},getAccountId:function(){return this.folder&&this.folder.acctId},getSizeInfo:function(){var e={toCount:this.to.length,bccCount:this.bcc.length,ccCount:this.cc.length,subjectSize:this.subject.length,bodySize:this.body.html.length||this.body.text.length,attachments:this.attachments.length,isReply:this.inreplyto?1:0};return e},makeInReplyTo:function(){var t,n,r=!1;return t=e.common.Utils.getVal(this,"origin.oMsg",null),t&&(this.origin.action==="edit"?(n=e.common.Utils.getVal(t,"inReplyToV3MsgRef",null),n&&n.messageReference&&(r={replied:n.replied?!0:!1,forwarded:n.forwarded?!0:!1,messageReference:{id:n.messageReference.id}})):r={replied:this.origin.action==="reply_sender"||this.origin.action==="reply_all",forwarded:this.origin.action==="forward",messageReference:{id:this.origin.oMsg.mid}}),r&&r.messageReference&&r.replied^r.forwarded?r:undefined}}),e.augment(l,e.EventTarget,!0,null,{prefix:"draft"}),e.namespace("Mail.Models").Draft=l},"1.0.0",{requires:["common-utils","event-custom","json","oop","mail-common-utils-features","mail-ui-folder-utils"]});
YUI.add('subcompose_strings', function(Y) {
Y.namespace("mail");
Y.mix(strings,[]);
}, '1.0.0');YUI.add("comms-utils",function(e){e.namespace("comms");var t={},n=e.Lang,r=n.trim,i=/{{([^{}]*)}}/g;e.mix(t,{substitute:function(e,n,r,s,o,u,a){if(typeof e!="string")return;return a&&(e=a.str||e,n=a.obj||n,r=a.formatters||r,s=a.args||s,o=a.strings||o,u=a.templates||u),e.replace(i,function(e,f){var l,c,h=t.substitute;return r&&(l=a&&a.formatters?a.formatters[f]:r[f])?l(n,s,a)||"":n&&f in n?(c=n[f],typeof c=="string"&&c.match(i)?h(c,n,r,s,o,u,a):c):o&&f in o?(c=o[f],c.match(i)?h(c,n,r,s,o,u,a):c):u&&f in u?h(u[f].base||u[f],n,r,s,o,u,a):""})},escapeHtml:function(e){return e===null?null:(e=""+e,e=e.replace(/&(?!(amp|lt|gt|quot|#39|#92);)/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\'/g,"&#39;"),e=e.replace(/\\/g,"&#92;"),e)},unescapeHtml:function(e){return e===null?null:(e=""+e,e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&#39;/g,"'"),e=e.replace(/&#92;/g,"\\"),e)},createAddress:function(e){var n=!1,i=null,s=null,o=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a=e.replace(/\".*\"/g,"");return!r(a)||a.indexOf("@")<0?{fail:!0,email:e,name:t.escapeHtml(e)}:(o.test(e)?(u=e.match(o),s=u[0],i=r(e.replace(s,"")),s=s.substring(1,s.length-1)):s=i=r(e),t.isValidEmail(s)||(n=!0),{fail:n,email:s,name:t.escapeHtml(i)})},isValidEmail:function(e){if(!e)return!1;var t=0,n=e,r=e.lastIndexOf("@"),i=e.substr(0,r),s=i.replace(/\\\\/g,""),o=e.substr(r+1),u=o.length,a=/^(\\.|[A-Za-z0-9!#%&`_=\/$'*+?^{}|~.-])+$/,f=/^"(\\"|[^"])+"$/,l=/^[A-Za-z0-9\-]+$/;!a.test(s)&&!f.test(s)&&(n=!1),o=o.split("."),u=o.length,u<2&&(n=!1);while(t<u)l.test(o[t++])||(n=!1);return n},splitName:function(e){var t={},n,i,s=r(e),o,u,a=[],f=strings.str_name_format.replace(/\{|\}/g,"").split(" "),l=!1,c=!0;f[0]==="family_name"&&(l=!0),f.length<3&&(c=!1);while(s){o=s.match(/([^\u3000\s]*)[\u3000\s]+/);if(!o||o.length!==2||!o[0]){a.push(s);break}a.push(o[1]),s=s.substring(o[0].length)}n=a.length;for(i=0;i<n;i+=1){u=a[i];switch(i){case 0:t[l?"familyName":"givenName"]=u;break;case 1:c&&2<n?t.middleName=u:t[l?"givenName":"familyName"]=u;break;case 2:c?t[l?"givenName":"familyName"]=u:t[l?"givenName":"familyName"]+=" "+u;break;default:t[l?"givenName":"familyName"]+=" "+u}}return t}}),e.comms.Utils=t},"1.0.0",{requires:[]});
YUI.add("mail-model-attachment",function(e){var t=e.common.Utils,n=t.verify,r=t.escapeHtml,i=t.unescapeHtml,s=e.Array.hash(["saved","pending","uploading","failed","infected","deleted","uploaded"]),o={web:"web",file:"file"},u={zip:["thumbnail-fileicon-zip","icon-compressed"],pdf:["thumbnail-fileicon-pdf","icon-pdf"],ppt:["thumbnail-fileicon-ppt","icon-ppt"],doc:["thumbnail-fileicon-doc","icon-doc"],xls:["thumbnail-fileicon-xls","icon-spreadsheet"],mp3:["thumbnail-fileicon-mp3","icon-music"],attachment:["thumbnail-fileicon-attachment","icon-attachment-big"]},a=function(t,f){var l=f,c=t,h="pending",p=f.partId,d=f.contentId,v=f.currentSessionAttachment||!1,m=!0,g=null,y={prefix:"attachment"},b,w,E,S,x,T,N=l.fetchFromWeb||!1,C=l.webUrl||"",k=function(){e.use("tictac-att-filter",function(e){var t=b.getFileExtension();E=e.Tictac.att.filter.map(l.type,t),T=!!a.DOC_PREVIEW_TYPES[E]})};return l&&l.partId&&(h="saved"),b={isToFetchFromWeb:function(){return N},isCurrentSessionAttachment:function(){return v},getWebUrl:function(){return C},getSourceType:function(){return N?o.web:o.file},getMultiPartName:function(){return x},getPayloadReference:function(){return N?"$(id_"+this.getMultiPartName()+")":"multipart://"+this.getMultiPartName()},setMultiPartName:function(e){x=e},getPayLoadPartDefinitionForJediBatch:function(){return N?{partName:this.getMultiPartName(),payloadFromExport:this.getPayloadReference()}:{partName:this.getMultiPartName(),payloadReference:this.getPayloadReference()}},getFilename:function(){return l.filename},getFileExtension:function(){var e=l.filename.lastIndexOf("."),t=e>=0?l.filename.substr(e+1):"";return t.toLowerCase()},getFilenameWithoutExtension:function(){var e=l.filename.lastIndexOf(".");return e>=0?l.filename.substr(0,e):l.filename},getFileType:function(){return E==="undefined"&&k(),E},isImage:function(){var e=this.getFileExtension();return!!a.IMAGE_EXTENSIONS[e]},getAttachmentIconClass:function(){return this.isImage()?[]:(typeof S=="undefined"&&k(),S=u[E]||u.attachment,S.push("icon","thumbnail-attach-icon","thumbnail-file-icon"),S)},isViewableDoc:function(){return typeof T=="undefined"&&k(),T},contentId:function(){return d},deleted:function(){var e=this;e.fire("deleted"),e.destroySlideshow()},disposition:function(){return l.disposition||"attachment"},getDownloadUrl:function(){return l.downloadUrl},getDownloadUrlV3:function(){return l.downloadUrlV3||l.downloadUrl},getThumbnailUrl:function(){return l.thumbnailurl},file:function(){return l.file},isInline:function(){return l.referencedInline===!0||l.disposition==="inline"},inputEl:function(){return l.inputEl},mid:function(){return c},size:function(){return l.size||0},state:function(){return h},partId:function(){return p},setContentId:function(e){d=e},setData:function(t){l=e.clone(t),l.partId&&this.setPartId(l.partId)},setMid:function(e){c=e},setPartId:function(e){p=e},setProgress:function(e){this.loaded=e,this.fire("progress",this.loaded)},setState:function(t){var r=!!s[t];n(r,"Attachment: Illegal model state: "+t),t!==h&&e.fire("MailLog",{m:"v3 attach state change",info:"contentId: "+(d?d:"none")+", filename: "+(l.filename?l.filename:"none")+", next: "+t+", prev: "+h}),h=t,this.fire(h),this.fire("changedState",h)},setSavedInfo:function(e){this._savedInfo=e},getSavedInfo:function(){return this._savedInfo},isViewable:function(){var e=this;if(e.getThumbnailUrl()||e.isViewableDoc())return!0},getHumanReadableSize:function(){var e=l.size||0,t=1024,n=t*t;return e>=n?(e/n).toPrecision(4)+"MB":e>=t?(e/t).toPrecision(3)+"KB":e+"B"},convertThumbnailURL:function(e,t,n){var r="&w="+t+"&h="+(n||t),i=/&w=\d*&h=\d*$/;return e?e.match(i)?e.replace(i,r):e+r:""},destroySlideshow:function(){w&&w.destroy()},openSlideshow:function(n){var s=this;w?w.show(0,!0):e.use("tictac-att-slideshow","ymma-stats").then(function(e){var o=l.filename,u=o.lastIndexOf(".")>0?o.lastIndexOf("."):o.length,a=o.substr(0,u),f=o.substr(u)||"",c=l.thumbnailurl,h={aid:p,mid:t,fullsize:c?s.convertThumbnailURL(c,3e3):"",thumbnailurl:c,has_thumbnail:!!c,filename:l.filename,filenameWithoutExtension:a,filenameExtension:f,filesize:s.getHumanReadableSize(),filetype:s.getFileType(),isDoc:s.isViewableDoc(),isViewable:s.isViewable(),getAttachmentUrl:l.downloadUrl},d={attachments:[h],position:0,showDropboxLinK:!0,stats:e.common.Utils.ymmastats};w=new e.Tictac.att.Slideshow(d),w.on("download:single",function(){e.use("mail-services-plugins",function(e){var t=e.Mail.Services.AttachIO,o=s;t.getDownLoadUrl(o).then(function(e){return n.download([{filename:r(i(o.getFilename())),url:e}])})["catch"](function(){w._showError()})})}),w.on("dropbox:single",function(){e.use("mail-services-plugins",function(e){var t=e.Mail.Services.Plugins.get("attachmentDownloader"),n=e.Mail.Services.AttachIO,o=s;n.getDownLoadUrl(o).then(function(e){return t[0].download([{filename:r(i(o.getFilename())),url:e}])})["catch"](function(){w._showError()})})}),w.show(0,!0)})}},e.augment(b,e.EventTarget,m,g,y)};a.IMAGE_EXTENSIONS=e.Array.hash(["jpg","jpeg","gif","png","bmp","tiff","tif","jif","jfif","jp2","jpx","j2k","j2c","pcd"]),a.DOC_PREVIEW_TYPES=e.Array.hash(["pdf","xls","doc","ppt"]),e.namespace("mail.Models").Attachment=a},"1.0.0",{requires:["common-utils","event-custom"]});
YUI.add("mail-controller-text-processor",function(D){function A(){}var C=D.common.Utils,B={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};D.mix(A.prototype,{convertToPlain:function(H,I,G){var J=H.cloneNode(true),F=D.Node.getDOMNode(J),E=this.convertGuts(F);if(I){E=this._formatPlaintextForDisplay(E,true);}if(G){E=this.clearNonBreakingSpaces(E);}return E;},convertHTMLToPlain:function(G,I){var E=D.Node.create("<div>"+G+"</div>"),H=D.Node.getDOMNode(E),F=this.convertGuts(H);if(I){F=this._formatPlaintextForDisplay(F);}return F;},clearNonBreakingSpaces:function(E){return E.replace(/\xA0/g," ");},convertGuts:function(F){var E=D.UA.ie;if(!E){this._removeIrrelevantTextNodes(F);}else{F.innerHTML=F.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return this._richToPlain(F,false,"").replace(/\n[\s\xA0]+$/,"");},_richToPlain:function(H,L,M){var O=D.one(H),J,P;if(O.hasClass("compose-ignore")){return"";}else{if(H.nodeType===1||H.nodeType===11){var G=H.tagName;if(D.UA.ie&&H.tagName==="DIV"&&H.getAttribute("class")&&H.getAttribute("class")!==null&&H.getAttribute("class").indexOf("hr")!==-1){G="HR";}switch(G){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":P=H.previousSibling;return(this._isLineBreak(P)?"":"\n")+M+"________________________________\n"+M;case"BR":return"\n"+M;case"BLOCKQUOTE":M+=">";default:J=[];var E=H.firstChild;var K=0;while(E!==null){var N=this._richToPlain(E,E.tagName==="PRE",M);if(E.nodeType===1){if(this._getDisplayType(E)==="block"&&J.length>0&&E.tagName!=="TD"){var I=N.match(/^[ \t\r\n\v\f]*$/);if(!I||E.tagName==="LI"){J.push("\n"+M);}}switch(E.tagName){case"LI":K++;J.push("\t"+(E.parentNode.tagName==="OL"?K+".":"*")+" ");break;}}if(N){J.push(N);}if(E.nodeType===1){switch(E.tagName){case"TD":J.push(" ");break;}}E=E.nextSibling;}return J.join("");}}else{if(H.nodeType===3){J=H.nodeValue;if(!L){P=H.previousSibling;var F=P?this._getDisplayType(P):null;J=this._isLineBreak(P)?J:J.replace(/\n[ \t\r\n\v\f]+/g," ");if(P===null||this._isLineBreak(P)){J=J.replace(/^[ \t\r\n\v\f]+/,"");}else{if(F==="block"){J=J.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(F==="inline"){J=J.replace(/^[ \t\r\n\v\f]+/," ");}}}J=J.replace(/[ \t\r\n\v\f]+$/," ");}return J;}else{return"";}}}},_isLineBreak:function(E){if(E===null||E.nodeType!==1){return false;}return E.tagName==="BR";},_getDisplayType:function(E){if(E===null||E.nodeType!==1){return null;}if(E.style.display){if(E.style.display==="block"){return"block";}else{if(E.style.display==="inline"){return"inline";}}}return B[E.tagName.toLowerCase()]?"block":"inline";},_removeIrrelevantTextNodes:function(H){if(H.nodeType===1||H.nodeType===11){var F=H.firstChild;while(F!==null){var J=F.nextSibling;this._removeIrrelevantTextNodes(F);F=J;}}else{if(H.nodeType===3){var G=H.nodeValue;if(G.match(/^[ \t\r\n\v\f]*$/)){var E=H.previousSibling;var I=E?this._getDisplayType(E):"inline";if(I==="inline"&&!this._isLineBreak(E)){H.nodeValue=H.nodeValue.replace(/\n.*/," ");}else{H.parentNode.removeChild(H);}}}}},_formatPlaintextForDisplay:function(F,E){F=C.escapeHtml(F);if(E){F=F.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");F=F.replace(/( ){2}/g,"&nbsp;&nbsp;");}F=F.replace(/\n/ig,"<br />");return F;},_removeControlCharacters:function(F){var G=F,E=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig;G=G.replace(E,"");return G;},process:function(E){var F=this.convertToPlain(E,false,true);F=this._removeControlCharacters(F);return F;}});D.namespace("mail.Controller").TextProcessor=new A();},"1.0.0",{requires:["common-utils","node"]});YUI.add("mail-models-serializers-draft-gdm-unserializer",function(e){var t=e.common.Utils.features,n=t.enabled("yodaConversationRead"),r=t.enabled("yodaMessageRead"),i=function(e,t,n){for(var r in n){var i=n[r];if(t.hasOwnProperty(i.contentId)){var s=t[i.contentId];s.setMid(e.mid),s.setData(n[r]),s.setProgress(1),s.setState("uploaded")}}},s=function(e,t){var n,r=t.length,i;for(n=0;n<r;n++){var s=t[n];e.hasOwnProperty(s.contentId)&&(i=e[s.contentId],i.setSavedInfo(s))}},o=function(e){e.attachments.filter(function(e){e.state()==="uploaded"&&e.setState("saved")})},u=function(e,t){e.mid=t.mid,e.cid=t.cid},a=function(e,t){e.mid=t.id,e.cid=t.conversationId},f=function(){};e.mix(f.prototype,{update:function(t,f,l){var c=l.result.messageV2,h=l.result.simpleBody.attachments||[];n||r?a(t,l.result.message):u(t,c),f&&e.Object.size(f)>0?(s(f,h),i(t,f,c.part.slice(1))):o(t)},addAttachments:function(t,n,r){if(n.attachments){var i,s,o=!0;for(s=0;s<n.attachments.length;s++)o=r?r(n.attachments[s]):!0,o&&(i=new e.mail.Models.Attachment(n.mid,n.attachments[s]),t.addAttachment(i))}},addNonInlineAttachments:function(e,t){this.addAttachments(e,t,function(e){return e.referencedInline!==!0&&e.disposition!=="inline"})},hasNonInlineAttachments:function(e){var t,n;if(e.attachments)for(t=0;t<e.attachments.length;t++){n=e.attachments[t];if(n.referencedInline!==!0&&n.disposition!=="inline")return!0}return!1},addIds:function(e,t){u(e,t),e.csid=t.csid,e.csid||(e.draftToDelete=t.mid)}}),e.namespace("Mail.Models.Serializers").DraftGdmUnserializer=f},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add("_shared_module_compose_reply",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_compose_reply={base:"{{reply_rich}}{{reply_plain}}{{cchdr}}{{plain_cchdr}}{{fwdhdr}}{{qthdr}}{{qtftr}}{{subject}}{{origHeader}}{{rulerHeader}}{{fwd_rich_short_header}}{{reply_rich_short_header}}{{reply_rich_short}}{{reply_plain_short}}",reply_rich:'<div class="yahoo_quoted"> {{quotetext_header}} <div style="font-family: {{fontfamily}}; font-size: {{fontsize}};"> <div style="font-family: {{deffontfamily}}; font-size: {{deffontsize}};"> <div {{headerDir}}> <font size="2" face="Arial"> {{reply_rich_header}} <b><span style="font-weight:bold;">{{str_comp_reply_from}}</span></b> {{from_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_to}}</span></b> {{to_data}} {{cchdr}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_date}}</span></b> {{date_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_subject}}</span></b> {{subject_data}}<br> </font> </div> <div class="y_msg_container"><br>{{reply_rich_body}}<br><br></div> </div> </div> {{quotetext_footer}} </div>',reply_plain:"<div> <br> <div>{{reply_plain_header}}<br> {{quoteprefix}}{{str_comp_reply_from}} {{from_data}}<br> {{quoteprefix}}{{str_comp_reply_to}} {{to_data}}<br> {{plain_cchdr}} {{quoteprefix}}{{str_comp_reply_date}} {{date_data}}<br> {{quoteprefix}}{{str_comp_reply_subject}} {{subject_data}}<br> {{quoteprefix}}<br>{{reply_plain_body}} </div> </div>",cchdr:'<br><b><span style="font-weight: bold;">{{str_comp_reply_cc}}</span></b> {{cc_data}}',plain_cchdr:"{{quoteprefix}}{{str_comp_reply_cc}} {{cc_data}}<br>",fwdhdr:"<br>{{str_comp_reply_fwdHeader}}<br>",qthdr:'<blockquote style="border-left: 2px solid rgb(16, 16, 255); margin-left: 5px; margin-top: 5px; padding-left: 5px;">',qtftr:"</blockquote>",subject:"{{subject_prefix}} {{subject_data}}",origHeader:"{{str_comp_reply_origHeader}}<br>",rulerHeader:'<hr size="1">',fwd_rich_short_header:'<div {{headerDir}}> <font size="2" face="Arial"> {{str_comp_reply_fwdHeader}}<br> <b><span style="font-weight:bold;">{{str_comp_reply_from}}</span></b> {{from_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_to}}</span></b> {{to_data}} {{cchdr}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_date}}</span></b> {{date_data}}<br> <b><span style="font-weight: bold;">{{str_comp_reply_subject}}</span></b> {{subject_data}}<br> </font> </div>',reply_rich_short_header:'<div {{headerDir}}><font size="2" face="Arial"> {{str_comp_reply_short}}<br></font></div>',forward_rich_body:'<div class="qtdSeparateBR"><br><br></div> ',reply_rich_short:'{{forward_rich_body}} <div class="yahoo_quoted"> <div style="font-family: {{fontfamily}}; font-size: {{fontsize}};"> <div style="font-family: {{deffontfamily}}; font-size: {{deffontsize}};"> {{msg_rich_header}} {{quotetext_header}} <br><br> <div class="y_msg_container">{{reply_rich_body}}<br><br></div> {{quotetext_footer}} </div> </div> {{quotetext_footer}} </div>',reply_plain_short:"<div> <br> <br> <div> {{quoteprefix}}{{str_comp_reply_short}}<br> {{quoteprefix}}{{reply_plain_body}} </div> </div>"}},"1.0.0");
YUI.add("mail-controller-signature-processor",function(e){function i(){}var t=e.mail.persist.MetaData,n=e.namespace("mail.Controller"),r=e.common.Utils;e.mix(i.prototype,{insertSignature:function(e,t){var n=this,r,i=n.getSignature(e);i&&(r=n.injectSignature(e.body.html,t,i),r&&e.setBody(null,r))},getSignature:function(n){var r=t.get("enableTweet")==="on",i=e.mail.model.DataStore.Accounts,s=n.folder.acctId,o,u;return o=i.get(s),u={text:o.signature,isRich:!0,isActive:o.signatureActive,hasTweet:r&&s===i.getPrimaryAccount().id},u&&u.isActive&&(u.text||u.hasTweet)?u:null},_getTweetPlaceholder:function(e,t){return e&&e.isRich&&t&&e.hasTweet&&r.features.enabled("lastTweetSignature")?'<div class="signature-tweet"></div>':""},injectSignature:function(t,r,i){var s=this,o,u=i&&i.isRich,a=i&&i.text;if(!a)return s._getTweetPlaceholder(i,r);a=s._getSignatureText(a,u),a="<div class='signature'>"+a+"</div>"+s._getTweetPlaceholder(i,r);if(!u)a=s._cleanAndEscapeSignature(a);else if(!r||r==="plain")try{a=n.TextProcessor.convertHTMLToPlain(a,!0)}catch(f){}return t=t||"",o=t!=="",a!==""&&(e.UA.ie||e.UA.webkit?o?t=t+"<div></div><div>&nbsp;</div>"+a:t="<div></div><div>&nbsp;</div>"+a+t:o?t=t+"<div>&nbsp;</div>"+a:t="<div>&nbsp;</div>"+a+t),t},_getSignatureText:function(e,t){if(e!==null){if(!t)return e=e.replace(/<vbr>|\n/gi,"<br />"),"<div>"+e+"</div>";e=e.replace(/<vbr>/gi,"<br>")}return e||""},_cleanAndEscapeSignature:function(e){var t,n;return e=r.unescapeHtml(e),e=e.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>"),e=e.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag"),e=e.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag"),e=e.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag"),e=e.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag"),e=e.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag"),e=e.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag"),e=e.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag"),e=e.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag"),e=e.replace(/<\/p>/gi,"endptag"),t=e.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag"),t=t.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag"),t=t.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag"),e=t.replace(/<\/div>/gi,"endptag"),n=r.escapeHtml(e),n=n.replace(/brtag/g,"<br />"),n=n.replace(/ltrstartptag/g,"<div dir='ltr'>"),n=n.replace(/rtlstartptag/g,"<div dir='rtl'>"),n=n.replace(/startptag/g,"<div>"),n=n.replace(/endptag/g,"</div>"),n=n.replace(/pblanklinep/g,"<br/><br/>"),n}}),n.SignatureProcessor=new i},"1.0.0",{requires:["mail-controller-text-processor","common-persist-user-data","common-utils","mail-model-datastore","mail-persist-meta-data","mail-model-datastore","mail-common-utils-features"]});
YUI.add("mail-ui-mailcompose-header-form-list-helper",function(e){function f(){return a=new u,a}function l(){return a||(a=f(),a.init()),a}function c(n){var r=l(),i="sendingName",s=t.get("userSendPref.defaultID"),u="email",a=e.mail.Controller.ImapIn,f,c;return f=r.getFromList(n),NeoConfig.imapIn&&n===o.PrimaryAcctId&&r.changeSelection(s,n),c=r.getSelectedIndex(n)||0,n!==o.PrimaryAcctId&&NeoConfig.imapIn?{name:a.getAccountAttribute(n,i),email:a.getAccountAttribute(n,u)}:{name:f[c].name,email:f[c].addr}}function h(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function p(e){var t=r.getAccountsByType(e);return t.length?(t=t.filter(function(e){return!!(e&&e.status==="ENABLED"&&e.accountVerified&&i.isValidEmail(e.address||e.email))}),t):[]}function d(t,n,r){var i,s=null,o={},u=function(e){if(e){var t=e.address||e.email;if(t&&t===o.email)return s={email:t,name:e.fromName||e.sendingName||o.name||""},!0}};for(i=0;i<t.length;i++){o=t[i];if(o.email===n.email)return n;e.Array.some(r,u)}return s}function v(n){var r={email:t.get("userSendPref.defaultFromAddress"),name:t.get("userSendPref.defaultFromName")},i=[],s,o;return n.fid==="Sent"?h(n.oMsg):(i=i.concat(p("SENDAS"),p("ALIAS"),p("DEA")),s=d(n.oMsg.header.to,r,i),s||(s=d(n.oMsg.header.cc,r,i)),s||(s=d(n.oMsg.header.bcc,r,i)),s||(NeoConfig.imapIn?(o=e.mail.ui.FolderUtils.getAcctIdByFid(n.fid),s=c(o)):s=c()),s)}function m(){var e={},n=p("SENDAS"),r=p("ALIAS"),i=p("DEA"),s=NeoConfig.accounts&&NeoConfig.accounts.imapInAccount?NeoConfig.accounts.imapInAccount:[],o=n.concat(r,i),u={defaultFromAddress:t.get("userSendPref.defaultFromAddress"),defaultID:t.get("userSendPref.defaultID")},a=s.length,f=o.length,l,c,h;u.defaultID&&(e[u.defaultID]=1),u.defaultFromAddress&&(e[u.defaultFromAddress]=1);for(h=0;h<a;h++)l=s[h],l.isPrimary||(e[l.email]=1);for(h=0;h<f;h++)if(c=o[h].address||o[h].email)e[c]=1;return e}function g(e){var t=e,r,s,o;o=n.Accounts.getAll(),s=o.length;for(r=0;r<s;r++)if(o[r].email===e)return i.isValidEmail(o[r].replyToAddress)?o[r].replyToAddress:e;return t}var t=e.common.persist.UserData,n=e.mail.model.DataStore,r=n.Accounts,i=e.comms.Utils,s="default",o=e.mail.ui.FolderUtils,u=function(){},a;e.mix(u.prototype,{_allowedTypes:{IMAPIN:"IMAPIN",POPIN:"POPIN",SENDAS:"SENDAS",DEA:"DEA",ALIAS:"ALIAS",BIZMAIL:"BIZMAIL"},_buildAddresListItem:function(e,t){return{addr:e.address||e.email,name:e.fromName||e.sendingName||"",source:t,isRTL:e.fromNameDir==="rtl",isDefault:!!e.isDefault}},_verifyInit:function(){if(!this._init)throw new Error("FromOptionList is not initialized")},_populateV3AddressList:function(){var e=[],t,n,i=function(e){return!!e&&e.status==="ENABLED"&&!!e.accountVerified},s;for(t in this._allowedTypes)n=this._allowedTypes[t],s=r.getAccountsByType(n),e.push({list:s,length:s?s.length:0,type:n,allowedAsFrom:i});this._refactorAddressList(e)},_refactorAddressList:function(e){var t=[],n={},o,u,a,f,l,c,h;for(c=0;c<e.length;c++){f=e[c];for(l=0;l<f.length;l++)h=f.list[l],f.allowedAsFrom(h)&&(a=this._buildAddresListItem(h,f.type),n[h.address||h.email]=!0,i.isValidEmail(a.addr)&&t.push(a))}u=r.getPrimaryAccount(),a=this._buildAddresListItem({address:u.email,fromName:u.sendingName,isDefault:!0},s),o=a.addr,i.isValidEmail(o)&&!n[o]&&t.push(a),this._fromAddrList=t},_populateAddressList:function(){this._populateV3AddressList()},_sortAddressList:function(){this._fromAddrList=this._fromAddrList.sort(function(e,t){var n=e.name+e.addr,r=t.name+t.addr;return n<r?-1:n>r?1:0})},changeSelection:function(e,t){var n=0,r=this.getFromList(t);for(n=0;n<r.length;n++)if(r[n].addr.toLowerCase()===e.toLowerCase())return this._selectedItemIndex=n,!0;return!1},getSelectedIndex:function(n){var r,i;return this._verifyInit(),typeof this._selectedItemIndex=="undefined"&&(r={defaultID:t.get("userSendPref.defaultID"),defaultFromAddress:t.get("userSendPref.defaultFromAddress")},r.defaultID?(i=this.changeSelection(r.defaultID,n),i||(i=this.changeSelection(r.defaultFromAddress,n),e.fire("util:ymstats",{name:i?"v3AccountListIncomplete":"v3AccountListWrong"}))):this.changeSelection(r.defaultFromAddress,n)),this._selectedItemIndex},getFromList:function(t){var n,r,i=[];return this._verifyInit(),this._populateAddressList(),n=t?t:e.mail.Controller.ImapIn.getCurrentAccountId(),n==="1"&&(i=e.clone(this._fromAddrList.filter(function(e){return e.source!==a._allowedTypes.IMAPIN}))),i.length===0&&(r=e.mail.Controller.ImapIn.getAccountAttribute(n,"email"),i=e.clone(this._fromAddrList.filter(function(e){return e.addr===r}))),e.common.Utils.features.enabled("sortFromList")?i.sort(function(e,t){return e.addr>t.addr?1:-1}):i},getVisible:function(){return this._verifyInit(),this._visible},init:function(){if(this._init)return;this._populateAddressList(!0),this._sortAddressList(),this._fromAddrList.length>1?this._visible=!0:this._visible=!1,this._init=!0}}),e.namespace("mail.Controller").mailComposeFromListHelper={getInstance:l,getReplyFromAddress:v,getDefaultFromAddress:c,getAllAccountEmails:m,getReplyTo:g}},"1.0.0",{requires:["comms-utils","mail-controller-imapin","common-persist-user-data","mail-common-utils-features","mail-persist-meta-data","mail-ui-folder-utils","mail-model-datastore"]});
YUI.add("mail-controller-reply-processor",function(e){function S(){return strings.str_cfg_tog_compose_autoattach_prefix}function x(e,t){var n=i.getVal(e,"origin.action"),r=i.getVal(e,"origin.parentMsg"),s=i.getVal(e,"origin.parentMsg.fid"),o,u,a;return n!=="edit"&&!t.fetchGDM?Promise.resolve(e.origin.oMsg):t.fetchGDM?(o={fid:s||"Inbox",msg:r||e,cachekey:"Prime"},a=this.requestMessage(r,o),a.then(function(t){return t},function(t){return t}),a):(u=i.getVal(e,"origin.parentMsg.part"),u&&u.length>0?Promise.resolve(e.origin.parentMsg):Promise.resolve())}function T(n,r){var i,s=t&&t.Controller?t.Controller.Messages:{},o=n?n.mid||0:0;if(o&&r.fid)return i=new Promise(function(t,n){var i=function(n){t(n)},o=function(t){n(t)},u={success:i,failure:o,suppressCodes:"[*]"};r.fid&&r.msg?NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[r.msg],sourceFid:r.fid,success:function(e){u.success(e[0])},failure:u.failure}):s.get(r,u):e.fire("MailLog",{m:"GDM failed in attach in reply",fid:r.fid,msg:r.msg},1,"attachInReplyFailure")}),i}function N(e){var t=0,n=e.attachments;for(t=0;t<n.length;t++)n[t].setState("deleted")}function C(t,n){var r=this,s,o,u=i.getVal(t,"origin.parentMsg.flags.hasAttachment");return u&&(s=new e.Mail.Models.Serializers.DraftGdmUnserializer,o=r.getParentMsg(t,n),o.then(function(n){s.addNonInlineAttachments(t,n)},function(){})),o}function k(e,t){var n=e.to.concat(e.cc),r,s,o=t.to.concat(t.cc),u={};for(r=0;r<o.length;r++){var a=i.getVal(o[r],"email");u[a]||(u[a]=1)}for(s=0;s<n.length;s++){var f=i.getVal(n[s],"email");if(!u[f])return{hasNewRecipients:!0}}return{hasNewRecipients:!1}}function L(e){var t=v+e.replace(/\r?\n|(.{0,80})\r?\n|(.{1,80})$|(.{1,80} +)/mg,"$1$2$3<br />"+v);return t=t.replace(/(^(?:\>|\&gt\;)+|\<br \/\>(?:\>|\&gt\;)*)/mgi,"$1 "),t.substring(0,t.length-v.length)}function A(t,n){var r,i=document.createElement("div");return i.innerHTML=t,r=e.mail.Controller.Compose.convertGuts(i),n||(r=s(r)),i.innerHTML="",i=null,r}function O(e){var t=e.oMsg.part;if(t)for(var n=0;n<t.length;n++)if(t[n].subtype==="html")return!0;return!1}function M(e){return e&&(e=e.replace(g,"$1"),e=e.replace(y,"$1"),e=e.replace(b,"")),e}function _(e){var t,n;return e?{fontFamily:t=P(!0),fontSize:n=H(!0)}:D()}function D(){var e,t;return t=p.get("userUIPref.composeFontFamily"),t=t.split("|"),t.length>1?t=t[0]:(t=P(!1),p.set("userUIPref.composeFontFamily",t+"|1")),t||(t=P(!1),p.set("userUIPref.composeFontFamily",t+"|1")),e=p.get("userUIPref.composeFontSize"),e?e+="px":e=H(!1),{fontFamily:t,fontSize:e}}function P(e){return e?B()[0]:strings.str_rte_default_font}function H(e){if(e){var t=B();return""+parseInt(t[1],10)+t[2]}return parseInt(strings.str_rte_default_font_size,10)+"px"}function B(){return[strings.str_comp_plaintext_default_font,strings.str_comp_plaintext_default_font_size,"px"]}function j(e,t){var n=0,r=t.length,i=new Array(r);while(r--)i[n]=e(t[n++]);return i}function F(e){return e.name?e.name:e.email}function I(e){var t="";return e.name&&(t=q(e.name)?'"'+e.name+'"':e.name),e.email&&(t+=t.length?" <"+e.email+">":e.email),t}function q(e){return e.match(/[;,"<>@]/)!==null}function R(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function U(e,t,n){return e=z(e,n),j(t?I:F,e).join("; ")}function z(e,t){return W(e,t)}function W(e,t){var n,r,i,s=[],o;for(n=0;n<e.length;n++){o=!1;if(!e[n].email)continue;i=e[n].email.toLowerCase();if(t)for(r=0;r<t.length;r++)if(i===t[r].email.toLowerCase()){o=!0;break}o||(s.push({name:e[n].name,email:e[n].email}),t&&t.push(e[n]))}return s}function X(){return new RegExp("(^re:\\s?)|(^fw:\\s?)|(^"+strings.str_comp_reply_spRE+"\\s?)|"+"(^"+strings.str_comp_reply_spFWD+"\\s?)","i")}function V(){}var t=e.mail,n=e.mail.Controller.Messages,r=e.common,i=r.Utils,s=i.escapeHtml,o=i.unescapeHtml,u=i.substitute,a=t.Controller.mailComposeFromListHelper,f=a.getReplyFromAddress,l=a.getDefaultFromAddress,c=e.ui.Templates,h=c._shared_module_compose_reply,p=r.persist.UserData,d=t.persist.MetaData,v=">",m=null,g=new RegExp(/<a[^>]*href="([^\s]*?)"[^>]*>[\s]*<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>http(([\s]|[^\s])*?)<\/span>[\s]*<\/a>/ig),y=new RegExp(/<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>(([\s]|[^\s])*?)<\/span>/ig),b=new RegExp(/<script[^>]*[^>]*>(([\s]|[^\s])*?)<\/script>/ig),w={subject_prefix:function(e){return strings[e.action==="forward"?"str_comp_reply_spFWD":"str_comp_reply_spRE"]},subject_data:function(e){return m||(m=X()),e.oMsg.header.subject.replace(m,"")}},E={quotetext_header:function(){return S()?h.qthdr:""},quotetext_footer:function(){return S()?h.qtftr:""},fontfamily:function(){return D().fontFamily},fontsize:function(){return D().fontSize},deffontfamily:function(){return P(!1)},deffontsize:function(){return H(!1)},from_data:function(e){return s(o(I(R(e.oMsg,!0))))},to_data:function(e){return s(o(U(e.oMsg.header.to,!0)))},cchdr:function(e){return e.oMsg.header.cc.length>0?u(h.cchdr,e,E,null,strings):""},plain_cchdr:function(e){return e.oMsg.header.cc.length>0?u(h.plain_cchdr,e,E,null,strings):""},cc_data:function(e){return s(o(U(e.oMsg.header.cc,!0)))},date_data:function(e){return s(i.dateFormatter(new Date(e.oMsg.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n))},subject_data:function(e){return s(o(e.oMsg.header.subject))},reply_rich_body:function(e){return M(e.oMsg.body.display)},forward_rich_body:function(e){return e.action==="forward"?h.forward_rich_body:!1},reply_rich_header:function(e){var t=NeoConfig.hasConv?"":h.rulerHeader,n=e.action==="forward"?h.fwdhdr:t;return u(n,null,null,null,strings)},msg_rich_header:function(e){var t;return e.action==="forward"&&i.features.enabled("convFWDHeader")?t=h.fwd_rich_short_header:t=h.reply_rich_short_header,u(t,e,E,null,strings)},reply_plain_body:function(e){var t=M(e.oMsg.body.display);if(S()||O(e)){try{t=A(t)}catch(n){}t=L(t)}return t},reply_plain_header:function(e){return strings[e.action==="forward"?"str_comp_reply_fwdHeader"
:"str_comp_reply_origHeader"]},quoteprefix:function(){return S()?v+" ":""},headerDir:function(){return NeoConfig.isRTL?' dir="rtl" ':' dir="ltr" '}};e.mix(V.prototype,{fetchOrigin:function(t,r,i,s,o){var u=this,a=t.origin;if(a.action&&a.fid&&a.oMsg){a.ctxReq&&e.mail.Controller.Messages&&n.abort(a.ctxReq);var f,l={truncateAt:null},c={success:function(e,t){u._fetchSuccess(e,t),o&&o()},failure:function(e,t){u._fetchFailure(e,t)},draft:t,isDraft:r,isRichText:i,stopwatch:s};f={fid:a.fid,msg:a.oMsg,cachekey:"Prime",ovparams:l},s&&!s.CMGStart&&(s.CMGStart=new Date),NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[f.msg],sourceFid:f.fid,filter:l,blockImages:"none",success:function(e){c.success(e[0],c)},failure:c.failure}):e.use("mail-controller-messages",function(){e.mail.Controller.Messages.get(f,c)})}},_fetchSuccess:function(e,t){var n=this,r=t.draft,i=r.origin,s=t.stopwatch,o={};e.mid?(s&&(s.CMGEnd||(s.CMGEnd=new Date,t.respProps&&(s.wasCached=t.respProps.wasCached)),s.CMGSize=e.body.display.length),i.oMsg=n.validateMsg(e),i.ctxReq=null,i.errInfo="ok",i.yqtdPrefix=e.yivPrefixNumber,r.setOrigin(i),n._updateFromOrigin(i,r,t.isDraft,t.isRichText,o)):n._fetchFailure({msg:this.message},t)},validateMsg:function(t){var n,r;if(t&&t.header&&t.header.replyto&&t.header.replyto.length>0){r=t.header.replyto;for(n=r.length-1;n>=0;n--)!e.comms.Utils.isValidEmail(r[n].email)&&r.splice(n,1)}return t},_fetchFailure:function(e,t){var n=t.draft,r=n.origin;r.errInfo=e,n.setOrigin(r)},_updateFromOrigin:function(t,n,r,i,s){var o=this,u,a;o._markAsRead(n),u=o._transformOrigin(t,n,r,i);if(!r){var f=e.mail.Controller.SignatureProcessor.getSignature(n),l,c=!0;s&&s.noSig&&(c=!1),f&&c&&(l=e.mail.Controller.SignatureProcessor.injectSignature(null,u.isRichText,f),u.prolog=strings.str_cfg_tog_insert_signature_bottom?u.prolog+l:l+u.prolog)}n.setOrigin(t),a=new e.Mail.Models.Serializers.DraftGdmUnserializer,r&&a.addIds(n,t.oMsg),t.action==="forward"||t.action==="edit"?a.addAttachments(n,t.oMsg):a.addAttachments(n,t.oMsg,function(e){return e.referencedInline===!0||e.disposition==="inline"}),n.cc&&n.cc.length>0&&(u.header.cc||(u.header.cc=[]),u.header.cc=u.header.cc.concat(n.cc)),n.bcc&&n.bcc.length>0&&(u.header.bcc||(u.header.bcc=[]),u.header.bcc=u.header.bcc.concat(n.bcc)),o.updateDraft(n,u)},updateDraft:function(e,t){e.setHeader(t.header),e.setBody(null,t.prolog),e.notifyHeaderChanged({reply:!0}),e.notifyBodyChanged({reply:!0,isRichText:t.isRichText})},_markAsRead:function(t){var n=t.origin,r={},i=new Array(n.oMsg);r.read=1;if(NeoConfig.yodaUpdateEnabled&&NeoConfig.yodaControllerLoaded){e.mail.controller.v3.api.flagMessagesWithMid({messages:i,sourceFid:n.fid,flags:r,statTAE:!1});return}e.use("mail-controller-messages-ops",function(){e.mail.Controller.Messages.flag({fid:n.fid,mid:i,setFlags:r},{failure:function(){},suppressCodes:["Client.MessageIdsNotFound"]})})},_transformOrigin:function(e,t,n,r){var i=this,s,o=e,u={prolog:null,header:null,attachments:null,isRichText:r};return n?(u.header=o.oMsg.header,u.prolog=M(o.oMsg.body.display),u):(u.header=i.getHeaderContent(o),s=i.getBody(t,o,r),u.prolog=s.markup,u.isRichText=s.isRichText,u)},getBody:function(e,t,n){var r=O(t),s,o;return!n&&r&&i.features.enabled("replyInPlainText")&&(t.action==="reply_sender"||t.action==="reply_all")&&(r=!1),n||r?s=NeoConfig.hasConv?h.reply_rich_short:h.reply_rich:t.action==="forward"&&i.features.enabled("convFWDHeader")?s=h.reply_plain:s=NeoConfig.hasConv?h.reply_plain_short:h.reply_plain,o=u(s,t,E,e,strings),!n&&r&&(n=!0),{markup:o,isRichText:n}},getHeaderContent:function(t){var n=this,r,i=t.action==="reply_sender"||t.action==="reply_all",s={from:null,to:null,cc:null,subject:null},u=[],a=[],c=t.fid==="Sent"||t.fid==="%40S%40Search"&&t.oMsg.sourceFolderInfo.fid==="Sent";return s.from=i?f(t):l(),i&&(r=R(t.oMsg),t.action==="reply_sender"?(a.push(r),s.to=a):(c||a.push(r),u.push(r),u.push(s.from),s.to=a.concat(z(t.oMsg.header.to,u)),s.cc=z(t.oMsg.header.cc,u),c&&s.to.length===0&&s.cc.length===0&&(s.to=t.oMsg.header.to,s.to.length===0&&(s.cc=t.oMsg.header.cc)))),s.subject=o(n.seedSubject(t)),c||e.Array.each(t.oMsg.header.replyto||[],function(t){var n=s.to;n&&e.Array.indexOf(n,t)<0&&e.Array.indexOf(a,t)<0&&s.to.push(t)}),s},seedSubject:function(e){var t=e.action==="reply_sender"||e.action==="reply_all"||e.action==="forward";return t?(e.oMsg.header.subject===strings["str_msg-view_no_subject"]&&(e.oMsg.header.subject=""),u(h.subject.replace(/\s+$/,""),e,w,null,strings)):e.oMsg.header.subject}}),e.mix(V.prototype,{getDefaultFromAddress:l,htmlToText:A,getStyleFontFamily:P,getStyleFontSize:H,getDefaultFontInfo:_,matchRecipients:k,getParentMsg:x,requestMessage:T,includeAttachment:C,excludeAttachment:N}),e.namespace("mail.Controller").ReplyProcessor=new V},"1.0.0",{requires:["mail-models-draft","comms-utils","mail-model-attachment","mail-controller-messages","mail-controller-text-processor","common-persist-user-data","mail-persist-meta-data","mail-models-serializers-draft-gdm-unserializer","_shared_module_compose_reply","mail-controller-signature-processor","mail-common-utils-features","mail-ui-mailcompose-header-form-list-helper"]});
YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("_shared_module_compose_quick_reply_card_actions",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_quick_reply_card_actions={base:'<div class="qr-card-actions {{tallCompose}}"> <span class="right"><a tabindex="0" data-action="qr-cancel" role="button" class="icon icon-close" title="{{str_btn_discard}}"></a></span></div>',tallCompose:"tallCompose"};},"1.0.0");YUI.add("_shared_module_compose_message_header_fresh",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_compose_message_header_fresh={base:'<div class="compose-header fresh"> {{show_full_header}} {{more_recipients_str}} </div> ',quick_reply_card_actions:"{{_shared_module_compose_quick_reply_card_actions}} ",compose_from_address:'<option value="{{fromAddress}}"{{fromSelected}}>{{fromAddress}}</option> ',quickCompose:'<span class="menu" data-action="menu"> <a href="#" aria-haspopup="true" role="button" class="icon arrow-down" title="{{str_comp_btn_menu_reply_options}}"><b></b></a></span>',templates_in_qr:'<span data-id="menu" data-action="template-list" data-menu-position="below" aria-haspopup="true" class="small qr-templates remove-outline" tabindex="-1"> {{str_comp_btn_templates}} <i class="icon-placement icon icon-chevron-down" aria-haspopup="true"></i> </span> ',make_reply_all:'<span class="small makereplyall-btn replyall-toggle-btn hidden" data-action="make-replyall"> <a id="btn-switch-reply-mode" tabindex="-1" role="button">{{title}}</a> </span>',conversation_user:'<li role="presentation" class="recipient"> <span class="small lozenge {{lozengeerror}}"><a>{{conversation_user}}</a></span> </li> ',subject_hidden:"hidden",conversation_user1:"Our conversation on {{timestamp}}",less_than_IE10:'<span class="IEplaceholder cm-subject-field"> {{str_comp_add_subject}} </span> ',show_templates:'<div class="address-btns"> <span data-id="menu" data-action="template-list" data-menu-position="below" aria-haspopup="true" class="small templates menu remove-outline" tabindex="-1"> {{str_comp_btn_templates}} <i class="icon-placement icon icon-chevron-down" aria-haspopup="true"></i> </span> </div> ',show_full_header:'{{quick_reply_card_actions}} <div class="field account-select hidden"> <label for="from-field" class="compose-label">{{str_msg_hdr_label_from_fresh}}</label> <div class="custom-select from-selector"> <select id="from-field" class="cm-from-field from-select"> {{compose_from_address}} </select> </div> </div> {{quickCompose}} <div id="to-group" role="group" class="field contact-search cm-to-group"> <a class="compose-label label-to-field choose-contact" tabindex="-1" id="to_add_contacts" title="{{str_comp_btn_to_add_attr}}">{{str_comp_label_to_fresh}}</a> <div class="address-btns"> <span id="btn-show-cc-in-to" class="cm-btn-show-cc cc-btn small" tabindex="-1"><a role="button" href="#" id="cc_show_btn_in_to" tabindex="-1" data-action="toggle-visibility">{{str_comp_btn_show_cc_bcc}}</a></span> {{templates_in_qr}} {{make_reply_all}} </div> <div id="to" class="cm-to ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> {{conversation_user}} <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" aria-label="{{str_to_cap}}" spellcheck="false" id="to-field" name="to-field" class="cm-to-field" value=""> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div id="cc-group" class="cm-cc-group field contact-search hidden"> <a class="compose-label label-cc-field choose-contact" id="cc_add_contacts" title="{{str_comp_btn_to_add_attr}}" tabindex="-1">{{str_comp_label_cc_fresh}}</a> <div class="address-btns"> <span class="cc-btn small"><a role="button" href="#" id="cc_hide_btn" tabindex="-1" data-action="toggle-visibility">{{str_comp_btn_hide_cc_bcc}}</a></span> </div> <div id="cc" class="cm-cc ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" spellcheck="false" id="cc-field" name="cc-field" class="cm-cc-field" aria-label="{{str_cc}}"> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div id="bcc-group" class="cm-bcc-group field contact-search hidden"> <a class="compose-label label-bcc-field choose-contact" tabindex="-1" id="bcc_add_contacts" title="{{str_comp_btn_to_add_attr}}">{{str_comp_label_bcc_fresh}}</a> <div id="bcc" class="cm-bcc ac-input" data-action="autocomplete" tabindex="-1"> <ul role="presentation"> <li role="presentation" class="recipient-input"> <input role="textbox" aria-autocomplete="list" aria-expanded="false" spellcheck="false" id="bcc-field" name="bcc-field" class="cm-bcc-field" aria-label="{{str_bcc}}"> </li> </ul> <span class="hidden compose-hide-recpts" data-action="hide-recpts" title="{{str_thread_hdr_hide_recipients_attr}}" aria-label="{{str_thread_hdr_hide_recipients_attr}}">{{str_hdr_hide_recipients}}</span> </div> </div> <div class="field subject {{subject_hidden}}"> <div id="subject" class="cm-subject"> <label> <span> <input id="subject-field" name="subject-field{{timestamp_id}}" class="cm-subject-field" data-action="compose-subject" value="{{conversation_user1}}" placeholder="{{str_comp_add_subject}}"/> </span> {{less_than_IE10}} </label> </div> {{show_templates}} </div> ',more_recipients_str:'<li class="hLozenge"> <span class="more_recp lozenge-static cl hcard more" data-address="{{data_address}}" data-action="compose-recpt-more" role="button" tabindex="0" aria-label="{{str_thread_hdr_more_recipients_attr}}"> {{str_hdr_more_recipients}}</span> </li> '}},"1.0.0",{requires:["_shared_module_compose_quick_reply_card_actions"]});
YUI.add("comms-ui-lozenge",function(e){function a(t){var n=function(t){t.addClass("focus"),e.fire("lozenge:highlight")},r=e.UA.os==="macintosh"?t.metaKey:t.ctrlKey,i=-2,s=-1,o=-1,u,a=-1,f,l,c=!0,h,p;if(r||t.shiftKey){h=this.rootNode.ancestor(".ac-input"),h&&this.rootNode.ancestor(".compose-header").all(".ac-input").each(function(e){e!==h&&e.all(".hLozenge").removeClass("focus")});if(r)this.rootNode.hasClass("focus")?this.rootNode.removeClass("focus"):n(this.rootNode);else if(h){var d=h.all(".hLozenge");d.each(function(e){e.hasClass("focus")&&(u=d.indexOf(e),a===u-1&&c?c=!0:a>=0?c=!1:c=!0,s<u&&(s=u),i<0&&(i=u),a=u)}),o=d.indexOf(this.rootNode),i===s||o<i||o>s?o<i?c?(f=o,l=s):(f=o,l=i):o>s&&(c?(f=i,l=o):(f=s,l=o)):(f=i,l=o),d.removeClass("focus");if(f<0||l<0)n(this.rootNode);else for(u=f;u<=l;u++)n(d.item(u))}}else p=this.rootNode.ancestor(".compose-header"),p&&(p=p.all(".hLozenge.focus"),p.size()===1&&this.rootNode.hasClass("focus")?(t.halt(),this.rootNode.removeClass("focus"),this.startEdit()):(p.removeClass("focus"),n(this.rootNode)))}function f(){var e=this,t=e.getFullDisplayData();e.staticL.setContent(r(t)),e.editL.removeClass("mask"),e.staticL.addClass("mask"),e.editL.focus(),e.editL.setAttribute("value",t)}function l(t){var n=this,i,s,o,u,a=t.keyCode;a===13?(i=n.rootNode.ancestor("div"),i&&(s=i.get("scrollTop"),o=i.all("li"),u=o.item(o.size()-1).one("input"),u.focus(),e.later(50,n,function(){i.set("scrollTop",s),u.addClass("whiteout")}))):e.later(0,n,function(){n.staticL.setContent(r(n.editL.get("value"))),n.staticL.setAttribute("title",n.getFullDisplayData())})}function c(){var e=this,t=s(e.editL.get("value"));if(!t){e.remove();return}e.data=e.createUserDataFromString(t),e.validate(),e.setState(),e.setLabel(),e.staticL.setAttribute("title",e.getFullDisplayData()),e.staticL.setAttribute("data-address",e.data.email),e.staticL.removeClass("mask"),e.editL.addClass("mask")}function h(){return this.rootNode}function p(){var e=this;if(e.valFn){if(!e.valFn.call(e,e.data))return e.data.fail=!0,e.error=!0,!1}else if(!i.isValidEmail(e.data.email))return e.data.fail=!0,e.error=!0,!1;return e.data.fail=!1,e.error=!1,!0}function d(){var e=this.data,t;t=e.name||e.email,this.staticL.setContent(r(t))}function v(){this.error?this.staticL.addClass("lozenge-error"):this.staticL.removeClass("lozenge-error")}function m(e){var t=!1,n=null,r=null,o=/(<[^<>]+[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a;return e=s(e),a=e.replace(/\".*\"/g,""),!s(a)||a.indexOf("@")<0?(t=!0,r=n=e):(o.test(e)?(u=e.match(o),r=u[0],n=s(e.replace(r,"")),r=r.substring(1,r.length-1)):r=n=e,i.isValidEmail(r)?(this.error=!1,t=!1):(this.error=!0,t=!0)),{fail:t,email:r,name:n}}function g(){var e=this.data,t=e.name||"",n=e.email;return this.error?n:(t=t===n?"":t+" ",t+"<"+n+">")}function y(){var t=this;e.later(0,t,function(){t.rootNode.remove().destroy(!0),e.fire("lozenge:remove")})}var t=e.common.Utils,n=t.substitute,r=t.escapeHtml,i=e.comms.Utils,s=e.Lang.trim,o={base:'<li class="hLozenge {{parentClass}}" data-action="{{action}}"><span role="button" class="lozenge-static hcard cl {{errorClass}} {{dataClass}}" title="{{hover}}" data-address="{{hover}}" >{{label}}</span>{{editable}}</li>',edit:'<input class="lozenge-edit mask" type="text" value="{{fullDisplayData}}">'},u;e.on("click",function(t){if(!t.altKey&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){var n=e.all(".hLozenge");n.each(function(e){e!==t.target&&e!==t.target.get("parentNode")&&e.hasClass("focus")&&e.removeClass("focus")})}}),u=function(t){var i=this,s,u,a,f;i.label=t.label||"",i.hover=t.hover||"",i.valFn=t.valFn||null,i.error=t.error||!1,i.menu=t.menu||null,i.edit=t.edit||!1,i.copy=t.copy||!1,i.bidi=t.bidi||!1,i.action=t.action||"",i.dataClass=t.dataClass||"",i.parentClass=t.parentClass||"",NeoConfig&&(i.bidi=!!NeoConfig.bidi),i.data=t.data||{name:"",email:"",cid:null},i.validate(),s=e.Node.create(n(o.base,null,null,null,{label:r(this.label),editable:i.edit?o.edit:"",errorClass:i.error?"lozenge-error":"",dataClass:i.dataClass,parentClass:i.parentClass,action:i.action})),u=i.staticL=s.one(".lozenge-static"),u.setAttribute("title",i.hover),t.state!=="error"&&u.setAttribute("data-address",i.hover),s.setData("lozenge",i),s.setData("user",i.data),i.bidi&&(f=e.Intl.detectDirection(i.label.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,">").replace(/&amp;/g,"&")),s.setAttribute("dir",f),s.addClass(f)),i.edit&&(a=i.editL=s.one(".lozenge-edit"),a.setAttribute("value",i.getFullDisplayData()),e.on("click",i.highlight,u,i),e.on("dblclick",i.startEdit,u,i),e.on("keydown",i.typeEdit,a,i),e.on("blur",i.finishEdit,a,i),e.on("mousedown",function(t){t.preventDefault(),e.ACWidgetInst&&e.ACWidgetInst.hide(),e.fire("HoverCard:hideHoverCard")},u,i)),i.rootNode=s},u.prototype={highlight:a,startEdit:f,typeEdit:l,finishEdit:c,getNode:h,validate:p,setLabel:d,setState:v,getFullDisplayData:g,createUserDataFromString:m,remove:y},e.namespace("comms.ui"),e.comms.ui.Lozenge=u,e.comms.ui.LozengeUtils={makeContact:function(e,t){var r,i=[],s=[],o,u,a,f,l,c,h,p=e.all("span.lozenge");for(r in t){u=t[r].fields;for(var d=0,v=u.length;d<v;d++)o=u[d],o.type==="email"?i=i.concat(o.value):o.type==="name"&&(a=o.value,f=n(strings.str_name_format,{given_name:a.givenName,family_name:a.familyName}),s=s.concat(f))}p.each(function(e){if(e.hasClass("lozengeadd")){c=e.getAttribute("data-address");for(l=0;l<i.length;l++)i[l]===c&&(e.remove(),h&&(h.addClass("right"),f=s[l],f&&h.one("a").setContent(f),h=null))}else h=e})}}},"0.0.1",{requires:["comms-ui-lozenge_css","common-utils","comms-utils","node"]});
YUI.add("comms-ui-autocomplete-plugin",function(C){var B="autocomplete",F=C.Lang,G=C.Array.each,L=C.Plugin,E=L.Base,I="ac",D=13;function J(O,Q){var N="down",P=C.stamp(this)+"|";if(C.UA.gecko>0&&C.UA.gecko<5){N="press";C.on(P+"key",O.raiseFlag,Q,"down",O);}C.on(P+"valueChange",H,Q,O);C.on(P+"key",O.next,Q,N+":40",O);C.on(P+"key",O.previous,Q,N+":38",O);C.on(P+"key",O.close,Q,"down:27",O);Q.on("keyup",function(R){if(R.keyCode===D){R.type="select";this.select.call(O,R);}},O,"select");}function H(O){var N=O.newVal;if(!N&&!(N===""&&this.get("minQueryLength")===0)){this._cachedValue=false;return this.close();}if(N===this._cachedValue||N.length<this.get("minQueryLength")){return false;}this._cachedValue=N;this.fire("ac:query",{value:O.newVal});return true;}function A(N){return function(){if(N){N.setAttribute(B,"on");}N=null;};}function K(N){var P=C.Node.getDOMNode(N),Q=P.getAttribute(B);if((Q&&Q!=="off")||Q===null||Q===undefined){var O=A(P);C.on("beforeunload",O,window);C.on("unload",O,window);}P.setAttribute(B,"off");}function M(){M.superclass.constructor.apply(this,arguments);}C.extend(M,E,{_defaultEventFn:null,initializer:function(){var N=this,O=N.get("host"),P=(!F.isNull(N._defaultEventFn)?N._defaultEventFn:{});J(N,O);G(["query","load","show","hide","next","previous","select"],function(Q){N.publish("ac:"+Q,{broadcast:1,bubbles:1,context:N,preventable:true,prefix:I,defaultFn:P[Q]||null});},N);K(O);},destructor:function(){var N=this;C.detach(C.stamp(N)+"|");N.detachAll();},open:function(){this.fire("ac:show");},next:function(N){if(this.conflictingKeyFlag&&C.UA.gecko){return;}N.preventDefault();this.fire("ac:next");},previous:function(N){if(this.conflictingKeyFlag&&C.UA.gecko){return;}N.preventDefault();this.fire("ac:previous");},raiseFlag:function(O,N){if((O.keyCode===55)||(O.keyCode===57)){N.conflictingKeyFlag=true;}else{N.conflictingKeyFlag=false;}},select:function(N){this.fire("ac:select",N);},hide:function(){},close:function(){this.fire("ac:hide");},reload:function(N){if(N){if(N.length<1){this.set("badResult",this.get("queryValue"));}this.fire("ac:load",{results:N,query:this.get("queryValue")});}}},{NAME:"ACPlugin",NS:I,ATTRS:{queryValue:{getter:function(){return this.get("host").get("value");},setter:function(N){this.get("host").set("value",N);this._cachedValue=N;return this._cachedValue;}},dataSource:{value:[]},minQueryLength:{value:0,validator:F.isNumber},queryTemplate:{value:encodeURIComponent,setter:function(N){return(F.isFunction(N)?N:function(O){return N.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(O)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");});}},alignNode:null,conflictingKeyFlag:false,badResult:{value:false,setter:function(N){return(C.Lang.isString(N))?N:false;}}}});C.namespace("comms.ui");C.comms.ui.AutoCompleteEventsPlugin=M;},"1.0.0",{requires:["node","plugin","event-valuechange","event-key"]});YUI.add("comms-ui-autocomplete",function(C){var H=C.Array.each,F=C.Lang,B=C.Overlay,G="selectedIndex",A="queryValue",J="ac",D="_BOUND",I="_"+G,K="_originalValue";function E(){E.superclass.constructor.apply(this,arguments);this.delegated=false;this.listeners=[];}C.extend(E,B,{initializer:function(){var L=this;L.after({queryChanged:L.drawMarkUp,dataChanged:L.drawMarkUp});L.hide();L.publish(J+":complete",{broadcast:1,bubbles:1,context:L,preventable:true,prefix:J});},renderUI:function(){var M=this.get("ac"),L={"display":"none","overflow":"auto","maxHeight":"300px"};if(!M){return false;}this.get("contentBox").setStyles(L);this.get("contentBox").set("role","listbox");this.setSize();this.set("align",{node:this.get("ac").get("alignNode"),points:[C.WidgetPositionAlign.TL,C.WidgetPositionAlign.BL]});this.get("contentBox").setStyle("display","block");return true;},bind:function(P){var Q=this,L=Q.get("contentBox"),O=Q.get("ac"),N=C.stamp(Q)+"|";if(P&&O!==P&&Q[D]){C.detach(N);Q[D]=0;}P=P||O;if(P&&!Q[D]){var M=[];Q[D]=1;if(!Q.delegated){Q.delegated=true;M.push(L.delegate("click",Q.click,"li",Q));M.push(L.delegate("mouseover",Q.mouseover,"li",Q));M.push(L.delegate("mouseout",Q.mouseout,"li",Q));M.push(L.delegate("mousemove",function(R){R.halt();R.currentTarget.addClass("over");},"li",Q));M.push(L.delegate("mouseleave",function(R){R.halt();R.currentTarget.removeClass("over");},"li",Q));M.push(C.on("click",function(R){if(!Q.isVisible()){return;}if(Q.get("contentBox").contains(R.target)){if(R.target.get("nodeName").toLowerCase()!=="li"){return;}Q.get("ac").get("host").simulate("keydown",{keyCode:13});}if(Q.get("ac").get("host").contains(R.target)){return;}Q.hide();},document,this));}M.push(P.on(N+J+":load",function(R){if(!Q.get("disabled")){Q.setAttrs({query:R.query,data:R.results}).drawMarkUp().show().setAlign();}}));M.push(P.on(N+J+":query",function(R){Q.set("query",R.value).drawMarkUp();}));M.push(P.on(N+J+":next",Q.next,Q));M.push(P.on(N+J+":previous",Q.previous,Q));M.push(P.on(N+J+":hide",Q.hide,Q));P.select=function(R){Q.selected.call(Q,R,"enter");};Q.listeners=M;}return Q;},bindUI:function(L){return this.bind(L);},setSize:function(){if(!this.get("expandWidthToContents")){this.set("width",this.get("ac").get("alignNode").get("offsetWidth"));}},setAlign:function(){var O=this,M=O.get("ac").get("alignNode"),L=M.get("region"),N=[L.left,L.bottom];O.set("xy",N);return O;},drawMarkUp:function(){var L=this,M=L.get("data");if(!M){return L;}L[I]=-1;L[K]="";L.get("contentBox").set("innerHTML",L.getListMarkup(M));if(M.length>0){if(L.get("selectFirst")){this.set(G,0);}L.get("contentBox").setStyle("display","block");}else{L.get("contentBox").setStyle("display","none");}return L;},getListMarkup:function(O){var N=this,L=N.get("listTpl"),M=[];H(O,function(P){M.push(N.getItemMarkup(P));});return L.replace(/\{list\}/g,M.join(""));},getItemMarkup:function(M){var L=this;if(!F.isString(M)){return false;}return L.get("itemTpl").replace(/\{hilite\}/g,M);},_fixView:function(O){var R=this,N=R.get(G),L=R.get("contentBox"),Q,M,P;if(N===-1){L.set("scrollTop",0);return true;}M=R.item(N);Q=L.get("scrollTop");M=R.item(N);P=M.get("offsetTop");M.addClass("key-select");if(O){if((P>Q)&&(R.itemsCount()!==(N+1))){return true;}L.set("scrollTop",P);document.body.scrollIntoView();return false;}else{if((P+M.get("clientHeight"))>(Q+L.get("clientHeight"))){L.set("scrollTop",L.get("scrollTop")+M.get("clientHeight"));if(C.UA.ie<=0){M.scrollIntoView();}document.body.scrollIntoView(false);}return true;}},next:function(){var L=this;if(L.get("selectFirst")&&L.itemsCount()===1){return false;}return(L.get("visible")?L.selectNext():L);},selectNext:function(){var L=this;L.set(G,this.get(G)+1);L._fixView(false);return L.get(G);},selectPrevious:function(){var L=this;L.set(G,this.get(G)-1);L._fixView(true);return L.get(G);},previous:function(){var L=this;if(L.itemsCount()===1){return false;}return L.get("visible")?L.selectPrevious():L;},isVisible:function(){return this.get("visible");},hasSelectedItem:function(){return this.get("selectedIndex")>-1;},item:function(L){return this.get("contentBox").all(this.get("itemSelector")).item(L);},itemsCount:function(){return this.get("contentBox").all(this.get("allItemsSelector")).size();},click:function(L){this.selected(L,"click");},mouseover:function(O){var M,L,N=this;M=O.currentTarget;L=N.get("contentBox").all("li").indexOf(M);N.set("selectedIndex",L);},mouseout:function(){this.set("selectedIndex",-1);},autoManageSelect:function(L){var M=this,N=M.get("ac");if(!L){L=false;}if(L){N.on(J+":select",M.handleEnter,M);}else{N.detachAll(J+":select");}},handleEnter:function(P,M){if(!M){M=this;}var O=M.get("ac"),L=M[I],N,Q;P.halt();M.fire(J+":complete",M);if(L!==-1){N=M.item(L);if(N){Q=N.get("text");O.set(A,Q);}M[I]=-1;O.get("host").focus();M.hide();}},selected:function(R,P){var M=null,N=this,Q=N.get("ac"),L,O;if(!P){P="click";}M=N.item(this.get(G));if(!M){return false;}O=M.getData("selectedCb");if(O){O.call(M,R);return;}L=this.get(G);R.selectedItem=M;R.selectedIndex=L;R.type=P;R.container=N.get("contentBox");Q.fire("ac:select",R);N[I]=-1;return true;},setHostValue:function(M){var L=this;L.get("ac").set(A,M);L.get("ac").get("host").focus();L.hide();},reload:function(L){return this.get("ac").reload(L);},close:function(){var L=this;L.get("ac").close();L.hide();},destroy:function(){var M=this.listeners;if(M){var N=M.length,L;for(L=0;L<N;L++){if(M[L]){M[L].detach();M[L]=null;}}this.listeners=null;}if(this.get("ac")){this.get("ac").destructor();}E.superclass.destroy.apply(this,arguments);}},{NAME:"AutoCompleteWidget",ATTRS:{ac:{setter:function(L){if(!this[D]){return;}this.bind(L);},validator:function(){return true;}},data:{},query:{value:""},listTpl:{value:'<ul role="presentation">{list}</ul>'},itemTpl:{value:'<li role="option">{hilite}</li>'},itemSelector:{value:"ul li"},allItemsSelector:{value:"ul li"},selectedItem:{getter:function(){return this.item(this.get(G));},readOnly:true},expandWidthToContents:{value:false},selectFirst:{value:true}}});
E.ATTRS[G]={value:-1,validator:function(L){var M=this.get("data");return M&&C.Lang.isNumber(L);},getter:function(){return this[I];},setter:function(O){var T=this,Q=T.get(G),R=T.get("data"),L=T.itemsCount(),S=T.get("ac"),M=this.getClassName("selected"),P,N;if(isNaN(Q)){Q=-1;}if(!R||!L){return false;}while(O<-1){O+=L+1;}O=(O+1)%(L+1)-1;Q=(Q+1)%(L+1)-1;T[I]=O;if(Q===-1){T[K]=S.get(A);}if(Q===O){return false;}var U=T.get("contentBox").one("."+M);if(U){U.removeClass(M).removeClass("key-select");}if(O===-1){}else{P=T.item(O);if(P&&P.hasClass("corpmail.label")){N=O+(Q<O?1:-1);T[I]=N;P=T.item(N);}if(P){P.addClass(M);}}return O;}};C.namespace("comms.ui");C.comms.ui.AutoComplete=E;},"1.0.0",{requires:["overlay","comms-ui-autocomplete-plugin","node-event-simulate"]});YUI.add("filter-contacts",function(e){function h(){this.filterItems=[],this.matchType=1,this.init_temp_data=!0,this.del_temp_data=!0,this.match_limit=50}function b(e){var t,n,r,i=e.value;if(e.numeric){n=i.length;if(n>1){r=i.charAt(0),t=1;while(t<n)r+="[ _\\.\\-()]*",r+=i.charAt(t),t+=1}else r=i}else r=i;e.regExp=new RegExp(r,"gi")}function w(e,t){var n={};return n.value=e,v.test(e)||(n.numeric=!0),n.group_id=t,n.match_siIndex=-1,b(n),n}function E(e){var t,n,r,i,s,o,u=[];n=e.length;if(n===0)return u;var a=new RegExp("[ ]","g");for(t=0;t<n;t++){r=e[t],i=0;while(a.test(r))s=a.lastIndex-1,i<s&&(o=w(r.substring(i,s),t),u.push(o)),i=a.lastIndex;i<r.length&&(o=w(r.substring(i),t),u.push(o))}return u}function S(e){var t=[],n,r,i;if(e.length>0){i=new RegExp("[,;]","g"),n=0;while(i.test(e))r=i.lastIndex-1,r>n&&t.push(e.substring(n,r)),n=i.lastIndex;n<e.length&&t.push(e.substring(n))}return t}function x(e,t,n,r){var i,s,o,u,a,f,l,c,p;l=r.fuzzy_match_idx+1,f=r.fuzzy_matches;if(l<f.length)return a=f[l],r.fuzzy_match_idx=l,a;if(!r.fuzzy_complete){i=g,s=-1;for(;;){if(s===-1&&r.fuzzy_match_idx===-1)s=0;else{s<=0&&(i.lastIndex=r.fuzzy_match_idx===-1?0:f[r.fuzzy_match_idx].start+1);if(!i.test(e))break;s=i.lastIndex-1}u=r.matches;for(l=0,c=u.length;l<c;l++){o=u[l];if(s>o.start)break;if(s===o.start)return a={},a.start=o.start,a.end=o.end,a.diff=0,f.push(a),r.fuzzy_match_idx+=1,n.match_idx=a.end,a}c=n.value.length;if(c<=2){p=0;if(r.complete)continue}else c<=5?p=1:p=2;if((a=h.fuzzyMatch(n.value,e,s,p))!==null)return f.push(a),r.fuzzy_match_idx+=1,n.match_idx=a.end,a}r.fuzzy_complete=!0}return r.fuzzy_match_idx=-1,null}function T(e,t,n,r){var i,s,o,u,a,f;s=r.match_idx+1,f=r.matches;if(s<f.length)return a=f[s],r.match_idx=s,a;if(!r.complete){i=n.regExp,i.lastIndex=r.match_idx===-1?0:f[r.match_idx].start+1,o=i.lastIndex;while(i.exec(e)){if(t)return u=e.substring(o,i.lastIndex),o+=u.search(i),a={},a.end=i.lastIndex,a.start=o,f.push(a),r.match_idx+=1,n.match_idx=a.end,a;o=i.lastIndex-n.value.replace(/\\/g,"").length;if(o===0||e.charAt(o-1).search(m)===0)return a={},a.end=i.lastIndex,a.start=o,f.push(a),r.match_idx+=1,n.match_idx=a.end,a}r.complete=!0}return r.match_idx=-1,null}function N(e,t,n,r,i,s,o){var u,a=n||e.matchType!==2?T:x;while((u=a(t,n,r,i))!==null){if(!o){if(r.start_siIndex===s&&r.start_idx===u.start)continue;return!0}if(u.start>=r.start_idx)return r.start_idx=u.start,!0}return!1}function C(e,t){var n=t.matches,r,i,s,o,u,a,f;if(e.match_idx!==-1)r=e.match_idx,i=e.matches;else{if(e.fuzzy_match_idx===-1)return!1;r=e.fuzzy_match_idx,i=e.fuzzy_matches}u=i[r].start,a=i[r].end;for(s=0,o=n.length;s<o;s++){f=n[s];if(!(f.end<=u||a<=f.start))return!1}for(s=0,o=t.length;s<o;s++)if((t[s].match_idx!==-1||t[s].fuzzy_match_idx!==-1)&&t[s].group_id!==e.group_id)return!1;return f={},f.start=u,f.end=a,t.matches.push(f),!0}function k(e,t,n,r,i,s,o){if(i.phoneno&&!t.numeric)return!1;var u,a,f,l,c,h,p;for(u=0,a=i.length;u<a;u++)if(i[u].index===n){f=i[u];break}f||(f={},f.index=n,f.group_id=t.group_id,f.match_idx=-1,f.matches=[],f.fuzzy_match_idx=-1,f.fuzzy_matches=[],i.push(f));var d=f.match_idx;while(N(e,r,i.phoneno,t,f,s,o))if(C(f,i))return!0;if(d!==-1){p=i.matches,l=f.matches[d].start,c=f.matches[d].end;for(u=0,a=p.length;u<a;u++)h=p[u],h.start===l&&h.end===c&&p.splice(u,1)}return t.match_idx=-1,!1}function L(e,t,n,r){var i,s,o,u,a,f,l,c;s=p.length,c=!1,n.match_siIndex===-1&&(c=!0,n.start_siIndex=-1,n.start_idx=-1,r>0&&(l=e.filterItems[r-1],l.group_id===n.group_id&&(n.start_siIndex=l.match_siIndex,n.start_idx=l.match_idx)));if(c&&n.start_siIndex!==-1){i=n.start_siIndex,f=i<3;if(!f||!!n.numeric){o=p[i],u=t[o];if(u&&u.length>0){a=t._matches[o],a||(a=[],a.matches=[],f&&(a.phoneno=!0),t._matches[o]=a);if(k(e,n,r,u,a,i,!0))return n.match_siIndex=i,n.special_match=!0,!0}}}n.match_siIndex===-1?i=0:n.special_match?(n.special_match=!1,i=0):i=n.match_siIndex;while(i<s){f=i<3;if(f&&!n.numeric){i+=1;continue}o=p[i],u=t[o];if(u&&u.length>0){a=t._matches[o],a||(a=[],a.matches=[],f&&(a.phoneno=!0),t._matches[o]=a);if(k(e,n,r,u,a,i,!1))return n.match_siIndex=i,!0}i+=1}return n.match_siIndex=-1,!1}function O(e){var t,n;for(t=0,n=e.filterItems.length;t<n;t++)if(e.filterItems[t].match_siIndex!==-1)return!1;return!0}function M(e){var t,n,r,i,s,o,u,a;if(!e._matches)return!0;for(t=0,i=p.length;t<i;t++){s=p[t],o=e[s];if(o&&o.length>0){u=e._matches[s];if(u){if(u.matches.length>0)return!1;for(n=0,r=u.length;n<r;n++){a=u[n];if(a.match_idx!==-1)return!1;if(a.fuzzy_match_idx!==-1)return!1}}}}return!0}var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=e.contacts,s=i.api,o=i.utils,u={},a=function(e){return e.emailField&&e.emailField.value?e.emailField.value:e.id},f=function(e,t){for(var n=0;n<t.length;n++)e.push(t[n]);return e},l=function(){var e=o.getSortedFlatContacts(),t=function(e,t){var n=[];return e.user&&n.push(e.user.charAt(t).toLowerCase()),e.firstname&&n.push(e.firstname.charAt(t).toLowerCase()),e.lastname&&n.push(e.lastname.charAt(t).toLowerCase()),e.nickname&&n.push(e.nickname.charAt(t).toLowerCase()),e.mobileno&&f(n,e.mobileno.toLowerCase()),e.homeno&&f(n,e.homeno.toLowerCase()),e.workno&&f(n,e.workno.toLowerCase()),e.isCategory||e.email&&n.push(e.email.charAt(t).toLowerCase()),n},n=function(e){var t=o.getHigherPrecedenceFieldByType(e,"name");return t?{firstname:t.givenName,lastname:t.familyName,middlename:t.middleName}:{}},r,i,s,l=o.getCategories();for(i in l){var c=l[i],h=0,p=[],d;for(r in c.contacts){var v=o.getContactById(c.contacts[r]),m=o.getFieldsByType(v,"email");m&&m.length&&(h+=1,d=n(v),d.email=m[0].value,p.push(d))}e.push({firstname:c.name,email:[h,"<span style='display:none'>___AC_CAT_ID:",c.id,"</span>"].join(""),id:c.id,count:h,endpoints:p,isCategory:!0})}s={},u=[];for(r in e){var g=e[r];if(!g.email||!g.email.length)continue;var y,b=t(g,0);for(y in b){var w=b[y];u[w]||(u[w]={}),u[w][a(g)]=g}}},c=function(e,t){var n={},r={},i={},s=null,f,l;f=e.filterItems;for(var c=0;c<f.length;c++){var h=f[c],p=h.value.charAt(0).toLowerCase
(),d=u[p];for(l in d){s=d[l];if(!d[l].isCategory||!t)r[l]=d[l]}}for(l in r){var v=r[l];e.filterContact(v)&&!i[v.email]&&(i[v.email]=!0,n[a(v)]=v)}var m=[];for(l in n)m.push(n[l]);return o.sortFlatContacts(m),m};e.on("contacts:api:contactChanged",l),e.on("contacts:api:loaded",l),o.areContactsLoaded()?l():s.load();var p=["mobileno","homeno","workno","firstname","lastname","user","email","nickname"],d=new RegExp("[\\+\\*\\?\\^\\[\\]\\{\\}\\$\\\\/%#~:<>()]","g"),v=new RegExp("[^0-9]","g"),m=new RegExp("[ _\\.\\-@]","g"),g=new RegExp("[ _\\.\\-@][^ _\\.\\-@]","g");h.prototype.fastMatch=function(e){return e=!!e,c(this,e).slice(0,this.match_limit)};var y=/___AC_CAT_ID\:(-?[0-9]+)/;h.prototype.decodeCategory=function(e){var t=y.exec(e);if(t&&t.length>1){var n=o.getCategoryById(t[1]),r=[];for(var i in n.contacts){var s=o.getBasicFlatContacts(o.getContactById(n.contacts[i]));for(var u in s){var f=s[u];if(f.isPrimary){r[a(f)]=f;break}}}return r}return!1},h.prototype.updateFilterItems=function(t){t.length>2048&&(t=t.substring(0,2048)),t=t.replace(d," ");var n=S(t),r,i=e.common.Utils;for(r in n)n.hasOwnProperty(r)&&(n[r]=i.regexpEscape(i.escapeHtml(n[r])));this.filterItems=E(n)},h.fuzzyMatch=function(e,t,n,r){var i=e.length,s=t.length,o=[],u=[],a=[],f,l,c,h,p,d,v,m,g,y,b,w;for(f=0;f<=i;f++)u[f]=f;h=s-n,h>i+r&&(h=i+r),c=0,d="";for(l=0;l<h;l++){m=d,d=t.charAt(l+n).toLowerCase(),c<=0?(g=l+1,a[0]=g,b=g,c=0,p=""):(g=r+1,a[c]=g,b=g,p=e.charAt(f-1).toLowerCase());for(f=c,c=-1;f<i;f++){v=p,p=e.charAt(f).toLowerCase(),p===d?g=u[f]:(g=u[f]+1,y=a[f]+1,g>y&&(g=y),y=u[f+1]+1,g>y&&(g=y),p===m&&v===d&&(y=o[f-1]+1,g>y&&(g=y))),a[f+1]=g,b>g&&(b=g),c===-1&&g<=r&&(f===0&&a[0]<=r?c=0:c=f+1);if(g>a[f]&&g>r)break}if(f===i){if(g===0){u=a,l+=1;break}y=u[i];if(y!==undefined&&y<g)break}if(b>r)return null;o=u,u=a,a=[]}return g=u[i],g===undefined||g>r?null:(w={},w.start=n,w.end=l+n,w.diff=g,w)},h.prototype.filterContact=function(e){delete e.matches;if(this.filterItems.length===0)return!1;this.init_temp_data&&(e._matches={});var t,n;n=this.filterItems.length,t=0;while(t<n){if(!L(this,e,this.filterItems[t],t)){if(t>0){t-=1;continue}return this.del_temp_data&&delete e._matches,!1}t+=1}e.matches={};var r,i,s,o,u,a,f,l,c;i=p.length,r=0;while(r<i){s=p[r],o=e._matches[s];if(o&&o.length>0){for(t=0,n=o.length;t<n;t++)u=o[t],(f=u.match_idx)!==-1?(a=this.filterItems[u.index],c=u.matches[f],l={},l.term=a.value,l.startIndex=c.start,l.endIndex=c.end,e.matches[s]||(e.matches[s]=[]),e.matches[s].push(l),u.match_idx=-1):(f=u.fuzzy_match_idx)!==-1&&(a=this.filterItems[u.index],c=u.fuzzy_matches[f],l={},l.term=a.value,l.startIndex=c.start,l.endIndex=c.end,l.diff=c.diff,e.matches[s]||(e.matches[s]=[]),e.matches[s].push(l),u.fuzzy_match_idx=-1);this.del_temp_data||(o.matches=[])}r+=1}this.del_temp_data&&delete e._matches;for(t=0,n=this.filterItems.length;t<n;t++)this.filterItems[t].match_siIndex=-1;return!0},h.prototype.setConfigValues=function(t,n,r){this.matchType=t,this.init_temp_data=e.Lang.isBoolean(n)?n:!0,this.del_temp_data=e.Lang.isBoolean(r)?r:!0},h.prototype.filterContacts=function(e){var t=!0,n=[];if(this.filterItems.length!==0){this.setConfigValues(1,!0,!t);for(var r in e)typeof e[r].email!="undefined"&&this.filterContact(e[r])&&n.push(e[r])}return n},h.prototype.buildContactsIndex=function(){l()};var A=function(){function s(t){var n=u(t),s;return t.isCategory?s=e.common.Utils.substitute(r,{hilite:n},0,0,0,0,strings):s=e.common.Utils.substitute(i,{hilite:n,id:t.id,email:t.email,emailFieldId:t.emailField.id},0,0,0,0,strings),s}function o(t,n,r,i){var s="";return t||n||r?(s=e.common.Utils.substitute(strings.str_name_format,{given_name:t?t:"",middle_name:n?n:"",family_name:r?r:""}),s=s.replace(/ +(?= )/g,"")):i?s=i:s="",s}function u(t){function x(e,t,n){var r="";switch(t){case"amp":n?r="&"+n+";":r="&";break;case"#39":r="'";break;case"quot":r='"';break;case"lt":r="<";break;case"gt":r=">";break;case"#35":r="#";break;default:r=""}return r}var n=t.matches,r,i,s,u="",f="",l="";if(n&&(n.nickname||n.user||n.firstname||n.lastname||n.mobileno||n.homeno||n.workno||n.email)){var c=e.Lang.isArray(n.nickname)&&n.nickname.length>0?!0:!1,h=e.Lang.isArray(n.firstname)&&n.firstname.length>0?!0:!1,p=e.Lang.isArray(n.lastname)&&n.lastname.length>0?!0:!1,d=e.Lang.isArray(n.email)&&n.email.length>0?!0:!1,v=t.nickname||null,m=t.firstname||null,g=t.lastname||null,y=t.email||null,b=c?a(v,n.nickname):v&&v.length>0?v:null,w=h?a(m,n.firstname):m&&m.length>0?m:null,E=p?a(g,n.lastname):g&&g.length>0?g:null,S=d?a(y,n.email):null;r="",r=o(w,"",E,b),b=c?b:null,w=h?w:null,E=p?E:null,i="",S?i+=S:i+=y,f=r||"",f=e.Lang.trim(f),f!==""&&(NeoConfig.bidi?(s=e.Intl.detectDirection(u.replace(/<\/?b\>/,"")),f="<span data-name dir="+s+">"+f+"</span>"):f="<span data-name>"+f+"</span>"),i.length>0&&(f.length>0&&(f+=" "),f===""?l="<em class='email no-name'"+(t.isCategory?"":" data-email='"+y+"'")+" dir='ltr'>"+i+"</em>":l="<em class='email'"+(t.isCategory?"":" data-email='"+y+"'")+" dir='ltr'>("+i+")</em>")}return l=l.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,x),u=f+l,u}function a(t,n){var r=t,i,s,o,u,a;n.sort(l),s=r.length;for(i=n.length-1;i>=0;i--)o=n[i],NeoConfig.bidi?(u=r.substring(0,o.startIndex),a=r.substring(o.endIndex,s)+r.substring(s),r=u+e.comms.Intl.highlightString(r.substring(o.startIndex,o.endIndex),u,a)+a):r=r.substring(0,o.startIndex)+f(r.substring(o.startIndex,o.endIndex))+r.substring(o.endIndex,s)+r.substring(s),s=o.startIndex;return r=r.substring(0,s)+r.substring(s),r}function f(e){return"<b>"+e+"</b>"}function l(e,t){return typeof e=="object"&&typeof t=="object"&&typeof e.startIndex=="number"&&typeof t.startIndex=="number"?+(e.startIndex-t.startIndex):0}var t='<li role="option"><span class="ac-value">{{hilite}}</span><span data-action="ac-remove-item" data-ac-email-field-id="{{emailFieldId}}" data-ac-id="{{id}}" data-ac-email="{{email}}" class="icon icon-small-close ac-remove-item"></span></li>',n='<li role="option"><span class="ac-value">{{hilite}}</span></li>'
,r=n,i=NeoConfig.enableContactDelete?t:n;return{getItemMarkup:s,hlMatch:a,buildName:o}}();h._test={validateFilterItems:O,validateTempMatchData:M},e.namespace("comms").FilterContacts=h,e.namespace("comms").FilterContactsMarkup=A},"1.0.0",{requires:["contacts-api-utils","contacts-api","common-utils"]});
YUI.add("comms-intl-bidihighlight",function(A){A.mix(A.namespace("comms.Intl"),{_needPrevChar:/[\u0620\u0622-\u063F\u0641-\u064A\u066E\u066F\u0671-\u0673\u0675-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u077F\u07CA-\u07EA]/,_needNextChar:/[\u0620\u0626\u0628\u062A-\u062E\u0633-\u063F\u0641-\u0647\u0649\u064A\u066E\u066F\u0678-\u0687\u069A-\u06BF\u06C1\u06C2\u06CC\u06CE\u06D0\u06D1\u06FA-\u06FC\u06FF\u0712-\u0714\u071A-\u071D\u071F-\u0727\u0729\u072B\u072D\u072E\u074E-\u0758\u075C-\u076A\u076D-\u0770\u0772\u0775-\u0777\u077A-\u077F\u07CA-\u07EA]/,_highlightJoiner:"\u200d",_highlightStartTag:"<b>",_highlightEndTag:"</b>",_initializeBidiHighlightJoiner:function(){},highlightString:function(I,J,G){var K,F,M,D,B,L,C,E,H;E=function(N){return N===""?"":N.charAt(N.length-1);};H=function(N){return N===""?"":N.charAt(0);};if(I.length===0){return"";}L=E(J);C=H(G);K=I.charAt(0);M=I.charAt(I.length-1);F=K.charCodeAt(0);D=M.charCodeAt(0);if(L===""||L.charCodeAt(0)<1568||F<1568){B=this._highlightStartTag+I;}else{if(this._needNextChar.test(L)&&this._needPrevChar.test(K)){B=this._highlightJoiner+this._highlightStartTag+this._highlightJoiner+I;}else{B=this._highlightStartTag+I;}}if(C===""||C.charCodeAt(0)<1568||D<1568){B=B+this._highlightEndTag;}else{if(this._needPrevChar.test(C)&&this._needNextChar.test(M)){B=B+this._highlightJoiner+this._highlightEndTag+this._highlightJoiner;}else{B=B+this._highlightEndTag;}}return B;}});A.comms.Intl._initializeBidiHighlightJoiner();},"1.0.0");YUI.add("ac-widget",function(e){function s(e){var t=null,n=null;return e&&(n=e.one(".ac-value"))&&(t=n.get("text")),t}function o(e){var t=this;e.ac=t._getEventPlugin(e),e.itemNodeToValue?this._nodeToValue=e.itemNodeToValue:this._nodeToValue=s,e.ac&&o.superclass.constructor.apply(t,[e])}var t=e.Lang,n=e.contacts,r=n.utils,i=e.comms;o.NAME="ACWidget",e.extend(o,i.ui.AutoComplete,{bind:function(){o.superclass.bind.apply(this,arguments)},bindUI:function(){o.superclass.bindUI.apply(this,arguments)},_getEventPlugin:function(e){var n=!1,r=t.isUndefined;return!r(e.acNode)&&!r(e.acTarget)&&(n=e.acTarget.plug(i.ui.AutoCompleteEventsPlugin,{alignNode:e.acNode}).ac),n},refresh:function(e){var t=this,n=!1;return n=t._getEventPlugin(e),n?(e.ac=n,t.setAttrs(e)):t},getItemMarkup:function(t){return e.comms.FilterContactsMarkup.getItemMarkup(t)},click:function(t){var n=this,r=n.get("ac");t.halt();if(t.target.hasClass("ac-remove-item")){var s=t.target,o=s.getAttribute("data-ac-id"),u=s.getAttribute("data-ac-email-field-id"),a=s.getAttribute("data-ac-email");e.fire("mt:click",{action:"ac_del",append:{ltxt:n._selectedIndex}}),e.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(e){var t=e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok",btnLabel:strings.str_delete}),n=e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_btn_cancel}),s={hd:strings.str_address_remove_hd,bd:e.common.Utils.substitute(strings.str_contacts_remove_bd,{name:a}),ft:t+n},f={ok:{handler:function(){var t=new i.FilterContacts;e.contacts.api.removeEmail(o,parseInt(u,10),t.buildContactsIndex),r.set("queryValue",""),s={hd:strings.str_address_removed_hd,bd:e.common.Utils.substitute(strings.str_address_removed_bd,{name:a}),ft:e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"ok","default":"default",btnLabel:strings.str_ok})},e.common.ui.DialogHelper.createCommon(s)}},cancel:{handler:function(){r.set("queryValue","")}}},l=function(){};e.common.ui.DialogHelper.createCommon(s,f,l)})}else{var f;e.fire("mt:click",{action:"ac_select",append:{ltxt:n._selectedIndex}}),f=t.currentTarget.getData("selectedCb");if(f){f.call(t.target,t);return}n._selectedIndex=-1;var l=this._nodeToValue(t.currentTarget);l!==null&&(r.set("queryValue",l),r.get("host").simulate("keydown",{keyCode:13})),n._currentValue=l,r.get("host").focus()}n.hide()},handleEnter:function(e,t){var n=t.get("ac"),s=t._selectedIndex,o,u;e.halt();var a=new i.FilterContacts;if(t.get("data").queryStr!==n.get("queryValue")){a.updateFilterItems(n.get("queryValue"));var f=a.filterContacts(r.getSortedFlatContacts(["firstname","lastname","email"]));t.setAttrs({query:n.get("queryValue"),data:f}).drawMarkUp().setAlign().show()}s!==-1&&(o=t.item(s),o&&(u=this._nodeToValue(o),u!==null&&(n.set("queryValue",u),t._selectedIndex=-1,n.get("host").focus(),t.hide())))},triggerQuery:function(){this.get("ac").fire("ac:query",{value:this.get("ac").get("queryValue")})},isMousedOver:function(){var e=this.get("boundingBox"),t=e&&(e.one("div.ac-results:hover")||e.one("div.ac-results li.over")||e.one("li.yui3-aclist-item-hover"));return!!t},buildName:e.comms.FilterContactsMarkup.buildName}),o.ATTRS={host:{value:null,getter:function(){return this.get("ac").get("host")}},alignNode:{value:null,getter:function(){return this.get("ac").get("alignNode")}}},e.namespace("contacts.ui"),e.contacts.ui.ACWidget=o},"1.0.0",{requires:["overlay","node-event-simulate","comms-ui-autocomplete-plugin","comms-ui-autocomplete","contacts-api-utils","contacts-api","filter-contacts","common-utils","comms-intl-bidihighlight"]});
YUI.add("_shared_module_offscreen_bin_compose",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose={base:'<div id="ac-to-results" class="ac-results"></div><div id="ac-cc-results" class="ac-results"></div><div id="ac-bcc-results" class="ac-results"></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_notification_notifications",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_notification_notifications={base:"{{addlozenge_exceededmax}}{{send_success}}{{send_error}}{{send_abuse}}{{intro}}{{spam_success}}",addlozenge_exceededmax:'<div class="nf-text">{{str_comp_addlozenge_exceededmax}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_success:'<div class="nf-text">{{str_comp_msg_sent}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_error:'<div class="nf-text">{{str_comp_not_sent}} <a href = "#" data-action="retry">{{str_retry}}</a> <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',send_abuse:'<div class="nf-text">{{str_comp_send_abuse_error}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',intro:'<div class="nf-text">Click <a href = "#" data-action = "view" style="padding:0">here</a> to learn more about your inbox! <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>',spam_success:'<div class="nf-text">{{str_modal_spam_investigation}} <a class="icon btn-cancel-notification" data-action="closeNotification"></a></div>'};},"1.0.0");YUI.add('calendar_strings', function(Y) {
Y.namespace("mail");
Y.mix(strings,{"str_cal_fmt_addEvent_date":"{dd}\/{MM}\/{yyyy}","str_cal_fmt_add_event_time":"{h}:{mm}{tt}","str_cal_dateformat_AM":" a.m.","str_cal_dateformat_PM":" p.m.","str_cal_ae_never":"Nunca","str_cal_ae_daily":"A diario","str_cal_ae_weekly":"Semanalmente","str_cal_ae_monthly":"Mensualmente","str_cal_ae_yearly":"Anualmente","str_cal_err_title_length":"La longitud del t\u00edtulo debe tener menos de 1024 caracteres","str_cal_err_title":"Indica el t\u00edtulo del evento","str_event_saved":"Evento guardado","str_cal_err_date":"Escribe una fecha v\u00e1lida con formato","str_cal_err_email_id_title":"Escribe una direcci\u00f3n de correo electr\u00f3nico con un formato v\u00e1lido: nombre@ejemplo.com","str_cal_err_enddate":"La fecha de inicio debe ser anterior a la fecha de finalizaci\u00f3n.","str_cal_err_frequency":"La duraci\u00f3n del evento debe ser menor que su periodicidad. Acorta la duraci\u00f3n o cambia su periodicidad.","str_cal_err_invite":"Hay un problema con el formato de la direcci\u00f3n de correo electr\u00f3nico que ingresaste. Aseg\u00farate de usar el formato siguiente: usuario@ejemplo.com","str_cal_err_name":"Indica el nombre en pantalla para la agenda","str_cal_err_reminder":"Selecciona por lo menos una manera para recibir los recordatorios","str_cal_err_time":"Escribe una hora v\u00e1lida con formato","str_cal_err_title_calendar":"Indica el t\u00edtulo para la agenda","str_cal_err_title_friends_id":"Indica la direcci\u00f3n de correo electr\u00f3nico de tu amigo","str_cal_err_title_ical":"Escribe una direcci\u00f3n de iCal v\u00e1lida","str_cal_err_title_todo":"Especifica un t\u00edtulo para la tarea","str_cal_err_title_todo_list":"Especifica un t\u00edtulo para la lista de tareas","str_cal_err_weekly_repeat":"Selecciona por lo menos un d\u00eda a la semana para repetir.","str_cal_mod_addevent":"Evento nuevo","str_event_title":"T\u00edtulo","str_event_AllDay":"Todo el d\u00eda","str_event_remindMe":"Enviarme un recordatorio","str_cal__label_repeat":"Repetir:","str_event_location":"Ubicaci\u00f3n","str_event_notes":"Notas","str_event_added_to_calendar":"Este evento ha sido a\u00f1adido a tu Agenda."});
}, '1.0.0');YUI.add("mail-model-compose",function(e){var t=function(){t.superclass.constructor.apply(this,arguments)},n={oComposeData:null,initializer:function(){this.oComposeData={header:{subject:null,from:null,replyto:null,to:null,cc:null,bcc:null},origin:{action:null,fid:null,oMsg:null,ctxReq:null,forwardAsAttachment:!1,errInfo:null},content:null,textcontent:null,attachments:[],spellcheck:{corrections:null,correctionHash:[]},composeActions:[],isRich:null},this.cdoType="compose"},destructor:function(){},updateData:function(e){var t,n={uiUpdate:!0};for(t in e)t&&this.set(t,e[t],n)},neas:function(e){return e&&e.length},_getActionCount:function(){return this.oComposeData.composeActions.length},_setComposeAction:function(e){var t,n;e&&(typeof e=="string"?t=e:(t=e.action||"composestart",n=e.timestamp),n=n||Date.now(),this.oComposeData.composeActions.push({action:t,timestamp:n}))},_getComposeAction:function(){var e=this.oComposeData.composeActions.length;return this.oComposeData.composeActions[e]},_getReplyHeader:function(){var e={from:this.oComposeData.header.from,to:this.oComposeData.header.to,cc:this.oComposeData.header.cc,subject:this.oComposeData.header.subject};return e},_setReplyHeader:function(e){e.from&&(this.oComposeData.header.from=e.from),e.to&&(this.oComposeData.header.to=e.to),e.cc&&(this.oComposeData.header.cc=e.cc),e.bcc&&(this.oComposeData.header.bcc=e.bcc),e.subject&&(this.oComposeData.header.subject=e.subject)},_getHeader:function(){return this.oComposeData.header},_setHeader:function(e){this.oComposeData.header=e},_getContent:function(){return this.oComposeData.content},_setContent:function(e){this.oComposeData.content=e},_getTextContent:function(){return this.oComposeData.textcontent},_setTextContent:function(e){this.oComposeData.textcontent=e},_getReplyContent:function(){return this._getContent()},_setReplyContent:function(e){this._setContent(e)},_getTextMode:function(){if(this.oComposeData.isRich!==null)return this.oComposeData.isRich;var t=e.common.persist.UserData.get("userUIPref.useRichText"),n=t&&t!=="plain";return this.oComposeData.isRich=n,n},_setTextMode:function(t){this.oComposeData.isRich=t,e.common.persist.UserData.set("userUIPref.useRichText",t?"dynamic":"plain"),setTimeout(function(){e.common.persist.UserData.saveOne("userUIPref.useRichText")},10)},_getOrigin:function(){return this.oComposeData.origin},_setOrigin:function(e){this.oComposeData.origin=e,this.cdoType="compose",e.action?this.cdoType+=e.action:this.cdoType+="unkorigin"},_getOriginError:function(){return this.oComposeData.origin.errInfo},_setOriginError:function(e){this.oComposeData.origin.errInfo=e},_addAttachment:function(e){var t=this.oComposeData.attachments.length,n=e&&e.state&&e.state.uploaded||0;e.cdoIndex=t,this.oComposeData.attachments.push(e),this.fire("CDO_ATTACHMENT_ADDED",t,n)},_isAttachmentOversized:function(e){return e.state.failCause==="size"},_addAttachments:function(e){if(e)for(var t=0;t<e.length;t++)this._addAttachment(e[t])},_removeAttachment:function(e){var t=this.oComposeData.attachments[e]||{};t.state=t.state||{},t.state.cancelled=!0,this.fire("CDO_ATTACHMENT_DELETED",e)},_removeAllAttachments:function(e){var t=this.oComposeData.attachments;for(var n=0;n<t.length;n++)(!e||e(t[n]))&&this._removeAttachment(n);this.fire("CDO_ALL_ATTACHMENTS_DELETED")},_updateAttachment:function(e,t){var n=this.oComposeData.attachments[e];for(var r in t)n[r]=t[r];this.fire("CDO_ATTACHMENT_PROCESSED",e)},_getAttachmentsSize:function(){var e=this.oComposeData.attachments,t=0;for(var n=0;n<e.length;n++){var r=e[n],i=r.state||{},s=r.size||{sampled:0,original:0};isNaN(s.original)&&(s.original=0),isNaN(s.resampled)&&(s.resampled=0),i.cancelled||(i.resampled?t+=s.sampled:t+=s.original)}return t},_getAttachmentsCount:function(e){var t=this.oComposeData.attachments,n=0;for(var r=0;r<t.length;r++){var i=t[r],s=i.state||{};if(e&&!e(i))continue;if(!e&&s.cancelled)continue;n++}return n},_getIsEmpty:function(){var e=this.oComposeData,t=this.oComposeData.header,n=this.neas(t.subject)||this.neas(t.to)||this.neas(t.cc)||this.neas(t.bcc)||t.replyto!==null||e.origin.action!==null||this.neas(e.attachments);return!n},_getAttachments:function(){return this.oComposeData.attachments},_setSpellCheckCorrections:function(e){this.oComposeData.spellcheck.corrections=e},_getSpellCheckCorrections:function(){return this.oComposeData.spellcheck.corrections},_setSpellCheckCorrectionHash:function(e){this.oComposeData.spellcheck.correctionHash=e},_getSpellCheckCorrectionHash:function(){return this.oComposeData.spellcheck.correctionHash}};e.extend(t,e.Base,n,{NAME:"composeModel",ATTRS:{header:{setter:n._setHeader,getter:n._getHeader},replyheader:{setter:n._setReplyHeader,getter:n._getReplyHeader},content:{setter:n._setContent,getter:n._getContent},textcontent:{setter:n._setTextContent,getter:n._getTextContent},replycontent:{setter:n._setReplyContent,getter:n._getReplyContent},isRichText:{setter:n._setTextMode,getter:n._getTextMode},origin:{setter:n._setOrigin,getter:n._getOrigin},originerror:{setter:n._setOriginError,getter:n._getOriginError},attachments:{getter:n._getAttachments},attachmentsSize:{getter:n._getAttachmentsSize},attachmentsCount:{getter:n._getAttachmentsCount},spellcheckcorrections:{setter:n._setSpellCheckCorrections,getter:n._getSpellCheckCorrections},spellcheckcorrectionhash:{setter:n._setSpellCheckCorrectionHash,getter:n._getSpellCheckCorrectionHash},actionCount:{value:0,getter:n._getActionCount},composeAction:{value:"",setter:n._setComposeAction,getter:n._getComposeAction},antivirus:{value:0},prePopulated:{value:!1},saveaction:{}}});var r=function(){function i(e){var n=new t;return n.isDirty=!1,n.isDraft=e,n.cdoCount=r,r++,n}var n=this,r=0;e.mix(n,{createModel:i})};e.namespace("mail.model"),e.mail.model.ComposeModel=t,e.mail.model.ComposeModelFactory=new r},"1.0.0",{requires:["base","common-persist-user-data"]});
YUI.add("mail-model-send",function(D){var C=function(){C.superclass.constructor.apply(this,arguments);};var B={oSendData:null,initializer:function(){this.oSendData={cascade:{message:{subject:null,from:null,to:null,cc:null,bcc:null,replyto:{name:null,email:null},simplebody:{html:null,text:null,attachment:null}}},origin:{fid:null,oMsg:null,action:null},draftMID:null,cid:null,requestState:null,requestId:0};},destructor:function(){},reset:function(){delete this.oSendData;this.initializer();},_setHeader:function(F){for(var E in F){if(E){this.oSendData.cascade.message[E]=F[E];}}},_setContentHTML:function(E){this.oSendData.cascade.message.simplebody.html=E;},_setContentText:function(E){this.oSendData.cascade.message.simplebody.text=E;},_setAttachments:function(E){this.oSendData.cascade.message.simplebody.attachment=E;},_setOrigin:function(E){this.oSendData.origin=E;if(E.action&&E.action!=="edit"&&E.fid&&E.oMsg&&E.oMsg&&E.oMsg.mid){this.oSendData.cascade.messageReference={fid:E.fid,mid:E.oMsg.mid,replied:E.action==="reply_all"||E.action==="reply_sender",forwarded:E.action==="forward"};}},_getOrigin:function(){return this.oSendData.origin;},_setDraftMID:function(E){this.oSendData.draftMID=E;},_getDraftMID:function(){return this.oSendData.draftMID;},_setCaptcha:function(F){if(!this.oSendData.cascade.headers){this.oSendData.cascade.headers={};}for(var E in F){if(E){this.oSendData.cascade.headers[E]=F[E];}}},_getRecipients:function(){return{to:this.oSendData.cascade.message.to,cc:this.oSendData.cascade.message.cc,bcc:this.oSendData.cascade.message.bcc};},_getCascade:function(){return this.oSendData.cascade;},_setCID:function(E){this.oSendData.cid=E;},_getCID:function(){return this.oSendData.cid;},_getRequestState:function(){return this.oSendData.requestState;},_setRequestState:function(E){this.oSendData.requestState=E;},_getRequestId:function(){return this.oSendData.requestId;},_setRequestId:function(E){this.oSendData.requestId=E;}};D.extend(C,D.Base,B,{NAME:"sendModel",ATTRS:{header:{setter:B._setHeader},contenthtml:{setter:B._setContentHTML},contenttext:{setter:B._setContentText},attachments:{setter:B._setAttachments},origin:{setter:B._setOrigin,getter:B._getOrigin},draftMID:{setter:B._setDraftMID,getter:B._getDraftMID},captcha:{setter:B._setCaptcha},recipients:{getter:B._getRecipients},cascade:{getter:B._getCascade},sendaction:{},disableaddcontact:{},cid:{setter:B._setCID,getter:B._getCID},requestState:{setter:B._setRequestState,getter:B._getRequestState},requestId:{setter:B._setRequestId,getter:B._getRequestId}}});var A=function(){var F=this;function E(){var G=new C();return G;}D.mix(F,{createModel:E});};D.namespace("mail.model");D.mail.model.SendModel=C;D.mail.model.SendModelFactory=new A();},"1.0.0",{requires:["base"]});YUI.add("mail-controller-compose",function(e){function S(){return n.createModel()}function x(){}function T(){}function N(t){var n,r=j(p.get("userSendPref.defaultID"));r&&(n=e.mail.Controller.Compose.injectSignature(t.get("content"),t.get("isRichText"),r),n&&t.set("content",n))}function C(t){e.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(e){var n={sdo:M(t.cdo,null,{draftMID:t.mid},!0),auto:t.auto||null,silent:t.silent||null,mid:t.mid},r;t.cdo&&t.cdo.appid&&(n.appid=t.cdo.appid),t.cdo&&(r=t.cdo.get("origin"),r&&(n.cid=r.oMsg&&r.oMsg.cid)),n.action=t.cdo.cdoType+"_"+t.cdo.cdoCount+"_savedraft",t.cdo.set("composeAction",n.action),n.actionCount=t.cdo.get("actionCount"),e.mail.Controller.SendConfirm.saveMessage(n,function(e,r,i){t.cdo.set("saveaction",{mid:e,auto:n.auto,state:r,isMailboxBusy:i})})})}function k(e,t){var n={textConvert:!0};e.set("isRichText",!1),e.set("content",t,n)}function L(e){e.set("isRichText",!0)}function A(t,n){p.set(t,n),setTimeout(function(){e.common.persist.UserData.saveOne(t)},10)}function O(t,n,r,i){e.Array.each(t,function(e){if(e.uploadState!=="success")return;var t=e.original;if(!t||!t.mid||r){n.push({attachment:"upload://"+e.diskfilename,disposition:"attachment"});return}n.push({attachment:Z(t.fid,t.mid?t.mid:i,t.partId,t.tnef),disposition:"attachment"})})}function M(t,n,r,i){var s=t.get("header"),o=t.get("origin"),u=t.get("content"),a=t.get("textcontent"),f=t.get("isRichText"),l=[],c;return NeoConfig.useAttComposerTT&&O(t.attachments.getAll(!1,!0),l,t.get("passive"),r?r.draftMID:null),c={subject:s.subj||s.subject,from:s.from,to:s.to,cc:s.cc,bcc:s.bcc,replyto:{name:s.from.name,email:vt(s.from.email)}},mt(o,c),n?n.reset():n=e.mail.model.SendModelFactory.createModel(),n.set("header",c),n.set("contenttext",a),n.set("attachments",l),f&&n.set("contenthtml",u),i&&!!o&&o.action&&n.set("origin",o),r&&(r.draftMID&&n.set("draftMID",r.draftMID),r.cid&&n.set("cid",r.cid)),n}function _(t,n,r,i){var o=t.get("origin");if(o.action&&o.fid&&o.oMsg){o.ctxReq&&e.mail.Controller.Messages&&s.abort(o.ctxReq);var u,a=n?{truncateAt:null,midRequest:{blockImages:"none"}}:{truncateAt:null},f={success:function(){D.apply(this,arguments),i&&i()},failure:function(){P.apply(this,arguments)},args:{cdo:t,isDraft:n,stopwatch:r}};u={fid:o.fid,msg:o.oMsg,cachekey:"Prime",ovparams:a},r&&!r.CMGStart&&(r.CMGStart=new Date),NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[u.msg],sourceFid:u.fid,filter:a,success:function(e,t){e.length>0?f.success(e[0],f):f.failure(t)},failure:f.failure}):e.use("mail-controller-messages",function(){o.ctxReq=e.mail.Controller.Messages.get(u,f),t.set("origin",o)})}}function D(e,t){var n=t.args.cdo,r=n.get("origin"),i=t.args.stopwatch,s={};e.mid?(i&&(i.CMGEnd||(i.CMGEnd=new Date,t.respProps&&(i.wasCached=t.respProps.wasCached)),i.CMGSize=e.body.display.length),r.oMsg=e,r.ctxReq=null,r.errInfo="ok",e.yivPrefixNumber&&(s={yqtdPrefix:e.yivPrefixNumber}),H(n,t.args.isDraft,s)):P({msg:this.message},t)}function P(e,t){var n=t.args.cdo;n.set("originerror",e)}function H(t,n,r){var i,s,o;F(t),i=I(t,n),NeoConfig.useAttComposerTT&&(o=0,e.Array.each(i.attachments,function(e){typeof t.attach_map=="undefined"&&(t.attach_map=[]),t.attach_map[o]&&t.attachments.get(t.attach_map[o])?t.get("origin").action!=="forward"&&(t.attachments.del(t.attach_map[o]),t.attach_map.splice(o,1)):(s=t.attachments.add(e),t.attach_map.push(s)),o++}));if(!n){var u=t.get("origin"),a=ot(u),f=j(a.email),l,c=!0;r&&r.noSig&&(c=!1),f&&c&&(l=e.mail.Controller.Compose.injectSignature(null,t.get("isRichText"),f),i.prolog=strings.str_cfg_tog_insert_signature_bottom?i.prolog+l:l+i.prolog)}r&&r.yqtdPrefix&&t.set("yqtdPrefix",r.yqtdPrefix),t.set("replyheader",i.header),t.set("replycontent",i.prolog)}function B(t){var n,r,i;n=I(t,!1),NeoConfig.useAttComposerTT&&(i=0,e.Array.each(n.attachments,function(e){typeof t.attach_map=="undefined"&&(t.attach_map=[]),t.attach_map[i]&&t.attachments.get(t.attach_map[i])?t.get("origin").action!=="forward"&&(t.attachments.del(t.attach_map[i]),t.attach_map.splice(i,1)):(r=t.attachments.add(e),t.attach_map.push(r)),i++}))}function j(e){return null}function F(t){e.use("mail-controller-messages-ops",function(){var n=t.get("origin"),r={},i=new Array(n.oMsg);r.read=1,e.mail.Controller.Messages.flag({fid:n.fid,mid:i,setFlags:r},{failure:function(){},suppressCodes:["Client.MessageIdsNotFound"]})})}function I(e,t){var n=e.get("origin"),r={prolog:null,header:null,attachments:null};if(t)return r.header=n.oMsg.header,r.prolog=Y(n.oMsg.body.display),r.attachments=z(n),r;r.header=R(n);if(n.forwardAsAttachment)return r.prolog="",r.attachments=W(n),r;r.prolog=q(e,n);if(n.action==="forward"||n.action==="reply_sender"||n.action==="reply_all")r.attachments=z(n);return r}function q(e,t){var n=$(e),r=G(t),i;return NeoConfig.hasConv?i=l(n||r?h.reply_rich_short:h.reply_plain_short,t,E,e,strings):i=l(n||r?h.reply_rich:h.reply_plain,t,E,e,strings),!n&&r&&e.set("isRichText",!0),i}function R(t){var n,r=t.action==="reply_sender"||t.action==="reply_all",i={from:null,to:null,cc:null,subject:null},s=[],o=[],u=t.fid==="Sent"||t.fid==="%40S%40Search"&&t.oMsg.sourceFolderInfo.fid==="Sent";return i.from=r?ot(t):st(),r&&(n=ct(t.oMsg),t.action==="reply_sender"?(o.push(n),i.to=o):(u||o.push(n),s.push(n),s.push(i.from),i.to=o.concat(pt(t.oMsg.header.to,s)),i.cc=pt(t.oMsg.header.cc,s),u&&i.to.length===0&&i.cc.length===0&&(i.to=t.oMsg.header.to,i.to.length===0&&(i.cc=t.oMsg.header.cc)))),i.subject=f(U(t)),u||e.Array.each(t.oMsg.header.replyto||[],function(t){var n=i.to;n&&e.Array.indexOf(n,t)<0&&e.Array.indexOf(o,t)<0&&i.to.push(t)}),i}function U(e){var t=e.action==="reply_sender"||e.action==="reply_all"||e.action==="forward";return t?(e.oMsg.header.subject===strings["str_msg-view_no_subject"]&&(e.oMsg.header.subject=""),l(h.subject.replace(/\s+$/,""),e,w,null,strings)):e.oMsg.header.subject}function z(t){var n=t.oMsg.attachments,r=
[];return e.Array.each(n,function(e){(t.action==="forward"||t.action==="edit"||(t.action==="reply_sender"||t.action==="reply_all")&&(e.referencedInline===!0||e.disposition==="inline"))&&r.push(X(e,t))}),r}function W(e){var t=strings.str_comp_nosubject;return e.oMsg.header.subject.length>0&&(t=e.oMsg.header.subject.substring(0,240)),NeoConfig.useAttComposerTT?[{filename:t+".eml",uploadState:"success",size:e.oMsg.header.size,original:{fid:e.fid,mid:e.oMsg.mid,partId:"",tnef:"",disposition:"attachment",displayable:!1}}]:[{filename:t+".eml",state:{uploaded:!0},size:{original:e.oMsg.header.size},original:{partId:"",mid:e.oMsg.mid,fid:e.fid,tnef:""}}]}function X(e,t){return NeoConfig.useAttComposerTT?{filename:e.filename,size:e.size,mimetype:e.type+"/"+e.subtype,thumbnail:e.thumbnailurl,type:e.type,referencedInline:e.referencedInline,uploadState:"success",original:{fid:t.fid,mid:t.oMsg.mid,partId:e.partId||"",tnef:e.tnef,displayable:e.isDisplayable,disposition:e.disposition}}:{filename:e.filename,mimetype:e.type+"/"+e.subtype,size:{original:e.size},state:{uploaded:!0},disposition:e.disposition,isDisplayable:e.isDisplayable,original:{partId:e.partId||"",mid:t.oMsg.mid,fid:t.fid,tnef:e.tnefId}}}function V(e,t,n){var r=/[\x01-\x08\x0B-\x0C\x0E-\x1F\x7F-\x84\x86-\x9F]/ig,i,s,o,u=!0;return e.get("nodeType")===9?o=e.one("body"):o=e,i=n,s=this.convertToPlain(o,!1,u),i=i.replace("<!-- ORIGINAL -->",""),i=i.replace(r,""),s=s.replace(r,""),i=i.replace(/<br\b([^>]*?)\bclass="yui-cursor"(.*?)>/ig,""),i=i.replace(/<p\b([^>]*)>/ig,"<div$1>"),i=i.replace(/<\/p\b[^>]*>/ig,"</div>"),i=["<html><body>",'<div style="color:',t.foreColor,"; background-color:",t.backColor,"; font-family:",t.fontFamily,";font-size:",t.fontSize,'">',i,"</div></body></html>"].join(""),{html:i,text:s}}function $(e){return!NeoConfig.low_bandwidth&&e.get("isRichText")}function J(){return strings.str_cfg_tog_compose_autoattach_prefix}function K(e){var t=v+e.replace(/\r?\n|(.{0,80})\r?\n|(.{1,80})$|(.{1,80} +)/mg,"$1$2$3<br />"+v);return t=t.replace(/(^[\>|(?:&gt;)]+|\<br \/\>(?:\>|\&gt\;)*)/mgi,"$1 "),t.substring(0,t.length-v.length)}function Q(t,n){var r,i=document.createElement("div");return i.innerHTML=t,r=e.mail.Controller.Compose.convertGuts(i),n||(r=a(r)),i.innerHTML="",i=null,r}function G(e){var t=e.oMsg.part;if(t)for(var n=0;n<t.length;n++)if(t[n].subtype==="html")return!0;return!1}function Y(e){return e&&(e=e.replace(g,"$1"),e=e.replace(y,"$1"),e=e.replace(b,"")),e}function Z(e,t,n,r){return typeof r!="undefined"&&r!==""&&r!=="null"?["message:/",encodeURIComponent(e),encodeURIComponent(t),n,r].join("/"):["message:/",encodeURIComponent(e),encodeURIComponent(t),n].join("/")}function et(e){var t,n;return e?{fontFamily:t=nt(!0),fontSize:n=rt(!0)}:tt()}function tt(){var e,t;return t=p.get("userUIPref.composeFontFamily"),t=t.split("|"),t.length>1?t=t[0]:(t=nt(!1),p.set("userUIPref.composeFontFamily",t+"|1")),t||(t=nt(!1),p.set("userUIPref.composeFontFamily",t+"|1")),e=p.get("userUIPref.composeFontSize"),e?e+="px":e=rt(!1),{fontFamily:t,fontSize:e}}function nt(e){return e?it()[0]:strings.str_rte_default_font}function rt(e){if(e){var t=it();return""+parseInt(t[1],10)+t[2]}return parseInt(strings.str_rte_default_font_size,10)+"px"}function it(){return[strings.str_comp_plaintext_default_font,strings.str_comp_plaintext_default_font_size,"px"]}function st(){var e,t,n,r=p.get("userSendPref.defaultFromAddress"),i=p.get("userSendPref.defaultFromName"),s=p.get("externalAccounts")||{},o=s.extAccountsTotal||0,u=s.extAccount||[];if(o>0)for(e=0;e<o;e++)t=u[e],n=t.address,t.address&&t.address.length>0&&t.isDefault&&(r=t.address,i=t.fromName,i===""&&(i=p.get("userSendPref.defaultFromName")));return{name:i,email:r}}function ot(e){return st()}function ut(e,t){var n=0,r=t.length,i=new Array(r);while(r--)i[n]=e(t[n++]);return i}function at(e){return e.name?e.name:e.email}function ft(t){var n="",r;return NeoConfig.bidi?(t.name&&(r=e.Intl.detectDirection(t.name)==="rtl"?"\u202b":"\u202a",n=lt(t.name)?r+'"'+t.name+'"\u202c':r+t.name+"\u202c"),t.email&&(n+=n.length?" \u202a<"+t.email+">\u202c":t.email)):(t.name&&(n=lt(t.name)?'"'+t.name+'"':t.name),t.email&&(n+=n.length?" <"+t.email+">":t.email)),n}function lt(e){return e.match(/[;,"<>@]/)!==null}function ct(e,t){return!t&&e.header.replyto&&e.header.replyto.length>0?e.header.replyto[0]:e.header.from}function ht(e,t,n){return e=pt(e,n),ut(t?ft:at,e).join("; ")}function pt(e,t){return dt(e,t)}function dt(e,t){var n,r,i,s=[],o;for(n=0;n<e.length;n++){o=!1;if(!e[n].email)continue;i=e[n].email.toLowerCase();if(t)for(r=0;r<t.length;r++)if(i===t[r].email.toLowerCase()){o=!0;break}o||(s.push({name:e[n].name,email:e[n].email}),t&&t.push(e[n]))}return s}function vt(e){return st()}function mt(e,t){if(e.oMsg&&e.oMsg.header){var n=e.oMsg.header;t.inreplyto=n.messageId||n.inReplyTo,t.references="",n.references?t.references=n.references+" ":n.inReplyTo&&(t.references=n.inReplyTo+" "),t.references+=n.messageId}}function gt(){return new RegExp("(^re:\\s?)|(^fw:\\s?)|(^"+strings.str_comp_reply_spRE+"\\s?)|"+"(^"+strings.str_comp_reply_spFWD+"\\s?)","i")}function yt(t,n){var r=e.mail.Controller.Compose.convertHTMLToPlain,i=r(t),s=r(n),o=i.replace(s,""),u=["see attached","see attachment","find the included","see included","is attached","attached is","are attached","please find attached","attached are","attached to this email","attached to this message","I'm attaching","I am attaching","find attached","find the attached","find included","attached file","see the attached","see attachments","attached files","I've attached","I have attached"];for(var a in u)if(o.indexOf(u[a])!=="-1")return u[a];return!1}var t=e.mail,n=t.model.ComposeModelFactory,r=t.Controller,i=r.extend("Compose"),s=t.Controller.Messages,o=e.common,u=o.Utils,a=u.escapeHtml,f=u.unescapeHtml,l=u.substitute,c=e.ui.Templates,h=c._shared_module_compose_reply,p=o.persist.UserData,d=t.persist.MetaData,v=">",m=null,g=new RegExp(/<a[^>]*href="([^\s]*?)"[^>]*>[\s]*<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>http(([\s]|[^\s])*?)<\/span>[\s]*<\/a>/ig
),y=new RegExp(/<span[^>]*id="?lw_\d*?_\d*?"?[^>]*>(([\s]|[^\s])*?)<\/span>/ig),b=new RegExp(/<script[^>]*[^>]*>(([\s]|[^\s])*?)<\/script>/ig),w={subject_prefix:function(e){return strings[e.action==="forward"?"str_comp_reply_spFWD":"str_comp_reply_spRE"]},subject_data:function(e){return m||(m=gt()),e.oMsg.header.subject.replace(m,"")}},E={quotetext_header:function(){return J()?h.qthdr:""},quotetext_footer:function(){return J()?h.qtftr:""},fontfamily:function(){return tt().fontFamily},fontsize:function(){return tt().fontSize},deffontfamily:function(){return nt(!1)},deffontsize:function(){return rt(!1)},from_data:function(e){return a(f(ft(ct(e.oMsg,!0))))},to_data:function(e){return a(f(ht(e.oMsg.header.to,!0)))},cchdr:function(e){return e.oMsg.header.cc.length>0?l(h.cchdr,e,E,null,strings):""},cc_data:function(e){return a(f(ht(e.oMsg.header.cc,!0)))},date_data:function(e){return a(u.dateFormatter(new Date(e.oMsg.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n))},subject_data:function(e){return a(f(e.oMsg.header.subject))},reply_rich_body:function(e){return Y(e.oMsg.body.display)},forward_rich_body:function(e){return e.action==="forward"?h.forward_rich_body:!1},reply_rich_header:function(e){var t=NeoConfig.hasConv?"":h.rulerHeader,n=e.action==="forward"?h.fwdhdr:t;return l(n,null,null,null,strings)},reply_plain_body:function(e){var t=Y(e.oMsg.body.display);if(J()){try{t=Q(t)}catch(n){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composectrl:1",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composectrl:1")}t=K(t)}return t},reply_plain_header:function(e){return strings[e.action==="forward"?"str_comp_reply_fwdHeader":"str_comp_reply_origHeader"]},quoteprefix:function(){return J()?v+" ":""},headerDir:function(){return NeoConfig.isRTL?' dir="rtl" ':' dir="ltr" '}};e.mix(i,{createCDO:S,insertSignature:N,applyStationery:x,addAttachment:T,assembleSendBody:V,transformSend:M,save:C,savePref:A,toPlainText:k,toRichText:L,fetchOrigin:_,getDefaultFontInfo:et,getStyleFontFamily:nt,getStyleFontSize:rt,getDefaultFromAddress:st,seedSubject:U,htmlToText:Q,getSignature:j,convertAttachmentData:z,attachAlert:yt,updateAttachments:B,getBody:q,getHeaderContent:R,transformOrigin:I,updateFromOrigin:H},!0)},"3.0.0",{requires:["mail-controller-base","mail-model-compose","mail-model-send","common-persist-user-data","mail-persist-meta-data","_shared_module_compose_reply"]});
YUI.add("mail-controller-compose-text",function(A){A.namespace("mail.Controller");var J=A.common.Utils,O={address:1,blockquote:1,body:1,caption:1,center:1,col:1,colgroup:1,dd:1,dir:1,div:1,dl:1,dt:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,li:1,menu:1,ol:1,p:1,pre:1,table:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,ul:1};function B(S,T,R){var U=S.cloneNode(true),Q=A.Node.getDOMNode(U),P=F(Q);if(T){P=I(P,true);}if(R){P=E(P);}return P;}function L(R,T){var P=A.Node.create("<div>"+R+"</div>"),S=A.Node.getDOMNode(P),Q=F(S);if(T){Q=I(Q);}return Q;}function F(Q){var P=A.UA.ie;if(!P){K(Q);}else{Q.innerHTML=Q.innerHTML.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"<BR/>");}return M(Q,false,"").replace(/\n[\s\xA0]+$/,"");}function E(P){return P.replace(/\xA0/g," ");}function M(S,W,X){var Z=A.one(S),U,a;if(Z.hasClass("compose-ignore")){return"";}else{if(S.nodeType===1||S.nodeType===11){var R=S.tagName;if(A.UA.ie&&S.tagName==="DIV"&&S.getAttribute("class")&&S.getAttribute("class")!=null&&S.getAttribute("class").indexOf("hr")!==-1){R="HR";}switch(R){case"SCRIPT":case"STYLE":case"LINK":case"OBJECT":case"EMBED":return"";case"HR":a=S.previousSibling;return(G(a)?"":"\n")+X+"________________________________\n"+X;case"BR":return"\n"+X;case"BLOCKQUOTE":X+=">";default:U=[];var P=S.firstChild;var V=0;if(R==="SPAN"&&A.one(S).hasClass("Apple-tab-span")){return A.one(S).get("text");}while(P!==null){var Y=M(P,P.tagName==="PRE",X);if(P.nodeType===1){if(H(P)==="block"&&U.length>0&&P.tagName!=="TD"){var T=Y.match(/^[ \t\r\n\v\f]*$/);if(!T||P.tagName==="LI"){U.push("\n"+X);}}switch(P.tagName){case"LI":V++;U.push("\t"+(P.parentNode.tagName==="OL"?V+".":"*")+" ");break;}}if(Y){U.push(Y);}if(P.nodeType===1){switch(P.tagName){case"TD":U.push(" ");break;}}P=P.nextSibling;}return U.join("");}}else{if(S.nodeType===3){U=S.nodeValue;if(!W){a=S.previousSibling;var Q=a?H(a):null;U=G(a)?U:U.replace(/\n[ \t\r\n\v\f]+/g," ");if(a===null||G(a)){U=U.replace(/^[ \t\r\n\v\f]+/,"");}else{if(Q==="block"){U=U.replace(/^[ \t\r\n\v\f]+/,"\n");}else{if(Q==="inline"){U=U.replace(/^[ \t\r\n\v\f]+/," ");}}}U=U.replace(/[ \t\r\n\v\f]+$/," ");}return U;}else{return"";}}}}function G(P){if(P===null||P.nodeType!==1){return false;}return P.tagName==="BR";}function H(P){if(P===null||P.nodeType!==1){return null;}if(P.style.display){if(P.style.display==="block"){return"block";}else{if(P.style.display==="inline"){return"inline";}}}return O[P.tagName.toLowerCase()]?"block":"inline";}function K(S){if(S.nodeType===1||S.nodeType===11){var Q=S.firstChild;while(Q!==null){var U=Q.nextSibling;K(Q);Q=U;}}else{if(S.nodeType===3){var R=S.nodeValue;if(R.match(/^[ \t\r\n\v\f]*$/)){var P=S.previousSibling;var T=P?H(P):"inline";if(T==="inline"&&!G(P)){S.nodeValue=S.nodeValue.replace(/\n.*/," ");}else{S.parentNode.removeChild(S);}}}}}function I(Q,P){Q=J.escapeHtml(Q);if(P){Q=Q.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");Q=Q.replace(/( ){2}/g,"&nbsp;&nbsp;");}Q=Q.replace(/\n/ig,"<br />");return Q;}function C(U,R,S){var P,T=S&&S.isRich,Q,W=S&&S.text;if(!W){return"";}W=N(W,T);if(!T){W=D(W);}else{if(!R){try{Q="<br>";W=W.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);W=W.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,Q);W=W.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,Q);W=W.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,Q);W=W.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,Q);W=W.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,Q);W=W.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"");W=W.replace(/<\/p>/gi,Q);W=W.replace(/(<hr\s*>)/gi,Q+"________________________________"+Q);W=L(W,true);}catch(V){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-controller-composetext:1",V,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-controller-composetext:1");}}}U=U||"";P=U!="";if(W!=""){if(A.UA.ie||A.UA.webkit){if(P){U=U+"<div></div><div>&nbsp;</div>"+W;}else{U="<div></div><div>&nbsp;</div>"+W+U;}}else{if(P){U=U+"<div>&nbsp;</div>"+W;}else{U="<div>&nbsp;</div>"+W+U;}}}return U;}function N(Q,P){if(Q!=null){if(!P){Q=Q.replace(/<vbr>|\n/gi,"<br />");return"<div>"+Q+"</div>";}else{Q=Q.replace(/<vbr>/gi,"");}}return Q||"";}function D(R){var Q,P;R=A.common.Utils.unescapeHtml(R);R=R.replace(/<hr\s*[^>]*>/gi,"<div><hr></div>");R=R.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklineppblanklinepstartptag");R=R.replace(/((<br\s+[^>]*>)|(<br\s*>))((<br\s+[^>]*>)|(<br\s*>))/gi,"endptagpblanklinepstartptag");R=R.replace(/((<p\s+[^>]*>)|(<p\s*>)&nbsp;<\/p>)/gi,"endptagpblanklinepstartptag");R=R.replace(/(((<div\s+[^>]*>)|(<div\s*>))&nbsp;<\/div>)/gi,"endptagpblanklinepstartptag");R=R.replace(/(<br\s+[^>]*>)|(<br\s*>)/gi,"brtag");R=R.replace(/(<br\/\s+[^>]*>)|(<br\/\s*>)/gi,"brtag");R=R.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");R=R.replace(/(<p\s+[^>]*>)|(<p\s*>)/gi,"startptag");R=R.replace(/<\/p>/gi,"endptag");Q=R.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]ltr[\'|\"]\s*[^>]*>/gi,"ltrstartptag");Q=Q.replace(/<div\s+[^>]*dir\s*=\s*[\'|\"]rtl[\'|\"]\s*[^>]*>/gi,"rtlstartptag");Q=Q.replace(/(<div\s+[^>]*>)|(<div\s*>)/gi,"startptag");R=Q.replace(/<\/div>/gi,"endptag");P=A.common.Utils.escapeHtml(R);P=P.replace(/brtag/g,"<br />");P=P.replace(/ltrstartptag/g,"<div dir='ltr'>");P=P.replace(/rtlstartptag/g,"<div dir='rtl'>");P=P.replace(/startptag/g,"<div>");P=P.replace(/endptag/g,"</div>");P=P.replace(/pblanklinep/g,"<br/><br/>");return P;}A.mix(A.mail.Controller.Compose,{convertToPlain:B,convertHTMLToPlain:L,convertGuts:F,injectSignature:C});},"1.0.0",{requires:["common-persist-user-data","mail-controller-compose"]});YUI.add("mail-models-validators-send",function(e){e.namespace("mail.Models.Validators").send={MAX_NUM_OF_RECIPIENTS:100,YNC_ADDR_WHITELIST:["sgproxy_test_10@localhost","sgproxy_test_20@localhost","sgproxy_test_40@localhost","sgproxy_test_50@localhost"],validateAddress:function(t){var n=Array.prototype.concat(t.to,t.cc,t.bcc),r=n.length,i,s={valid:!0};for(i=0;i<r;i++)if(!e.comms.Utils.isValidEmail(n[i].email)){if(this.YNC_ADDR_WHITELIST.indexOf(n[i].email)!==-1)continue;return s.valid=!1,s.invalidAddress=n[i].email,s}return s},validatePresenceOfRecipients:function(e){var t={valid:!0};return e.to.length<1&&e.cc.length<1&&e.bcc.length<1&&(t.valid=!1),t},validateNotUploadingAttachments:function(e){return{valid:!e.isUploadingAttachments()}},validateCleanAttachments:function(t){var n=0,r=0;return e.each(t.attachments,function(e){e.state()==="infected"?n++:e.state()==="failed"&&r++}),{valid:n+r===0,cntInfected:n,cntFailed:r}},validatePresenceOfContent:function(t){var n=e.Lang.trim(t.subject),r={valid:!0};return t.state==="captchaing"?r:(n.length<1&&(r.valid=!1),r)},validateNumberOfRecipients:function(e){var t={valid:!0},n=e.to.length+e.cc.length+e.bcc.length;return n>this.MAX_NUM_OF_RECIPIENTS&&(t.valid=!1),t},validateSpame:function(e){var t={valid:!0};return e.isSpame()&&(t.valid=!1),t},validateCaptcha:function(e){var t={valid:!0};return e.isRejectedOnCaptcha()&&!e.captchaAnswer&&(t.valid=!1),t},checkForAttachment:function(t){var n={valid:!0},r=e.common.Utils.getVal(t,"origin.action"),i;return r==="edit"&&e.common.Utils.getVal(t,"attachments").length===0&&(i=t.makeInReplyTo(),e.common.Utils.getVal(i,"replied")&&(r="reply_sender")),e.common.Utils.getVal(t,"origin.parentMsg.flags.hasAttachment")&&(r==="reply_all"||r==="reply_sender")&&(n.valid=!1),n}}},"1.0.0",{requires:["comms-utils","common-utils"]});
YUI.add("mail-ui-mailcompose-base-header-v3",function(e){function B(e){var t=this;t.composeView.attView&&t.composeView.attView.reposAttachObj(e)}function j(){e.ACWidgetInst&&e.ACWidgetInst.hide()}function F(e){e.removeAttribute("aria-owns"),e.removeAttribute("aria-activedescendant")}function I(e){e.removeAttribute("aria-describedby")}function q(){var t=e.ACWidgetInst;t&&t.get("ac").get("host").set("aria-owns",t.get("contentBox").generateID())}function R(e){var t=e.ancestor("ul"),n=t.all(".lozenge-static"),r;n.size()>0&&(r=[],n.each(function(e){r.push(e.generateID())})),r?e.set("aria-describedby",r.join(" ")):e.removeAttribute("aria-describedby")}function U(e){var t;t=e.get("value").replace(/([^,; ]+?@[^ ,;]+?\.[a-z]+?>?)[ ;]+([^ ,;])/ig,"$1, $2"),e.set("value",t)}function z(e,t){var n=e.get("value"),r=n.length,i=parseInt(e.ancestor(".ac-input").getStyle("width"),10)-40,s=150,o=17,u=this;t&&(n?(U(e),u._lozengeIt(e)):setTimeout(function(){U(e),u._lozengeIt(e)},500)),r>o?(s+=(r-o)*10,s>i&&(s=i),e.setStyle("width",s+"px")):e.setStyle("width","")}function W(t){var r=!1,i=null,s=null,o=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,u,a=t.replace(/\".*\"/g,"");return!n(a)||a.indexOf("@")<0?{fail:!0,email:t,name:t}:(o.test(t)?(u=t.match(o),s=u[0],i=n(t.replace(s,"")),s=s.substring(1,s.length-1)):s=i=n(t),e.comms.Utils.isValidEmail(s)||(r=!0),{fail:r,email:s,name:i})}function X(e){var t=0,n=0,r=e.length,i=[],s=!1,o=!1;for(n=0;n!==r;n++){var u=e.charAt(n);switch(u){case'"':s=!s;break;case"&":o=!0;break;case";":o&&(o=!1);break;case",":s||(i.push(e.slice(t,n)),t=n+1)}}return t!==n&&i.push(e.slice(t,n)),i}function V(t){var n=t.ancestor("ul"),r=n.all(".hLozenge"),i;r&&(F(t),I(t),r.remove(),e.fire("lozenge:remove"),O&&(i=t.ancestor(".ac-input"),this._toggleHideRecptsBtn(i.get("id"),!1)))}function $(){var t=this,n;if(!t.isLozengeHighlighted)return;n=t.composeView.baseNode.all(".hLozenge.focus"),n.removeClass(E),F(e.all("#to-field, #cc-field, #bcc-field")),t.allLozengesSelected=!1,t.isLozengeHighlighted=!1}function J(e,t){var n=this;n._removeLozengeHighlights(),e.toggleClass(E),n.isLozengeHighlighted=!0;var r=e.one(".lozenge-static").generateID();t.setAttrs({"aria-owns":r,"aria-activedescendant":r})}function K(e){var t=this,n=e.ancestor("ul"),r=n.all(".hLozenge");r&&(r.addClass(E),t.isLozengeHighlighted=!0),t.allLozengesSelected=!0}function Q(e){var t=this,r,i,s;r=e.ancestor(),i=n(e.get("value"));if(!n(i)){e.set("value","");return}i&&i.indexOf('"')>-1?s=X(i):(i.lastIndexOf(",")===i.length-1&&(i=i.substring(0,i.length-1)),s=i.split(/[;,]+/)),t._makeLozenges(s,r),R(e),e.set("value",""),t.checkOtherLozengeBoxes()}function G(){var t=this,n=t.composeView.baseNode,r,i;n.all("li.hLozenge").size()>100&&(i=new e.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"}),r=p._shared_module_offscreen_bin_notification_notifications.addlozenge_exceededmax,i.on("clickEvent",function(){i.destroy()}),i.notify(f(r,null,null,null,strings),5e3))}function Y(e,t){var r=this,i,s=e.length,o,u,a,f;for(i=0;i<s;i++)u=e[i],n(u),u&&(a=W(u),f=r._createLozenge(a),t.insert(f,t));O&&(o=t.ancestor(".ac-input"),r._toggleHideRecptsBtn(o.get("id"))),r.composeView.resizeRTE(),r._checkRecipientCount(),r.composeView._setDirty(),r.checkOtherLozengeBoxes()}function Z(t,n){var r,i,s,o,u=[];D[n]=[];for(i=0;i<t.length;i++)o=t[i],D[n].push(o),u.push(o.email);s=u.join(",");var a={label:f(strings.str_hdr_more_recipients,{num_more_recipients:u.length},0,0,strings),hover:s,state:"normal",data:s,menu:null,edit:!1,copy:!1,parentClass:"group",dataClass:"more_recp more",action:"expand-recpts",valFn:function(){return!0}},l=new e.comms.ui.Lozenge(a);return l.getNode()}function et(t){var n,r;if(!t)return null;t.name=t.name||t.email;if(strings.str_cfg_tog_compose_enable_nickname){var i=y.getContactsByEmail(t.email),s;i&&(s=y.getFirstFieldValue(i[0],"nickname"),s&&(t.isNN=!0,t.name=s))}n||(n={email:t.email,firstName:t.name||t.email}),t.fail?r=strings.str_comp_error_email_lozenge_attr:r=t.email;var o,u={label:c(t.name),hover:c(r),state:t.fail?"error":"normal",data:t,menu:null,edit:!0,copy:!0,parentClass:"draggable"};o=new e.comms.ui.Lozenge(u);var a=o.getNode();return a.set("role","presentation"),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.validateRecipients([t.email],function(e){e[0].recipient===t.email&&e[0].valid&&a._node.classList.add("lozenge-secure")}),a}function tt(t){var n=t.getData("lozenge"),r=n.data,i=n.error;if(t.hasClass("group"))return;if(strings.str_cfg_tog_compose_enable_nickname&&r.name&&r.isNN){var s=e.contacts.utils,o=s.getContactsByEmail(r.email),u,a;u=s.getFirstFieldValue(o[0],"name"),a=u?u.familyName+" "+u.givenName:"",r.name=a}if(i){this.currentAddress=r.email,this.validAddress=!1;if(!this.allowWhitelist||this.currentField!=="to"||e.mail.Models.Validators.send.YNC_ADDR_WHITELIST.indexOf(r.email)===-1)return}this[this.currentField].push(r)}function nt(){var e=this,t={to:[],cc:[],bcc:[],validAddress:!0,allowWhitelist:NeoConfig.isAMT||!!NeoConfig.isInternal||!!NeoConfig.isInternalIP,currentAddress:"",currentField:""},n,r,i,s,o,u,a,f,l,c,h,p,d;return n=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge"),t.currentField="to",n.each(tt,t),r=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge"),t.currentField="cc",r.each(tt,t),i=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge"),t.currentField="bcc",i.each(tt,t),e.composeView.type&&e.composeView.type==="inlineCompose"?t.from={email:e.composeView.draft.get("header").from.email,name:e.composeView.draft.get("header").from.name}:(f=e.composeView.baseNode.one(".from-select").get("value"),l=f.lastIndexOf("<"),c=f.lastIndexOf(">"),h=f.substring(l+1,c),p=f.substring(0,l-1),t.from={email:h,name:p}),s=e.composeView.baseNode.one(".cm-subject-field"),s?t.subject=s.get("value"):t.subject=e.composeView.draft.get("header").subject,t}function rt(t,n,r){
var i,s,o,u,a,l,c,h=e.mail.ui.PaneUtils,p=n.recipients,d=n.more_recipients,v=n.to_str;if(t)return s=t.to||[],o=t.cc||[],u=t.bcc||[],a=s.concat(o,u),i=a.length,l=function(e){var t={to:h.getName(e),rcpt_id:h.getAddress(e),rcpt_name:h.getName(e)};return t},c=h.createRecipientList(a,p,null,r,l),r!==""&&a.length>r&&(c+=f(d,{num_more_recipients:a.length-r},0,0,strings)),c=f(v,null,null,null,strings)+c,c}function it(e){var t=at("cc"),n,r,i=this.composeView.baseNode,s=i.one(t.groupNode+" .address-btns");typeof e!="boolean"&&(n=at("bcc"),r=i.all(t.groupNode+" .hLozenge, "+n.groupNode+" .hLozenge"),e=r.size()>0?!1:!0),s[e?"removeClass":"addClass"]("hidden")}function st(e,t){var n=at(e),r=this.composeView.baseNode.one(n.groupNode),i=r.one(".compose-hide-recpts"),s,o,u;typeof t=="undefined"&&(o=r.all(".hLozenge"),u=o.size(),t=u>_),e!=="to"&&this._showHideCcBccOption(t?!1:""),i[t?"removeClass":"addClass"]("hidden")}function ot(e,t){var n=this.composeView,r=at(e),i=n.baseNode.one(r.groupNode),s=n.baseNode.one(r.node),o=s.ancestor("li"),u=[],a,f,l,c,h,p,d;d=i.one(".hLozenge.group"),d&&d.remove(!0),a=i.all(".hLozenge"),p=a.size(),l=t?!1:_===p?p:M,a.each(function(e,t){l&&t>=l?(e.addClass("hidden"),u.push(e.getData("lozenge").data)):e.removeClass("hidden")}),u.length?(h=Z(u,e),o.insert(h,o),this._toggleHideRecptsBtn(e,!1)):p>_&&this._toggleHideRecptsBtn(e,!0),n.resizeRTE()}function ut(e,t,n){var r=this.composeView,i=at(t),s=r.baseNode.one(i.node),o=s.ancestor("li"),u,a,f,l;l=n?!1:M;for(u=0;u<e.length;u++)a=e[u],f=this._createLozenge({name:a.name,email:a.email}),l&&u>=l&&f.addClass("hidden"),o.insert(f,o),r.resizeRTE(),this._checkRecipientCount(),r._setDirty();O&&this._manageHideMoreOptions(t,n),this._showHideCcBccOption(),R(s)}function at(e,t){return{list:t&&t[e],node:".cm-"+e+"-field",groupNode:".cm-"+e+"-group"}}function ft(t){var n=this,r=n.composeView,i,s,o,u,f,l,c=r.type==="inlineCompose"?r.baseNode.one(".thread-recipients"):null,h="",d=[],v=["to","cc","bcc"],m=function(e){var t={to:a.getName(e),email:a.getAddress(e)};return t},g;for(s in v)l=v[s],f=at(l,t),u=f.list,u&&(o=f.node,c&&o!==".cm-bcc-field"&&(d=d.concat(u)),n._createAddressList(u,l));c&&(h=a.createRecipientList(d,p._shared_module_thread_thread_display_rollup.recipients1,null,null,m),c.setContent(h));if(t.cc&&t.cc.length!==0||t.bcc&&t.bcc.length!==0)n._bccSwitch(!0,!1,"cc"),n._bccSwitch(!0,!1,"bcc");if(r.type==="fullCompose"){t.from&&t.from.email&&n._setFromMenu(t.from);if(t.subject){r.baseNode.one(".cm-subject-field").set("value",t.subject);var y=e.UA.ie>0&&e.UA.ie<10,b=y&&r.baseNode.one(".IEplaceholder");y&&b&&b.addClass("hidden"),r._setDirty()}}n.checkOtherLozengeBoxes()}function lt(e){var t=this,n=t.composeView.baseNode.all("div.ac-input input"),r=t.composeView.baseNode.all("div.subject input");e?(n.removeAttribute("readOnly"),r.removeAttribute("readOnly")):(n.setAttribute("readOnly",!0),r.setAttribute("readOnly",!0))}function ct(e){!P||!e?P.changeSelection(s.get("userSendPref.defaultID")):P.changeSelection(e.email),this._buildFromMenu()}function ht(t,n){var r=this,i=t.result.value.filters,o=i.length,u,a,f,l,c,h,p,d;if(o===0){d=s.get("userSendPref.defaultFromAddress");for(h=0;h<length;h++)if(d===n[h].email){r._setFromMenu(d);break}}else{a=e.one("#storm-listnav li.selected i"),u=a?a.get("text"):null;if(u)for(h=0;h<o;h++)if(i[h].actions[0].value.folderActionValueBean.folder.name===u){c=i[h].criterions,l=c.length;for(p=0;p<l;p++){f=c[p];if(f.field==="TO"&&pt(f.value,n)){r._setFromMenu(f.value);return}}}}}function pt(e,t){var n=t.length,r;for(r=0;r<n;r++)if(t[r].addr===e||t[r].email===e)return!0;return!1}function dt(t,n,r){var i=this,s=t?t:[],u,a,f,l,c;n&&(s=t.concat(n));if(!s||s.length===0)return;P||(P=e.mail.Controller.mailComposeFromListHelper.getInstance()),u=P.getFromList();if(s.length===1&&pt(s[0].email,u)){i._setFromMenu(s[0]);return}if(r&&!pt(r,s)){i._setFromMenu();return}r&&pt(r,u)?(l={email:r},i._setFromMenu(l)):(a=i.getMatchedAddresses(s,u),f=a.length,f===0?i._setFromMenu():f===1?i._setFromMenu(a[0]):NeoConfig.imapIn?o?i._setFromMenu(o.getCurrentAccount()):e.use("mail-controller-filters-v3",function(e){c=e.mail.Controller.FiltersV3Controller.listFilters({suppressNotification:!0,suppressStat:!1}),c.then(function(t){i._processFiltersForReplyFrom(t,a)},function(t){i._setFromMenu(a[0])})}):i._setFromMenu(a[0]))}function vt(e,t){var n=e.length,r=t.length,i=[],s,o,u;for(s=0;s<n;s++){u=e[s];for(o=0;o<r;o++)if(u.email===t[o].addr){i.push(u);break}}return i}function mt(e,t){var n=this,r,i,s=(e.isRTL?"rtl":!1)||(strings.str_tog_loadRTLCss?"rtl":"ltr"),o,u;return NeoConfig.bidi?(o=(s==="rtl"?"\u202b":"\u202a")+e.name+"\u202c",u=(s==="rtl"?"\u202b":"\u202a")+"\u200e&lt;"+e.addr+"&gt;\u200e\u202c",i=l(o)+" "+u):i=l(e.name,h)+" &lt;"+e.addr+"&gt;",r=f(v,{isDefault:t,address:i},n.composeView.formatters,null,strings),r}function gt(){var t=this,n=t.composeView.baseNode.one(".from-select"),r=t.composeView.draft,i=r&&r.folder.acctId,s=[],o,u,a,f,l,c,h,p,d;P||(P=e.mail.Controller.mailComposeFromListHelper.getInstance()),h=P.getFromList(i),a=h.length,p=P.getSelectedIndex(i);for(f=0;f<a;f++)l=h[f],c=t._buildOptionMarkup(l,f===p),s.push(c);n.purge(!0,"change"),n.setContent(s.join("")),P.getVisible()?t.composeView.baseNode.one("div.account-select").removeClass(b):t.composeView.baseNode.one("div.account-select").addClass(b),o=t.composeView.baseNode.one(".from-selector"),u=o.one("#from-field"),a===1?(u.set(w,!0),o.addClass("disable-select-chevron")):(u.set(w,!1),o.removeClass("disable-select-chevron")),n.on("change",function(){t.composeView._setDirty()})}function yt(){var e=this,t=d.show_full_header,n=f(t,e.draft,e.composeView.formatters,null,strings,p);e.hdr=e.composeView.baseNode.one(".compose-header"),e.hdr.setContent(n),e._bindUIHeader(),e._buildFromMenu()}function bt(e,t){var n=this,r;t=t||!1,r=t?1:0,n._bccSwitch(r,!1,"cc")}function wt(e){var t,n=-1;return typeof e.get("selectionEnd")=="number"?n=e.get("selectionEnd"):document.selection&&document.selection
.createRange&&(t=document.selection.createRange(),t.moveStart("character",-e.get("value").length),n=t.text.length),n}function Et(e,t){this._bccSwitch(e,!0,t||"bcc")}function St(t,n,r){r=r||"bcc";var i=this,s=i.composeView.baseNode.all(".cm-btn-show-"+r),o=i.composeView.baseNode.one(".cm-"+r+"-group");typeof n=="undefined"&&(n=!0),t?(o.removeClass(b),s&&s.addClass(b),n&&i.composeView.setFocus(r)):(o.addClass(b),s&&s.removeClass(b),n&&i.composeView.setFocus(r)),i._reposAttachObj(N),i.composeView.resizeRTE(),e.fire("recalculateScrollToRepositionSend")}function xt(t){var n={"to-field":".cm-to","cc-field":".cm-cc","bcc-field":".cm-bcc"},r=this,i=g.ui.ACWidget,s=t.get("id");if(s&&n[s]){t.removeClass("whiteout");var o=r.composeView.baseNode.one(n[s]),u=function(){r.listeners.push(e.ACWidgetInst.get("ac").on("ac:query",function(t){var n=this,r=t.value,i,s;if(y.areContactsLoaded()){var o=new e.comms.FilterContacts;o.updateFilterItems(r),i=o.fastMatch(),i.queryStr=r,s=e.bind(n.reload,n,i),s(i)}}))};e.ACWidgetInst?e.ACWidgetInst.get("ac").get("alignNode")!==o&&(e.ACWidgetInst.get("ac").destructor(),e.ACWidgetInst.refresh({acNode:o,acTarget:t,width:o.getStyle("width"),selectFirst:!0}).setAlign().render(),u(),r._setACWidgetARIAOwns()):(r.offscreenContent&&r.offscreenContent.remove(),r.offscreenContent=e.Node.create(f(p._shared_module_offscreen_bin_compose.base,{},null,null,strings,p)),e.one(document.body).append(r.offscreenContent),e.ACWidgetInst=(new i({acNode:o,acTarget:t,contentBox:"#ac-to-results",selectFirst:!0})).setAlign().render(),r._setACWidgetARIAOwns(),e.ACWidgetInst.after("visibleChange",function(t){var n=this.get("ac").get("host"),r=e.ACWidgetInst.get("contentBox").one("li"),i=t.newVal&&r?!0:!1;n.set("aria-expanded",i),i||n.set("aria-activedescendant","")}),e.ACWidgetInst.after("selectedIndexChange",function(e){var t="";e.newVal>-1&&(t=this.get("contentBox").one(".yui3-acwidget-selected").generateID()),this.get("ac").get("host").set("aria-activedescendant",t)}),u())}}function Tt(){var e=this,t=e.listeners;if(t){var n=t.length,r;for(r=0;r<n;r++)t[r]&&t[r].detach();t.length=0}e.lozengeDD&&e.lozengeDD.destroy(!0),e.hdr&&(e.hdr.detachAll(),e.hdr.remove()),H.superclass.ondestroy.call(e,arguments)}function Nt(e){var t=this,n=e.target,r=n.ancestor("div.ac-input",!1),i;if(r){i=r.get("id"),t.composeView.focusNode=i,r.addClass(S),r.get("parentNode").addClass("active");if(r.one(".hLozenge.group")){t._manageHideMoreOptions(i,!0);return}}if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))t.composeView._registerFocus(n),u.features.enabled("autosuggest")||t._initAutoComplete(n),t.checkOtherLozengeBoxes()}function Ct(t){e.one("div.ac-results:hover")||e.one("div.ac-results li.over")||e.one("li.yui3-aclist-item-hover")||(j(),this._lozengeIt(t),e.ACWidgetInst&&e.ACWidgetInst.get("ac").set("queryValue",""))}function kt(e){var t=this,n=e.target,r=t.composeView.draft;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))e.preventDefault(),this.handleACBlur(n);else if(n.get("id")==="subject-field"){var i=n.get("value");i&&i!==""&&r.subject&&typeof r.subject!="undefined"&&r.subject!==i&&t.composeView._setDirty()}}function Lt(e,t){var n=this,r=e.target,i=e.keyCode,s,o,u=r.ancestor("div"),a=u.one(".hLozenge.focus"),f=r.get("value"),l,c,h=r.get("id");if(h){s={"to-field":t.one("#to_add_contacts"),cc_show_btn_in_to:"to",cc_hide_btn:"cc","cc-field":t.one("#cc_add_contacts"),"bcc-field":t.one("#bcc_add_contacts"),bcc_show_btn_in_cc:t.one("#cc_hide_btn"),bcc_hide_btn:"bcc"},o={"to-field":t.one("#cc_show_btn_in_to"),to_add_contacts:"to",cc_add_contacts:"cc",cc_hide_btn:t.one("#bcc_show_btn_in_cc"),bcc_add_contacts:"bcc",cc_show_btn_in_to:t.one("#bcc_show_btn_in_to"),"cc-field":t.one("#cc_hide_btn"),"bcc-field":t.one("#bcc_hide_btn")};if(i===39)if(r.get("nodeName")==="A"||!f&&!a||f&&wt(r)===f.length){l=o[h];if(l){n.composeView.setFocus(l);if(l==="to"||l==="cc"||l==="bcc"){var p=t.one("#"+l);c=p.one(".hLozenge"),c&&(n._selectSingleLozenge(c,p),p.addClass("whiteout"))}return}}}if(!r.get("value")){e.preventDefault();var d;if(a)i===37?(d=a.previous(),d||(s[h]&&n.composeView.setFocus(s[h]),n._removeLozengeHighlights(),r.removeClass("whiteout"))):(d=a.next(),d.hasClass("hLozenge")||(d=null,n._removeLozengeHighlights(),r.removeClass("whiteout"))),d&&(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r));else if(i===37){var v=r.ancestor();d=v.previous(),d&&d.hasClass("hLozenge")?(n._removeLozengeHighlights(),n._selectSingleLozenge(d,r),r.addClass("whiteout")):s[h]&&n.composeView.setFocus(s[h])}}}function At(t){var n=this,r=t.keyCode,i=t.target;if(!i.get("value")){var s=i.ancestor(),o=i.ancestor(".ac-input"),u=o.all(".hLozenge.focus"),a=u.size();t.halt();if(n.allLozengesSelected){n.removeAllLozenges(i),i.removeClass("whiteout");return}var f,l;a?(n.removeARIAFocus(i),n.removeARIADescription(i),a===1?(f=u.item(0),l=f.next(),l===s&&(l=f.previous()),l?n._selectSingleLozenge(l,i):i.removeClass("whiteout")):i.removeClass("whiteout"),n.composeView._setDirty(),u.detachAll(),u.remove(),u=null,e.fire("lozenge:remove"),O&&n._toggleHideRecptsBtn(o.get("id"))):r===8&&(l=s.previous(),l&&(n._removeLozengeHighlights(),n._selectSingleLozenge(l,i),i.addClass("whiteout"))),n.checkOtherLozengeBoxes(),n.composeView.resizeRTE()}}function Ot(){var e=this,t=e.composeView.baseNode.one(".cm-to.ac-input").all(".hLozenge").size(),n=e.composeView.baseNode.one(".cm-cc.ac-input").all(".hLozenge").size(),r=e.composeView.baseNode.one(".cm-bcc.ac-input").all(".hLozenge").size(),i=0;return i=t+n+r,e.totalLozenges=i,i}function Mt(){var e=this,t=e.lozengeCount();t<=0?e.composeView._showSendBtn(!1):e.composeView._showSendBtn(!0)}function _t(){var t=e.ACWidgetInst;return t&&t.canHandleEnter?t.canHandleEnter():t&&t.isVisible()&&(t.get("data").length>0||NeoConfig.isCorpmail&&t.get("gabData").length>0)}function Dt(t,n){var r=this,i=e.ACWidgetInst,s=t.decodeCategory(n.get("value")),o=function(e,t,n,r,i){switch(
t){case"amp":if(n)return o(e,n,"",r+5,i);return"&";case"#39":return"'";case"quot":return'"';case"lt":return"<";case"gt":return">";case"#35":return"#";default:return""}};if(s){var u,a=[];for(u in s){var f=s[u];if(f){var c="",h=f.firstname&&l(f.firstname),p=f.middlename&&l(f.middlename),d=f.lastname&&l(f.lastname),v=f.nickname&&l(f.nickname);c=i&&i.buildName(h,p,d,v),c=c+"("+f.email+")",a.push(c.replace(/&((?:[a-zA-Z]+)|(?:#[0-9]+));(?:([a-zA-Z]+|(?:#[0-9]+));)?|([;,])/gi,o))}}r._makeLozenges(a,n.ancestor()),r.addARIADescription(n),n.set("value","")}else r._lozengeIt(n)}function Pt(t){var n=this,i=t.target,s=t.ctrlKey,o=t.metaKey,u=e.ACWidgetInst,a=e.UA.os,f=s&&(a==="linux"||a==="windows"||a==="win")||o&&(a==="macintosh"||a==="mac");if(i.get("nodeName")==="A")return;f&&!t.altKey&&n.composeView.handleComposeAction("send",t);var l=new e.comms.FilterContacts;if(u&&n.canACWidgetInstHandleEnter())u.handleEnter(t,u);else{l.updateFilterItems(i.get("value"));var c=l.fastMatch();if(c&&c.length){var h=c[0],p;u&&(p=r(u.getItemMarkup(h)),p.one("span.ac-remove-item").remove(),i.set("value",p.get("text")))}}t.halt();if(!i.get("value")){t.preventDefault();var d=i.ancestor("div"),v=d.one(".hLozenge.focus");v&&v.getData("lozenge").startEdit();return}n.setACCategory(l,i)}function Ht(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.ACWidgetInst,u,a,f=(u=o&&o.get("data"))&&u.length,l=(a=o&&o.get("gabData"))&&a.length;if(i||s||!r.get("value"))return;if(f>=2||l>=2)return;f===1||l===1?(t.halt(),o&&o.isVisible()&&r.simulate("keydown",{keyCode:13})):(t.halt(),n._lozengeIt(r))}function Bt(e){var t=this,n=e.target,r=e.ctrlKey,i=e.metaKey;if(!r&&!i||n.get("value"))return;e.halt(),t._selectAllLozenges(n),n.addClass("whiteout")}function jt(t){var n=this,r,i=t.target,s=t.ctrlKey,o=t.metaKey,u=t.altKey,a=e.ACWidgetInst,f=(r=a&&a.get("data"))&&r.length;if(!i.get("value")){if(!a)return;if(a.hasItemSelected){if(!a.hasItemSelected())return}else if(!a.isVisible())return}!s&&!o&&!u&&(f>=1&&t.halt(),n.composeView.keepHdrFocus=!0,i.simulate("keydown",{keyCode:13}))}function Ft(n){function u(){var e=r.hdr,n=t.ui.MessagePaneUtils,i="";e.all("li.focus").each(function(e){i+=e.one("input").get("value"),i+="; "}),i!==""&&(i=i.substring(0,i.length-1),n.initializeCopyText(),n.copyToClipboard(i,null,document.activeElement))}var r=this,i=n.ctrlKey,s=n.metaKey,o=e.UA.os==="macintosh"?s:i;o&&(n.stopPropagation(),u())}function It(t){var n=this,r=t.target,i=t.ctrlKey,s=t.metaKey,o=e.UA.os==="macintosh"?s:i,u=t.type==="paste"?!0:!1;(o||u)&&setTimeout(function(){n.updateTextField(r,!0)},0)}function qt(n){var r=this,i=(e.UA.os==="macintosh"?n.metaKey:n.ctrlKey)&&!n.altKey&&!n.shiftKey,s=t.ui.MessagePaneUtils,o="",u;i&&(u=r.hdr.all("li.focus"),u.each(function(e){o+=e.one("input").get("value"),o+="; "}),o!==""&&(e.fire("lozenge:remove"),r.composeView._setDirty(),u.detachAll(),u.remove(),u=null,o=o.substring(0,o.length-1),s.initializeCopyText(),s.copyToClipboard(o,null,document.activeElement)))}function Rt(t){var n=this,r=t.target,i=t.shiftKey,s=t.ctrlKey,o=t.metaKey,u=e.UA.os==="macintosh"?o:s;r.removeClass("whiteout"),!u&&!i&&n._removeLozengeHighlights()}function Ut(e){var t=this,n=e.target;if(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field")){var r=t.composeView.baseNode.one(".ac-input.compose-field-focus .recipient-input input"),i=t.totalLozenges;r===null&&i<=0?t.composeView._showSendBtn(!1):r.getDOMNode().value===""&&i<=0?t.composeView._showSendBtn(!1):t.composeView._showSendBtn(!0)}}function zt(t){var n=this,r=n.hdr,i=t.keyCode,s=t.shiftKey,o=t.ctrlKey,u=t.metaKey,a=t.altKey,f=e.UA.os==="macintosh"?u:o,l,c=t.target,h=NeoConfig.infinitePane,p=c?c.get("type")?c.get("type").toLowerCase()||"":"":"",d=c?c.get("tagName").toLowerCase():"",v=function(){return c.ancestor("div.cm-to ul,.cm-cc ul,div.cm-bcc ul")},m;e.fire("HoverCard:hideHoverCard"),!p||p!=="text"&&p!=="textarea"?d&&(d==="input"||d==="textarea")&&t.stopPropagation():t.stopPropagation(),c.hasClass("cm-from-field")&&h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation(),!(s&&o&&u&&a)&&(i===188||i===186)&&c.hasClass("lozenge-edit")&&v()&&(m=v().one("li.recipient-input input"),m?m.focus():c.blur());if(c.hasClass("cm-subject-field")||c.hasClass("cm-to-field")||c.hasClass("cm-cc-field")||c.hasClass("cm-bcc-field")||c.get("nodeName")==="A"){h&&(t.keyCode===37||t.keyCode===39)&&t.stopPropagation();if((i===83||i===89&&s||i===85&&s)&&(o||u)||i===27){n.composeView.get("keydownHandler")?n.composeView.get("keydownHandler")(t):n.composeView.onKeyDown(t);return}if(c.hasClass("cm-subject-field")){l=(o||u)&&!a&&!s||i===9,(!l||f&&i===86)&&n.composeView._setDirty(),i===9&&!s&&(c.blur(),n.composeView.setFocus("body"),t.halt()),i===13&&f&&!t.altKey&&(n.composeView.handleComposeAction("send",t),t.halt());return}switch(i){case 37:case 39:n.handleLeftRightArrow(t,r);break;case 8:case 46:n.handleDelete(t);break;case 13:n.handleEnter(t);break;case 32:n.handleSpacebar(t);break;case 65:n.handleSelectAll(t);break;case 38:break;case 9:n.handleTab(t);break;case 67:n.handleCopy(t,r);break;case 86:n.handlePaste(t);break;case 88:n.handleCut(t,r);break;default:n.handleDefaultKeydown(t)}}}function Wt(){var e=this,t=e.hdr,n=e.listeners;n.push(t.on("blur",e.setInputBlur,e)),n.push(t.on("keydown",e.keyHandler,e)),n.push(t.on("keyup",e.sendEnableKeyHandle,e)),n.push(t.one("#subject-field").on("keyup",function(){e.composeView._setDirty()})),n.push(t.on("change",function(t){var n=t.target;(n.hasClass("cm-to-field")||n.hasClass("cm-cc-field")||n.hasClass("cm-bcc-field"))&&e.composeView._setDirty()}))}function Xt(t){var n=this,r=t.dataAction;switch(r){case"reply_all":case"reply_sender":case"forward":n.switchReplyMode(t.dataAction),e.fire("mt:click",{action:"reply_card_menu_"+r});break;case"edit_subject":n.allowSubjectEdit(!0)}}function Vt(t){var n=this,r=n.composeView.draft.origin,i=e.common.ui.MenuHelper,s=t.target;e.use("mail-ui-inboxmenu-base","_shared_module_offscreen_bin_menus_reply_modes",
function(e){e.mail.ui.InboxMenu.insert("menu-reply-modes",function(){var r=e.one("#menu-reply-modes");i.create(s,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY]},function(){r.on("menuSelected",n.onReplyModeSelected,n),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(s.removeClass("pressed"),s.unplug(e.Plugin.Menu),this.destroy(!0))})})},r.fid,{origin:r,isQuickReply:n.composeView.get("isQuickReply")})})}function $t(){var t=this,n,r,i,s;t.listeners.push(t.hdr.delegate("click",function(r){var i=u.getDataAction(r).action;switch(i){case"menu":t.loadReplyModeMenu(r),e.fire("mt:click",{action:"reply_card_"+i});break;case"qr-cancel":t.neoFire("qrCancel"),e.fire("mt:click",{action:"reply_card_"+i});break;case"expand-recpts":s=r.target.ancestor(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!0);break;case"hide-recpts":s=r.target.ancestor(".field").one(".ac-input"),n=s.get("id"),t._manageHideMoreOptions(n,!1);break;case"template-list":e.use("mail-ui-mailcompose-templates",function(e){e.mail.Views.composeTemplates.loadTemplates(r,t)})}},".compose-header"))}function Jt(){var t=this,r=t.composeView.baseNode,i=r.one("input.cm-subject-field"),s=r.one("input.cm-to-field"),o=r.one("input.cm-cc-field"),u=r.one("input.cm-bcc-field"),a=e.UA.ie>0&&e.UA.ie<10,f=a&&r.one(".IEplaceholder"),l=t.hdr;NeoConfig.bidi&&i.plug(e.Plugin.BidiTextEntry),t._bindAutoComplete(),t.listeners.push(t.hdr.delegate("paste",It,"#to-field, #cc-field, #bcc-field",t)),t.listeners.push(e.on("lozenge:highlight",function(){t.isLozengeHighlighted=!0})),NeoConfig.useDD&&t.composeView.type==="fullCompose"&&e.use("common-ui-lozengeDD",function(e){e.Lang.later(0,0,function(){t.lozengeDD=new e.common.ui.lozengeDD({composeView:t.composeView,dragSelector:".draggable"})})}),t.listeners.push(l.on("focus",Nt,t)),t.listeners.push(i.after("focus",function(){t.composeView._registerFocus(i),a&&f.addClass("hidden")})),t.listeners.push(i.on("change",function(){a&&f.addClass("hidden")})),t.listeners.push(s.after("blur",function(){s.ancestor("div").removeClass(S),t.composeView.resizeRTE()})),t.listeners.push(o.after("blur",function(){o.ancestor("div").removeClass(S),t.composeView.resizeRTE()})),t.listeners.push(u.after("blur",function(){u.ancestor("div").removeClass(S),t.composeView.resizeRTE()})),t.listeners.push(i.after("blur",function(n){t.neoFire("updateSubject"),a&&e.Lang.trim(n.target.get("value"))===""&&f.removeClass("hidden")})),t.listeners.push(l.delegate("click",function(n){n.halt(),t._reposAttachObj(x);var r={to_add_contacts:".cm-to",cc_add_contacts:".cm-cc",bcc_add_contacts:".cm-bcc"},i=function(e,n){var i,s,o,u=n.get("id"),a=t.composeView.baseNode.one(r[u]),f=a.all("li"),l=f.item(f.size()-1);for(i in e)s={name:e[i].name,email:c(e[i].field.value)},o=t._createLozenge(s),t.composeView._setDirty(),l.insert(o,l),t.composeView.resizeRTE(),t._checkRecipientCount();O&&t._toggleHideRecptsBtn(a.get("id")),t._reposAttachObj(T),t.composeView._restoreFocus()},s=n.currentTarget.get("id"),o="addrec";s=s||"bcc_add_contacts",e.fire("ws:onboarding",{module:"contact_picker",onDone:i,target:n.currentTarget,field:s.slice(0,s.indexOf("_"))}),s==="to_add_contacts"?o="addrec":s==="cc_add_contacts"&&(o="addcc"),e.fire("mt:click",{action:"cmps_"+o,append:{t1:"cmpsTb"}})},".choose-contact")),t.listeners.push(l.delegate("click",function(e){var n=e.target,r=e.currentTarget,i=r.getElementsByTagName("INPUT"),s=i.item(i.size()-1),o;if(n.hasClass("lozenge-edit"))return;o=r.get("scrollTop"),n.hasClass("compose-hide-recpts")||n.hasClass("more_recp")?s===t.composeView.focusNode?t.composeView.setFocus(t.composeView.editor.getRTE()):t.composeView._restoreFocus():s.focus(),n.hasClass("lozenge-static")||n.hasClass("lozenge-edit")?(r.set("scrollTop",o),s.addClass("whiteout")):(s.removeClass("whiteout"),t._removeLozengeHighlights(),r.set("scrollTop",r.get("scrollHeight")))},"div.ac-input")),t.listeners.push(l.on("keyup",function(e){var r=e.target,i=r.get("value"),s=i.length,o=i[s-1];if(!(r.hasClass("cm-to-field")||r.hasClass("cm-cc-field")||r.hasClass("cm-bcc-field")))return;s>0&&t.composeView._setDirty();if(o===";"||o===","){e.halt(),i=n(i);if(i.length===1){r.set("value","");return}if(!i)return;t._lozengeIt(r)}t.updateTextField(r),t._reposAttachObj(N)}))}function Kt(e,t){var n=e.action===C;n?(t.removeClass("ico-thread-reply"),t.addClass("ico-thread-reply-all")):(t.removeClass("ico-thread-reply-all"),t.addClass("ico-thread-reply"))}function Qt(t){t=t||0;var n=this,r=n.composeView.draft.origin,s=n.composeView.baseNode,o=s.all(".replyall-toggle-btn a"),u,a,l=s.one(".qr-card-actions");t||(t=r.action===k?C:k),r.action=t,l&&l.replace(f(p._shared_module_compose_quick_reply_card_actions.base,{reply_type:A[t]},null,null,strings)),t===k?(o.set("text",strings.str_comp_btn_reply_all),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplysndr",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===C?(o.set("text",strings.str_comp_btn_reply_sender),!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_rplyall",append:{t1:"cmpsTb"}}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane")),i.excludeAttachment(n.composeView.draft)):t===L&&(!n.composeView.get("isQuickReply")&&e.fire("mt:click",{action:"cmps_fwd",append:{t1:"cmpsTb"}}),n.allowSubjectEdit(!1),i.excludeAttachment(n.composeView.draft),i.includeAttachment(n.composeView.draft,{fetchGDM:!0}),n.composeView.composeTictacApi.render(n.composeView.baseNode.one(".attachments-pane"))),n.composeView.type==="inlineCompose"&&Kt(r,o),a=i.getHeaderContent(r),u=s.one(".cm-subject-field"),u&&(a.subject=u.get("value"));var c=s.one(".cm-to-field"),h=s.one(".cm-cc-field");n.removeAllLozenges(c),n.removeAllLozenges(h),n.setHeader(a),n.composeView._restoreFocus()}function Gt(){var e=this,t=e.hdr,n,r,i=e.composeView.draft.origin,s=i&&i.oMsg&&i.oMsg.header,o=i&&i.oMsg&&i.oMsg
.body,u=s&&(s.to?s.to.length:0)+(s.cc?s.cc.length:0)||0,a=i.action,f,l,c,h=e.composeView.baseNode,p=h.all(".replyall-toggle-btn"),d,v={},g,y,b=1,w;i.fid==="Sent"&&a===k&&(i.action=C);if(a!==C&&a!==k||!o||!u)return;if(s.replyto){w=s.replyto.length;for(d=0;d<w;d++)v[s.replyto[d].email]=1}g=s.to.concat(s.cc),f=m()||{},w=g.length;for(d=0;d<w;d++){l=g[d].email||"";if(y&&l!==y||w===1&&!(l in f||l in v))b=0;y=l,(l in f||l in v)&&!c?c=0:c=1}if(a&&c&&!b&&h.one(".replyall-toggle-btn")&&i.fid!=="Sent"){p.removeClass("hidden"),n=t.one("#to"),r=t.one(".address-btns");if(r&&n.getX()+n.get("clientWidth")+r.get("clientWidth")+20>t.get("clientWidth")+t.getX()){p.addClass("hidden");return}e.composeView.type==="inlineCompose"&&Kt(i,h.all(".replyall-toggle-btn a")),e.listeners.push(h.delegate("click",function(){e.switchReplyMode()},".address-btns .replyall-toggle-btn a",e))}}function Yt(e){var t=this.hdr.one(".subject");t.removeClass("hidden"),e&&setTimeout(function(){t.one("input").focus()},0)}var t=e.mail,n=e.Lang.trim,r=e.Node.create,i=e.mail.Controller.ReplyProcessor,s=e.common.persist.UserData,o=t.model.DataStore.Accounts,u=e.common.Utils,a=t.ui.PaneUtils,f=u.substitute,l=u.escapeHtml,c=u.unescapeHtml,h=strings.str_cfg_tog_unescape_ncr,p=e.ui.Templates,d=p._shared_module_compose_message_header_fresh,v=d&&d.compose_from_address,m=e.mail.Controller.mailComposeFromListHelper.getAllAccountEmails,g=e.contacts,y=g.utils,b="hidden",w="disabled",E="focus",S="compose-field-focus",x="offscreen",T="restore",N="move",C="reply_all",k="reply_sender",L="forward",A={reply_sender:strings.str_reply,reply_all:strings.str_reply,forward:strings.str_forward},O=u.features.enabled("showHideComposeRecipients"),M=u.settings.value("recipientThresholdVal"),_=M+1,D={},P,H=function(e,t){var n=this;n.isLozengeHighlighted=!1,n.allLozengesSelected=!1,n.composeView=t,n.offscreenContent=null,n.listeners=[],H.superclass.constructor.apply(n,arguments),n.neoEvent("updateSubject",{emitFacade:!0,broadcast:1}),n.neoEvent("qrCancel",{emitFacade:!0,broadcast:1})};e.extend(H,t.ui.BaseWidget),e.mix(H.prototype,{NAME:"HeaderBase",render:yt,getHeader:nt,setHeader:ft,enableHeader:lt,allowEditing:bt,_bindUIHeader:Jt,bind:$t,loadReplyModeMenu:Vt,setInputFocus:Nt,setInputBlur:kt,keyHandler:zt,lozengeCount:Ot,sendEnableKeyHandle:Ut,handleACBlur:Ct,handleLeftRightArrow:Lt,handleDelete:At,handleEnter:Pt,handleSpacebar:Ht,handleTab:jt,handleSelectAll:Bt,handleCopy:Ft,handlePaste:It,handleCut:qt,handleDefaultKeydown:Rt,setACCategory:Dt,canACWidgetInstHandleEnter:_t,checkOtherLozengeBoxes:Mt,_bindAutoComplete:Wt,ondestroy:Tt,destroy:Tt,hideACWidget:j,_cmdBccSwitch:Et,_reposAttachObj:B,_setFromMenu:ct,removeAllLozenges:V,_removeLozengeHighlights:$,_createLozenge:et,enableSwitchReplyButton:Gt,switchReplyMode:Qt,_lozengeIt:Q,_manageHideMoreOptions:ot,_createAddressList:ut,_toggleHideRecptsBtn:st,_showHideCcBccOption:it,_checkRecipientCount:G,_makeLozenges:Y,_selectSingleLozenge:J,_selectAllLozenges:K,_tokenizeAddresses:X,removeARIAFocus:F,_setACWidgetARIAOwns:q,removeARIADescription:I,addARIADescription:R,updateTextField:z,_buildOptionMarkup:mt,_buildFromMenu:gt,createAddress:W,_initAutoComplete:xt,_processFiltersForReplyFrom:ht,addressInList:pt,_bccSwitch:St,_getRecptList:rt,getCursorLocation:wt,onReplyModeSelected:Xt,setReplyFrom:dt,getMatchedAddresses:vt,allowSubjectEdit:Yt,_ccSwitch:function(){}},!0),e.namespace("mail.Views").ComposeHeader=H},"1.0.0",{requires:["comms-ui-lozenge","ac-widget","_shared_module_offscreen_bin_compose","mail-controller-reply-processor","_shared_module_offscreen_bin_notification_notifications","mail-controller-compose-text","contacts-api","_shared_module_compose_message_header_fresh","mail-models-validators-send","mail-ui-basewidget","mail-common-utils-features","mail-ui-mailcompose-header-form-list-helper","mail-model-datastore","mail-common-utils-settings","mail-ui-pane-utils"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("selector-css3",function(e,t){e.Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/,e.Selector._getNth=function(t,n,r,i){e.Selector._reNth.test(n);var s=parseInt(RegExp.$1,10),o=RegExp.$2,u=RegExp.$3,a=parseInt(RegExp.$4,10)||0,f=[],l=e.DOM._children(t.parentNode,r),c;u?(s=2,c="+",o="n",a=u==="odd"?1:0):isNaN(s)&&(s=o?1:0);if(s===0)return i&&(a=l.length-a+1),l[a-1]===t?!0:!1;s<0&&(i=!!i,s=Math.abs(s));if(!i){for(var h=a-1,p=l.length;h<p;h+=s)if(h>=0&&l[h]===t)return!0}else for(var h=l.length-a,p=l.length;h>=0;h-=s)if(h<p&&l[h]===t)return!0;return!1},e.mix(e.Selector.pseudos,{root:function(e){return e===e.ownerDocument.documentElement},"nth-child":function(t,n){return e.Selector._getNth(t,n)},"nth-last-child":function(t,n){return e.Selector._getNth(t,n,null,!0)},"nth-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName)},"nth-last-of-type":function(t,n){return e.Selector._getNth(t,n,t.tagName,!0)},"last-child":function(t){var n=e.DOM._children(t.parentNode);return n[n.length-1]===t},"first-of-type":function(t){return e.DOM._children(t.parentNode,t.tagName)[0]===t},"last-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return n[n.length-1]===t},"only-child":function(t){var n=e.DOM._children(t.parentNode);return n.length===1&&n[0]===t},"only-of-type":function(t){var n=e.DOM._children(t.parentNode,t.tagName);return n.length===1&&n[0]===t},empty:function(e){return e.childNodes.length===0},not:function(t,n){return!e.Selector.test(t,n)},contains:function(e,t){var n=e.innerText||e.textContent||"";return n.indexOf(t)>-1},checked:function(e){return e.checked===!0||e.selected===!0},enabled:function(e){return e.disabled!==undefined&&!e.disabled},disabled:function(e){return e.disabled}}),e.mix(e.Selector.operators,{"^=":"^{val}","$=":"{val}$","*=":"{val}"}),e.Selector.combinators["~"]={axis:"previousSibling"}},"3.16.0-ym19",{requires:["selector-native","selector-css2"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("frame",function(e,t){var n=e.Lang,r="contentready",i="host",s=function(){s.superclass.constructor.apply(this,arguments)};e.extend(s,e.Plugin.Base,{_ready:null,_rendered:null,_iframe:null,_instance:null,_create:function(t){var n,r="",i,o=this.get("src")===s.ATTRS.src.value,u=this.get("extracss")?'<style id="extra_css">'+this.get("extracss")+"</style>":"";this._iframe=e.one(e.config.doc.createElement("iframe")),this._iframe.setAttrs(s.IFRAME_ATTRS),this._iframe.setStyle("visibility","hidden"),this._iframe.set("src",this.get("src")),this.get("container").append(this._iframe),this._iframe.set("height","99%"),o&&(r=e.Lang.sub(s.PAGE_HTML,{DIR:this.get("dir"),LANG:this.get("lang"),TITLE:this.get("title"),META:s.META,LINKED_CSS:this.get("linkedcss"),CONTENT:this.get("content"),BASE_HREF:this.get("basehref"),DEFAULT_CSS:s.DEFAULT_CSS,EXTRA_CSS:u}),e.config.doc.compatMode!=="BackCompat"&&(r=s.getDocType()+"\n"+r)),n=this._resolveWinDoc(),r&&(n.doc.open(),n.doc.write(r),n.doc.close()),n.doc.documentElement?t(n):i=e.later(1,this,function(){n.doc&&n.doc.documentElement&&(t(n),i.cancel())},null,!0)},_resolveWinDoc:function(t){var n=t?t:{};return n.win=e.Node.getDOMNode(this._iframe.get("contentWindow")),n.doc=e.Node.getDOMNode(this._iframe.get("contentWindow.document")),n.doc||(n.doc=e.config.doc),n.win||(n.win=e.config.win),n},_onDomEvent:function(t){var n,r;if(!e.Node.getDOMNode(this._iframe))return;t.frameX=t.frameY=0,(t.pageX>0||t.pageY>0)&&t.type.substring(0,3)!=="key"&&(r=this._instance.one("win"),n=this._iframe.getXY(),t.frameX=n[0]+t.pageX-r.get("scrollLeft"),t.frameY=n[1]+t.pageY-r.get("scrollTop")),t.frameTarget=t.target,t.frameCurrentTarget=t.currentTarget,t.frameEvent=t,this.fire("dom:"+t.type,t)},initializer:function(){var e=this.get(i);e&&(e.frame=this),this.publish("ready",{emitFacade:!0,defaultFn:this._defReadyFn})},destructor:function(){var e=this.getInstance();e.one("doc").detachAll(),e=null,this._iframe.remove()},_DOMPaste:function(e){var t=this.getInstance(),n="",r=t.config.win;e._event.originalTarget&&(n=e._event.originalTarget),e._event.clipboardData&&(n=e._event.clipboardData.getData("Text")),r.clipboardData&&(n=r.clipboardData.getData("Text"),n===""&&(r.clipboardData.setData("Text",n)||(n=null))),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,n?e.clipboardData={data:n,getData:function(){return n}}:e.clipboardData=null,this.fire("dom:paste",e)},_defReadyFn:function(){var t=this.getInstance();e.each(s.DOM_EVENTS,function(n,r){var i=e.bind(this._onDomEvent,this),o=e.UA.ie&&s.THROTTLE_TIME>0?e.throttle(i,s.THROTTLE_TIME):i;t.Node.DOM_EVENTS[r]||(t.Node.DOM_EVENTS[r]=1),n===1&&r!=="focus"&&r!=="blur"&&r!=="paste"&&(r.substring(0,3)==="key"?t.on(r,o,t.config.doc):t.on(r,i,t.config.doc))},this),t.Node.DOM_EVENTS.paste=1,t.on("paste",e.bind(this._DOMPaste,this),t.one("body")),t.on("focus",e.bind(this._onDomEvent,this),t.config.win),t.on("blur",e.bind(this._onDomEvent,this),t.config.win),t.__use=t.use,t.use=e.bind(this.use,this),this._iframe.setStyles({visibility:"inherit"}),t.one("body").setStyle("display","block")},_fixIECursors:function(){var e=this.getInstance(),t=e.all("table"),n=e.all("br"),r;t.size()&&n.size()&&(r=t.item(0).get("sourceIndex"),n.each(function(t){var n=t.get("parentNode"),i=n.get("children"),s=n.all(">br");n.test("div")&&(i.size()>2?t.replace(e.Node.create("<wbr>")):t.get("sourceIndex")>r?s.size()&&t.replace(e.Node.create("<wbr>")):s.size()>1&&t.replace(e.Node.create("<wbr>")))}))},_onContentReady:function(t){if(!this._ready){this._ready=!0;var n=this.getInstance(),r=e.clone(this.get("use"));this.fire("contentready"),t&&(n.config.doc=e.Node.getDOMNode(t.target)),r.push(e.bind(function(){n.EditorSelection&&(n.EditorSelection.DEFAULT_BLOCK_TAG=this.get("defaultblock")),this.get("designMode")&&(e.UA.ie?(n.config.doc.body.contentEditable="true",this._ieSetBodyHeight(),n.on("keyup",e.bind(this._ieSetBodyHeight,this),n.config.doc)):n.config.doc.designMode="on"),this.fire("ready")},this)),n.use.apply(n,r),n.one("doc").get("documentElement").addClass("yui-js-enabled")}},_ieHeightCounter:null,_ieSetBodyHeight:function(t){this._ieHeightCounter||(this._ieHeightCounter=0),this._ieHeightCounter++;var n=!1,r,i,s;t||(n=!0);if(t){switch(t.keyCode){case 8:case 13:n=!0}if(t.ctrlKey||t.shiftKey)n=!0}if(n)try{r=this.getInstance(),i=this._iframe.get("offsetHeight"),s=r.config.doc.body.scrollHeight,i>s?(i=i-15+"px",r.config.doc.body.style.height=i):r.config.doc.body.style.height="auto"}catch(t){this._ieHeightCounter<100&&e.later(200,this,this._ieSetBodyHeight)}},_resolveBaseHref:function(t){if(!t||t==="")t=e.config.doc.location.href,t.indexOf("?")!==-1&&(t=t.substring(0,t.indexOf("?"))),t=t.substring(0,t.lastIndexOf("/"))+"/";return t},_getHTML:function(e){if(this._ready){var t=this.getInstance();e=t.one("body").get("innerHTML")}return e},_setHTML:function(t){if(this._ready){var n=this.getInstance();n.one("body").set("innerHTML",t)}else this.once(r,e.bind(this._setHTML,this,t));return t},_getLinkedCSS:function(t){e.Lang.isArray(t)||(t=[t]);var n="";return this._ready?n=t:e.each(t,function(e){e&&(n+='<link rel="stylesheet" href="'+e+'" type="text/css">')}),n},_setLinkedCSS:function(e){if(this._ready){var t=this.getInstance();t.Get.css(e)}return e},_setExtraCSS:function(t){if(this._ready){var n=this.getInstance(),i=n.one("#extra_css");i&&i.remove(),n.one("head").append('<style id="extra_css">'+t+"</style>")}else this.once(r,e.bind(this._setExtraCSS,this,t));return t},_instanceLoaded:function(t){this._instance=t,this._onContentReady();var n=this._instance.config.doc;if(this.get("designMode")&&!e.UA.ie)try{n.execCommand("styleWithCSS",!1,!1),n.execCommand("insertbronreturn",!1,!1)}catch(r){}},use:function(){var t=this.getInstance(),n=e.Array(arguments),r=!1;return e.Lang.isFunction(n[n.length-1])&&(r=n.pop()),r&&n.push(function(){r.apply(t,arguments)}),t.__use.apply(t,n)},delegate:function(e,t,n,r){var i=this.getInstance();return i?(r||(r=n,n="body"),i.delegate
(e,t,n,r)):!1},getInstance:function(){return this._instance},render:function(t){return this._rendered?this:(this._rendered=!0,t&&this.set("container",t),this._create(e.bind(function(t){var n,r,s=e.bind(function(e){this._instanceLoaded(e)},this),o=e.clone(this.get("use")),u={debug:!1,win:t.win,doc:t.doc},a=e.bind(function(){u=this._resolveWinDoc(u),n=YUI(u),n.host=this.get(i);try{n.use("node-base",s),r&&clearInterval(r)}catch(e){r=setInterval(function(){a()},350)}},this);o.push(a),e.use.apply(e,o)},this)),this)},_handleFocus:function(){var e=this.getInstance(),t=new e.EditorSelection,n,r,i,s;t.anchorNode&&(n=t.anchorNode,n.test("p")&&n.get("innerHTML")===""&&(n=n.get("parentNode")),r=n.get("childNodes"),r.size()&&(r.item(0).test("br")?t.selectNode(n,!0,!1):r.item(0).test("p")?(n=r.item(0).one("br.yui-cursor"),n&&(n=n.get("parentNode")),n||(n=r.item(0).get("firstChild")),n||(n=r.item(0)),n&&t.selectNode(n,!0,!1)):(i=e.one("br.yui-cursor"),i&&(s=i.get("parentNode"),s&&t.selectNode(s,!0,!1)))))},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},focus:function(t){if(e.UA.ie&&e.UA.ie<9){try{e.one("win").focus(),this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus()}catch(n){}t===!0&&this._handleFocus(),e.Lang.isFunction(t)&&t()}else try{e.one("win").focus(),e.later(100,this,function(){this.getInstance()&&this.getInstance().one("win")&&this.getInstance().one("win").focus(),t===!0&&this._handleFocus(),e.Lang.isFunction(t)&&t()})}catch(r){}return this},show:function(){this._iframe.setStyles({position:"static",left:""});if(e.UA.gecko){try{this.getInstance()&&(this.getInstance().config.doc.designMode="on")}catch(t){}this.focus()}return this},hide:function(){return this._iframe.setStyles({position:"absolute",left:"-999999px"}),this}},{THROTTLE_TIME:100,DOM_EVENTS:{dblclick:1,click:1,paste:1,mouseup:1,mousedown:1,keyup:1,keydown:1,keypress:1,activate:1,deactivate:1,beforedeactivate:1,focusin:1,focusout:1},DEFAULT_CSS:"body { background-color: #fff; font: 13px/1.22 arial,helvetica,clean,sans-serif;*font-size:small;*font:x-small; } a, a:visited, a:hover { color: blue !important; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }",IFRAME_ATTRS:{border:"0",frameBorder:"0",marginWidth:"0",marginHeight:"0",leftMargin:"0",topMargin:"0",allowTransparency:"true",width:"100%",height:"99%"},PAGE_HTML:'<html dir="{DIR}" lang="{LANG}"><head><title>{TITLE}</title>{META}<base href="{BASE_HREF}"/>{LINKED_CSS}<style id="editor_css">{DEFAULT_CSS}</style>{EXTRA_CSS}</head><body>{CONTENT}</body></html>',getDocType:function(){var t=e.config.doc.doctype,n=s.DOC_TYPE;return t?n="<!DOCTYPE "+t.name+(t.publicId?" "+t.publicId:"")+(t.systemId?" "+t.systemId:"")+">":e.config.doc.all&&(t=e.config.doc.all[0],t.nodeType&&t.nodeType===8&&t.nodeValue&&t.nodeValue.toLowerCase().indexOf("doctype")!==-1&&(n="<!"+t.nodeValue+">")),n},DOC_TYPE:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',META:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=7">',NAME:"frame",NS:"frame",ATTRS:{title:{value:"Blank Page"},dir:{value:"ltr"},lang:{value:"en-US"},src:{value:"javascript"+(e.UA.ie?":false":":")+";"},designMode:{writeOnce:!0,value:!1},content:{validator:n.isString,value:"<br>",setter:"_setHTML",getter:"_getHTML"},basehref:{value:!1,getter:"_resolveBaseHref"},use:{writeOnce:!0,value:["node","node-style","selector-css3"]},container:{value:"body",setter:function(t){return e.one(t)}},node:{readOnly:!0,value:null,getter:function(){return this._iframe}},id:{writeOnce:!0,getter:function(t){return t||(t="iframe-"+e.guid()),t}},linkedcss:{validator:"_validateLinkedCSS",getter:"_getLinkedCSS",setter:"_setLinkedCSS"},extracss:{validator:n.isString,setter:"_setExtraCSS"},defaultblock:{value:"p"}}}),e.namespace("Plugin"),e.Plugin.Frame=s,e.Frame=s},"3.16.0-ym19",{requires:["base","node","plugin","selector-css3","yui-throttle"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("exec-command",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r=function(t,n,r){var i=this.getInstance(),s=i.config.doc,o=s.selection.createRange(),u=s.queryCommandValue(t),a,f,l,c,h,p,d;u&&(a=o.htmlText,f=new RegExp(r,"g"),l=a.match(f),l&&(a=a.replace(r+";","").replace(r,""),o.pasteHTML('<var id="yui-ie-bs">'),c=s.getElementById("yui-ie-bs"),h=s.createElement("div"),p=s.createElement(n),h.innerHTML=a,c.parentNode!==i.config.doc.body&&(c=c.parentNode),d=h.childNodes,c.parentNode.replaceChild(p,c),e.each(d,function(e){p.appendChild(e)}),o.collapse(),o.moveToElementText&&o.moveToElementText(p),o.select())),this._command(t)};e.extend(n,e.Base,{_lastKey:null,_inst:null,command:function(e,t){var r=n.COMMANDS[e];return r?r.call(this,e,t):this._command(e,t)},_command:function(e,t){var n=this.getInstance();try{try{n.config.doc.execCommand("styleWithCSS",null,1)}catch(r){try{n.config.doc.execCommand("useCSS",null,0)}catch(i){}}n.config.doc.execCommand(e,null,t)}catch(s){}},getInstance:function(){return this._inst||(this._inst=this.get("host").getInstance()),this._inst},initializer:function(){e.mix(this.get("host"),{execCommand:function(e,t){return this.exec.command(e,t)},_execCommand:function(e,t){return this.exec._command(e,t)}}),this.get("host").on("dom:keypress",e.bind(function(e){this._lastKey=e.keyCode},this))},_wrapContent:function(e,t){var n=this.getInstance().host.editorPara&&!t?!0:!1;return n?e="<p>"+e+"</p>":e+="<br>",e}},{NAME:"execCommand",NS:"exec",ATTRS:{host:{value:!1}},COMMANDS:{wrap:function(e,t){var n=this.getInstance();return(new n.EditorSelection).wrapContent(t)},inserthtml:function(t,n){var r=this.getInstance();if(r.EditorSelection.hasCursor()||e.UA.ie)return(new r.EditorSelection).insertContent(n);this._command("inserthtml",n)},insertandfocus:function(e,t){var n=this.getInstance(),r,i;return n.EditorSelection.hasCursor()?(t+=n.EditorSelection.CURSOR,r=this.command("inserthtml",t),i=new n.EditorSelection,i.focusCursor(!0,!0)):this.command("inserthtml",t),r},insertbr:function(){var t=this.getInstance(),n=new t.EditorSelection,r="<var>|</var>",i=null,s=t.EditorSelection.ROOT,o=e.UA.webkit?"span.Apple-style-span,var":"var",u=function(e){var n=t.Node.create("<br>");return e.insert(n,"before"),n};n._selection.pasteHTML?n._selection.pasteHTML(r):this._command("inserthtml",r),s.all(o).each(function(t){var n=!0,r;e.UA.webkit&&(n=!1,t.get("innerHTML")==="|"&&(n=!0)),n&&(i=u(t),(!i.previous()||!i.previous().test("br"))&&e.UA.gecko&&(r=i.cloneNode(),i.insert(r,"after"),i=r),t.remove())}),e.UA.webkit&&i&&(u(i),n.selectNode(i))},insertimage:function(e,t){return this.command("inserthtml",'<img src="'+t+'">')},addclass:function(e,t){var n=this.getInstance();return(new n.EditorSelection).getSelected().addClass(t)},removeclass:function(e,t){var n=this.getInstance();return(new n.EditorSelection).getSelected().removeClass(t)},forecolor:function(t,n){var r=this.getInstance(),i=new r.EditorSelection,s;e.UA.ie||this._command("useCSS",!1);if(r.EditorSelection.hasCursor())return i.isCollapsed?(i.anchorNode&&i.anchorNode.get("innerHTML")==="&nbsp;"?(i.anchorNode.setStyle("color",n),s=i.anchorNode):(s=this.command("inserthtml",'<span style="color: '+n+'">'+r.EditorSelection.CURSOR+"</span>"),i.focusCursor(!0,!0)),s):this._command(t,n);this._command(t,n)},backcolor:function(t,n){var r=this.getInstance(),i=new r.EditorSelection,s;if(e.UA.gecko||e.UA.opera)t="hilitecolor";e.UA.ie||this._command("useCSS",!1);if(r.EditorSelection.hasCursor())return i.isCollapsed?(i.anchorNode&&i.anchorNode.get("innerHTML")==="&nbsp;"?(i.anchorNode.setStyle("backgroundColor",n),s=i.anchorNode):(s=this.command("inserthtml",'<span style="background-color: '+n+'">'+r.EditorSelection.CURSOR+"</span>"),i.focusCursor(!0,!0)),s):this._command(t,n);this._command(t,n)},hilitecolor:function(){return n.COMMANDS.backcolor.apply(this,arguments)},fontname2:function(e,t){this._command("fontname",t);var n=this.getInstance(),r=new n.EditorSelection;r.isCollapsed&&this._lastKey!==32&&r.anchorNode.test("font")&&r.anchorNode.set("face",t)},fontsize2:function(t,n){this._command("fontsize",n);var r=this.getInstance(),i=new r.EditorSelection,s;i.isCollapsed&&i.anchorNode&&this._lastKey!==32&&(e.UA.webkit&&i.anchorNode.getStyle("lineHeight")&&i.anchorNode.setStyle("lineHeight",""),i.anchorNode.test("font")?i.anchorNode.set("size",n):e.UA.gecko&&(s=i.anchorNode.ancestor(r.EditorSelection.DEFAULT_BLOCK_TAG),s&&s.setStyle("fontSize","")))},insertunorderedlist:function(){this.command("list","ul")},insertorderedlist:function(){this.command("list","ol")},list:function(t,n){var r=this.getInstance(),i,s=this,o="dir",u="yui3-touched",a,f,l,c,h,p,d,v,m,g,y=r.host.editorPara?!0:!1,b,w,E,S,x=r.EditorSelection.ROOT,T=new r.EditorSelection;t="insert"+(n==="ul"?"un":"")+"orderedlist";if(e.UA.ie&&e.UA.ie<11&&!T.isCollapsed){f=T._selection,i=f.htmlText,l=r.Node.create(i)||x;if(l.test("li")||l.one("li")){this._command(t,null);return}l.test(n)?(c=f.item?f.item(0):f.parentElement(),h=r.one(c),g=h.all("li"),p="<div>",g.each(function(e){p=s._wrapContent(e.get("innerHTML"))}),p+="</div>",d=r.Node.create(p),h.get("parentNode").test("div")&&(h=h.get("parentNode")),h&&h.hasAttribute(o)&&(y?d.all("p").setAttribute(o,h.getAttribute(o)):d.setAttribute(o,h.getAttribute(o))),y?h.replace(d.get("innerHTML")):h.replace(d),f.moveToElementText&&f.moveToElementText(d._node),f.select()):(v=e.one(f.parentElement()),v.test(r.EditorSelection.BLOCKS)||(v=v.ancestor(r.EditorSelection.BLOCKS)),v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),i.indexOf("<br>")>-1?i=i.split(/<br>/i):(b=r.Node.create(i),ps=b?b.all("p"):null,ps&&ps.size()?(i=[],ps.each(function(e){i.push(e.get("innerHTML"))})):i=[i]),m="<"+n+' id="ie-list">',e.each(i,function(e){var t=r.Node.create(e);t&&t.test("p")&&(t.hasAttribute(o)&&(a=t.getAttribute(o)),e=t.get("innerHTML")),m+="<li>"+e+"</li>"}),m+="</"+n+">",f.pasteHTML(m),c=r.config.doc.getElementById("ie-list"),c.id="",a&&c.setAttribute
(o,a),f.moveToElementText&&f.moveToElementText(c),f.select())}else e.UA.ie&&e.UA.ie<11?(v=r.one(T._selection.parentElement()),v.test("p")?(v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),i=e.EditorSelection.getText(v),i===""?(w="",a&&(w=' dir="'+a+'"'),m=r.Node.create(e.Lang.sub("<{tag}{dir}><li></li></{tag}>",{tag:n,dir:w})),v.replace(m),T.selectNode(m.one("li"))):this._command(t,null)):this._command(t,null)):(x.all(n).addClass(u),T.anchorNode.test(r.EditorSelection.BLOCKS)?v=T.anchorNode:v=T.anchorNode.ancestor(r.EditorSelection.BLOCKS),v||(v=T.anchorNode.one(r.EditorSelection.BLOCKS)),v&&v.hasAttribute(o)&&(a=v.getAttribute(o)),v&&v.test(n)?(E=v.ancestor("p"),i=r.Node.create("<div/>"),c=v.all("li"),c.each(function(e){i.append(s._wrapContent(e.get("innerHTML"),E))}),a&&(y?i.all("p").setAttribute(o,a):i.setAttribute(o,a)),y&&(i=r.Node.create(i.get("innerHTML"))),S=i.get("firstChild"),v.replace(i),T.selectNode(S)):this._command(t,null),m=x.all(n),a&&m.size()&&m.each(function(e){e.hasClass(u)||e.setAttribute(o,a)}),m.removeClass(u))},justify:function(t,n){if(e.UA.webkit){var r=this.getInstance(),i=new r.EditorSelection,s=i.anchorNode,o,u=s.getStyle("backgroundColor");this._command(n),i=new r.EditorSelection,i.anchorNode.test("div")&&(o="<span>"+i.anchorNode.get("innerHTML")+"</span>",i.anchorNode.set("innerHTML",o),i.anchorNode.one("span").setStyle("backgroundColor",u),i.selectNode(i.anchorNode.one("span")))}else this._command(n)},justifycenter:function(){this.command("justify","justifycenter")},justifyleft:function(){this.command("justify","justifyleft")},justifyright:function(){this.command("justify","justifyright")},justifyfull:function(){this.command("justify","justifyfull")}}}),e.UA.ie&&e.UA.ie<11&&(n.COMMANDS.bold=function(){r.call(this,"bold","b","FONT-WEIGHT: bold")},n.COMMANDS.italic=function(){r.call(this,"italic","i","FONT-STYLE: italic")},n.COMMANDS.underline=function(){r.call(this,"underline","u","TEXT-DECORATION: underline")}),e.namespace("Plugin"),e.Plugin.ExecCommand=n},"3.16.0-ym19",{requires:["frame"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-selection",function(e,t){var n="textContent",r="innerHTML",i="fontFamily";e.UA.ie&&e.UA.ie<11&&(n="nodeValue"),e.EditorSelection=function(t){var n,r,i,s,o,u,a,f=0,l,c,h=e.EditorSelection.ROOT;e.config.win.getSelection&&(!e.UA.ie||e.UA.ie>8)?n=e.config.win.getSelection():e.config.doc.selection&&(n=e.config.doc.selection.createRange()),this._selection=n;if(!n)return!1;if(n.pasteHTML){this.isCollapsed=n.compareEndPoints("StartToEnd",n)?!1:!0;if(this.isCollapsed){this.anchorNode=this.focusNode=e.one(n.parentElement()),t&&(i=e.config.doc.elementFromPoint(t.clientX,t.clientY)),o=n.duplicate();if(!i){r=n.parentElement(),s=r.childNodes;for(u=0;u<s.length;u++)o.inRange(n)&&(i||(i=s[u]))}this.ieNode=i,i&&(i.nodeType!==3&&(i.firstChild&&(i=i.firstChild),h.compareTo(i)&&i.firstChild&&(i=i.firstChild)),this.anchorNode=this.focusNode=e.EditorSelection.resolve(i),o.moveToElementText(n.parentElement()),a=n.compareEndPoints("StartToStart",o),a&&(f=this.getEditorOffset(h),n.move("character",-f)),this.anchorOffset=this.focusOffset=f,this.anchorTextNode=this.focusTextNode=e.one(i))}else n.htmlText&&n.htmlText!==""&&(l=e.Node.create(n.htmlText),l&&l.get("id")?(c=l.get("id"),this.anchorNode=this.focusNode=e.one("#"+c)):l&&(l=l.get("childNodes"),this.anchorNode=this.focusNode=l.item(0)))}else this.isCollapsed=n.isCollapsed,this.anchorNode=e.EditorSelection.resolve(n.anchorNode),this.focusNode=e.EditorSelection.resolve(n.focusNode),this.anchorOffset=n.anchorOffset,this.focusOffset=n.focusOffset,this.anchorTextNode=e.one(n.anchorNode||this.anchorNode),this.focusTextNode=e.one(n.focusNode||this.focusNode);e.Lang.isString(n.text)?this.text=n.text:n.toString?this.text=n.toString():this.text=""},e.EditorSelection.removeFontFamily=function(t){t.removeAttribute("face");var n=t.getAttribute("style").toLowerCase();(n===""||n==="font-family: ")&&t.removeAttribute("style"),n.match(e.EditorSelection.REG_FONTFAMILY)&&(n=n.replace(e.EditorSelection.REG_FONTFAMILY,""),t.setAttribute("style",n))},e.EditorSelection.filter=function(t){var n=(new Date).getTime(),r=e.EditorSelection,s=r.ROOT,o,u=s.all(r.ALL),a=s.all("strong,em"),f=e.config.doc,l,c={},h="",p,d=(new Date).getTime(),v;u.each(function(t){var n=e.Node.getDOMNode(t);n.style[i]&&(c["."+t._yuid]=n.style[i],t.addClass(t._yuid),r.removeFontFamily(n))}),v=(new Date).getTime(),s.all(".hr").addClass("yui-skip").addClass("yui-non"),e.UA.ie&&(l=e.Node.getDOMNode(s).getElementsByTagName("hr"),e.each(l,function(e){var t=f.createElement("div"),n=t.style;t.className="hr yui-non yui-skip",t.setAttribute("readonly",!0),t.setAttribute("contenteditable",!1),e.parentNode&&e.parentNode.replaceChild(t,e),n.border="1px solid #ccc",n.lineHeight="0",n.height="0",n.fontSize="0",n.marginTop="5px",n.marginBottom="5px",n.marginLeft="0px",n.marginRight="0px",n.padding="0"})),e.each(c,function(e,t){h+=t+" { font-family: "+e.replace(/"/gi,"")+"; }"}),e.StyleSheet(h,"editor"),a.each(function(e,t){var n=e.get("tagName").toLowerCase(),i="i";n==="strong"&&(i="b"),r.prototype._swap(a.item(t),i)}),p=s.all("ol,ul"),p.each(function(e){var t=e.all("li");t.size()||e.remove()}),t&&r.filterBlocks(),o=(new Date).getTime()},e.EditorSelection.filterBlocks=function(){var t=(new Date).getTime(),r,i=e.Node.getDOMNode(e.EditorSelection.ROOT).childNodes,s,o,u=!1,a=!0,f,l,c,h,p,d;if(i){for(s=0;s<i.length;s++)o=e.one(i[s]),o.test(e.EditorSelection.BLOCKS)?u=e.EditorSelection._wrapBlock(u):(a=!0,i[s].nodeType===3&&(h=i[s][n].match(e.EditorSelection.REG_CHAR),p=i[s][n].match(e.EditorSelection.REG_NON),h===null&&p&&(a=!1)),a&&(u||(u=[]),u.push(i[s])));u=e.EditorSelection._wrapBlock(u)}l=e.all(e.EditorSelection.DEFAULT_BLOCK_TAG);if(l.size()===1){c=l.item(0).all("br");if(c.size()===1){c.item(0).test(".yui-cursor")||c.item(0).remove(),d=l.item(0).get("innerHTML");if(d===""||d===" ")l.set("innerHTML",e.EditorSelection.CURSOR),f=new e.EditorSelection,f.focusCursor(!0,!0);c.item(0).test(".yui-cursor")&&e.UA.ie&&c.item(0).remove()}}else l.each(function(e){var t=e.get("innerHTML");t===""&&e.remove()});r=(new Date).getTime()},e.EditorSelection.REG_FONTFAMILY=/font-family:\s*;/,e.EditorSelection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi,e.EditorSelection.REG_NON=/[\s|\n|\t]/gi,e.EditorSelection.REG_NOHTML=/<\S[^><]*>/g,e.EditorSelection._wrapBlock=function(t){if(t){var n=e.Node.create("<"+e.EditorSelection.DEFAULT_BLOCK_TAG+"></"+e.EditorSelection.DEFAULT_BLOCK_TAG+">"),r=e.one(t[0]),i;for(i=1;i<t.length;i++)n.append(t[i]);r.replace(n),n.prepend(r)}return!1},e.EditorSelection.unfilter=function(){var t=e.EditorSelection.ROOT,n=t.all("[class]"),r="",s,o,u=t;return n.each(function(e){e.hasClass(e._yuid)&&(e.setStyle(i,e.getStyle(i)),e.removeClass(e._yuid),e.getAttribute("class")===""&&e.removeAttribute("class"))}),s=t.all(".yui-non"),s.each(function(e){!e.hasClass("yui-skip")&&e.get("innerHTML")===""?e.remove():e.removeClass("yui-non").removeClass("yui-skip")}),o=t.all("[id]"),o.each(function(e){e.get("id").indexOf("yui_3_")===0&&(e.removeAttribute("id"),e.removeAttribute("_yuid"))}),u&&(r=u.get("innerHTML")),t.all(".hr").addClass("yui-skip").addClass("yui-non"),r},e.EditorSelection.resolve=function(t){if(!t)return e.EditorSelection.ROOT;if(t&&t.nodeType===3)try{t=t.parentNode}catch(n){t=e.EditorSelection.ROOT}return e.one(t)},e.EditorSelection.getText=function(t){var n=t.get("innerHTML").replace(e.EditorSelection.REG_NOHTML,"");return n=n.replace("<span><br></span>","").replace("<br>",""),n},e.EditorSelection.DEFAULT_BLOCK_TAG="p",e.EditorSelection.ALL="[style],font[face]",e.EditorSelection.BLOCKS="p,div,ul,ol,table,style",e.EditorSelection.TMP="yui-tmp",e.EditorSelection.DEFAULT_TAG="span",e.EditorSelection.CURID="yui-cursor",e.EditorSelection.CUR_WRAPID="yui-cursor-wrapper",e.EditorSelection.CURSOR='<span><br class="yui-cursor"></span>',e.EditorSelection.ROOT=e.one("body"),e.EditorSelection.hasCursor=function(){var t=e.all("#"+e.EditorSelection.CUR_WRAPID);return t.size()},e.EditorSelection.cleanCursor=
function(){var t,n="br.yui-cursor";t=e.all(n),t.size()&&t.each(function(t){var n=t.get("parentNode.parentNode.childNodes"),r;n.size()?t.remove():(r=e.EditorSelection.getText(n.item(0)),r!==""&&t.remove())})},e.EditorSelection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(t,n){var i=e.Node.create("<"+n+"></"+n+">");return i.set(r,t.get(r)),t.set(r,""),t.append(i),e.Node.getDOMNode(i)},_swap:function(t,n){var i=e.Node.create("<"+n+"></"+n+">");return i.set(r,t.get(r)),t.replace(i,t),e.Node.getDOMNode(i)},getSelected:function(){var t=e.EditorSelection,n=t.ROOT,r,s=[];return t.filter(),e.config.doc.execCommand("fontname",null,t.TMP),r=n.all(t.ALL),r.each(function(o,u){o.getStyle(i)===t.TMP&&(o.setStyle(i,""),t.removeFontFamily(o),o.compareTo(n)||s.push(e.Node.getDOMNode(r.item(u))))}),e.all(s)},insertContent:function(e){return this.insertAtCursor(e,this.anchorTextNode,this.anchorOffset,!0)},insertAtCursor:function(t,r,i,s){var o=e.Node.create("<"+e.EditorSelection.DEFAULT_TAG+' class="yui-non"></'+e.EditorSelection.DEFAULT_TAG+">"),u,a,f,l,c=this.createRange(),h,p=e.EditorSelection.ROOT;p.compareTo(r)&&(h=e.Node.create("<span></span>"),r.append(h),r=h);if(c.pasteHTML){if(i===0&&r&&!r.previous()&&r.get("nodeType")===3)return r.insert(t,"before"),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(r.previous())),c.collapse(!1),c.select(),r.previous();l=e.Node.create(t);try{c.pasteHTML('<span id="rte-insert"></span>')}catch(d){}u=p.one("#rte-insert");if(u)return u.set("id",""),u.replace(l),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(l)),c.collapse(!1),c.select(),l;e.on("available",function(){u.set("id",""),u.replace(l),c.moveToElementText&&c.moveToElementText(e.Node.getDOMNode(l)),c.collapse(!1),c.select()},"#rte-insert")}else i>0?(u=r.get(n),a=e.one(e.config.doc.createTextNode(u.substr(0,i))),f=e.one(e.config.doc.createTextNode(u.substr(i))),r.replace(a,r),l=e.Node.create(t),l.get("nodeType")===11&&(h=e.Node.create("<span></span>"),h.append(l),l=h),a.insert(l,"after"),f&&(l.insert(o,"after"),o.insert(f,"after"),this.selectNode(o,s))):(r.get("nodeType")===3&&(r=r.get("parentNode")||p),l=e.Node.create(t),t=r.get("innerHTML").replace(/\n/gi,""),t===""||t==="<br>"?r.append(l):l.get("parentNode")?r.insert(l,"before"):p.prepend(l),r.get("firstChild").test("br")&&r.get("firstChild").remove());return l},wrapContent:function(t){t=t?t:e.EditorSelection.DEFAULT_TAG;if(!this.isCollapsed){var n=this.getSelected(),r=[],i,s,o,u;return n.each(function(e,i){var s=e.get("tagName").toLowerCase();s==="font"?r.push(this._swap(n.item(i),t)):r.push(this._wrap(n.item(i),t))},this),i=this.createRange(),o=r[0],s=r[r.length-1],this._selection.removeAllRanges?(i.setStart(r[0],0),i.setEnd(s,s.childNodes.length),this._selection.removeAllRanges(),this._selection.addRange(i)):(i.moveToElementText&&(i.moveToElementText(e.Node.getDOMNode(o)),u=this.createRange(),u.moveToElementText(e.Node.getDOMNode(s)),i.setEndPoint("EndToEnd",u)),i.select()),r=e.all(r),r}return e.all([])},replace:function(t,r){var i=this.createRange(),s,o,u,a;return i.getBookmark?(u=i.getBookmark(),o=this.anchorNode.get("innerHTML").replace(t,r),this.anchorNode.set("innerHTML",o),i.moveToBookmark(u),a=e.one(i.parentElement())):(s=this.anchorTextNode,o=s.get(n),u=o.indexOf(t),o=o.replace(t,""),s.set(n,o),a=this.insertAtCursor(r,s,u,!0)),a},remove:function(){return this._selection&&this._selection.removeAllRanges&&this._selection.removeAllRanges(),this},createRange:function(){return e.config.doc.selection?e.config.doc.selection.createRange():e.config.doc.createRange()},selectNode:function(t,n,r){if(!t)return;r=r||0,t=e.Node.getDOMNode(t);var i=this.createRange();if(i.selectNode){try{i.selectNode(t)}catch(s){}this._selection.removeAllRanges(),this._selection.addRange(i);if(n)try{this._selection.collapse(t,r)}catch(s){this._selection.collapse(t,0)}}else{t.nodeType===3&&(t=t.parentNode);try{i.moveToElementText(t)}catch(o){}n&&i.collapse(r?!1:!0),i.select()}return this},setCursor:function(){return this.removeCursor(!1),this.insertContent(e.EditorSelection.CURSOR)},getCursor:function(){var t=e.EditorSelection.ROOT.all("."+e.EditorSelection.CURID);return t.isEmpty()?null:t.get("parentNode")},removeCursor:function(t){var n=this.getCursor();return n&&!t&&n.all("."+e.EditorSelection.CURID).remove(),n},focusCursor:function(e,t){e!==!1&&(e=!0),t!==!1&&(t=!0);var n=this.removeCursor(!0);n&&n.each(function(n){this.selectNode(n,e,t)},this)},toString:function(){return"EditorSelection Object"},getEditorOffset:function(t){var n=(t||e.EditorSelection.ROOT).getDOMNode(),r=0,i=e.config.doc,s=e.config.win,o,u,a;return typeof s.getSelection!="undefined"?(u=s.getSelection().getRangeAt(0),a=u.cloneRange(),a.selectNodeContents(n),a.setEnd(u.endContainer,u.endOffset),r=a.toString().length):(o=i.selection,o&&o.type!=="Control"&&(u=o.createRange(),a=i.body.createTextRange(),a.moveToElementText(n),a.setEndPoint("EndToEnd",u),r=a.text.length)),r}},e.Selection=e.EditorSelection},"3.16.0-ym19",{requires:["node"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-base",function(e,t){var n=e.Lang,r=function(){r.superclass.constructor.apply(this,arguments)},i=":last-child";e.extend(r,e.Base,{frame:null,initializer:function(){this.publish("nodeChange",{emitFacade:!0,bubbles:!0,defaultFn:this._defNodeChangeFn})},destructor:function(){this.detachAll()},copyStyles:function(t,n){if(t.test("a"))return;var r=["color","fontSize","fontFamily","backgroundColor","fontStyle"],i={};e.each(r,function(e){i[e]=t.getStyle(e)}),t.ancestor("b,strong")&&(i.fontWeight="bold"),t.ancestor("u")&&(i.textDecoration||(i.textDecoration="underline")),n.setStyles(i)},_lastBookmark:null,_resolveChangedNode:function(e){var t=this.getInstance(),n,r,s,o=this._getRoot(),u;e&&e.compareTo(o)&&(u=new t.EditorSelection,u&&u.anchorNode&&(e=u.anchorNode));if(t&&e&&e.test("html")){n=o.one(i);while(!s)n?(r=n.one(i),r?n=r:s=!0):s=!0;n&&(n.test("br")&&(n.previous()?n=n.previous():n=n.get("parentNode")),n&&(e=n))}return e||(e=o),e},_getRoot:function(){return this.getInstance().EditorSelection.ROOT},_defNodeChangeFn:function(t){var n=(new Date).getTime(),i=this.getInstance(),s,o,u,a={},f,l,c=[],h="",p="",d,v=!1,m=this._getRoot();if(e.UA.ie&&e.UA.ie<11)try{s=i.config.doc.selection.createRange(),s.getBookmark&&(this._lastBookmark=s.getBookmark())}catch(g){}t.changedNode=this._resolveChangedNode(t.changedNode);switch(t.changedType){case"backspace-up":e.UA.webkit&&t.changedNode&&t.changedNode.set("innerHTML",t.changedNode.get("innerHTML"))}e.UA.webkit&&t.commands&&(t.commands.indent||t.commands.outdent)&&(d=m.all(".webkit-indent-blockquote, blockquote"),d.size()&&d.setStyle("margin","")),o=this.getDomPath(t.changedNode,!1),t.commands&&(a=t.commands),e.each(o,function(t){var n=t.tagName.toLowerCase(),s=r.TAG2CMD[n],o,u,d,m,g;s&&(a[s]=1),o=t.currentStyle||t.style,""+o.fontWeight=="normal"&&(v=!0),""+o.fontWeight=="bold"&&(a.bold=1),e.UA.ie&&o.fontWeight>400&&(a.bold=1),o.fontStyle==="italic"&&(a.italic=1),o.textDecoration.indexOf("underline")>-1&&(a.underline=1),o.textDecoration.indexOf("line-through")>-1&&(a.strikethrough=1),u=i.one(t),u.getStyle("fontFamily")&&(d=u.getStyle("fontFamily").split(",")[0].toLowerCase(),d&&(f=d),f&&(f=f.replace(/'/g,"").replace(/"/g,""))),l=r.NORMALIZE_FONTSIZE(u),m=t.className.split(" "),e.each(m,function(e){e!==""&&e.substr(0,4)!=="yui_"&&c.push(e)}),h=r.FILTER_RGB(u.getStyle("color")),g=r.FILTER_RGB(o.backgroundColor),g!=="transparent"&&g!==""&&(p=g)}),v&&(delete a.bold,delete a.italic),t.dompath=i.all(o),t.classNames=c,t.commands=a,t.fontFamily||(t.fontFamily=f),t.fontSize||(t.fontSize=l),t.fontColor||(t.fontColor=h),t.backgroundColor||(t.backgroundColor=p),u=(new Date).getTime()},getDomPath:function(e,t){var n=[],r,i,s=this._getRoot(),o=this.frame.getInstance();r=o.Node.getDOMNode(e),i=o.Node.getDOMNode(s);while(r!==null){if(r===o.config.doc.documentElement||r===o.config.doc||!r.tagName){r=null;break}if(!o.DOM.inDoc(r)){r=null;break}r.nodeName&&r.nodeType&&r.nodeType===1&&n.push(r);if(r===i){r=null;break}r=r.parentNode}return n.length===0&&(n[0]=o.config.doc.body),t?o.all(n.reverse()):n.reverse()},_afterFrameReady:function(){var t=this.frame.getInstance();this.frame.on("dom:mouseup",e.bind(this._onFrameMouseUp,this)),this.frame.on("dom:mousedown",e.bind(this._onFrameMouseDown,this)),this.frame.on("dom:keydown",e.bind(this._onFrameKeyDown,this)),e.UA.ie&&e.UA.ie<11&&(this.frame.on("dom:activate",e.bind(this._onFrameActivate,this)),this.frame.on("dom:beforedeactivate",e.bind(this._beforeFrameDeactivate,this))),this.frame.on("dom:keyup",e.bind(this._onFrameKeyUp,this)),this.frame.on("dom:keypress",e.bind(this._onFrameKeyPress,this)),this.frame.on("dom:paste",e.bind(this._onPaste,this)),t.EditorSelection.filter(),this.fire("ready")},_beforeFrameDeactivate:function(e){if(e.frameTarget.test("html"))return;var t=this.getInstance(),n=t.config.doc.selection.createRange();n.compareEndPoints&&!n.compareEndPoints("StartToEnd",n)&&n.pasteHTML('<var id="yui-ie-cursor">')},_onFrameActivate:function(e){if(e.frameTarget.test("html"))return;var t=this.getInstance(),n=new t.EditorSelection,r=n.createRange(),i=this._getRoot(),s=i.all("#yui-ie-cursor");s.size()&&s.each(function(e){e.set("id","");if(r.moveToElementText)try{r.moveToElementText(e._node);var t=r.move("character",-1);t===-1&&r.move("character",1),r.select(),r.text=""}catch(n){}e.remove()})},_onPaste:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"paste",changedEvent:e.frameEvent})},_onFrameMouseUp:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mouseup",changedEvent:e.frameEvent})},_onFrameMouseDown:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mousedown",changedEvent:e.frameEvent})},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(t){var n,i;this._currentSelection?i=this._currentSelection:(this._currentSelectionTimer&&this._currentSelectionTimer.cancel(),this._currentSelectionTimer=e.later(850,this,function(){this._currentSelectionClear=!0}),n=this.frame.getInstance(),i=new n.EditorSelection(t),this._currentSelection=i),n=this.frame.getInstance(),i=new n.EditorSelection,this._currentSelection=i,i&&i.anchorNode&&(this.fire("nodeChange",{changedNode:i.anchorNode,changedType:"keydown",changedEvent:t.frameEvent}),r.NC_KEYS[t.keyCode]&&(this.fire("nodeChange",{changedNode:i.anchorNode,changedType:r.NC_KEYS[t.keyCode],changedEvent:t.frameEvent}),this.fire("nodeChange",{changedNode:i.anchorNode,changedType:r.NC_KEYS[t.keyCode]+"-down",changedEvent:t.frameEvent})))},_onFrameKeyPress:function(e){var t=this._currentSelection;t&&t.anchorNode&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:"keypress",changedEvent:e.frameEvent}),r.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:t.anchorNode,changedType:r.NC_KEYS[e.keyCode]+"-press",changedEvent:e.frameEvent}))},_onFrameKeyUp:function(e){var t=this.frame.getInstance(),n=new t.EditorSelection(e);n&&n.anchorNode&&(this
.fire("nodeChange",{changedNode:n.anchorNode,changedType:"keyup",selection:n,changedEvent:e.frameEvent}),r.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:n.anchorNode,changedType:r.NC_KEYS[e.keyCode]+"-up",selection:n,changedEvent:e.frameEvent})),this._currentSelectionClear&&(this._currentSelectionClear=this._currentSelection=null)},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},execCommand:function(e,t){var n=this.frame.execCommand(e,t),r=this.frame.getInstance(),i=new r.EditorSelection,s={},o={changedNode:i.anchorNode,changedType:"execcommand",nodes:n};switch(e){case"forecolor":o.fontColor=t;break;case"backcolor":o.backgroundColor=t;break;case"fontsize":o.fontSize=t;break;case"fontname":o.fontFamily=t}return s[e]=1,o.commands=s,this.fire("nodeChange",o),n},getInstance:function(){return this.frame.getInstance()},render:function(t){var n=this.frame;return n||(this.plug(e.Plugin.Frame,{designMode:!0,title:r.STRINGS.title,use:r.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock")}),n=this.frame),n.hasPlugin("exec")||n.plug(e.Plugin.ExecCommand),n.after("ready",e.bind(this._afterFrameReady,this)),n.addTarget(this),n.set("content",this.get("content")),n.render(t),this},focus:function(e){return this.frame.focus(e),this},show:function(){return this.frame.show(),this},hide:function(){return this.frame.hide(),this},getContent:function(){var e="",t=this.getInstance();return t&&t.EditorSelection&&(e=t.EditorSelection.unfilter()),e=e.replace(/ _yuid="([^>]*)"/g,""),e}},{NORMALIZE_FONTSIZE:function(e){var t=e.getStyle("fontSize"),n=t;switch(t){case"-webkit-xxx-large":t="48px";break;case"xx-large":t="32px";break;case"x-large":t="24px";break;case"large":t="18px";break;case"medium":t="16px";break;case"small":t="13px";break;case"x-small":t="10px"}return n!==t&&e.setStyle("fontSize",t),t},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(e){if(e.toLowerCase().indexOf("rgb")!==-1){var t=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi"),n=e.replace(t,"$1,$2,$3,$4,$5").split(","),r,i,s;n.length===5&&(r=parseInt(n[1],10).toString(16),i=parseInt(n[2],10).toString(16),s=parseInt(n[3],10).toString(16),r=r.length===1?"0"+r:r,i=i.length===1?"0"+i:i,s=s.length===1?"0"+s:s,e="#"+r+i+s)}return e},TAG2CMD:{b:"bold",strong:"bold",i:"italic",em:"italic",u:"underline",sup:"superscript",sub:"subscript",img:"insertimage",a:"createlink",ul:"insertunorderedlist",ol:"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["node","selector-css3","editor-selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{validator:n.isString,value:'<br class="yui-cursor">',setter:function(t){return t.substr(0,1)==="\n"&&(t=t.substr(1)),t===""&&(t='<br class="yui-cursor">'),t===" "&&e.UA.gecko&&(t='<br class="yui-cursor">'),this.frame.set("content",t)},getter:function(){return this.frame.get("content")}},dir:{validator:n.isString,writeOnce:!0,value:"ltr"},linkedcss:{validator:"_validateLinkedCSS",value:"",setter:function(e){return this.frame&&this.frame.set("linkedcss",e),e}},extracss:{validator:n.isString,value:"",setter:function(e){return this.frame&&this.frame.set("extracss",e),e}},defaultblock:{validator:n.isString,value:"p"}}}),e.EditorBase=r},"3.16.0-ym19",{requires:["base","frame","node","exec-command","editor-selection"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("stylesheet",function(e,t){function v(t,r){var o,a,f,l={},h,p,m,g,y,b;if(!e.instanceOf(this,v))return new v(t,r);if(t){if(e.Node&&t instanceof e.Node)a=t._node;else if(t.nodeName)a=t;else if(s(t)){if(t&&u[t])return u[t];a=n.getElementById(t.replace(/^#/,d))}if(a&&u[e.stamp(a)])return u[e.stamp(a)]}if(!a||!/^(?:style|link)$/i.test(a.nodeName))a=n.createElement("style"),a.type="text/css";s(t)&&(t.indexOf("{")!=-1?a.styleSheet?a.styleSheet.cssText=t:a.appendChild(n.createTextNode(t)):r||(r=t));if(!a.parentNode||a.parentNode.nodeName.toLowerCase()!=="head")o=(a.ownerDocument||n).getElementsByTagName("head")[0],o.appendChild(a);f=a.sheet||a.styleSheet,h=f&&"cssRules"in f?"cssRules":"rules",m="deleteRule"in f?function(e){f.deleteRule(e)}:function(e){f.removeRule(e)},p="insertRule"in f?function(e,t,n){f.insertRule(e+" {"+t+"}",n)}:function(e,t,n){f.addRule(e,t,n)};for(g=f[h].length-1;g>=0;--g)y=f[h][g],b=y.selectorText,l[b]?(l[b].style.cssText+=";"+y.style.cssText,m(g)):l[b]=y;v.register(e.stamp(a),this),r&&v.register(r,this),e.mix(this,{getId:function(){return e.stamp(a)},enable:function(){return f.disabled=!1,this},disable:function(){return f.disabled=!0,this},isEnabled:function(){return!f.disabled},set:function(e,t){var n=l[e],r=e.split(/\s*,\s*/),i,s;if(r.length>1){for(i=r.length-1;i>=0;--i)this.set(r[i],t);return this}return v.isValidSelector(e)?(n?n.style.cssText=v.toCssText(t,n.style.cssText):(s=f[h].length,t=v.toCssText(t),t&&(p(e,t,s),l[e]=f[h][s])),this):this},unset:function(t,n){var r=l[t],s=t.split(/\s*,\s*/),o=!n,u,a;if(s.length>1){for(a=s.length-1;a>=0;--a)this.unset(s[a],n);return this}if(r){if(!o){n=e.Array(n),i.cssText=r.style.cssText;for(a=n.length-1;a>=0;--a)c(i,n[a]);i.cssText?r.style.cssText=i.cssText:o=!0}if(o){u=f[h];for(a=u.length-1;a>=0;--a)if(u[a]===r){delete l[t],m(a);break}}}return this},getCssText:function(e){var t,n,r;if(s(e))return t=l[e.split(/\s*,\s*/)[0]],t?t.style.cssText:null;n=[];for(r in l)l.hasOwnProperty(r)&&(t=l[r],n.push(t.selectorText+" {"+t.style.cssText+"}"));return n.join("\n")}})}var n=e.config.doc,r=n.createElement("p"),i=r.style,s=e.Lang.isString,o={},u={},a="cssFloat"in i?"cssFloat":"styleFloat",f,l,c,h="opacity",p="float",d="";l=h in i?function(e){e.opacity=d}:function(e){e.filter=d},i.border="1px solid red",i.border=d,c=i.borderLeft?function(e,t){var n;t!==a&&t.toLowerCase().indexOf(p)!=-1&&(t=a);if(s(e[t]))switch(t){case h:case"filter":l(e);break;case"font":e.font=e.fontStyle=e.fontVariant=e.fontWeight=e.fontSize=e.lineHeight=e.fontFamily=d;break;default:for(n in e)n.indexOf(t)===0&&(e[n]=d)}}:function(e,t){t!==a&&t.toLowerCase().indexOf(p)!=-1&&(t=a),s(e[t])&&(t===h?l(e):e[t]=d)},f=function(t,s){var o=t.styleFloat||t.cssFloat||t[p],u=e.Lang.trim,f;try{i.cssText=s||d}catch(l){r=n.createElement("p"),i=r.style,i.cssText=s||d}o&&!t[a]&&(t=e.merge(t),delete t.styleFloat,delete t.cssFloat,delete t[p],t[a]=o);for(f in t)if(t.hasOwnProperty(f))try{i[f]=u(t[f])}catch(c){}return i.cssText},e.mix(v,{toCssText:h in i?f:function(t,n){return h in t&&(t=e.merge(t,{filter:"alpha(opacity="+t.opacity*100+")"}),delete t.opacity),f(t,n)},register:function(e,t){return!!(e&&t instanceof v&&!u[e]&&(u[e]=t))},isValidSelector:function(e){var t=!1;return e&&s(e)&&(o.hasOwnProperty(e)||(o[e]=!/\S/.test(e.replace(/\s+|\s*[+~>]\s*/g," ").replace(/([^ ])\[.*?\]/g,"$1").replace(/([^ ])::?[a-z][a-z\-]+[a-z](?:\(.*?\))?/ig,"$1").replace(/(?:^| )[a-z0-6]+/ig," ").replace(/\\./g,d).replace(/[.#]\w[\w\-]*/g,d))),t=o[e]),t}},!0),e.StyleSheet=v},"3.16.0-ym19",{requires:["yui-base"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("content-editable",function(e,t){var n=e.Lang,r=e.Node,i="contentready",s="ready",o="p",u="blur",a="container",f="contentEditable",l="",c="focus",h="host",p="innerHTML",d="key",v="parentNode",m="paste",g="Text",y="use",b=function(){b.superclass.constructor.apply(this,arguments)};e.extend(b,e.Plugin.Base,{_rendered:null,_instance:null,initializer:function(){var e=this.get(h);e&&(e.frame=this),this._eventHandles=[],this.publish(s,{emitFacade:!0,defaultFn:this._defReadyFn})},destructor:function(){(new e.EventHandle(this._eventHandles)).detach(),this._container.removeAttribute(f)},_onDomEvent:function(e){var t;e.frameX=e.frameY=0,(e.pageX>0||e.pageY>0)&&e.type.substring(0,3)!==d&&(t=this._container.getXY(),e.frameX=t[0],e.frameY=t[1]),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,this.fire("dom:"+e.type,e)},_DOMPaste:function(e){var t=this.getInstance(),n=l,r=t.config.win;e._event.originalTarget&&(n=e._event.originalTarget),e._event.clipboardData&&(n=e._event.clipboardData.getData(g)),r.clipboardData&&(n=r.clipboardData.getData(g),n===l&&(r.clipboardData.setData(g,n)||(n=null))),e.frameTarget=e.target,e.frameCurrentTarget=e.currentTarget,e.frameEvent=e,n?e.clipboardData={data:n,getData:function(){return n}}:e.clipboardData=null,this.fire("dom:paste",e)},_defReadyFn:function(){var t=this.getInstance(),n=this.get(a);e.each(b.DOM_EVENTS,function(r,i){var s=e.bind(this._onDomEvent,this),o=e.UA.ie&&b.THROTTLE_TIME>0?e.throttle(s,b.THROTTLE_TIME):s;t.Node.DOM_EVENTS[i]||(t.Node.DOM_EVENTS[i]=1),r===1&&i!==c&&i!==u&&i!==m&&(i.substring(0,3)===d?this._eventHandles.push(n.on(i,o,n)):this._eventHandles.push(n.on(i,s,n)))},this),t.Node.DOM_EVENTS.paste=1,this._eventHandles.push(n.on(m,e.bind(this._DOMPaste,this),n),n.on(c,e.bind(this._onDomEvent,this),n),n.on(u,e.bind(this._onDomEvent,this),n)),t.__use=t.use,t.use=e.bind(this.use,this)},_onContentReady:function(t){if(!this._ready){this._ready=!0;var n=this.getInstance(),o=e.clone(this.get(y));this.fire(i),t&&(n.config.doc=r.getDOMNode(t.target)),o.push(e.bind(function(){n.EditorSelection&&(n.EditorSelection.DEFAULT_BLOCK_TAG=this.get("defaultblock"),n.EditorSelection.ROOT=this.get(a)),this.fire(s)},this)),n.use.apply(n,o)}},_getDefaultBlock:function(){return this._getHostValue("defaultblock")},_getDir:function(){return this._getHostValue("dir")},_getExtraCSS:function(){return this._getHostValue("extracss")},_getHTML:function(){var e,t;return this._ready&&(t=this.get(a),e=t.get(p)),e},_getHostValue:function(e){var t=this.get(h);if(t)return t.get(e)},_setHTML:function(t){if(this._ready){var n=this.get(a);n.set(p,t)}else this.once(i,e.bind(this._setHTML,this,t));return t},_setLinkedCSS:function(t){if(this._ready){var n=this.getInstance();n.Get.css(t)}else this.once(i,e.bind(this._setLinkedCSS,this,t));return t},_setDir:function(t){var n;return this._ready?(n=this.get(a),n.setAttribute("dir",t)):this.once(i,e.bind(this._setDir,this,t)),t},_setExtraCSS:function(t){if(this._ready){if(t){var n=this.getInstance(),s=n.one("head");this._extraCSSNode&&this._extraCSSNode.remove(),this._extraCSSNode=r.create("<style>"+t+"</style>"),s.append(this._extraCSSNode)}}else this.once(i,e.bind(this._setExtraCSS,this,t));return t},_setLang:function(t){var n;return this._ready?(n=this.get(a),n.setAttribute("lang",t)):this.once(i,e.bind(this._setLang,this,t)),t},_instanceLoaded:function(t){this._instance=t,this._onContentReady();var n=this._instance.config.doc;if(!e.UA.ie)try{n.execCommand("styleWithCSS",!1,!1),n.execCommand("insertbronreturn",!1,!1)}catch(r){}},_validateLinkedCSS:function(e){return n.isString(e)||n.isArray(e)},use:function(){var t=this.getInstance(),r=e.Array(arguments),i=!1;return n.isFunction(r[r.length-1])&&(i=r.pop()),i&&r.push(function(){i.apply(t,arguments)}),t.__use.apply(t,r)},delegate:function(e,t,n,r){var i=this.getInstance();return i?(r||(r=n,n=this.get(a)),i.delegate(e,t,n,r)):!1},getInstance:function(){return this._instance},render:function(t){var n,i,s;return this._rendered?this:(t&&this.set(a,t),container=this.get(a),container||(container=r.create(b.HTML),e.one("body").prepend(container),this.set(a,container)),this._rendered=!0,this._container.setAttribute(f,!0),n=e.clone(this.get(y)),s=e.bind(function(){i=YUI(),i.host=this.get(h),i.use("node-base",e.bind(this._instanceLoaded,this))},this),n.push(s),e.use.apply(e,n),this)},focus:function(){return this._container.focus(),this},show:function(){return this._container.show(),this.focus(),this},hide:function(){return this._container.hide(),this}},{THROTTLE_TIME:100,DOM_EVENTS:{click:1,dblclick:1,focusin:1,focusout:1,keydown:1,keypress:1,keyup:1,mousedown:1,mouseup:1,paste:1},HTML:"<div></div>",NAME:"contentEditable",NS:f,ATTRS:{dir:{lazyAdd:!1,validator:n.isString,setter:"_setDir",valueFn:"_getDir"},container:{setter:function(t){return this._container=e.one(t),this._container}},content:{getter:"_getHTML",lazyAdd:!1,setter:"_setHTML",validator:n.isString,value:"<br>"},defaultblock:{validator:n.isString,value:o,valueFn:"_getDefaultBlock"},extracss:{lazyAdd:!1,setter:"_setExtraCSS",validator:n.isString,valueFn:"_getExtraCSS"},id:{writeOnce:!0,getter:function(t){return t||(t="inlineedit-"+e.guid()),t}},lang:{validator:n.isString,setter:"_setLang",lazyAdd:!1,value:"en-US"},linkedcss:{setter:"_setLinkedCSS",validator:"_validateLinkedCSS"},node:{readOnly:!0,value:null,getter:function(){return this._container}},use:{validator:n.isArray,writeOnce:!0,value:["node-base","editor-selection","stylesheet"]}}}),e.namespace("Plugin"),e.Plugin.ContentEditable=b},"3.16.0-ym19",{requires:["node-base","editor-selection","stylesheet","plugin"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("editor-inline",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)};e.extend(n,e.EditorBase,{initializer:function(){this.plug(e.Plugin.ContentEditable)}}),e.InlineEditor=n},"3.16.0-ym19",{requires:["editor-base","content-editable"]});
YUI.add("mail-ui-mailcompose-v3",function(e){function w(){var e=this;b.superclass.ondestroy.call(e,arguments)}function E(){var e=this;return e.dirty}function S(t,n,r,i,s){var o=this,u=t?t:strings.str_comp_dialogheader;if(o.suppressDialog===!0){r();return}e.use("common-ui-dialog-helper",function(e){var t={hd:u,bd:n,suppressRestoreFocus:!0};e.common.ui.DialogHelper.confirm(t,{ok:{text:s,handler:r},cancel:{handler:function(){o._restoreFocus(),i&&i()}}})}),o.hiliteCP&&o.hiliteCP.hide(),o.textCP&&o.textCP.hide()}function x(){var e=this;return e.draft.isUploadingAttachments()?1:0}function T(e){var t=this;t.focusNode=e,t.neoFire("composeEvent",{action:"setFocusNode",focusNode:e})}function N(){var e=this;e.setFocus(e.focusNode)}function C(){this.controller.edited(),this.dirty=!0,this.resetSaveTimer(),r.features.enabled("composeActivityAdr")&&(this._cancelAdRotation(),this._lastActivityTime=Date.now(),!this.adRotationTimer&&this.get("active")&&this._startAdRotationTimer())}function k(){var e=this;e.controller.isEdited()&&(e.controller.unedited(),e.dirty=!1,e._cancelSaveTimer())}function L(){var t=this,n,r;return t.isRichText!==null?t.isRichText:(r=e.common.persist.UserData.get("userUIPref.useRichText"),n=r&&r!=="plain",t.isRichText=n,n)}function A(t){var n=this;n.isRichText!==t&&(n.isRichText=t,e.common.persist.UserData.set("userUIPref.useRichText",t?"dynamic":"plain"),setTimeout(function(){e.common.persist.UserData.saveOne("userUIPref.useRichText")},10),n.fire("isRichTextChanged"))}function O(){var t=this,n=!0,r=e.mail.Error.platform.isAvailable(),i=new Date-t.lastAutoSaveTime,s=Math.max(0,t.autoSaveTimePeriod-i);t._cancelSaveTimer(),r&&!NeoConfig.isAMT&&(t.saveTimer=e.later(s,t,function(){t.isAutoSave=!0,t.lastAutoSaveTime=new Date,t.save(),t._cancelSaveTimer()},[],!n))}function M(){var e=this;e.saveTimer&&(e.saveTimer.cancel(),e.saveTimer=null)}function _(){var t=this;if(!r.features.enabled("composeActivityAdr"))return;t._cancelAdRotationTimer(),t.adRotationTimer=e.later(h,t,function(){var e=Date.now(),n;if(!t.draft)return;n=t.draft.state,(n==="saved"||n==="unsaved")&&e>t._lastActivityTime+d&&e>t._lastAdRotateTime+p&&(t._startAdRotation(),e>t._lastActivityTime+v&&t._cancelAdRotationTimer())},null,!0)}function D(){var e=this;e.adRotationTimer&&(e.adRotationTimer.cancel(),e.adRotationTimer=null)}function P(){var t=this;t._lastAdRotateTime=Date.now(),e.fire("darlaEvent",{action:"compose_save"})}function H(){e.fire("darlaEvent",{action:"abortAdCall"})}function B(e){var t=this;e.newVal?(t._lastActivityTime=t._lastAdRotateTime=Date.now(),t._startAdRotationTimer()):t._cancelAdRotationTimer()}function j(t,n){var r=this,i=t?t:strings.str_comp_dialogheader;r.allowSend?e.use("common-ui-dialog-helper",function(e){r.allowSend=!1;var t={hd:i,bd:n,suppressRestoreFocus:!0},s=function(){r.allowSend=!0,r._restoreFocus()};e.common.ui.DialogHelper.alert(t,{ok:{handler:s},cancel:{handler:s}})}):r._restoreFocus()}function F(){this._cancelSaveTimer(),this.controller.save(this.isAutoSave)}function I(){return}function q(){var e=this;if(e.draft===null)return;e.updateSaveText(!0)}function R(){var e=this,t=e.richFontInfo,r=t.fontFamily,i=t.fontSize;return r||(r=n.getStyleFontFamily(!1)),i||(i=n.getStyleFontSize(!1)),{fontFamily:r,fontSize:i,foreColor:t.foreColor,backColor:t.backColor}}function U(){var e=this;e.isAutoSave=!1,e.save(),e.header&&e.header.hideACWidget(),e.dirty="ForceClose",e._closeAfterWarning(!0)}function z(){var n=this,r=n.areAttachmentsPending(),i='<button id="{{btnID}}ModalOverlay" class="btn left right {{default}}" role="button" data-action="{{btnID}}">{{btnLabel}}</button>';e.use("common-ui-dialog-helper",function(e){var s=t(i,{btnID:"SaveDraft","default":"default",btnLabel:strings.str_comp_savetodrafts_fresh}),o=t(i,{btnID:"DontSave",btnLabel:r?strings.str_comp_closewithoutsaving:strings.str_comp_abandon}),u=t(i,{btnID:"Continue","default":r?"default":"",btnLabel:r?strings.str_comp_returntomessage:strings.str_comp_keepwriting}),a=r?u+o:s+o+u,f=r?strings.str_comp_close_attachmentprocessing:strings.str_comp_close_confirm,h={modal_classes:"lg saveDraftDialog",hd:strings.str_comp_close,bd:f,ft:a,suppressRestoreFocus:!0},p={SaveDraft:{handler:function(){n.doSaveAndClose()}},DontSave:{handler:function(){n.header&&n.header.hideACWidget(),n.dirty="ForceClose",!n.hasHardDraft&&n.getDraftMID()&&e.use("mail-ui-proxyevents",function(){var t=l.getFolderByIndex(n.draft.folder&&n.draft.folder.id),r=t&&t.folderInfo&&t.folderInfo.fid||c;e.mail.ui.MailEventsProxy.handleUI({action:"delete"},r,null,[{fid:r,mid:n.getDraftMID(),force:!0}])}),n._closeAfterWarning(!1)}},Continue:{handler:function(){n.blockAutoSave=!1,n.cancelDialogLoad=!1,n._restoreFocus()}}},d=function(t){n.blockAutoSave=!0,t&&n.setFocus("to"),e.common.ui.DialogHelper.createCommon(h,p,function(e){e.set&&e.set("adAction","disableRetriggerOnOk")})};n.neoFire("composeEvent",{action:"showSaveDialog",sdcbk:e.bind(d,n),sdinline:n.type==="inlineCompose"})})}function W(){return this.draft.mid}function X(n){function o(){var t=e.common.Utils.features,n=t.enabled("NotificationsV2"),i=t.enabled("deleteDraftIcon"),s,o,u,a;r.getDraftMID()?e.use("mail-ui-proxyevents",function(){var t=l.getFolderByIndex(r.draft.folder&&r.draft.folder.id),n=t&&t.folderInfo&&t.folderInfo.fid||c;e.mail.ui.MailEventsProxy.handleUI({action:"delete"},n,null,[{fid:n,mid:r.getDraftMID(),force:!0}])}):i&&n&&r.dirty===!0&&(s=function(){},o={},a=[{fid:"Draft",mid:null,force:!0}],u=["Trash","Draft",a,null,"msg"],e.use("mail-ui-proxyevents",function(){e.mail.ui.MailEventsProxy.showMoveNotification(s,o,u)}))}var r=this,i=r.areAttachmentsPending(),s='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';if(!n){o();return}e.use("common-ui-dialog-helper",function(e){var n=t(s,{btnID:"Discard","default":"default",btnLabel:strings.str_comp_discard}),u=t(s,{btnID:"Continue","default":i?"default":"",btnLabel:strings.str_comp_keepwriting
}),a=i?u+n:n+u,f=i?strings.str_comp_discard_attachmentprocessing:strings.str_comp_discard_confirm,l={modal_classes:"lg",hd:strings.str_comp_deletedraft,bd:f,ft:a,suppressRestoreFocus:!0},c={Discard:{handler:function(){r.header&&r.header.hideACWidget(),r.dirty="ForceClose",o(),r._closeAfterWarning(!1)}},Continue:{handler:function(){r.blockAutoSave=!1,r.cancelDialogLoad=!1,r._restoreFocus()}}},h=function(){r.blockAutoSave=!0,e.common.ui.DialogHelper.createCommon(l,c,function(e){e.set&&e.set("adAction","disableRetriggerOnOk")})};r.neoFire("composeEvent",{action:"showDeleteDraftDialog",sdcbk:e.bind(h,r)})})}function V(t){var n=this,r=n.baseNode&&n.baseNode.one(".attachment-button-attach"),i=n.baseNode&&n.baseNode.one("#rtetext");e.UA.gecko>0&&i&&(i.focus(),i.blur()),n.cancelDialogLoad=!0,n.hiliteCP&&n.hiliteCP.hide(),n.textCP&&n.textCP.hide();if(n.dirty==="ForceClose")return!0;var s=n.isDirty()||n.getDraftMID()&&!n.hasHardDraft&&!t,o=n.areAttachmentsPending();return o&&(s=n.dirty=1),n.get("isQuickReply")?n.doDiscardDraft(s):s?a.enabled("deleteDraftIcon")&&!o?n.doSaveAndClose():n.showSaveDraftDialog():r&&r.fire("compose:close"),!s}var t=e.common.Utils.substitute,n=e.mail.Controller.ReplyProcessor,r=e.common.Utils,i=r.log,s=e.ui.Templates,o={reply_sender:strings.str_reply,reply_all:strings.str_reply,edit:strings.str_reply,forward:strings.str_forward},u=s._shared_module_compose_message_header_fresh,a=r.features,f=r.settings,l=e.mail.ui.FolderUtils,c="Draft",h=f.value("composeAdRotationCheckInterval")||3e3,p=f.value("composeAdRotationInterval")||2e4,d=f.value("composeAdRotationQuietInterval")||5e3,v=f.value("composeAdRotationIdleInterval")||3e5,m=a.enabled("attachMenuInOldToolbar",!1),g=m?!0:!1,y=a.enabled("stationeryIconPlaceholder",!1),b=function(n,r,f){var l=this,c=f&&f.showSubject;l.controller=r,l.header=new e.mail.Views.ComposeHeader(n,l),l.draft=n,l.isDraft=!l.draft.isFresh(),l.title=strings.str_comp_nosubject,l.parent=null,l.baseNode=null,l.compArea=null,l.loadingArea=null,l.type="compose",l.dirty=!1,l.focusNode=null,l.attachmentsLoading=[],l.attView=null,l.loadingTimer=null,l.allowEdit=!1,l.allowSend=!0,l.richFontInfo={fontFamily:null,fontSize:null},l.saveTimer=null,l.adRotationTimer=null,l.lastAutoSaveTime=new Date,l.hasHardDraft=!1,l.blockAutoSave=!1,l.lastSave=null,l.lastSaveType=null,l.isSending=!1,l.isRichText=null,l.isAutoSave=!1,i("#SS: mailcompose init"),l.cancelDialogLoad=!1,l.contentLoaded=!1,l.stopwatch=f?f.stopwatch:null,l.origMsgFID=f?f.fid:null,l.suppressDialog=!1,l.formatTmpl=s._shared_module_rte_well_content_format_fresh,l.handles=[],l.autoSaveTimePeriod=(NeoConfig.autoSaveInSec||120)*1e3,l.formatters={page_well_email:function(){return t(s._shared_module_rte_well_tabs_compose.base,{},l.wellTabFormatters,null,strings,s)},page_well_format:function(){return t(l.formatTmpl.base,{},l.formatters,null,strings,s)},page_well_format_fresh:function(){return t(l.formatTmpl.base,{},l.formatters,null,strings,s)},page_well_emoticons:function(){return t(s._shared_module_rte_well_content_emoticons.base,{},l.formatters,null,strings,s)},page_well_attachments:function(){return t(s._shared_module_rte_well_content_attachments.base,{},l.formatters,null,strings,s)},quick_reply_card_actions:function(){if(a.enabled("deleteDraftIcon")){var e=l.parent&&l.parent.hasClass("quickReply");return e?null:t(u.quick_reply_card_actions,{},l.formatters,0,strings,s)}return t(u.quick_reply_card_actions,{},l.formatters,0,strings,s)},show_delete_draft_icon:function(){if(a.enabled("deleteDraftIcon"))return t(s._shared_module_compose_fresh_conv.show_delete_draft_icon,{},null,null,strings,s)},quickCompose:function(){if(l.get("isQuickReply"))return t(u.quickCompose,{},0,0,strings,s)},make_reply_all:function(){if(l.get("isQuickReply"))return;var e=l.draft.origin,n=e.action,r={title:n==="reply_all"||e.fid==="Sent"?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return n!=="reply_all"&&n!=="reply_sender"?"":t(u.make_reply_all,r,0,0,strings)},make_reply_all_qr:function(){var e=l.draft.origin,n=e.action,r={title:n==="reply_all"||e.fid==="Sent"?strings.str_comp_btn_reply_sender:strings.str_comp_btn_reply_all};return n!=="reply_all"&&n!=="reply_sender"?"":t(u.make_reply_all_qr,r,0,0,strings)},spellCheckEnabled:function(){return a.enabled("spellCheck")?t(l.formatTmpl.spellCheckEnabled,{},l.formatters,null,strings,s):""},is_rtl:function(){var e;return NeoConfig.bidi?(e=strings.str_tog_loadRTLCss?l.formatTmpl.is_rtl:l.formatTmpl.is_rtl_else,t(e,{},l.formatters,null,strings,s)):""},bidi:function(){return NeoConfig.bidi?t(l.formatTmpl.bidi,{},l.formatters,null,strings,s):""},page_compose_conversation:function(){return""},compose_from_address:function(){return t(u.compose_from_address,{},l.formatters,null,strings,s)},timestamp_id:function(){return Date.now()},fromSelected:function(e){return e.isDefault?' selected="selected" class="nsel"':""},fromAddress:function(e){return typeof e=="string"?e:typeof e=="object"&&typeof e.address=="string"?e.address:""},global_path_img:function(){return NeoConfig.globalPathImg+"/u/assets/img"},display_av_logo:function(){return NeoConfig.avLogoUrl?t(s._shared_module_rte_well_content_file_count.display_av_logo,{},l.formatters,null,strings,s):""},antivirus_logo_path_img:function(){return NeoConfig.avLogoUrl},page_compose_email_else:function(){return"hidden"},reply_type:function(){var e=l.draft.origin.action;return e?o[e]:strings.str_reply},smartscroll:function(){return e.common.Utils.features.enabled("smartscroll")?s._shared_module_compose_fresh_conv.smartscroll:""},intl_fonts:function(){function n(e,n){var r=s._shared_module_rte_well_content_fontnamesize_fresh;return t(r.intl_fonts,{},{font_value:function(){return e},font_name:function(){return n}},null,strings,s)}var r="";if(strings.str_cfg_intl_fonts){var i=e.JSON.parse(strings.str_cfg_intl_fonts);e.Array.each(i,function(e){r+=n(e.value,e.name)})}return r},show_formatter_well:function(){return t(s._shared_module_rte_well_fresh_conv
.show_formatter_well,{},l.formatters,null,strings,s)},show_attachment_icon:function(){return t(s._shared_module_rte_well_fresh_conv.show_attachment_icon,{attachMenuPlus:g?t(s._shared_module_rte_well_content_attachments_fresh.attachMenuPlus,{},l.formatters,null,strings,s):"",attachMenuPlus_else:g?"":t(s._shared_module_rte_well_content_attachments_fresh.attachMenuPlus_else,{},l.formatters,null,strings,s)},l.formatters,null,strings,s)},ca_icon:function(){return a.enabled("richcompose")&&(!l.get("isQuickReply")||a.enabled("richcomposeInQuickReply"))?t(s._shared_module_rte_well_fresh_conv.ca_icon,{tooltip:g?s._shared_module_ca_openhide.tooltip:"",tooltip_else:g?"":s._shared_module_ca_openhide.tooltip_else},l.formatters,null,strings,s):""},bottomToolbar:function(){return t(s._shared_module_compose_fresh.bottomToolbar,{},l.formatters,null,strings,s)},subject_hidden:function(){return l.get("isQuickReply")&&!c?u.subject_hidden:""},less_than_IE10:function(){var n=e.UA.ie>0&&e.UA.ie<10;return n?t(u.less_than_IE10,{},l.formatters,null,strings,s):""},is_underline:function(){return NeoConfig.enableUnderline?t(l.formatTmpl.is_underline,{},l.formatters,null,strings,s):""},has_quote:function(){var e=l.draft.origin.action;if(e==="reply_sender"||e==="reply_all"||e==="edit")return t(s._shared_module_compose_message_body.has_quote,{},l.formatters,null,strings,s)},ca_active:function(){return a.enabled("richcompose")&&(!l.get("isQuickReply")||a.enabled("richcomposeInQuickReply"))?s._shared_module_compose_fresh_conv.ca_active:""},squeezeToolbar:function(){return a.enabled("squeezeToolbar")?s._shared_module_compose_fresh_conv.squeezeToolbar:""},newComposeAssitIcon:function(){return g?s._shared_module_compose_fresh_conv.newComposeAssitIcon:""},show_templates:function(){return a.enabled("cannedResponse")&&!l.get("isQuickReply")?t(s._shared_module_compose_message_header_fresh.show_templates,{},{},null,strings):""},templates_in_qr:function(){return a.enabled("cannedResponse")&&l.get("isQuickReply")?t(s._shared_module_compose_message_header_fresh.templates_in_qr,{},{},null,strings):""},stationery_icon_placeholder:function(){return m&&y?t(s._shared_module_rte_well_content_format_fresh.stationery_icon_placeholder,{},l.formatters,null,strings,s):""}},b.superclass.constructor.call(l),l.addChild(l.header),l.header.on("HeaderBase:updateSubject",function(){l.neoFire("composeEvent",{action:"updateSubject"})}),l.header.on("HeaderBase:qrCancel",function(){l.neoFire("composeEvent",{action:"qrCancel"})}),l.after("activeChange",l._afterActiveChanged,l)};e.extend(b,e.mail.ui.BaseWidget),e.mix(b.prototype,{NAME:"MailCompose",isDirty:E,_setDirty:C,_setClean:k,getHeader:function(){return this.header.getHeader()},_setHeader:function(e){this.header.setHeader(e)},areAttachmentsPending:x,resetSaveTimer:O,canClose:V,showSaveDraftDialog:z,doSaveAndClose:U,doDiscardDraft:X,getRichFontInfo:R,saveProgress:q,getDraftMID:W,_alertProblem:j,_invokeSaveDraft:I,save:F,_cancelSaveTimer:M,_closeAfterWarning:function(){},_startAdRotationTimer:_,_startAdRotation:P,_cancelAdRotationTimer:D,_cancelAdRotation:H,_afterActiveChanged:B,_registerFocus:T,_restoreFocus:N,_getTextMode:L,_setTextMode:A,confirm:S,ondestroy:w},!0),e.namespace("mail.Views").MailCompose=b},"1.0.0",{requires:["autocomplete_css","common-persist-user-data","mail-persist-meta-data","mail-controller-messages","mail-model-datastore","mail-controller-reply-processor","_shared_module_compose_message_header_fresh","mail-ui-mailcompose-base-header-v3","comms-utils","mail-ui-basewidget","editor-inline","mail-services-message-service","mail-error-v3","mail-common-utils-features","mail-common-utils-settings","mail-ui-folder-utils"]});
