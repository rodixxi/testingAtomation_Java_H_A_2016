YUI.add("_shared_module_ads_display",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_ads_display={base:'<div role="main" aria-label="{{str_msg-view_message_pane}}" class="messagepane basepane adspane"> <div class="message content"> <div aria-label="Message header" class="y-module message-header base-header"> <div class="base-msg-header"> <div aria-label="Message header" class="focusholder" tabindex="-1"></div> <h3 role="presentation"> <span class="subject" title="{{ad_subject}}">{{ad_subject}} </span> </h3> <div class="mb-sponsored-open"> {{str_mb_list_native_advertisement}} <i class="icon icon-info mb-native-info-open"> </i> </div> </div> </div> <div class="base-card"> <div class="base-card-body {{ad_fill}}"> <div class="msg-body inner" role="presentation" tabindex="0"> </div> <div class="base-card-clear"></div> </div> <div class="base-card-footer"> <div class="card-footer"></div> </div> </div> </div></div>'}},"1.0.0");
YUI.add("mail-ui-ad-toolbar",function(e){function n(e){var n=e.node||e.item,r=e.root,i=e.action,s;return!n||!r?!1:(n.get("tagName")==="A"&&(n=n.get("parentNode")),n.hasClass(t)?!1:i==="save_ad"&&r.hasClass("adSaved")?!1:!0)}function r(e){var t=this;r.superclass.constructor.call(t,e)}var t="disabled";e.extend(r,e.mail.ui.Toolbar,{buttonEnabled:n}),e.namespace("mail.ui.ad").Toolbar=r},"1.0.0",{requires:["common-ui-toolbar-base"]});
YUI.add("minty_module_toolbar_fragments_native_ad_group_rollup",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_toolbar_fragments_native_ad_group_rollup={base:'<div id="pagetoolbar" class="{{msgliststate}} threadtoolbar adspanetoolbar"> <button id="btn-delete" class="btn multimsg" aria-label="" title="{{str_delete_conv_attr}}" data-action="closemsg" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> {{mailactions}} <button id="btn-closemsg" class="btn btn-absolute btn-close-msg" aria-label="{{str_close}}" title="{{str_close}}" data-action="closemsg" tabindex="-1"> <i></i> </button></div>',mailactions:'<button id="btn-forward" class="btn onemsg forward" aria-label="" title="{{str_forward}} [{{str_menu_accel_shift_f}}]" data-action="ad-forward" tabindex="-1"> <i class="icon-forward"></i><span class="icon-text">{{str_forward}}</span> </button> <button id="native-ad-save" class="btn onemsg download" aria-label="" title="{{str_save_this_ad_to_inbox}}" data-action="save_ad" tabindex="-1"> <i class="icon-download"></i><span class="icon-text save-ib">{{str_save_ad_to_inbox}}</span> <span class="icon-text saved invisible">{{str_saved_ad_to_inbox}}</span> </button> '}},"1.0.0");
YUI.add("mail-ui-nativeads-read",function(e){var t=function(n){function o(t){var r=this,i="70,27,70+shift,46,83+shift";if(r.rendered)return;var s=e.ui.Templates._shared_module_ads_display,o;r.container=t,o=r.substituteAd(n,s),r.container.append(o),r.container.one(".msg-body").set("innerHTML",n.content),r.setToolbars(n),r.attachHandlers(r.container,n),r.set("charCodes",i),r.rendered=!0,r.on("closeChange",l),r.on("activeChange",r.handleActiveChange)}function u(t){var n=this;t.newVal&&e.one(".mb-sponsored-open").on("hover",n.showSponsoredToolTip,n.hideSponsoredToolTip)}function a(){e.mail.ui.Onboarding.closeDefaultOnboarding("sponsored_tool_tip")}function f(){e.mail.ui.Onboarding.showDefaultOnboarding({name:"sponsored_tool_tip",node:".mb-sponsored-open",pointer:"top-right",classNames:["sponsored_tool_tip"],hdText:strings.str_mb_list_native_what,bdText:strings.str_mb_list_native_hover,offset:[-177,26]})}function l(t){var n=this;t.newVal===1&&n.eventsHandler&&n.eventsHandler.forEach(function(t){e.detach(t)})}function c(t,n){var r=this,i=r.container.one("#AdlearnMore"),s=r.container.one("iframe");r.eventsHandler=[],i&&r.eventsHandler.push(i.on("click",function(){e.fire("util:ymstats",{name:"mb_list_native_ads_learnMore",tags:{bkt:NeoConfig.expBucketId}})})),s&&r.isLeadGenAd(n)&&s.on("load",function(){r.addLeadGenAddress()}),r.addInternalClickHandler(n)}function h(e){var t=this;e.clickInternalSelector&&(e.clickInternalGlobal&&t.container.one(e.clickInternalSelector).setAttribute("data-action","clickInternal"),t.eventsHandler.push(t.container.one(e.clickInternalSelector).on("click",function(t){var n,r=t.target.getAttribute("data-action")==="clickInternal"||t.currentTarget.getAttribute("data-action")==="clickInternal";r&&!t.target.getAttribute("data-click")&&e.clickInternalUrl&&(n=new Image,n.src=e.clickInternalUrl)})))}function p(){var t=this,n,r,i={};NeoConfig.imapIn?(r=e.mail.Controller.ImapIn,n=r.getCurrentAccountId(),i.name=r.getAccountAttribute(n,"sendingName"),i.email=r.getAccountAttribute(n,"email")):(i.name=s.get("userSendPref.defaultFromName"),i.email=s.get("userSendPref.defaultFromAddress")),t.postLeadsGenMessage(i)}function d(e){var t=this,i=t.container.one("iframe");try{i&&i._node.contentWindow.postMessage(e,r.extractOriginFromUrl(n.templateSrcUrl))}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-ads-nativeAdsRead:1",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-ads-nativeAdsRead:1")}}function v(e,t){var n=this,i={ad_from:e.header.from.email,ad_subject:e.header.subject,ad_to:e.header.to,ad_date:r.dateFormatter(new Date,strings.str_tog_dateformat_read_noyear_today),ad_fill:n.isLeadGenAd(e)?"native-ads-fill":""};return r.substitute(t.base,i,null,null,strings)}function m(e){return e.assetType&&e.assetType==="LEADSGEN_HTML"}function g(e){return e.assetType&&e.assetType==="VIDEO_PREVIEW"}function y(e){return m(e)||g(e)}function b(t){var n=this,i=e.ui.Templates.minty_module_toolbar_fragments_native_ad_group_rollup,s=r.substitute,o={mailactions:function(){return n.shouldHideToolbars(t)?"":s(i.mailactions,null,null,null,null,strings)}},u=s(i.base,null,o,null,null,strings),a=n.createToolbar(u);n.set("contentToolbar",a)}function w(t){var n=this,r;return r=new e.mail.ui.ad.Toolbar({template:t}),r.on("itemSelected",n.handleToolbarSelection,n),r}function E(){var t=this,n,r=e.contacts.ui.ContactsView,s,o,u;s=t.tab.prevTabId;if(s){o=i.getTabById(s);if(o&&o.widgetType==="search"){i.switchToTab(o),u=o.elContent.one("#msg-list"),u!==null&&e.UA.safari>0&&(u.addClass("toggle-to-force-repaint"),setTimeout(function(){u.removeClass("toggle-to-force-repaint")},1));return}n=r&&s===r.tab.get("id");if(n){i.switchToTab(r.tab);return}}i.switchToTab(i.tabs[0])}function S(t){var n=this,r=t?t.dataAction||t.currentTarget._node.getAttribute("data-action"):0;switch(r){case"save_ad":e.fire("nativeAd:save");break;case"ad-forward":e.fire("nativeAd:forward");break;case"closemsg":n.handlePaneClose()}}function x(t){var n=this,r=t.keyCode;switch(r){case 70:return e.fire("nativeAd:forward"),!0;case 83:return e.fire("nativeAd:save"),!0;case 27:case 46:case 8:return n.handlePaneClose(),!0;default:}}function T(){var t=this;e.fire("nativeAd:close"),e.fire("util:ymstats",{name:"mb_list_native_ads_closed",tags:{bkt:NeoConfig.expBucketId}}),NeoConfig.multitask&&!NeoConfig.tabs?(t.handleTabSwitch(),NeoConfig.backButtonFull&&e.fire("removePage")):(t.set("close",1),t.hideSponsoredToolTip())}var r=e.common.Utils,i=e.mail.Tabs,s=e.common.persist.UserData;this.rendered=!1,t.superclass.constructor.call(this),e.mix(t.prototype,{NAME:"NativeAdsRead",render:o,setToolbars:b,isLeadGenAd:m,isTrailerAd:g,shouldHideToolbars:y,createToolbar:w,addInternalClickHandler:h,addLeadGenAddress:p,postLeadsGenMessage:d,handleToolbarSelection:S,handleTabSwitch:E,handlePaneClose:T,onKeyDown:x,substituteAd:v,attachHandlers:c,detachHandlers:l,handleActiveChange:u,hideSponsoredToolTip:a,showSponsoredToolTip:f},!0)};e.extend(t,e.mail.ui.BaseWidget),e.namespace("Y.mail.ui"),e.mail.ui.NativeAdsRead=t},"1.0.0",{requires:["mail-ui-basewidget","_shared_module_ads_display","common-ui-toolbar-base","common-persist-user-data","mail-ui-ad-toolbar","minty_module_toolbar_fragments_native_ad_group_rollup","mail-ui-onboarding"]});
YUI.add("mail-ui-carouselads-read",function(e){var t=function(n){function s(e){t.superclass.render.call(i,e),i.carouselContainer=i.container.one(".native-ads-carousel")}function o(n){t.superclass.handleActiveChange.call(i,n),n.newVal?i.carouselAdTimer||(i.carouselAdTimer=e.later(r.settings.value("carousel_ad").rotationTime||5e3,i,i.rotateCarousel,null,!0)):i.carouselAdTimer&&(i.carouselAdTimer.cancel(),i.carouselAdTimer=null)}function u(n,s){t.superclass.attachHandlers.call(i,n,s),i.carouselAdTimer||(i.carouselAdTimer=e.later(r.settings.value("carousel_ad").rotationTime||5e3,i,i.rotateCarousel,null,!0))}function a(){return!0}function f(e){var t=e.target.getData("click"),n="clicked_link",r,s,o,u,a,f,c;if(t==="rotate"||t==="left"||t==="right"){e.preventDefault(),i.carouselAdTimer&&(i.carouselAdTimer.cancel(),i.carouselAdTimer=null);switch(t){case"rotate":r=e.target,c=r.getData("img-id"),n="clicked_thumb_"+c;break;case"right":case"left":o=t==="right",s=i.carouselContainer.all(".native-ads-carousel-thumb-img"),f=i.carouselContainer.one(".native-ads-carousel-main-img"),c=parseInt(f.getData("img-id"),10),c+=o?1:-1,a=o?c>=s.size():c<0,u=o?0:s.size()-1,c=a?u:c,n="clicked_thumb_nav_"+c}h(c,s,f)}l(n)}function l(t){e.fire("util:ymstats",{name:"native_ads_carousel_"+t,tags:{intl:NeoConfig.intl+(NeoConfig.partnerType?"_"+NeoConfig.partnerType:""),segmentation:NeoConfig.webEngScore}})}function c(){var e,t,n;e=i.carouselContainer.one(".native-ads-carousel-main-img"),n=i.carouselContainer.all(".native-ads-carousel-thumb-img"),t=parseInt(e.getData("img-id"),10)+1,t=t<n.size()?t:0,h(t,n,e)}function h(t,n,r){var s,o,u,a,f,l;n=n||i.carouselContainer.all(".native-ads-carousel-thumb-img"),r=r||i.carouselContainer.one(".native-ads-carousel-main-img"),s=parseInt(r.getData("img-id"),10),u=i.carouselContainer.one(".native-ads-carousel-title"),a=i.carouselContainer.one(".native-ads-carousel-description"),f=i.carouselContainer.one(".native-ads-carousel-action"),l=i.carouselContainer.one(".native-ads-carousel-beacon"),o=e.one(n.item(t)).getData(),r.set("src",o["hi-res"]),r.setData("img-id",t),u.set("text",o.title),a.set("text",o.description),f.set("text",o.action),l.set("src",o.beacon),i.carouselContainer.set("href",o.anchor),e.one(n.item(s)).removeClass("active"),e.one(n.item(t)).addClass("active"),o.action?f.removeClass("hidden"):f.addClass("hidden")}var r=e.common.Utils,i=this;t.superclass.constructor.call(this,n),e.mix(this,{NAME:"CarouselAdsRead",render:s,handleActiveChange:o,shouldHideToolbars:a,attachHandlers:u,rotateCarousel:c,carouselAdClick:f,fireCarouselAdStat:l},!0)};e.extend(t,e.mail.ui.NativeAdsRead),e.namespace("Y.mail.ui"),e.mail.ui.CarouselAdsRead=t},"1.0.0",{requires:["mail-ui-nativeads-read"]});
YUI.add("mail-ui-vd-factory",function(e){function t(){}t.prototype={dataServiceTypes:{NEWSFEED:0,GEMINI:1,CHANNEL:2,ID:3},modelTypes:{UUID:0,STREAMURL:1},viewTypes:{FOLDER:0,NFL:1,NEWSFEED:2,NATIVEAD:3,SPOTLIGHT:4},dataServiceMap:[{modulename:"mail-ui-vd-dataservice-newsfeed",classname:"vdDataServiceNewsfeed"},{modulename:"mail-ui-vd-dataservice-gemini",classname:"vdDataServiceGemini"},{modulename:"mail-ui-vd-dataservice-channel",classname:"vdDataServiceChannel"},{modulename:"mail-ui-vd-dataservice-id",classname:"vdDataServiceId"}],modelMap:[{modulename:"mail-ui-vd-model-uuid",classname:"vdModelUuid"},{modulename:"mail-ui-vd-model-stream",classname:"vdModelStream"}],viewMap:[{modulename:"mail-ui-vd-view-folder",classname:"vdViewFolder"},{modulename:"mail-ui-vd-view-nfl",classname:"vdViewNfl"},{modulename:"mail-ui-vd-view-newsfeed",classname:"vdViewNewsfeed"},{modulename:"mail-ui-vd-view-nativead",classname:"vdViewNativead"},{modulename:"mail-ui-vd-view-spotlight",classname:"vdViewSpotlight"}],create:function(t,n){return new Promise(function(r,i){var s;try{n[t]?e.use(n[t].modulename,function(e){s=new e.mail.ui[n[t].classname],s?r(s):i()}):i()}catch(o){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-video-vdfactory:1",o,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-video-vdfactory:1"),i()}})},createDataService:function(e){return this.create(e,this.dataServiceMap)},createModel:function(e){return this.create(e,this.modelMap)},createView:function(e){return this.create(e,this.viewMap)}},e.namespace("mail.ui"),e.mail.ui.vdFactory=new t},"1.0.0",{requires:["common-utils","mail-common-utils-features"]});
YUI.add("mail-ui-vd-controller",function(e){function t(){}t.prototype={initVideo:function(t,n,r){var i,s,o;return i=e.mail.ui.vdFactory.createDataService(t),s=e.mail.ui.vdFactory.createView(n),o=Promise.all([i,s]).then(function(t){var n=t[0],i=t[1];return n.init(r&&r.dataService),i.init(r&&r.view,n),t},function(){return null}),o}},e.namespace("mail.ui"),e.mail.ui.vdController=new t},"1.0.0",{requires:["mail-ui-vd-factory","common-utils","mail-common-utils-features"]});
YUI.add("mail-ui-geminivideo-ads",function(e){var t=function(n){function a(e){t.superclass.render.call(r,e),r.geminiVideoAdContainer=r.container.one(".native-ads-video"),r.videoReadView=r.container.one(".adspane"),r.videoConfig=n.videoConfig,r.thumbnail=n.thumbnail,r.videoReadView&&r.videoReadView.addClass("native-ads-video"),f(r.videoConfig,r.thumbnail)}function f(t,n){e.use("mail-ui-vd-controller","mail-track",function(e){var s;s=e.mail.ui.vdController.initVideo(e.mail.ui.vdFactory.dataServiceTypes.ID,e.mail.ui.vdFactory.viewTypes.NATIVEAD,t),s.then(function(t){var s=t[0],o=t[1],a=r.geminiVideoAdContainer,f={id:u,images:{thumbnail:n}};a&&s&&o&&(o.render(a),s.execute(f),i=o,c())})["catch"](function(){e.fire("util:ymstats",{name:"gemini_ad_video_error",tags:{agent:NeoConfig.browser},include:{bucket:!0}})})})}function l(){t.superclass.handlePaneClose.call(r),i.destroy(),i.parentNode.remove()}function c(){var e=r.geminiVideoAdContainer,t,n=r.videoConfig?r.videoConfig.view.height:270,i=r.videoConfig?r.videoConfig.view.width:480;e&&(t=e.one(".videopane"),t.setStyles({height:n+"px",width:i+"px"}))}var r=this,i,s=e.common.Utils,o=s.settings,u=o.value("trailerAdId");t.superclass.constructor.call(this,n),e.mix(this,{NAME:"GeminiVideoAds",render:a,launchVideoPlayer:f,handleVideoView:c,handlePaneClose:l},!0)};e.extend(t,e.mail.ui.NativeAdsRead),e.namespace("Y.mail.ui"),e.mail.ui.GeminiVideoAds=t},"1.0.0",{requires:["common-utils","mail-ui-nativeads-read","mail-ui-vd-controller","mail-track"]});
YUI.add("mail-ui-mb-list-native-view",function(e){var t=e.common.Utils,n=t.getSegmentData("webMail").currSegScore,r=e.mail.ui.mail,i=e.common.Utils.settings,s=e.mail.model.DataStore,o=s.Accounts,u=["gif","jpeg","jpg","png"],a=".",f="IMPR_INTERNAL",l="CLICK_INTERNAL",c="SAVE",h="SHARE",p;e.mail.ui.mbListNativeView=e.mail.ui.mbListView.extend({template:e.ui.Templates.minty_module_list_view_ad_mb_native_img_link,statName:"mbListNativeView",_postRender:function(){this.container.removeClass("hidden"),this._detach(),this._bindAdClick(this.container),this._bindVideoCallback(this.container),this._statNativeAdImpression()},_preRender:function(){this.fbView&&(this.fbView.end(),this.fbView=null),this.fbActive=!1},_initComplete:function(){this._statNativeAdImpression()},_adEventHandler:function(){var e=this;e.isAdRotationEnabled()&&(!NeoConfig.vertPane||t.features.enabled("mbListNativeViewVertPrvPn"))&&(this.model.execute(),this.stat("renderAttempt"))},_bindAdClick:function(e){e!==null&&(this.readHandler=e.delegate("click",function(e){this._handleClickDataAction(e)},".mb-native-ad",this))},_bindVideoCallback:function(e){var t=this,n=e.one(".mb-list-video"),r=t.model.currentAds[0]?t.model.currentAds[0]:NeoConfig.moneyball,i,s,o;n!==null&&(o=n.getDOMNode(),s=e.one(".video-overlay"),o&&o.play(),o.onended=function(){s.removeClass("hidden")}),r.asset_usagetype==="VIDEO_PREVIEW"&&r.asset_type!=="video/mp4"&&(i=e.one(".img-play-icon"),i.removeClass("hidden"))},_fireClickBeacon:function(){var e=this,t=new Image,n;n=e.model.currentAds[0]?e.model.currentAds[0]:NeoConfig.moneyball,t.src=n.click_url},_fireActionBeacon:function(e){var t=this,n,r;r=t.model._getActionBeacon(t._getCurrentAd(),e),r&&(n=new Image,n.src=r)},_getAdHtml:function(n){var r=n[0],i=NeoConfig.vertPane&&t.features.enabled("mbListNativeViewVertPrvPn");return t.features.enabled("mbListNativeView")&&!i?this.template=e.ui.Templates.minty_module_list_view_ad_mb_native_img_link:this.template=e.ui.Templates.minty_module_list_view_ad_mb_native_vert_prev,this.substituteWithConditionals(this.template,r)},_removeAd:function(){var e=this,n=e.container;n.remove(),t.features.enabled("mbAdFeedback")||(NeoGV.mbToggle=!0)},_startFeedback:function(){var r=this,i=r.model.currentAds[0]?r.model.currentAds[0].feedback_beacon:NeoConfig.moneyball.feedback_beacon;if(!t.features.enabled("mbAdFeedback")||!i){r._removeAd();return}if(r.fbActive)return;r.fbActive=!0,e.fire("stopAdRotation"),e.use("minty_module_list_view_ad_mb_native_feedback","mail-ui-mb-feedback-view",function(e){try{var t={template:e.ui.Templates.minty_module_list_view_ad_mb_native_feedback,fb:NeoConfig.vertPane?"vertical":"horizontal",ack:e.common.Utils.features.enabled("mailProEligible")?"feedback_ack_upsell":"feedback_ack"},i={done:"mb-done-button",option:"mb-option",select:"mb-select",comment:"mb-comment",upgrade:"mb-upgrade"},s={end:r._endFeedback};e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_attempt",tags:{segmentation:n},include:{bucket:!0}}),r.fbView||(r.fbView=new e.mail.ui.mbFeedbackView(r)),r.fbView.start(t,i,s)||(r.enableAdRotation(),e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_failure",tags:{status:"failure",segmentation:n},include:{bucket:!0}})),r._removeAd()}catch(o){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-moneyball-mbListNativeView:1",o,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-moneyball-mbListNativeView:1"),r.enableAdRotation(),e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_failure",tags:{status:"failure",segmentation:n},include:{bucket:!0}})}})},_endFeedback:function(t,n){var r=t;r.enableAdRotation(),r.fbActive=!1,n||e.fire("mbEvent:rotate")},_bindEvents:function(){var r=this,i;e.mail.ui.mbListView.prototype._bindEvents.call(this),this._bindAdClick(this.container),this._bindVideoCallback(this.container),e.on("nativeAd:save",function(){var t=this._getNativeAdMailTemplate(p);e.fire("util:ymstats",{name:"mb_list_native_ads_save_to_inbox_clicked",tags:{status:"clicked",segmentation:n},include:{bucket:!0}}),t.then(function(e){r._emailAd(p,e,!0)},function(){})},this),e.on("nativeAd:forward",function(){e.fire("util:ymstats",{name:"mb_list_native_forward_clicked",tags:{segmentation:n},include:{bucket:!0}}),this._forwardNativeAd()},this),e.on("stopAdRotation",function(){this.stopAdRotation()},this),e.on("nativeAd:close",function(){r.enableAdRotation(),r.frwdClicked=!1,r.isPrevPaneAdsPane=!0}),t.features.enabled("mbListNativeView")&&e.before("tabChange",function(){var t=e.mail.Tabs.getActiveTab().widget;if(t.type==="adspane")r.isPrevPaneAdsPane=!0;else if(t.type!=="adspane"&&!r.frwdClicked||t.fid!==r.srcFid||t.type!=="convlist"&&t.type!=="messagelist")r.enableAdRotation(),r.isPrevPaneAdsPane=!1}),e.after("tabChange",function(){if(t.features.enabled("mbListNativeView")){var n=e.mail.Tabs.getActiveTab().widget;r.isPrevPaneAdsPane&&n.fid===r.srcFid&&(n.type==="convlist"||n.type==="messagelist")&&(r.enableAdRotation(),r.isPrevPaneAdsPane=!1)}}),i=e.mail.ui.Workspace.getMessageList(),i&&i.on("fidChange",function(){r.enableAdRotation()})},_getTemplateUrl:function(e,n){var r;return t.features.enabled("mbTemplatePreview")?(r=t.settings.value("mbCreativeFile")||"main.html","https://s.yimg.com/nq/ads/mb/native/"+n+"/"+r):e.asset_url},_getServerTemplate:function(t){return e.fire("util:ymstats",{name:"mb_list_native_ads_template_fetch",tags:{segmentation:n},include:{bucket:!0}}),new Promise(function(r,i){function s(t,s){var o=s?s.status:"";o&&o===200&&s.responseText?r({base:s.responseText}):(e.fire("util:ymstats",{name:"mb_list_native_ads_template_failure",tags:{segmentation:n},include:{bucket:!0}}),i())}function o(){e.fire("util:ymstats",{name:"mb_list_native_ads_template_failure",tags:{segmentation:n},include:{bucket:!0}}),i()}e.io(t,{on:{success:s,failure:o},method:"GET",timeout:1e4})})},_isImageTemplate:function(e){var t;return!e||e.lastIndexOf(a)===-1?!1:(t=e.split(a).pop().
toLowerCase(),u.indexOf(t)!==-1)},_isLeadsGenTemplate:function(e){return e.asset_usagetype&&e.asset_usagetype==="LEADSGEN_HTML"?!0:!1},_isCarouselAdTemplate:function(e){return!!t.features.enabled("carouselAd")&&!!e.carousel},_getImageTemplate:function(n,r){var i=t.substitute(e.ui.Templates.minty_module_list_view_ad_mb_native_sponsored_img.base,{image_url:n,click_url:r});return Promise.resolve({base:i})},_getVideoTemplate:function(n,r){var i=t.substitute(e.ui.Templates.minty_module_list_view_ad_mb_native_sponsored_video.base,{click_url:r,source:n.ad_source,description:n.ad_summary,action:n.video_asset_action});return Promise.resolve({base:i})},_getLeadsGenTemplate:function(n){var r=t.substitute(e.ui.Templates.minty_module_list_view_ad_mb_native_sponsored_leadsgen.base,{leadsGenUrl:n});return Promise.resolve({base:r})},_getCarouselAdTemplate:function(n){var r,i,s,o=t.settings.value("carousel_ad"),u=e.ui.Templates.minty_module_list_view_ad_mb_native_sponsored_carousel;if(n&&n.carousel&&typeof n.carousel=="string")try{n.carousel=JSON.parse(n.carousel),n.assetType=n.assetType||"MULTI_IMAGE_"}catch(a){return typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-moneyball-mbListNativeView:2",a,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-moneyball-mbListNativeView:2"),Promise.reject(a)}return r=n.carousel.map(function(e,n){return s=e.beacon.replace(o.beaconReplace,o.beaconValue+n),t.substitute(u.thumbs,{imgSrc:e.secHqImage.url,hiRes:e.secHqImage.url,imgId:n,title:e.headline,description:e.summary,action:e.callToAction||"",beacon:s,clickUrl:e.clickUrl,isActive:n===0?"active":""})}).join(""),i=n.carousel[0],s=i.beacon.replace(o.beaconReplace,o.beaconValue+"0"),u.base=t.substitute(u.base,{imgSrc:i.secHqImage.url,imgId:"0",title:i.headline,description:i.summary,hasAction:i.callToAction?"":"hidden",action:i.callToAction||"",sponsor:n.ad_source,thumbs:r,clickUrl:i.landingPageUrl,beacon:s}),Promise.resolve({base:u.base})},_getNativeAdMailTemplate:function(e){var t=this,n,r,i,s=".msg-body",o=!0,u;return n=t.model._getCreativeId(e),r=t._getTemplateUrl(e,n),t._isImageTemplate(r)?(i=t._getImageTemplate(r,e.click_url),o=!1):(u=t._isLeadsGenTemplate(e))||t._isCarouselAdTemplate(e)?(i=u?t._getLeadsGenTemplate(r):t._getCarouselAdTemplate(e),s=u?null:".native-ads-carousel-container"):e.video_assets?i=t._getVideoTemplate(e,e.click_url):i=t._getServerTemplate(r),i.then(function(t){return t.clickInternalGlobal=o,t.clickInternalSelector=s,t},function(){return Promise.reject(null)})},_forwardNativeAd:function(){var n=this,r=e.ui.Templates.minty_module_ads_native_ad_forward,i=n._getNativeAdMailTemplate(p);i.then(function(i){n.frwdClicked=!0,n._fireActionBeacon(h),e.fire("newMessage",{cbfn:function(e){var n={},s;return s=t.substitute(r.base,null,null,null,strings),n.subject=t.substitute(strings.str_native_forward,null,null,null,p),s+=t.substitute(i.base,p,null,null,strings),e.setHeader(n),e.setBody(null,s),!0}})},function(){})},_handleClickDataAction:function(t){var r=this,i=t.target&&t.target.getAttribute("data-action"),s,o,u;p=r.model.currentAds[0]||NeoConfig.moneyball;switch(i){case"mb-redirect":t.preventDefault(),r._handleRedirect();break;case"menu":t.preventDefault(),s=t.target.ancestor(".mb-sub-header"),s&&r.showAdMenu(s);break;default:o=r._getCurrentAd();if(r.anchorSimulate){r.anchorSimulate=!1;return}if(!r.model._isSponsoredAd(o))return;t.preventDefault(),u=r._getNativeAdMailTemplate(o),u.then(function(i){i&&(o.video_assets||r._fireClickBeacon(),r._fireActionBeacon(f),r._openAd(o,i),e.fire("util:ymstats",{name:"mb_list_native_ads_open_clicked",tags:{segmentation:n},include:{bucket:!0}}))},function(){r._openAdLink(o,t.target)})}},_openAdLink:function(e,t){var n=t.ancestor("a");n&&(this.anchorSimulate=!0,n.simulate("click"))},_autoFillSponsoredForm:function(e){var t=o.getPrimaryAccount(),n,r;n=document.createElement("div"),n.innerHTML=e,r=n.getElementsByTagName("input");for(var i=0;i<r.length;i++)r[i].name==="fullname"&&t.sendingName?r[i].defaultValue=t.sendingName:r[i].name==="email"&&t.email&&(r[i].defaultValue=t.email);return n.innerHTML},_openAd:function(n,r){var s=this,o,u,a,f,c,h;n&&(e.fire("stopAdRotation"),a=s._isCarouselAdTemplate(n),n.video_assets?(s._fireStat("mb_list_native_ads_watch_clicked"),c="mail-ui-geminivideo-ads",h="GeminiVideoAds",f=s._getVideoConfig(n)):(c=a?"mail-ui-carouselads-read":"mail-ui-nativeads-read",h=a?"CarouselAdsRead":"NativeAdsRead"),o=t.substitute(r.base,n,null,null,strings),o=s._autoFillSponsoredForm(o),e.use(c,function(e){var t={subject:n.ad_headline,from:{email:i.value("mbNativeSender"),name:n.ad_source},to:"me"},c={fid:"Inbox",tabKey:"mid",header:t,content:o,assetType:n.asset_usagetype,clickInternalUrl:s.model._getActionBeacon(n,l),templateSrcUrl:n.video_assets?"":s._getTemplateUrl(n,""),clickInternalSelector:r.clickInternalSelector,clickInternalGlobal:r.clickInternalGlobal,videoConfig:f,thumbnail:n.hq_image?n.hq_image:""},p=new e.mail.ui[h](c),d={p_label:t.from.name,s_label:t.subject,s_labelDir:"",widget:p,widgetType:"adspane",isRemovable:!0,forcePane:0},v;p.type="adspane",p.set("title",d.s_label),u=e.mail.ui.Workspace.addContentWidget(d),v=p.container,a&&(v.delegate("click",p.carouselAdClick,".native-ads-carousel"),p.fireCarouselAdStat("rendered")),v.delegate("submit",function(t){return t.preventDefault(),s._fireStat("mb_list_native_ads_form_click"),e.mail.ui.Warnings.showFormWarning(this,function(e){e?s._fireStat("mb_list_native_ads_form_submit_click"):s._fireStat("mb_list_native_ads_form_cancel_click")}),!1},"form")}))},_getVideoConfig:function(t){var n,r={},s,o=t&&e.Lang.isArray(t.video_assets)?t.video_assets[0]:[];return t.action_beacons&&Object.keys(t.action_beacons).forEach(function(e){s=t.action_beacons[e],r[e]=[s]}),n={view:{autoplay:!0,html5:"raw",site:i.value("yql_video_config_site"),expName:i.value("trailerAdVideoConfigExpName"),lang:NeoConfig.lang,region:NeoConfig.intl,mute:!0,rootNodeSelector
:".videopane",spaceId:NeoGV&&NeoGV.sp?NeoGV.sp:"978500286",width:o.width?o.width:480,height:o.height?o.height:270,replayonlyendscreen:!0,yvap:{standaloneAd:{gemini:{mediaInfo:[o],clickUrl:t.click_url},rules:{viewabilityDefVideo:{d:3,p:50}},beacons:r}}}},n},_emailAd:function(i,s,o){var u=this,a=NeoConfig.accounts.primaryAccount&&NeoConfig.accounts.primaryAccount[0];if(i){var f={subject:i.ad_headline,from:a,to:[],cc:[],bcc:[],replyto:a},l=t.substitute(s.base,i,null,null,strings),h=i.ad_summary||"",p;p=r.saveEmailToInbox(f,l,h,o),p.then(function(){u._changeTbState(),u._fireActionBeacon(c)},function(){e.fire("util:ymstats",{name:"mb_list_native_ads_save_to_inbox_failure",tags:{status:"failure",segmentation:n},include:{bucket:!0}})})}},showAdMenu:function(n){var r=this;e.use("_shared_module_offscreen_bin_menus_moneyball_ad_feedback","common-ui-menu-helper",function(e){var i=e.ui.Templates._shared_module_offscreen_bin_menus_moneyball_ad_feedback,s,o;o=e.one("#mbAdActionsMenu"),o||(s=t.substitute(i.base,null,null,null,strings),o=e.one("body").appendChild(e.Node.create(s))),e.common.ui.MenuHelper.create(n,{menu:o,flushLeft:!1,alignToTarget:!0},function(){o.on("menuSelected",e.bind(r._onMenuSelected,r))})})},_onMenuSelected:function(e){var t=this;switch(e.dataAction){case"choices":t._handleRedirect();break;case"feedback":t._startFeedback();break;default:}},_handleRedirect:function(){var e=this._getCurrentAd(),t=e&&e.ad_choices_url?e.ad_choices_url:strings.str_cfg_url_about_adchoices;window.open(t,"_blank")},_changeTbState:function(){var t=e.one(".adspanetoolbar"),n,r;t&&(n=t.one(".save-ib"),r=t.one(".saved"),n&&(t.addClass("adSaved"),n.addClass("hidden"),r.removeClass("invisible")))},_detach:function(){this.readHandler&&this.readHandler.detach()},_statNativeAdImpression:function(){var e=this,t=this._getCurrentAd(),n=this.container&&this.container.one(".mb-list-ad");n&&t&&this.model._isSponsoredAd(t)&&(t.video_assets?e._fireStat("mb_list_sponsored_video_ad_rendered"):e._fireStat("mb_list_sponsored_ad_rendered"))},_fireStat:function(t){e.fire("util:ymstats",{name:t,tags:{segmentation:n},include:{bucket:!0}})}})},"1.0.0",{requires:["mail-ui-mb-list-view","minty_module_list_view_ad_mb_native","minty_module_ads_native_ad_forward","minty_module_list_view_ad_buckets_mb_right_rail_save_ad","minty_module_list_view_ad_mb_native_sponsored_img","minty_module_list_view_ad_mb_native_sponsored_video","minty_module_list_view_ad_mb_native_sponsored_leadsgen","minty_module_list_view_ad_mb_native_sponsored_carousel","minty_module_offscreen_bin_native_ad_callout","minty_module_offscreen_bin_native_ad_star","mail-ui-onboarding","mail-common-utils-features","mail-common-utils-settings","_shared_module_offscreen_bin_notification_native_ad_star","mail-ui-mail-helper","common-ui-tabs-base","common-net-sessionmgr","mail-ui-nativeads-read","mail-ui-carouselads-read","mail-ui-geminivideo-ads","_shared_module_offscreen_bin_modal_subscriptionad"]});
YUI.add("mail-ui-mb-controller",function(e){var t=function(){},n=e.common.Utils;t.prototype={init:function(){return this.isMoneyballEnabled()&&this._initViews(),this},_initViews:function(){NeoConfig.mbSectionId&&n.features.enabled("mbListNativeView")&&(new e.mail.ui.mbListNativeView).init({viewType:"native_view"}),NeoConfig.mbBackfillSearchAd&&NeoConfig.mbSearchSectionId&&(new e.mail.ui.mbSearchListView).init(),NeoConfig.enableTL1Fallback&&NeoConfig.mbLeftRailSectionId&&e.use("mail-ui-mb-rec-view",function(e){(new e.mail.ui.mbRecView).init()}),NeoConfig.mbBackfillRightRail&&NeoConfig.mbRightRailSectionId&&(/^CMUSGRRRC\d{2}$/.test(NeoConfig.expBucketId)?e.use("mail-ui-mb-right-rail-carousel-view",function(e){(new e.mail.ui.mbRightRailCarouselView).init()}):e.use("mail-ui-mb-right-rail-view",function(e){(new e.mail.ui.mbRightRailView).init()})),NeoConfig.mbOnMsgRead&&NeoConfig.mbMsgReadSectionId&&e.use("mail-ui-mb-msg-read-view",function(e){(new e.mail.ui.mbMsgReadView).init()})},isMoneyballEnabled:function(){return NeoConfig.moneyballEnabled&&NeoConfig.hasAds},isAffiliateDaypartingEligible:function(){var e=(new Date).getHours();return!n.features.enabled("affiliateAdsDayParting")||n.features.enabled("affiliateAdsDayParting")&&n.settings.value("affiliate_dayparting_hours").indexOf(e)!==-1?!0:!1}},e.namespace("mail.ui"),e.mail.ui.mbController=t},"1.0.0",{requires:["mail-ui-mb-list-view","mail-ui-mb-search-list-view","mail-ui-mb-list-img-view","mail-common-utils-features","mail-ui-mb-list-native-view"]});
YUI.add("comms-utils-stack-tracer",function(e){function r(e){var t,n,r,i=[],o=[],u=arguments;try{while(!r&&(t=u.caller?u.caller.callee:u.callee.caller)){o.length>50&&(r="*** stack too deep, stopping");for(n=0;n<i.length;n++)t===i[n]&&(r="*** recursion, stopping");u=t.arguments,i.push(t),o.push(r||s(t))}}catch(a){o.push("*** error going to next level, may be the end of the JS stack")}e.depth=o.length,e.stack=o.join(" >> ")}function i(e){var t=[],n=e.stack.split(/\r\n|\r|\n/);e.depth=n.length,n.forEach(function(e){var n=e.split("@");n.length===2?t.push("at "+n[0]+"("+n[1]+")"):t.push(e)}),e.stack=t.join("\n")}function s(e){var t,n,r;try{n=e.toString(),r=n.match(/function\s+([^\s(]+)/),r&&r.length>1&&(t=r[1])}catch(i){}return t=t||"{?}",t=t.replace(/^(\s+)?(.*\S)(\s+)?$/g,"$2"),t}var t,n=e.namespace("comms.utils.StackTracer");n.getStack=function(e){return e=e||new Error,e.fileName&&i(e),e.stack===undefined&&r(e),e.lineNumber=e.lineNumber||e.line,e.fileName=e.fileName||e.sourceURL,e.stack},n.depth=function(){var e=new Error;return t=1,n.getStack(e),t=0,e.depth-1}},"1.0.0");
YUI.add("common-utils-error",function(e){var t,n=0,r=["A network error occurred","A redirection problem occurred","Problema de redirecci\u00f3n","Houve um problema de redirecionamento","Un probl\u00e8me de redirection s\u2019est produit"];t=function(){function t(){var t,r=arguments,o,u,a,f,l,c,h=[],p=[],d,v="debug_jsexception",m=e.common.Utils.settings.value("JseSplunkLogLevel",{"default":"sample"}),g=NeoConfig.browser&&NeoConfig.browser.split("_")[0]||"unknown",y=e.mail.ui.Recorder,b=0;while(b<r.length)t=r[b++],typeof t=="string"?h.push(t):t instanceof Error?f=t:p.push(t);u=h[0]||"",a=i(h[1],u,f),l=f?f.name+":"+f.message:"";try{p[1]&&f&&(c=e.comms.utils.StackTracer.getStack(f))}catch(w){}a!=="CUSTOM"&&(a==="WONTFIX"?o="jsexception_wontfix":n<1e3?(o="jsexception",n++):n===1e3&&(o="jsexception_overlimit",n++)),o&&e.fire("util:ymstats",{name:o,tags:{type:a,browser:g,mp:!NeoConfig.hasAds},include:{env:!0}}),d={type:a,message:u,exceptionMessage:l,count:n,failedModules:s(),corpmail:NeoConfig.isCorpmail?1:0,stack:c&&c.split("\n")||[]},p[3]||(a==="CUSTOM"?v="debug_customexception":a==="WONTFIX"&&(v="debug_wontfixexception"),m=m[a]||m["default"],e.fire("SplunkLog",v,d,m)),p[2]&&e.common.Utils.features.enabled("showPinkbox")&&e.use("common-utils-pinkbox",function(e){d.errorObj=f,e.common.Utils.pinkBox.show(d)}),y&&y.getLastClickSig(!0)}function i(t,n,i){var s=i?i.name+":"+i.message:"",o=e.common.Utils.settings.value("JSE_WONTFIX"),u;if(s)for(u in r)if(s.indexOf(r[u])>-1)return"NetworkError";if(s&&(s.indexOf("A network error occurred")>-1||s.indexOf("A redirection problem occurred")>-1))return"NetworkError";if(s&&s.indexOf("TypeError:this is not a Date object")>-1)return"Fixdate";if(NeoConfig.isCorpmail&&n.indexOf("Missing Module: tictac-att")>-1&&e.one(".jiveAnywhereResetCss"))return"WONTFIX";if(/[A-Z0-9]{32}\/[A-Z0-9\-]{36}\/main\.js/g.test(n)&&s&&s.indexOf("SyntaxError:JSON syntax error")>-1)return"WONTFIX";if(o){if(e.Lang.isArray(o.message))for(u in o.message)if(n.indexOf(o.message[u])>-1)return"WONTFIX";if(e.Lang.isArray(o.exceptionMessage)&&s)for(u in o.exceptionMessage)if(s.indexOf(o.exceptionMessage[u])>-1)return"WONTFIX"}return t||"CUSTOM"}function s(){var e,t,n=[];try{t=globals.failures;for(e in t)n.push(e+":"+t[e]);n.sort(),n=n.join(", ")}catch(r){n=r.toString()}return n}e.mix(this,{report:t,getErrorType:i})},e.namespace("common.Utils").error=new t,typeof globals=="undefined"&&(globals={}),globals.report=e.common.Utils.error.report},"1.0.0",{requires:["mail-common-utils-features","mail-common-utils-settings","common-ui-tabs-base","comms-utils-stack-tracer","ymma-stats","mail-ui-recorder"]});
YUI.add("mail-ui-log",function(e){function u(t){t=t||{},this._sessionLogger=e.comms.log4js.getLogger("_sessionLogger",1,"ajax",{jsonReq:!0}),this._logger=[],this._logTimer={},this.FLUSH_LIMIT=t.FLUSH_LIMIT||s,this.LOG_LIMIT=t.LOG_LIMIT||o,this.events=t.events||{},this.tid=NeoConfig.loginId+n.rand(1e6),this._lastFlushed=0,this._index=0}function a(){var t=this;e.each(t.events,function(n,r){e.on(r,function(){try{n.apply(t,arguments)}catch(e){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-debug-maillog:1",e,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-debug-maillog:1"),t.add({m:"Logger Exception"},1,"JSException")}})}),e.one(window).on("beforeunload",function(){t.flush()})}function f(t){if(i.enabled("autoCheckNetwork")&&!NeoGV.isOnline)return;var n=new Date;this._logger.length===this.LOG_LIMIT&&(this._logger.shift(),this._lastFlushed=this._lastFlushed-1>0?this._lastFlushed-1:0),this._logger.push(e.JSON.stringify({t:n.toTimeString().substr(0,8)+":"+n.getMilliseconds(),d:t}))}function l(n,i){var s=this;s._logTimer[n.key]&&s._logTimer[n.key].cancel(),s._logTimer[n.key]=e.later(n.time||t,n.context,function(){var e=!1;n.onTimeout&&(e=!n.onTimeout.apply(n.context||null)),e||(s.add(n.data),r.stat("TimeoutError","reason=>"+n.key.split(":")[0]),s.flush(n.key)),i&&i.detach()})}function c(){this._logger=[],this._lastFlushed=0,this._index=0}function h(){var e=window.open("","","width=650,height=700,resizable"),t=e.document;return t.open(),t.write('<html><body><div id = "reason"></div><div id = "extraInfo"></div><div id = "logs"></div></body></html>'),e}function p(){var e=window.open("","","width=650,height=700,resizable"),t=e.document;return t.open(),t.write('<html><body><textarea id = "hardetails" rows="50" cols="80"></textarea></body></html>'),e}function d(){var e=window.open("","","width=1000,height=700,resizable"),t=e.document;return t.open(),t.write('<html><head><script>function createWF(res) {var _yr= "https://s.yimg.com/zz/combo?os/mit/media/p/content/'+NeoConfig.yaft_report_js_version+'",_yrs = document.createElement("script");'+'_yrs.src = _yr; _yrs.type ="text/javascript";'+"_yrs.onload = function(){ YAFT_REPORT.drawWaterfall(res); };"+"document.body.appendChild(_yrs);"+"}"+"</script>"+"</head><body></body></html>"),e}function v(){var t=this._prepareLog("Console Print"),n,r="getElementById",i,s="";this.logW&&this.logW.opener&&!this.logW.opener.closed||(this.logW=this._createUI()),n=this.logW.document,n[r]("reason").innerHTML=t.reason,n[r]("extraInfo").innerHTML=e.JSON.stringify(t.info);for(i=0;i<t.logs.length;i++)s+="<div>"+t.logs[i]+"</div>";n[r]("logs").innerHTML=s}function m(){var e=this,t={tid:e.tid,yid:NeoConfig.loginId,browser:NeoConfig.browser,build:NeoConfig.buildNumber,url:location.toString(),hasConv:NeoConfig.hasConvView,mailplus:NeoConfig.hasAds?"0":"1",bucket:NeoConfig.expBucketId,isWinApp:NeoConfig.isWinApp?!0:!1};return t}function g(t){if(NeoConfig.log_error_yapache){var n=this;t=t||"MailLog",n._sessionLogger.log(e.JSON.stringify(n._prepareLog(t,n.FLUSH_LIMIT))),n._lastFlushed=n._logger.length}}function y(t){var n=this,r=e.on(t.event,function(){t.condition.apply(t.context||null,arguments)&&(n._logTimer[t.key]&&n._logTimer[t.key].cancel(),r.detach())});n._addTimer(t,r)}function b(e,t){var n=this,r,i=[],s,o,u=n._logger.length;t?(u-n._lastFlushed<t?o=n._lastFlushed:o=u-t,o<0&&(o=0)):o=0;for(r=o;r<u;r++)i.push(this._logger[r]);return s={reason:e,info:this._getExtraLogInfo(),logs:i,index:n._index},n._index=n._index+i.length,s}function w(){this.waterFallW&&this.waterFallW.opener&&!this.waterFallW.opener.closed||(this.waterFallW=d()),YAFT.data&&YAFT.data.length&&this.waterFallW.createWF(YAFT.data[0])}function E(){this.harW&&this.harW.opener&&!this.harW.opener.closed||(this.harW=p()),YAFT.data&&YAFT.data.length&&(this.harW.document.getElementById("hardetails").value=e.JSON.stringify(YAFT.data[0].har))}function S(){var e=NeoConfig.launchPVID.replace(/[^a-zA-Z]/g,""),t=e.length,n,r="";for(n=8;n<t;n++)n%2===0&&(r+=e.charAt(n));return r}function x(e){YAFT.init({modules:["shellnavigation-inner","storm-listnav","shellcontent","nav","yucs-top-bar","yucsHead","slot_"],modulesExclude:["yucs-",NeoConfig.ccAb&&S()||"slot_MB"],canShowVisualReport:0,useNativeStartRender:!0,generateHAR:!0,maxWaitTime:200},function(t,n){n||(window.YAFT.data=[],YAFT.data.push(t),e())})}function T(e){if(window.YAFT&&window.YAFT_REPORT&&window.YAFT.data&&window.YAFT.data.length)e();else{var t="https://s.yimg.com/zz/combo?os/mit/media/p/content/"+NeoConfig.yaft_js_version+"&os/mit/media/p/content/"+NeoConfig.yaft_report_js_version,n=document.createElement("script");n.src=t,n.type="text/javascript",n.onload=function(){x(e)},document.body.appendChild(n)}}function N(){T(w)}function C(){T(E)}var t=15e3,n=e.common.Utils,r=n.ymmastats,i=n.features,s=200,o=1e3;e.mix(u.prototype,{flush:g,print:v,printWaterfall:N,printHAR:C,bindEvents:a,add:f,addFlow:y,reset:c,_createUI:h,_addTimer:l,_getExtraLogInfo:m,_prepareLog:b}),e.namespace("mail.ui").MailLog=u},"1.0.0",{requires:["ymma-stats","comms-log4js","common-utils","mail-common-utils-features"]});
YUI.add("mail-ui-log-events",function(e){function i(e,t,n){this.add(e),t&&n&&this.flush(n)}function s(e,t,i){if(typeof e!="string"||typeof t!="object")return;var s=NeoConfig,o={timestamp:Date.now(),key:e,farm:s.farm,browser:s.browser,bucket:s.expBucketId,build:s.buildNumber,env:s.mailEnv,remoteIP:s.remoteIp,uuid:s.uuid,yid:s.loginId};n.features.enabled("SplunkLog_"+(i||"sample"))&&(o.d=t,r.add(o))}function o(){this.print()}function u(e){e&&e(this._prepareLog())}function a(e,t,n){this.reset(),i.call(this,e,t,n)}function f(t,n){var r=[];e.each(n,function(e){r.push(e.mid)}),this.add({m:"Load Message Cards Start",cid:t.cid,fid:t.fid,mids:r.join(", ")})}function l(e){var t=this,n;if(!e)return;n={m:"Mail open",fid:e.fid,subject:e.message.subject},e.message.cid?n.cid=e.message.cid:n.mid=e.message.mid,t.add(n),NeoConfig.hasConv&&e.message.cid!==""&&t.addFlow({event:"MessagePane:rendered",key:"mailOpenFail:"+n.cid,condition:function(e,r){return t.add({m:"MessagePane rendered",fid:r.fid,subject:r.subject,cid:r.cid}),r.cid===n.cid},data:{m:"TimeoutError: Mail open failed for "+n.cid+":"+n.subject}})}function c(e){var t=this,n=e.mid;t.add({m:"Expand Click Start",mid:e.mid}),t.addFlow({event:"MessagePane:messageExpandDone",key:"msgExpandFail"+n,time:5e3,condition:function(e){return n===e.mid},data:{m:"TimeoutError: Expand message failed"}})}function h(t){var n=[];e.each(t,function(e){n.push(e.mid)}),this.add({m:"Load Message Success Start",mids:n.join(", ")})}function p(t){var n=[];e.each(t,function(e){n.push(e.mid)}),this.add({m:"Message Controller getMultipleMessages",mids:n.join(", ")})}function d(t){var n=[];e.each(t,function(e){n.push(e.mid)}),this.add({m:"Message Controller getMultipleMessagesSuccess",mids:n.join(", ")})}function v(e,t){this.add({m:"Set pending request variable",pending:e,reason:t}),e===1&&this.addFlow({event:"BaseController:pending",key:"pendingReq",time:31e3,condition:function(e){return e?!1:!0},data:{m:"TimeoutError: Pending is still set to 1 after 31 seconds"}})}function m(e,t,n){var r=[],i=[],s;for(s=0;s<e.length;s++)r.push(e[s].method);if(t){for(s=0;s<n.length;s++)n[s].method&&i.push(n[s].method);this.add({m:"Not executing batch request",methods:r.join(", "),waitingMethods:i})}else this.add({m:"Executing batch request",methods:r.join(", ")})}function g(t,n){var r=this,i=t.cid,s;t.totalUnread!==n.totalUnread&&(t.totalUnread===0||n.totalUnread===0)&&(t.totalUnread===0?(r.add({m:"Conversation changing state from read to unread in ConvStore",cid:i}),s=!1):n.totalUnread===0&&(r.add({m:"Conversation changing state from unread to read in ConvStore",cid:i}),s=!0),r.addFlow({event:"MessagePane:markConvRead",key:"markConvReadInPane:"+i,condition:function(e,t){return r.add({m:"Conversation getting marked as "+(t?"Read":"Unread")+" in the ConvPane UI",cid:e.cid}),e.cid===i&&t===s},onTimeout:function(){var t=e.mail.model.ConvStore.Conversations.getPermCidPart,n=t(i),r,s,o=e.mail.Tabs.iterateTabs(function(e){if(e.widgetType==="convlist"||e.widgetType==="convpane")if(e.widget&&e.widget.msgPane&&e.widget.msgPane.message){r=e.widget.msgPane.message.cid,s=t(r);if(i===r||i===s||n===r||n===s)return!0}});return o?!0:!1},time:1e3,data:{m:"TimeoutError: Conversation couldn't get marked as "+(s?"Read":"Unread")+" in the ConvPane UI",cid:i}}),r.addFlow({event:"listview:itemUpdate",key:"markConvReadInList:"+i,condition:function(e,t){var n=e.one(".list-view-item").hasClass("unread")?!1:!0;return r.add({m:"Conversation getting marked as "+(n?"read":"unread")+" in ConvList UI",cid:i}),t.cid===i&&n===s},time:1e3,data:{m:"TimeoutError: Conversation couldn't get marked as "+(s?"Read":"Unread")+" in the ConvList UI",cid:i}}))}function y(t,n,r){if(r.indexOf("appid="+e.common.Utils.settings.value("appid"))>-1&&r.indexOf("SetMetaData")===-1){var i=t.request.postdata,s;if(r.indexOf("SendMessage")>-1||r.indexOf("SaveMessage")>-1||r.indexOf("BatchExecute")>-1&&i.indexOf("SaveMessage")>-1||r.indexOf("BatchExecute")>-1&&i.indexOf("SendMessage")>-1)i=i.replace(/"message":{.*}/,'"message":{<filtered>},');s={m:"Request Sent",url:r,post:i},e.UA.chrome>0&&(s.online=navigator.onLine),this.add(s)}}function b(e,t){var n=this,r,i;i=x(e),r={m:"Initiating delete action",fid:t},r[NeoConfig.hasConv?"cids":"mids"]=i.join(", "),this.add(r),NeoConfig.hasConv&&n.addFlow({event:"convops:movecbk",key:"removeMailFail:"+i[0],condition:function(e){return i=i.sort(),e=e.sort(),i.join(",")===e.join(",")},time:3e4,data:{m:"TimeoutError: Mail couldn't be deleted",ids:i.join(", ")}})}function w(t,n){var r,i=[];e.each(n,function(e){i.push(T(t[e]))}),r={m:"Removing mails from listmodel"},r[NeoConfig.hasConv?"cids":"mids"]=i.join(", "),this.add(r)}function E(e){this.add({m:"Finished syncing listview",syncReason:e})}function S(e,t){var n=T(t),r;r={m:"Updating single item in the list",subject:t.subject},r[NeoConfig.hasConv?"cid":"mid"]=n,this.add(r)}function x(t){var n=[];return e.each(t,function(e){n.push(T(e))}),n}function T(e){return NeoConfig.hasConv?e.cid:e.mid}function N(){this.printWaterfall()}function C(){this.printHAR()}var t=e.mail.ui.MailLog,n=e.common.Utils,r=new n.NetworkQueue("/neo/splunkLogger?wssid="+NeoConfig.wssid,{type:"object",periodic:!0,periodTime:18e4,retries:2,salvageDatum:function(e){return e.d={origKey:e.key},e.key="splunk_bad_data_error",e}}),k=new t({events:{MailLog:i,SplunkLog:n.features.enabled("splunkLogs")?s:function(){},MailLogClean:a,printLog:o,extractLogs:u,printWaterfall:N,printHAR:C,"MessagePane:inception":l,"MessagePane:expandClick":c,"MessagePane:loadMessageCardsStart":f,"MessagePane:loadMessageSuccessStart":h,"MessageController:getMultipleMessages":p,"MessageController:getMultipleMessagesSuccess":d,"BaseController:pending":v,"BaseController:execute":m,"ConvStore:calcConvSummary":g,"net:start":y,"mailEvents:removeMails":b,"listmodel:remove":w,"listview:sync":E,"listview:itemUpdate":S}});k.bindEvents()},"1.0.0",{requires:["mail-ui-log","common-utils-net-queue","mail-common-utils-features"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("jsonp",function(e,t){function r(){this._init.apply(this,arguments)}var n=e.Lang.isFunction;r.prototype={_init:function(t,r){this.url=t,this._requests={},this._timeouts={},r=n(r)?{on:{success:r}}:r||{};var i=r.on||{};i.success||(i.success=this._defaultCallback(t,r)),this._config=e.merge({context:this,args:[],format:this._format,allowCache:!1},r,{on:i})},_defaultCallback:function(){},send:function(){function u(e,r){return n(e)?function(n){var o=!0,u="_requests";r?(++t._timeouts[s],--t._requests[s]):(t._requests[s]||(o=!1,u="_timeouts"),--t[u][s]),!t._requests[s]&&!t._timeouts[s]&&delete YUI.Env.JSONP[s],o&&e.apply(i.context,[n].concat(i.args))}:null}var t=this,r=e.Array(arguments,0,!0),i=t._config,s=t._proxy||e.guid(),o;return i.allowCache&&(t._proxy=s),t._requests[s]===undefined&&(t._requests[s]=0),t._timeouts[s]===undefined&&(t._timeouts[s]=0),t._requests[s]++,r.unshift(t.url,"YUI.Env.JSONP."+s),o=i.format.apply(t,r),i.on.success?(YUI.Env.JSONP[s]=u(i.on.success),e.Get.js(o,{onFailure:u(i.on.failure),onTimeout:u(i.on.timeout,!0),timeout:i.timeout,charset:i.charset,attributes:i.attributes,async:i.async}).execute(),t):t},_format:function(e,t){return e.replace(/\{callback\}/,t)}},e.JSONPRequest=r,e.jsonp=function(t,n){var r=new e.JSONPRequest(t,n);return r.send.apply(r,e.Array(arguments,2,!0))},YUI.Env.JSONP||(YUI.Env.JSONP={})},"3.16.0-ym19",{requires:["get","oop"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("jsonp-url",function(e,t){var n=e.JSONPRequest,r=e.Object.getValue,i=function(){};e.mix(n.prototype,{_pattern:/\bcallback=(.*?)(?=&|$)/i,_template:"callback={callback}",_defaultCallback:function(t){var n=t.match(this._pattern),s=[],o=0,u,a,f;if(n){u=n[1].replace(/\[(['"])(.*?)\1\]/g,function(e,t,n){return s[o]=n,".@"+o++}).replace(/\[(\d+)\]/g,function(e,t){return s[o]=parseInt(t,10)|0,".@"+o++}).replace(/^\./,"");if(!/[^\w\.\$@]/.test(u)){a=u.split(".");for(o=a.length-1;o>=0;--o)a[o].charAt(0)==="@"&&(a[o]=s[parseInt(a[o].substr(1),10)]);f=r(e.config.win,a)||r(e,a)||r(e,a.slice(1))}}return f||i},_format:function(e,t){var n=/\{callback\}/,r,i;return n.test(e)?e.replace(n,t):(r=this._template.replace(n,t),this._pattern.test(e)?e.replace(this._pattern,r):(i=e.slice(-1),i!=="&"&&i!=="?"&&(e+=e.indexOf("?")>-1?"&":"?"),e+r))}},!0)},"3.16.0-ym19",{requires:["jsonp"]});
YUI.add("comet",function(e){function t(e){t.superclass.constructor.apply(this,arguments)}e.namespace("Comet");var n={},r="comet:ready";e.initComet=function(i,s){var o=i.replace(/https:/,"http:");return o.substr(-1)==="/"&&(o=o.substring(0,o.length-1)),n[o]||(e.publish(r),n[o]=new t,n[o].clearListeners()),s&&n[o].addListener("/meta/handshake",s),n[o].initBayeux(i,function(t){t.successful&&e.fire(r,{message:t})}),n[o]},t.NAME="Comet",t.ATTRS={uri:{value:null,setter:function(e){if(e===null)return;var t=window.location.protocol;t.indexOf("https")!==-1?e=e.replace(/http:/,"https:"):t.indexOf("http")!==-1&&(e=e.replace(/https:/,"http:"));var n=e.toLowerCase();return n.indexOf("https://")!==-1?this.set("protocol","https://"):n.indexOf("http://")!==-1&&this.set("protocol","http://"),e}},protocol:{value:"https://"},meta:{value:{handshake:{channel:"/meta/handshake",version:"1.0",supportedConnectionTypes:["long-polling"]},connect:{channel:"/meta/connect",connectionType:"long-polling"},subscribe:{channel:"/meta/subscribe"},unsubscribe:{channel:"/meta/unsubscribe"},publish:{},disconnect:{channel:"/meta/disconnect"},ack:{channel:"/meta/ack"}}},ioCfg:{value:{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"}}},ext:{value:{all:{},handshake:{},subscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},unsubscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},connect:{},publish:{"Comet-api-version":"1.1","Comet-registration-id":"make-up","Comet-opaque-id":"markup","Comet-acknowledge-URI":"www.yahoo.com/ack","Comet-acknowledge-type":"All"},disconnect:{}}}},e.extend(t,e.Base,{_clientState:"unconnected",_advice:{},_connected:!1,_config:{backoffIncrement:1e3,maxBackoff:1e4,maxNetworkDelay:3e5,delayedSendMaxCount:10,advice:{timeout:6e4,interval:0,reconnect:"retry"},subscribe:{jsonpTimeout:5e3}},_delayedSendCount:0,_urlOrigin:"",_backoff:0,_isLongpollingConnect:!1,_isSendingQueue:!1,_isShutdown:!1,_clientId:null,_token:null,_lastMessageId:0,_outgoing:[],_subscribeChannel:{},_queue:new e.AsyncQueue,_ioQueue_c2s:e.io.queue,_ioQueue_s2c:e.io.queue,_jsonp:null,_listeners:{},initializer:function(t){this.setClientState("unconnected"),e.on("beforeunload",e.bind(function(){this.getClientState()!=="unconnected"&&this.disconnect()},this),window)},config:function(t,n){e.Object.setValue(this._config,t,n)},_Queue_send:function(t){var n=this;n._batch(t);if(!n.getClientId())return;if(n._isSendingQueue)return;if(n._outgoing.length<=0)return;e.each(n._outgoing,function(e){e=n._patchMessage(e)}),n._IO_send(!0,n._outgoing),n._outgoing=[]},_nextQueueSend:function(){this._Queue_send()},_IO_send:function(e,t){var n=this;if(!n.get("uri"))return;if(e){if(n._isSendingQueue||!t)return;n._IO_Queue_Send(t)}else{if(!n.getClientId())return;if(n._isLongpollingConnect||!t)return;n._IO_Longpolling_Send(t)}},_IO_Queue_Send:function(t){var n=this;n.setTokenHeader(n._token);var r=e.merge(n.get("ioCfg"),{context:n,timeout:n._config.maxNetworkDelay,data:e.JSON.stringify(t),xdr:{credentials:!0},on:{success:function(r,i){var s=e.common.Utils.json.tryParse(i.responseText,function(){n._handleFailure(t,"json parse error")});s&&n._handleResponse(s)},failure:function(e,r){n._handleFailure(t,"500::io failed")},start:function(){n._isSendingQueue=!0},complete:function(){n._isSendingQueue=!1,n._nextQueueSend()}}});if(n._isShutdown)return;n._ioQueue_c2s.stop(),n._ioQueue_c2s(n.get("uri"),r),n._ioQueue_c2s.start()},_IO_Jsonp_Send:function(t){var n=this;if(!n.get("uri"))return;var r=n.get("uri")+"?callback={callback}",i=encodeURIComponent(e.JSON.stringify(t));r=r+"&data="+i,n._jsonp=new e.JSONPRequest(r,{on:{success:function(e){n._handleResponse(e)},timeout:function(e){n._handleFailure(t,"408:"+n._config.subscribe.jsonpTimeout+":jsonp timeout")},failure:function(){n._handleFailure(t,"500::jsonp failed")}},timeout:n._config.subscribe.jsonpTimeout}),n._jsonp.send()},_IO_Longpolling_Send:function(t){var n=this;n.setTokenHeader(n._token);var r=e.merge(n.get("ioCfg"),{context:n,timeout:n._config.maxNetworkDelay,xdr:{credentials:!0},data:e.JSON.stringify(t),on:{success:function(r,i){try{var s=e.JSON.parse(i.responseText);n._handleResponse(s)}catch(o){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-common-net-cometd-yui3:1",o,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-common-net-cometd-yui3:1"),n._handleFailure(t,"json parse error");return}},failure:function(e,r){n._handleFailure(t,"500::io failed")},start:function(){n._isLongpollingConnect=!0},complete:function(){n._isLongpollingConnect=!1}}});if(n._isShutdown)return;n._ioQueue_s2c.stop(),n._ioQueue_s2c(n.get("uri"),r),n._ioQueue_s2c.start()},_handleResponse:function(t){if(t===undefined||t===null)return;var n=this;e.each(t,function(e){n._updateAdvice(e.advice),e.originalURI=n._urlOrigin;var t=e.channel;switch(t){case"/meta/handshake":n._handshakeResponse(e);break;case"/meta/connect":n._connectResponse(e);break;case"/meta/disconnect":n._disconnectResponse(e);break;case"/meta/subscribe":n._subscribeResponse(e);break;case"/meta/shutdown":n._shutdownResponse(e);break;case"/meta/unsubscribe":n._unsubscribeResponse(e);break;default:n._messageResponse(e)}})},_updateAdvice:function(e){e?this._advice=this._mixin(!1,{},this._config.advice,e):this._advice=this._config.advice},_handshakeResponse:function(e){var t=this;if(e.successful){t.setClientState("connected"),t._clientId=e.clientId,t._advice.VIP&&t.set("uri",t.get("protocol")+t._advice.VIP+"/comet"),t._notifyListeners("/meta/handshake",e),t._Queue_send();var n=t._isDisconnected()?"none":t._advice.reconnect;switch(n){case"retry":t._resetBackoff(),t._delayedConnect();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}}else t._failHandshake(e)},_failHandshake:function(e){var t=this;t.setClientState("unconnected"),t._clientId=null,t._notifyListeners("/meta/handshake",e),t._notifyListeners
("/meta/unsuccessful",e);var n=t._advice.reconnect!=="none";n?(t._increaseBackoff(),t._delayedHandshake()):t._disconnect(!1)},_delayedHandshake:function(){var e=this;this._delayedSend(function(){e._handshake()})},_subscribeResponse:function(e){if(e.successful){if(!this._subscribeChannel[e.subscription]||this._subscribeChannel[e.subscription]!==!0)this._subscribeChannel[e.subscription]=!0;e.ext["Comet-auth-token"]&&(this._token=e.ext["Comet-auth-token"]),this._notifyListeners("/meta/subscribe",e)}else this._failSubscribe(e)},_failSubscribe:function(e){this._notifyListeners("/meta/subscribe",e),this._notifyListeners("/meta/unsuccessful",e)},_connectResponse:function(e){var t=this;if(t._isDisconnected())return;t._connected=e.successful;if(t._connected){t.setClientState("connected"),t._notifyListeners("/meta/connect",e);var n=t._isDisconnected()?"none":t._advice.reconnect;switch(n){case"retry":t._resetBackoff(),t._delayedConnect();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}}else t._failConnect(e)},_failConnect:function(e){var t=this;t._notifyListeners("/meta/connect",e),t._notifyListeners("/meta/unsuccessful",e);var n=t._isDisconnected()?"none":t._advice.reconnect;switch(n){case"retry":t._delayedConnect(),t._increaseBackoff();break;case"subscribe":t._delayedConnect(),t._increaseBackoff();break;case"handshake":t.setClientState("unconnected"),t._resetBackoff(),t._delayedHandshake();break;case"none":t._disconnect(!1)}},_delayedConnect:function(){var e=this;this._delayedSend(function(){e._connect()})},_disconnectResponse:function(e){e.successful?(this._disconnect(!1),this._notifyListeners("/meta/disconnect",e)):this._failDisconnect(e)},_shutdownResponse:function(e){this._disconnect(!0),this._isShutdown=!0,this._notifyListeners("/meta/shutdown",e)},_failDisconnect:function(e){this._disconnect(!0),this._notifyListeners("/meta/disconnect",e),this._notifyListeners("/meta/unsuccessful",e)},_unsubscribeResponse:function(e){e.successful?(this._subscribeChannel[e.subscription]&&this._subscribeChannel[e.subscription]===!0&&delete this._subscribeChannel[e.subscription],this._notifyListeners("/meta/unsubscribe",e)):this._failUnsubscribe(e)},_failUnsubscribe:function(e){this._notifyListeners("/meta/unsubscribe",e),this._notifyListeners("/meta/unsuccessful",e)},_messageResponse:function(e){e.successful===undefined?e.data?(this._notifyListeners(e.channel,e),e.id&&this._ackMessage({msgId:e.id,msgChannel:e.channel})):this._notifyListeners("/meta/unsuccessful",e):e.successful?this._notifyListeners("/meta/publish",e):this._failMessage(e)},_ackMessage:function(e){var t=this._createMessage("ack",e);this._Queue_send(t)},_failMessage:function(e){this._notifyListeners("/meta/publish",e),this._notifyListeners("/meta/unsuccessful",e)},_delayedSend:function(e){var t=this,n=t._advice.interval+t._backoff;t._config.maxBackoff<=t._backoff?t._delayedSendCount++:t._delayedSendCount=0;if(t._delayedSendCount>t._config.delayedSendMaxCount){var r=t.get("uri");t.set("uri",t._urlOrigin);if(r===t.get("uri"))return;t._resetBackoff(),t._delayedSendCount=0}t._queue.add({fn:e,timeout:n}),t._queue.run()},_handshakeFailure:function(e,t){this._failHandshake({successful:!1,failure:!0,channel:"/meta/handshake",request:e,advice:{reconnect:"retry",interval:this._backoff},error:t||"",ext:e.ext||{},id:e.id||""})},_connectFailure:function(e,t){this._connected=!1,this._failConnect({successful:!1,failure:!0,channel:"/meta/connect",request:e,advice:{reconnect:"retry",interval:this._backoff},clientId:e.clientId||"",error:t||"",ext:e.ext||{},id:e.id||""})},_disconnectFailure:function(e,t){this._failDisconnect({successful:!1,failure:!0,channel:"/meta/disconnect",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",error:t||"",ext:e.ext||{},id:e.id||""})},_subscribeFailure:function(e,t){this._failSubscribe({successful:!1,failure:!0,channel:"/meta/subscribe",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},_unsubscribeFailure:function(e,t){this._failUnsubscribe({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},_messageFailure:function(e,t){this._failMessage({successful:!1,failure:!0,channel:e.channel,request:e,advice:{reconnect:"none",interval:0},clientId:e.clientId||"",subscription:e.subscription||"",error:t||"",ext:e.ext||{},id:e.id||""})},_handleFailure:function(e,t){var n,r,i;for(i=0;i<e.length;++i){n=e[i],r=n.channel;switch(r){case"/meta/handshake":this._handshakeFailure(n,t);break;case"/meta/connect":this._connectFailure(n,t);break;case"/meta/disconnect":this._disconnectFailure(n,t);break;case"/meta/subscribe":this._subscribeFailure(n,t);break;case"/meta/unsubscribe":this._unsubscribeFailure(n,t);break;default:this._messageFailure(n,t)}}},_notifyListeners:function(e,t){this._notify(e,t),this._notify(e+"/*",t);var n=e.split("/"),r=n.length-1,i=0;for(i=r;i>0;--i){var s=n.slice(0,i).join("/")+"/*";s!==e&&this._notify(s,t)}},_notify:function(t,n){var r=this._listeners[t];r&&e.each(r,function(t){e.Lang.isFunction(t.listener)&&t.listener(n)})},_isDisconnected:function(){return this._clientState==="unconnected"},_resetBackoff:function(){this._backoff=0},_nextMessageId:function(){return++this._lastMessageId+""},_increaseBackoff:function(){this._backoff<this._config.maxBackoff&&(this._backoff+=this._config.backoffIncrement)},_createMessage:function(t,n){n=n||{};var r=(new Date).valueOf(),i=window.location.host,s=[],o=e.merge(this.get("ext").all,this.get("ext")[t],n.ext||{},{timestamp:r,host:i||""});switch(t){case"handshake":s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t]));break;case"connect":s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t],{clientId:this.getClientId()}));break;case"subscribe"
:s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t],{clientId:this.getClientId(),subscription:n.channel}));break;case"unsubscribe":s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t],{clientId:this.getClientId(),subscription:n.channel}));break;case"publish":s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t],{clientId:this.getClientId(),channel:n.channel,data:n.data}));break;case"disconnect":s.push(e.merge({id:this._nextMessageId(),ext:o},this.get("meta")[t],{clientId:this.getClientId()}));break;case"ack":s.push(e.merge({id:this._nextMessageId(),ext:o,msgId:n.msgId,msgChannel:n.msgChannel},this.get("meta")[t],{clientId:this.getClientId()}))}return s},_handshake:function(e){var t=this;if(t.getClientState()!=="unconnected"){if(t.getClientState()==="connected"){var n={successful:!0,channel:"/meta/handshake",clientId:t._clientId,originalURI:t._urlOrigin};t._notifyListeners("/meta/handshake",n)}return}e&&e.listener&&t._addListener(e,!1),t._clientId=null,t._token=null,t.resetTokenHeader(),t._clearSubscriptions(),t._updateAdvice(t._config.advice);var r=t._createMessage("handshake",e);t._IO_send(!0,r),t.setClientState("connecting")},_connect:function(e){var t=this;if(t.getClientState()!=="connected")return;if(t._isLongpollingConnect)return;var n=t._createMessage("connect",e);t._IO_send(!1,n)},_subscribeJSONP:function(e){if(!e||!e.channel)return;if(!this.getClientId())return;if(this._subscribeChannel[e.channel]&&this._subscribeChannel[e.channel]===!0)return;e.listener&&this._addListener(e,!0);var t=this._createMessage("subscribe",e);this._IO_Jsonp_Send(t)},_unsubscribe:function(e){if(!this.getClientId())return;e&&e.channel&&this.removeListeners(e.channel);if(e&&e.channel){var t=this._createMessage("unsubscribe",e);this._Queue_send(t)}},_disconnect:function(e){var t=this;e&&(t._ioQueue_c2s.stop(),t._ioQueue_s2c.stop()),t.setClientState("unconnected"),t._clientId=null,t._resetBackoff(),t._queue.stop();if(t._outgoing.length>0){var n=t._outgoing;t._outgoing=[],t._handleFailure(n,"500::canceled after disconnect")}t._clearSubscriptions()},_patchMessage:function(e){return e.id||(e.id=this._nextMessageId()),e.clientId=this.getClientId(),e.channel==="/meta/handshake"&&delete e.clientId,e},_batch:function(){e.each(arguments,function(t){if(t&&e.Lang.isArray(t)){var n=0;for(n=0;n<t.length;++n)this._outgoing.push(t[n])}else t&&this._outgoing.push(t)},this)},_clearSubscriptions:function(){e.each(this._listeners,function(t){t&&e.each(t,function(e,t,n){e&&e.isSub&&n.splice(t)})}),this._subscribeChannel={}},_reDoSubscriptions:function(){e.each(this._subscribeChannel,function(e,t){e&&(this._subscribeChannel[t]=!1,this._subscribeJSONP({channel:t}))},this)},isDuplicatedListener:function(e,t){var n=0;for(n=0;n<t.length;++n){var r=t[n];if(r&&r.listener&&r.listener.toString()===e.toString())return!0}return!1},_addListener:function(t,n,r){t&&t.listener&&e.Lang.isFunction(t.listener)&&(this._listeners[t.channel]?(r||!this.isDuplicatedListener(t.listener,this._listeners[t.channel]))&&this._listeners[t.channel].push({listener:t.listener,isSub:n}):this._listeners[t.channel]=[{listener:t.listener,isSub:n}])},_mixin:function(e,t,n){var r,i,s=t||{};for(r=2;r<arguments.length;++r){var o=arguments[r];if(o===undefined||o===null)continue;for(i in o){var u=o[i],a=s[i];if(u===t)continue;if(u===undefined)continue;e&&typeof u=="object"&&u!==null?u instanceof Array?s[i]=this._mixin(e,a instanceof Array?a:[],u):s[i]=this._mixin(e,{},u):s[i]=u}}return s},destructor:function(){},getClientState:function(){return this._clientState},setClientState:function(e){this._clientState=e},getClientId:function(){return this._clientId},initBayeux:function(e,t){this._urlOrigin=e,this.set("uri",e),this._handshake({channel:"/meta/handshake",listener:t})},subscribe:function(e,t){this._subscribeJSONP({channel:e,listener:t})},unsubscribe:function(e){this._unsubscribe({channel:e})},disconnect:function(e){var t=this;e&&t._addListener({channel:"/meta/disconnect",listener:e},!1);if(t.getClientState()==="unconnected")return;if(!t.getClientId())return;var n=t._createMessage("disconnect");t._Queue_send(n)},publishMsg:function(e,t){if(e&&t){var n={channel:e,data:t},r=this._createMessage("publish",n);this._Queue_send(r)}},clearListeners:function(){this._listeners={}},addListener:function(t,n,r){r=r||!1;if(!n&&e.Lang.isFunction(n))return;this._addListener({channel:t,listener:n},!1,r)},removeListeners:function(e){this._listeners[e]&&delete this._listeners[e]},setUserInfo:function(e,t){if(e&&t){var n=this.get("ext");n.subscribe["Comet-subscriber-auth-info"]={uid:e,user_type:"yahoo",user_cred:t}}},setUserInfoWithCookie:function(e,t){if(e){var n=this.get("ext");n.subscribe["Comet-subscriber-auth-info"]={uid:e,user_type:"yahoo",user_cred:"Any Value"}}},setTokenHeader:function(e){if(e){var t=this.get("ioCfg");t.headers.Authorization="Basic token="+e}},resetTokenHeader:function(){var e=this.get("ioCfg");e.headers.Authorization="Basic token="},setYcaHeader:function(e,t){if(e){var n=this.get("ioCfg");n.headers["Yahoo-App-Auth"]=e}if(t){var r=this.get("ext");r.publish["Comet-opaque-id"]=t}}}),e.Comet=t},"3.4.1",{requires:["base","io","json","async-queue","cookie","jsonp","jsonp-url","common-utils-jsonparse"]});
YUI.add("mail-ui-rr-backfill-controller",function(e){var t;t=function(){function a(t){var n;if(!t&&!s&&!s.getEligibleRightRailAdPos)return;n=s.getEligibleRightRailAdPos(),e.fire(t,u,{rightRailAdPos:n})}function f(t){var n=t.name||"",r=t.tags||{},i=t.include||{};if(!t)return;e.fire("util.ymstats",{name:n,tags:r,include:i})}function l(e){var t;e=e||window.event;if(e&&e.data)switch(e.data){case"rmx:no-ad-tl1":a("darla:blankAdLoaded:TL1");break;case"rmx:no-ad-mbrightrail":NeoGV&&NeoGV.ads&&NeoGV.ads[t]&&NeoGV.ads[t].bookId&&f({name:"rmx_noad_mbrightrail",tags:{bookingId:NeoGV.ads[t].bookId}});case"rmx:no-ad":a(i),f({name:"righrail_backfill_total",tags:{event:i},include:{bucket:!0}});break;case"rmx:no-ad-mbbackfill":a("darla:blankAdLoaded"),f({name:"righrail_moneyball_backfill_total",include:{bucket:!0}});break;case"rmx:no-ad-trendingnow":a("darla:blankAdLoaded:trending"),f({name:"righrail_trending_backfill_total",include:{bucket:!0}});break;case"rmx:no-ad-sidekick":a("darla:blankAdLoaded:sidekick"),f({name:"righrail_sidekick_backfill_total",include:{bucket:!0}});break;case"rmx:no-ad-aff-rightrail":a("darla:blankAdLoaded:affiliate")}}function c(){e.on("darlaEvent:change",function(e){u=e},this),window.postMessage&&(window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l)),t.features.enabled("sidekick")&&e.use("mail-ui-sidekick-controller",function(e){e.mail.ui.sidekickController.init({blankAdLoadedDefaultEvent:n})}),t.features.enabled("trending")&&t.features.enabled("newsFeedTab")&&e.use("mail-ui-trending-controller",function(e){e.mail.ui.trendingController.init({blankAdLoadedDefaultEvent:n,adPosition:o})})}var t=e.common.Utils,n="darla:blankAdLoaded",r=t.features.enabled("trending")?"darla:blankAdLoaded:trending":n,i=t.features.enabled("sidekick")?"darla:blankAdLoaded:sidekick":r,s=e.mail.ui.darla,o=s.getEligibleRightRailAdPos(),u={};e.mix(this,{init:c,messageReceived:l})},e.namespace("mail.ui"),e.mail.ui.RRBackfillController=new t,e.mail.ui.RRBackfillController.init()},"1.0.0",{requires:["mail-ui-darla"]});
YUI.add("mail-ui-backbutton",function(C){var I,G=C.common.Utils,B=C.mail.Tabs,H=C.Node.one("#theAd"),E,F=0,D=0,A={};I=function(){function K(){var N,P,O=C.mail.FoldersView;window.onhashchange=function(S){if(typeof S.newURL==="string"){if((S.newURL.indexOf("#")>0&&S.oldURL.indexOf("#")>0)||(S.newURL.slice(-1)==="#")){return false;}}N=B.tabs;if(N[0].NAME.indexOf("INBOX")!==-1&&O.get("fid").fid==="Inbox"){B.switchToTab(B.tabs[0]);window.history.state&&window.history.go(-1);}else{if(N[N.length-2].widgetType==="search"&&NeoConfig.backButtonSearch){var Q=B.getActiveTab();Q.set("close",1);}else{var R={fid:"Inbox",forceRefresh:"",name:"Inbox",mailboxId:"Inbox",smartFolder:""};O.set("fid",R);C.fire("navigation:switch","none");}}if(typeof window.history.pushState==="function"&&typeof window.history.state!=="undefined"){if(window.history.state!==null){window.history.state.id=0;}}return false;};}function L(){var N=C.mail.Tabs,P,O=C.mail.FoldersView;window.onclick=function(Q){if(Q.button!==2&&Q.target.getAttribute("href")==="#"){Q.preventDefault();}};window.onhashchange=function(Q){if(typeof Q.newURL==="string"){if((Q.newURL.indexOf("#")>0&&Q.oldURL.indexOf("#")>0)||(Q.newURL.slice(-1)==="#")){return false;}}};window.onpopstate=function(){if(window.location.href.slice(-1)==="#"){return false;}P=A[window.location.hash.slice(1)];if(!P&&window.location.hash.length){return;}if(!P){N.switchToTab(N.tabs[0]);return false;}if(typeof P==="object"){var Q={fid:P.fid.fid,bb:true};O.set("fid",Q);}else{N.switchToTab(N.tabs[P||0],0,0,0,0,1);}C.fire("util:ymstats",{"name":"browsernav","tags":{"type":"switch"}});return false;};}function J(P){var O=false;C.fire("util:ymstats",{"name":"browsernav","tags":{"type":"init"}});if(!NeoConfig.backButtonFull){if(NeoConfig.backButton&&(typeof window.history.pushState==="function")){if(!window.history.state||!window.history.state.id){window.history.pushState({id:"1"},document.title,window.location.pathname+window.location.search);}if(!window.location.hash.length){window.history.replaceState({id:"1"},document.title,"#mail");}}return;}E=Math.ceil(Math.random()*Math.pow(10,10));var N;window.history.pushState({id:E},document.title,"#"+E);N=P?P.id:B.getActiveTab().cfg.label;switch(N){case"Contacts":A[E]=1;O=true;break;case"Calendar":A[E]=2;O=true;break;case"Notepad":A[E]=3;O=true;break;default:if(P.fid&&P.fid.length>1){A[E]={};A[E].tab=0;A[E].fid=P;}else{A[E]=B.getActiveTabIndex();}O=true;break;}F++;return O;}function M(){var N=window.location.hash.slice(1);if(A[N]){delete A[N];}}if(NeoConfig.backButtonFull){L();}else{if(NeoConfig.backButton){K();}}C.on("initPage",J);C.on("removePage",M);C.mix(this,{initPage:J,removePage:M});};C.namespace("mail.ui").BackButton=new I();},"1.0.0",{});YUI.add("mail-ui-lightdocpreview-constants",function(e){var t={DocPreviewPayloadTypes:{DocumentIterator:"DPTYPE_DocIter",BootCampItems:"DPTYPE_BootCampItems",MsgInfo:"DPTYPE_MsgInfo"}};e.namespace("mail.ui.lightDocPreview").Constants=t},"1.0.0",{requires:[]});
YUI.add("mail-ui-light-document-preview-helper",function(e){function t(e){var t={xlsx:"xls",excel:"xls",msexcel:"xls","x-dos_ms_excel":"xls","x-excel":"xls","x-ms-excel":"xls","x-msexcel":"xls","x-xls":"xls",xls:"xls","vnd.ms-excel":"xls","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xls","vnd.openxmlformats-officedocument.spreadsheetml.template":"xls","vnd.ms-excel.sheet.macroEnabled.12":"xls","vnd.ms-excel.template.macroEnabled.12":"xls",pptx:"ppt","vnd.ms-powerpoint":"ppt","vnd.openxmlformats-officedocument.presentationml.presentation":"ppt","vnd.openxmlformats-officedocument.presentationml.template":"ppt","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppt",docx:"doc",dot:"doc",microsoft_word:"doc","mswor2c sc2":"doc",msword:"doc",rtf:"doc","vnd.framemaker":"doc","vnd.ms-word":"doc","vnd.msword":"doc",winword:"doc",word:"doc","x-dot":"doc","x-fm":"doc","x-framemaker":"doc","x-maker":"doc","x-msw6":"doc","x-msword":"doc","x-rtf":"doc","x-soffice":"doc","text/richtext":"doc","text/rtf":"doc","text/vnd.graphviz":"doc","zz-winassoc-dot":"doc","vnd.openxmlformats-officedocument.wordprocessingml.document":"doc","vnd.ms-word.document.macroEnabled.12":"doc","x-zip-compressed":"zip","x-compressed":"zip",zip:"zip",pdf:"pdf",acrobat:"pdf","x-pdf":"pdf","vnd.pdf":"pdf","text/pdf":"pdf","text/x-pdf":"pdf"},n;return e?(n=e.split("/"),n.length<2?e:n[0]==="image"?"image":t[n[1]]?t[n[1]]:n[1]):""}function n(t,n,r){var i="&w="+n+"&h="+(r||n),s=/&w=\d*&h=\d*$/;return t?e.common.Utils.features.enabled("changeSizeInV3Thumbnail")&&t.match(/ws\/v3/)?e.common.Utils.replaceQueryString(t,{size:null,w:null,h:null}):t.match(s)?t.replace(s,i):t+i:undefined}function r(e){return{disposition:e.disposition,size:e.size,filename:e.name,pid:e.partId,type:e.type,downloadable:!0,documentId:e.documentId,filetype:t(e.mimeType),mimeType:e.mimeType,thumbnail:e.thumbnail||"",fullsize:n(e.thumbnail,3e3,3e3),viewable:!0,fid:e.fid,mid:e.mid,overlay:!1,filesize:e.size,simplefilesize:e.size,filename_without_extension:e.name?(""+e.name).substring(e.name.lastIndexOf("/")+1,e.name.lastIndexOf(".")):"",file_extension:e.name?(""+e.name).substr((""+e.name).lastIndexOf(".")):"",downloadInfo:{mid:e.mid,fid:e.fid,pid:e.partId},downloadUrl:e.downloadLink}}function i(e,t){var r=[],i=e.attachments,s=e.part.slice(1),o,u,a,f;return i.forEach(function(i,l){o=s[l],u=i.filename,f={disposition:i.disposition,size:i.size,filename:u,pid:i.partId,type:i.type,downloadable:!0,documentId:i.documentId,filetype:i.type==="image"?i.type:i.subtype,thumbnail:o.thumbnailurl||"",fullsize:n(o.thumbnailurl,3e3,3e3),viewable:!0,fid:e.sourceFolderInfo.fid,mid:e.mid,overlay:!1,filesize:i.size,simplefilesize:i.size,filename_without_extension:(""+u).substring(u.lastIndexOf("/")+1,u.lastIndexOf(".")),file_extension:(""+u).substr((""+u).lastIndexOf(".")),mimeType:i.type+"/"+i.subtype,active:t?i.partId===t:l===0,downloadInfo:{mid:e.mid,fid:e.sourceFolderInfo.fid,pid:i.partId},downloadUrl:o.downloadUrlV3||o.downloadUrl};if(t?i.partId===t:l===0)a=l;r.push(f)}),{list:r,activeIndex:a}}function s(t,n,r){var i={fid:n,msg:{mid:t},cachekey:"Prime",ovparams:{}},s={success:r};if(!i.msg.mid){r(null);return}NeoConfig.yodaReadEnabled&&NeoConfig.yodaControllerLoaded?e.mail.controller.v3.api.getSimpleBodyofMessages({messageList:[i.msg],sourceFid:i.fid,success:function(e){s.success(e[0],s)},failure:s.failure}):e.mail.Controller.Messages.get(i,s)}function o(e,t,n){var r;typeof t!="function"&&(t=function(){});if(!!e.documentId){e._enrichedDocumentId=!0,t();return}if(e._enrichedDocumentId){t();return}e._enrichedDocumentId=!0;if(n[e.mid]&&n[e.mid][e.pid]){r=n[e.mid][e.pid],e.documentId=r.documentId,e.downloadUrl=r.downloadUrlV3||r.downloadUrl,e.disposition=r.disposition,e.mimeType=r.type+"/"+r.subtype,t();return}if(!e.mid||!e.fid)return;s(e.mid,e.fid,function(r){var i,s=r.attachments,o=s&&s.length||0;n[e.mid]={};for(i=0;i<o;i++)e.pid===s[i].partId&&(e.documentId=s[i].documentId,e.downloadUrl=s[i].downloadUrlV3||s[i].downloadUrl,e.disposition=s[i].disposition,e.mimeType=s[i].type+"/"+s[i].subtype),n[e.mid][s[i].partId]=s[i];t()})}function u(){var e={};return function(t,n){return o(t,n,e)}}e.namespace("mail.ui.lightDocPreview").helper={makeGDM:s,enrichDocumentId:u(),getDocViewList:i,getFullSizeUrl:n,mapType:t,getDocumentInfoFromBootCampItem:r}},"1.0.0",{requires:["common-utils","mail-common-utils-features"]});
YUI.add("mail-ui-lightdocpreview-document-iterator",function(e){function s(e,t,n){var s=t||0;this.type=i.DocumentIterator,this._onNavigation=[],this._list=e,this.hasNext=function(){return s+1<this._list.length},this.hasPrevious=function(){return s-1>=0},this.next=function(){if(this.hasNext())return this.setCurrentIndex(s+1),this._list[s]},this.previous=function(){if(this.hasPrevious())return this.setCurrentIndex(s-1),this._list[s]},this.getActive=function(){var e=this._list[s];return e},this._activateCurent=function(e){if(this._list[s])return this._list[s].active=e,this._list[s].isFirstAtt=!this.hasPrevious(),this._list[s].isLastAtt=!this.hasNext(),!0},this._notifyNavigation=function(){var e=0,t=this._onNavigation.length,n;for(e=0;e<t;e++)n=this._onNavigation[e],typeof n=="function"&&n(s)},this.setCurrentIndex=function(e,t){var n=e!==s;this._activateCurent(!1),s=e,this._activateCurent(!0),r.enrichDocumentId(this._list[s],t),this.hasNext()&&r.enrichDocumentId(this._list[s+1]),this.hasPrevious()&&r.enrichDocumentId(this._list[s-1]),n&&this._notifyNavigation()},this.getCurrentIndex=function(){return s},this.getAt=function(e){return this._list[e]},this.setMsgObject=function(e){n=e},this.getMsgObject=function(){return n},this.getDownloadUrlOfActiveItem=function(e){var t=this.getActive().downloadUrl;typeof e&&e(t)},this.hookNavigation=function(e){this._onNavigation.push(e)},this.appendBootCampItems=function(e){var t;return Array.isArray(e)?(t=e.map(function(e){return r.getDocumentInfoFromBootCampItem(e)}),this._list.push(t),!0):!1},this.start=function(e){this.setCurrentIndex(s,e)}}var t=e.mail.ui.lightDocPreview,n=t.Constants,r=t.helper,i=n.DocPreviewPayloadTypes;e.namespace("mail.ui.lightDocPreview").DocumentIterator=s},"1.0.0",{requires:["mail-ui-lightdocpreview-constants","mail-ui-light-document-preview-helper"]});
YUI.add("_shared_module_fullscreen_slideshow",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_fullscreen_slideshow={base:'<div id="lightPreview"> <div class="splash"> <div class="s-loader"> </div> </div></div>'}},"1.0.0");
YUI.add("mail-ui-light-document-preview-fullscreenslideshow",function(e){function r(){var r=null,i;return{splash:function(){r||(r=e.Node.create(n(e.ui.Templates._shared_module_fullscreen_slideshow.base,{},null,null,{})),e.one("body").append(r),r.on("click",function(){r.hide()})),r.show()},render:function(n,s){var o=this,u;r||this.splash(),i&&i._oldRequestClose({enableRightRailAd:!1}),u=e.Tictac.base.AssistContainerManager,i=u.getContainer({tabId:t}),i._oldRequestClose=i.requestClose,i.requestClose=function(){o.close()},i.render(r),i.resize(100),i.resize=function(){},i.isFullScreenContainer=!0,e.Tictac.previewr.loadViewer(i,s,n),r.show(),e.fire("light-document-preview:ready")},close:function(){e.fire("light-document-preview:closed"),r&&(i&&i._oldRequestClose({enableRightRailAd:!1}),i=null,r.hide())}}}var t="lightPreview",n=e.common.Utils.substitute;e.namespace("mail.ui.lightDocPreview").FullScreenSlideView=r},"1.0.0",{requires:["_shared_module_fullscreen_slideshow","comms-utils"]});
YUI.add("mail-ui-lightdocpreview-controller",function(e){function f(){return u||(u=new r),u}function l(e){s.makeGDM(e.mid,e.fid,function(t){var n=s.getDocViewList(t,e.pid),r=new i(n.list,n.activeIndex,t);a.handleDocumentIterator(r)})}function c(e){var t=e.items,n=t.map(function(e){return s.getDocumentInfoFromBootCampItem(e)}),r=new i(n,e.activeIndex,{});r.hookNavigation(function(t){e.notifyIndexUpdate(t,r,s.getDocumentInfoFromBootCampItem)}),a.handleDocumentIterator(r)}function h(e){var t=a.getSingletonView();e.start(function(){t.render({},e)})}var t=e.mail.ui.lightDocPreview,n=t.Constants,r=t.FullScreenSlideView,i=t.DocumentIterator,s=t.helper,o=n.DocPreviewPayloadTypes,u=null,a;a={getSingletonView:f,handleBootCampArray:c,handleDocumentIterator:h,handleMessageAttachments:l},e.namespace("mail.ui.lightDocPreview").ctrl=a,e.on("open-light-document-preview",function(t){var n=a.getSingletonView();n.splash(),e.use("tictac-base-assist-container","tictac-previewr",function(){switch(t.type){case o.DocumentIterator:a.handleDocumentIterator(t);break;case o.BootCampItems:a.handleBootCampArray(t);break;case o.MsgInfo:a.handleMessageAttachments(t);break;default:a.handleMessageAttachments(t)}})}),e.on("close-light-document-preview",function(){var e=a.getSingletonView();e.close()})},"1.0.0",{requires:["event-base","mail-ui-lightdocpreview-constants","mail-ui-light-document-preview-helper","mail-ui-lightdocpreview-document-iterator","mail-ui-light-document-preview-fullscreenslideshow"]});
/*
YUI 3.16.0-ym19 (build 3.16.0-ym19)
Copyright 2016 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("cache-base",function(e,t){var n=e.Lang,r=e.Lang.isDate,i=function(){i.superclass.constructor.apply(this,arguments)};e.mix(i,{NAME:"cache",ATTRS:{max:{value:0,setter:"_setMax"},size:{readOnly:!0,getter:"_getSize"},uniqueKeys:{value:!1},expires:{value:0,validator:function(t){return e.Lang.isDate(t)||e.Lang.isNumber(t)&&t>=0}},entries:{readOnly:!0,getter:"_getEntries"}}}),e.extend(i,e.Base,{_entries:null,initializer:function(e){this.publish("add",{defaultFn:this._defAddFn}),this.publish("flush",{defaultFn:this._defFlushFn}),this._entries=[]},destructor:function(){this._entries=[]},_setMax:function(e){var t=this._entries;if(e>0){if(t)while(t.length>e)t.shift()}else e=0,this._entries=[];return e},_getSize:function(){return this._entries.length},_getEntries:function(){return this._entries},_defAddFn:function(e){var t=this._entries,r=e.entry,i=this.get("max"),s;this.get("uniqueKeys")&&(s=this._position(e.entry.request),n.isValue(s)&&t.splice(s,1));while(i&&t.length>=i)t.shift();t[t.length]=r},_defFlushFn:function(e){var t=this._entries,r=e.details[0],i;r&&n.isValue(r.request)?(i=this._position(r.request),n.isValue(i)&&t.splice(i,1)):this._entries=[]},_isMatch:function(e,t){return!t.expires||new Date<t.expires?e===t.request:!1},_position:function(e){var t=this._entries,n=t.length,r=n-1;if(this.get("max")===null||this.get("max")>0)for(;r>=0;r--)if(this._isMatch(e,t[r]))return r;return null},add:function(e,t){var i=this.get("expires");this.get("initialized")&&(this.get("max")===null||this.get("max")>0)&&(n.isValue(e)||n.isNull(e)||n.isUndefined(e))&&this.fire("add",{entry:{request:e,response:t,cached:new Date,expires:r(i)?i:i?new Date((new Date).getTime()+this.get("expires")):null}})},flush:function(e){this.fire("flush",{request:n.isValue(e)?e:null})},retrieve:function(e){var t=this._entries,r=t.length,i=null,s;if(r>0&&(this.get("max")===null||this.get("max")>0)){this.fire("request",{request:e}),s=this._position(e);if(n.isValue(s))return i=t[s],this.fire("retrieve",{entry:i}),s<r-1&&(t.splice(s,1),t[t.length]=i),i}return null}}),e.Cache=i},"3.16.0-ym19",{requires:["base"]});
YUI.add("contacts-ui-hovercard-datastore",function(e){var t,n=e.xobniContacts.searchAPI,r=e.xobniContacts.Utils.getXobniBaseURL();t=function(){var t=this;t.cache=new e.Cache({max:250,expires:36e5,uniqueKeys:!0}),e.on("xobni:contactChanged",function(e){t.addIntoCache(e.email,null)}),e.on("contacts:contactChanged",function(){t.flushCache()})},t.prototype={isFBTokenActive:null,load:function(t,n){var r=this,i,s=[],o=[];e.xobniContacts.isXobnified()?e.Array.each(t,function(e){i=r.retrieveFromCache(e),i?s.push(i):o.push(e)}):e.Array.each(t,function(e){s.push({name:e.name||e.email,email:e.email,endpoints:{smtp:[{ep:"smtp:"+e.email}]},card_size:0})}),o.length>0?(e.fire("util:ymstats",{name:"hovercard_ds",tags:{chache_hit:"false"}}),r.getContacts(o,s,n,0)):(e.fire("util:ymstats",{name:"hovercard_ds",tags:{chache_hit:"true"}}),n(s))},getContacts:function(t,r,i,s){var o=this,u=[],a,f,l=2,c;a=function(n){var o=this,u=n.contacts_by_ep,a=n.contacts_info,f,l,c;e.Object.each(u,function(n,i){l=i.replace("smtp:",""),f=n&&n[0],f?c=o.massageContactData(a[f],l):e.Array.each(t,function(e){l===e.email&&(c=o.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email))}),r.push(c),o.addIntoCache(l,c)}),e.fire("util:ymstats",{name:"hovercard_api",tags:{api:"contactsByEp",result:"success",retry:s}}),i(r)},f=function(n){e.fire("util:ymstats",{name:"hovercard_api",tags:{api:"contactsByEp",result:"failure",retry:s}}),s<l?(s++,o.getContacts(t,r,i,l)):(e.Array.each(t,function(e){r.push(o.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email))}),i(r))},e.Array.each(t,function(e){c=e.isCompose,u.push("smtp:"+e.email)}),n.contactsByEp({eps:u,isCompose:c},e.bind(a,o),e.bind(f,o))},massageContactData:function(t,n,i){var s=this,o={},u=t.endpoints,a,f,l;o={id:t.id,email:n,edit_token:t.edit_token,image_url:r.url,updated:Math.floor(Math.random()*1e5),card_size:0,endpoints:[],location:"",wssid:NeoConfig.wssid,appid:e.common.Utils.settings.value("appid"),buildNumber:NeoConfig.buildNumber,isKnownEntity:t.is_known_entity,isMachineGenerated:!1},t.name?o.name=t.name.name:o.name=i||n,t.role&&(o.card_size++,o.company=t.role.company,o.position=t.role.position,o.company&&o.position?o.title=o.position+", "+o.company:o.title=o.position||o.company,e.fire("util:ymstats",{name:"hovercard_role",tags:{source:t.role.source,isCorp:NeoConfig.isCorpmail?"true":"false"}}));for(l=0;l<u.length;l++)a=u[l],!o.phone&&a.ep.match(/tel:/g)?(o.card_size++,o.phone=a.display||a.ep.replace("tel:",""),o.isElcaro=a.source==="elcaro"?!0:!1,e.fire("util:ymstats",{name:"hovercard_phone",tags:{source:a.source,isCorp:NeoConfig.isCorpmail?"true":"false"}})):!o.im&&a.ep.match(/ymessenger:/g)?o.im=a.display||a.ep.replace("ymessenger:",""):!o.facebook&&a.ep.match(/facebook:/g)?(o.facebook=a.display||a.ep.replace("facebook:",""),o.facebook_url="https://www.facebook.com/"+o.facebook):!o.linkedin&&a.ep.match(/linkedin:/g)?(o.linkedin=a.ep.replace("linkedin:",""),o.linkedin_url=a.display):!o.twitter&&a.display&&a.source==="twitter"?(o.twitter=a.display,o.twitter_url="https://twitter.com/"+o.twitter+"?app=yahoo_mail"):!o.flickr&&a.ep.match(/flickr:/g)&&(o.flickr=a.ep.replace("flickr:",""),o.flickr_url="https://www.flickr.com/"+o.flickr),f=a.ep.split(":"),o.endpoints[f[0]]||(o.endpoints[f[0]]=[]),o.endpoints[f[0]].push(a);return e.Array.each(t.attributes,function(e){e.key==="location"&&(o.location=e.value),e.key==="user_id"&&e.source==="corpdir"&&(o.corpId=e.value),e.key==="last_edit_timestamp"&&(o.updated=e.value),e.key==="is_machine_generated"&&(o.isMachineGenerated=e.value==="true"?!0:!1)}),o},addIntoCache:function(e,t){var n=this;n.cache.add(e,t)},retrieveFromCache:function(e){var t=this,n,r;return e.email===NeoConfig.emailAddress?r=t.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email):(n=t.cache.retrieve(e.email),r=n&&n.response||null),r},flushCache:function(){this.cache.flush()}},e.namespace("mail.ui"),e.mail.ui.HoverCardDataStore=new t},"0.0.1",{requires:["cache-base","xobni-utilities","xobni-contacts-search-api","mail-common-utils-settings"]});
YUI.add("hovercard-ult",function(e){e.mix(e.common.Utils.RapidCM,{cmps_hvrCrdNewMsg:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdNewMsg"],cmps_hvrCrdNewIM:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdNewIM"],cmps_hvrCrdSrchMsg:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdSrchMsg"],cmps_hvrCrdAddCntct:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdAddCntct"],cmps_hvrCrdLnkBkyrd:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkBkyrd"],cmps_hvrCrdLnkFb:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkFb"],cmps_hvrCrdLnkTwtr:["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkTwtr"],msgRd_hvrCrdNewMsg:["hvrCrd","msgRdTb","msgHdr","hvrCrdNewMsg"],msgRd_hvrCrdNewIM:["hvrCrd","msgRdTb","msgHdr","hvrCrdNewIM"],msgRd_hvrCrdSrchMsg:["hvrCrd","msgRdTb","msgHdr","hvrCrdSrchMsg"],msgRd_hvrCrdAddCntct:["hvrCrd","msgRdTb","msgHdr","hvrCrdAddCntct"],msgRd_hvrCrdLnkBkyrd:["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkBkyrd"],msgRd_hvrCrdLnkFb:["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkFb"],msgRd_hvrCrdLnkTwtr:["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkTwtr"],thrdRd_hvrCrdNewMsg:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdNewMsg"],thrdRd_hvrCrdNewIM:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdNewIM"],thrdRd_hvrCrdSrchMsg:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdSrchMsg"],thrdRd_hvrCrdAddCntct:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdAddCntct"],thrdRd_hvrCrdLnkBkyrd:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkBkyrd"],thrdRd_hvrCrdLnkFb:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkFb"],thrdRd_hvrCrdLnkTwtr:["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkTwtr"]}),e.mix(e.common.Utils.RapidVM,{cmps_hvrCrd:["cmps_hvrCrdNewMsg","cmps_hvrCrdNewIM","cmps_hvrCrdSrchMsg","cmps_hvrCrdAddCntct","cmps_hvrCrdLnkBkyrd","cmps_hvrCrdLnkFb","cmps_hvrCrdLnkTwtr"],msgRd_hvrCrd:["msgRd_hvrCrdNewMsg","msgRd_hvrCrdNewIM","msgRd_hvrCrdSrchMsg","msgRd_hvrCrdAddCntct","msgRd_hvrCrdLnkBkyrd","msgRd_hvrCrdLnkFb","msgRd_hvrCrdLnkTwtr"],thrdRd_hvrCrd:["thrdRd_hvrCrdNewMsg","thrdRd_hvrCrdNewIM","thrdRd_hvrCrdSrchMsg","thrdRd_hvrCrdAddCntct","thrdRd_hvrCrdLnkBkyrd","thrdRd_hvrCrdLnkFb","thrdRd_hvrCrdLnkTwtr"]})},"1.0.0",{requires:["common-utils-rapid-clickmap","common-utils-rapid-viewmap"]});
YUI.add("_shared_module_offscreen_bin_contacts_hovercard",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_offscreen_bin_contacts_hovercard={base:'<div class=\'hovercard-arrow\'> <div class=\'inner\'></div></div><div id="hovercard" class="size-{{card_size}}"> <div class="image icon-attendee"> {{profile_photo}} {{upsell_link}} </div> <div class="bd"> <div class="name" tabindex="-1" > <span>{{name}}</span> </div> {{_title}} {{_email}} {{_phone}} <div class="link search" tabindex="-1" > <i class="icon icon-search"></i><span tabindex="-1" data-action="search-msg" title="{{str_people_card_search_msgs}}" >{{str_people_card_msgs}}</span> </div> </div> <div class="footer"> <div class="more"> <span data-action="more"> <i class="icon icon-more" ></i> </span> </div> <div class="menu-more optionMenu" role="menu" tabindex="-1"> <ul role="group"> {{add_contact}} {{edit_card}} <li data-action="copy-email" class="copy-email clipboard disabled" role="presentation" title="{{str_hovercard_copy_email}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_copy_email}}</span></a> </li> <li data-action="copy-all" id="copy_all" class="copy-all clipboard disabled" role="presentation" title="{{str_hovercard_copy_all}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_copy_all}}</span></a> </li> </ul> </div> <div class="social"> {{_backyard}} {{_facebook}} {{_flickr}} {{_linkedin}} {{_twitter}} </div> </div></div>',profile_photo:'<div class="image" id="hcardProfileImg" style="background-image: url({{image_url}}/v4/contacts/{{id}}/photo?spsize=250X250&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}})" data-action="open-img-src" data-value=""> <img style="display:none" id="upsellImg" src="{{image_url}}/v4/contacts/{{id}}/photo?spsize=250X250&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}}" /> </div> ',upsell_link:'<div class="upsell hidden {{service}} {{reconnect}}" data-value="{{service}}" data-action="upsell-connect"> <span><i class="icon icon-{{logo}}"></i></span> <span class="label">{{label}}</span> <span class="decline" data-value="{{service}}" data-action="upsell-hide" title="{{str_hovercard_fb_dismiss}}"> <i class="icon icon-close"></i> </span> </div> ',_title:'<div class="title"> <span>{{title}}</span> </div> ',_email:'<div class="link email" tabindex="-1" title="{{str_people_card_new_compose}}" data-to="{{email}}" data-name="{{name}}" > <i class="icon icon-mail-inbox"></i><span data-action="new-message" ><a href="mailto:{{email}}">{{email}}</a></span> </div> ',_phone:'<div class="phone" tabindex="-1" > <i class="icon icon-mobile-phone"></i><span dir="ltr" class="{{phone_style}}" title="{{phone_source}}" >{{phone}}</span> </div> ',add_contact:'<li data-action="add-contact" role="presentation" title="{{str_people_card_add_contacts}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_people_card_add_contacts}}</span></a> </li> ',edit_card:'<li data-action="edit-card" role="presentation" title="{{str_hovercard_edit_card}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_edit_card}}</span></a> </li> ',_backyard:'<i data-action="backyard" title="{{str_hovercard_backyard_profile}}" class="icon icon-logo-backyard" ></i> ',_facebook:'<i data-action="facebook" title="{{str_hovercard_facebook_profile}}" class="icon icon-facebook" ></i> ',_flickr:'<span class="circle" data-action="flickr" title="{{str_hovercard_flickr_profile}}"> <span class="inner c1"></span> <span class="inner c2"></span> </span> ',_linkedin:'<i data-action="linkedin" title="{{str_hovercard_linkedin_profile}}" class="icon icon-linkedin" ></i> ',_twitter:'<i data-action="twitter" title="{{str_hovercard_twitter_profile}} {{twitter}}" class="icon icon-twitter" ></i> '}},"1.0.0");
YUI.add("_shared_module_offscreen_bin_contacts_hovercard_mini",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_offscreen_bin_contacts_hovercard_mini={base:"<div class='hovercard-arrow'> <div class='inner'></div></div><div id=\"hovercard\" class=\"mini\"> {{contact_item}}</div>",profile_photo:'<div class="image" style="background-image: url({{image_url}}/v4/contacts/{{id}}/photo?wssid={{wssid}}&appid={{appid}}&spsize=72X72&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}})"></div> ',_name:'<div class="name"> <span>{{name}}</span> </div> ',_email:'<div class="title" > <span>{{email}}</span> </div> ',_title:'<div class="title"> <span>{{title}}</span> </div> ',contact_item:'<div class="item"> <div class="line"></div> <div class="image icon-attendee"> {{profile_photo}} </div> <div class="bd"> {{_name}} {{_email}} {{_title}} </div> </div> '}},"1.0.0");
YUI.add("contacts-ui-hovercard-plugin",function(e){var t,n=e.common.Utils,r=e.mail,i=e.ui.Templates,s=n.substitute,o=n.escapeHtml,u=n.unescapeHtml,a=n.convertToBoolString,f=r.ui.HoverCardDataStore,l=r.persist.MetaData,c=r.common.ConnectedAccounts,h=i._shared_module_offscreen_bin_contacts_hovercard,p=i._shared_module_offscreen_bin_contacts_hovercard_mini,d={regular:i._shared_module_offscreen_bin_contacts_hovercard,mini:i._shared_module_offscreen_bin_contacts_hovercard_mini},v=["mini","regular"],m="menu-active-item",g=null,y=[],b=e.xobniContacts.isXobnified(),w=e.xobniContacts.searchAPI,E=n.settings.value("facebook_credstore_spid");t=e.Base.create("hovercard",e.Widget,[e.WidgetPosition,e.WidgetStack,e.WidgetPositionConstrain],{mouseMoveTimeout:null,initializer:function(){var e=this;e._hcardSelectors=".message-item-header .hcard, .thread-item-header .hcard, .compose-header .hcard",e._currTrigger={node:null,dataAddress:null,contactsData:[],cardSize:null,mouseX:t.OFFSCREEN_XY[0],mouseY:t.OFFSCREEN_XY[1]},e._eventHandles={delegateEnter:null,delegateLeave:null},e._timers={show:null,hide:null,offscreen:null}},bindUI:function(){var t=this;t._bindDelegate(),e.on("lozenge:highlight",function(){t._hideHoverCard()}),e.on("lozenge:remove",function(){t._hideHoverCard()}),e.on("HoverCard:hideHoverCard",function(){t._hideHoverCard()})},syncUI:function(){var e=this;e.get("boundingBox").setStyles({position:"absolute"})},_bindDelegate:function(){var t=this,n=t._eventHandles,r=e.one("#shellcontent");n.delegateEnter&&(n.delegateEnter.detach(),n.delegateEnter=null),n.delegateLeave&&(n.delegateLeave.detach(),n.delegateLeave=null),n.delegateEnter=r.delegate(["mouseenter","mousedown"],e.bind(t._onNodeMouseEnter,t),t._hcardSelectors),n.delegateLeave=r.delegate("mouseleave",e.bind(t._onNodeMouseLeave,t),t._hcardSelectors)},setTriggerContent:function(t){var n=this,r=n._currTrigger,i=r.cardSize,s=n.get("contentBox"),o;e.Lang.isUndefined(b)&&(b=e.xobniContacts.isXobnified());if(i===v[0]||i===v[1]&&r.dataAddress===t[0].email)r.contactsData=t,s.set("innerHTML",""),o=n._getHoverCardMarkup(),s.appendChild(o),n._showHoverCard(),n._bindContentBoxUI(),i===v[1]&&t[0].id&&n.setProfilePhotoHandler()},_onNodeMouseEnter:function(t){var n=this,r=t.currentTarget;t.halt(),n._clearTimers();if(r.get("parentNode").hasClass("focus")||r.hasClass("lozenge-error")){n._hideHoverCard();return}n._triggerNodeChanged(t)?(n._hideHoverCard(),n._toggleTitleAttr(r,!0),clearTimeout(n.mouseMoveTimeout),e.fire("hideHoverCardCallout"),t.type==="mousedown"?r.hasClass("cl")||n._showCard(r,t.pageX,t.pageY):n.mouseMoveTimeout=setTimeout(function(){n._showCard(r,t.pageX,t.pageY)},400)):t.type==="mousedown"&&!r.hasClass("cl")&&(r.hasClass("active")?n.hideHoverCard():n._showCard(r,t.pageX,t.pageY))},_showCard:function(e,t,n){this._clearTimers(),this._clearHandles(),this._setOffscreenTimer(),this._setCurrentTrigger(e,t,n)},_triggerNodeChanged:function(e){var t=this,n=e.currentTarget,r=t._currTrigger.node,i=n&&n.getAttribute("data-address");return i?r?i===t._currTrigger.dataAddress&&n.getY()===r.getY()?!1:!0:!0:!1},_onNodeMouseLeave:function(t){var n=this,r=t.currentTarget;n._setNodeActive(!1),n._toggleTitleAttr(r,!1),clearTimeout(n.mouseMoveTimeout),n._timers.hide=e.later(n.get("delay.hide"),n,n._hideHoverCard)},_onNodeMouseMove:function(e){var t=this;e.halt(),t._currTrigger.mouseX=e.pageX,t._currTrigger.mouseY=e.pageY},_toggleTitleAttr:function(t,n){var r=e.mail.Tabs.getActiveTab().elContent,i=r&&r.all("[title]"),s="title",o="title-off",u,a,f;n?(u=o,a=s):(u=s,a=o),i&&i.each(function(e){f=e.getAttribute(a),f&&(e.setAttribute(a,""),e.setAttribute(u,f))})},_showHoverCard:function(){var n=this,r=n._currTrigger,i=r.node,s=i.hasClass("cl"),o=i.hasClass("more"),u=i&&i.get("parentNode").hasClass("focus"),f,l;f=n._getXYForPosition(),f&&!u&&(n.move(f[0]+t.OFFSET_XY[0],f[1]+t.OFFSET_XY[1]),(s||o)&&n._track("view","hvrCrd"),e.fire("util:ymstats",{name:"hovercard",tags:{size:r.cardSize,isCorp:a(NeoConfig.isCorpmail)}}),r.cardSize===v[1]&&(l=r.contactsData[0],e.fire("util:ymstats",{name:"hovercard_name",tags:{name:l.name===l.email?"email":"name",xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_tel",tags:{phone:a(l.phone),xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_facebook",tags:{facebook:a(l.facebook),xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_twitter",tags:{twitter:a(l.twitter),xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_linkedin",tags:{linkedin:a(l.linkedin),xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_flickr",tags:{flickr:a(l.flickr),xuser:a(b),xcontact:a(l.id),isCorp:a(NeoConfig.isCorpmail)}})),e.ACWidgetInst&&e.ACWidgetInst.hide(),n.show(),n._clearOffscreenTimer())},_getXYForPosition:function(){var t=this,n=t.get("boundingBox"),r=n.one(".hovercard-arrow"),i=e.one("html"),s=strings.str_tog_loadRTLCss?!0:!1,o=t._currTrigger,u=o.node,a,f,l,c,h,p,d,v,m;if(u){f=o.mouseX,l=o.mouseY,a=u.getXY(),c=u.get("clientHeight"),h=u.get("clientWidth"),v=n.get("clientWidth")-20,m=n.get("clientHeight")-20;if(a[0]&&a[1])return p=i.get("clientWidth"),d=i.get("clientHeight"),s?f>v?(f=h<30?a[0]+10:a[0]-10,f=f+h-v):(f=h<30?a[0]-30:a[0]-10,r&&r.setStyle("right",v-30+"px")):(f=h<30?a[0]-30:a[0]-10,p-f<v&&(f=a[0]+h-v,r&&r.setStyle("left",v-30+"px"))),d-l<m?(l=a[1]-c-m,r.addClass("down")):(r.removeClass("down"),l=a[1]+20),[f,l]}return!1},_hideHoverCard:function(){var e=this;try{e._currTrigger.dataAddress&&(e._toggleTitleAttr(e._currTrigger.node,!1),e.hide(),e._setNodeActive(!1),e._clearCurrentTrigger(),e._clearTimers(),e._setOffscreenTimer())}catch(t){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-contacts-ui-hovercard-hovercard-plugin:1",t,"TRY_CATCH",1,1,1):window.console&&console.log&&
console.log("caughterror:..-build-contacts-ui-hovercard-hovercard-plugin:1")}},_setNodeActive:function(e){var t=this,n=t._currTrigger.node,r=t._currTrigger.cardSize;r===v[1]&&n&&n.getDOMNode()&&n.toggleClass("active",e)},hideHoverCard:function(){this._hideHoverCard()},_setOffscreenTimer:function(){var t=this,n=t._timers;t._clearOffscreenTimer(),n.offscreen=e.later(t.get("delay.offscreen"),t,t._moveOffscreen)},_moveOffscreen:function(){this.get("boundingBox").setStyles({top:t.OFFSCREEN_XY[0]})},_clearOffscreenTimer:function(){var e=this._timers;e.offscreen&&e.offscreen.cancel()},_setCurrentTrigger:function(t,n,r){var i=this,s=i._currTrigger,o,u,a=[],l,c;u=t.getAttribute("data-name"),o=t.getAttribute("data-address"),l=t.hasClass("cl"),c=t.hasClass("more"),s.mouseX=n,s.mouseY=r,s.node=t,s.dataAddress=o,c?(s.cardSize=v[0],o=o.split(","),e.Array.each(o,function(e){a.push({name:e,email:e,isCompose:l})})):(s.cardSize=v[1],a.push({name:u,email:o,isCompose:l})),i._setNodeActive(!0),g&&clearTimeout(g),g=setTimeout(function(){f.load(a,e.bind(i.setTriggerContent,i))},0),!c&&!l&&(i._track("view","hvrCrd"),i.setTriggerContent([{name:u,email:o,isCompose:l,card_size:0,endpoints:[]}]))},_clearCurrentTrigger:function(){var e=this,t=e._currTrigger,n;t.node&&(n=t.node,t.node=null,t.dataAddress=null,e._clearHandles())},_clearTimers:function(){var e=this._timers;e.hide&&(e.hide.cancel(),e.hide=null)},_clearHandles:function(){var t;for(t in y)e.detach(y[t]);y=[]},_getHoverCardMarkup:function(){var t=this,r=t._currTrigger.contactsData,f=t._currTrigger.cardSize,l=f===v[0]?r:r[0],h=d[f],p,m=function(t){var n=e.contacts&&e.contacts.utils.getContactsByEmail(t)||[!1];return n[0]&&n[0].id>=0?n[0].id:!1};return p={_name:function(e,t,n){return e.name?(e.name=o(u(e.name)),s(h._name,e,null,null,strings)):""},_title:function(e,t,n){return e.title?(e.title=o(u(e.title)),s(h._title,e,null,null,strings)):""},_email:function(e,t,n){return f===v[1]||f===v[0]&&!e.title?(e.email=o(u(e.email)),s(h._email,e,null,null,strings)):""},_phone:function(e,t,r){return e.phone?(e.phone=o(u(e.phone)),e.isElcaro===!0?(e.phone_source=strings.str_hovercard_phone_src,e.phone_style=n.features.enabled("highlightElCaro")===!0?"elcaro":""):e.phone_source="",s(h._phone,e,null,null,strings)):""},add_contact:function(e,t,n){return m(e.email)===!1?s(h.add_contact,e,null,null,strings):""},edit_card:function(e,t,n){return e.id?s(h.edit_card,e,null,null,strings):""},_backyard:function(e,t,n){return e.corpId&&NeoConfig.isCorpmail?s(h._backyard,e,null,null,strings):""},_facebook:function(e,t,n){return e.facebook?(e.facebook=o(u(e.facebook)),s(h._facebook,e,null,null,strings)):""},_twitter:function(e,t,n){return e.twitter?(e.twitter=e.twitter.indexOf("@")===0?e.twitter:"@"+e.twitter,e.twitter=o(u(e.twitter)),s(h._twitter,e,null,null,strings)):""},_linkedin:function(t,n,r){return t.linkedin?(e.fire("util:ymstats",{name:"hovercard_linkedin_rendered"}),t.linkedin=o(u(t.linkedin)),s(h._linkedin,t,null,null,strings)):""},_flickr:function(e,t,n){return e.flickr?(e.flickr=o(u(e.flickr)),s(h._flickr,e,null,null,strings)):""},upsell_link:function(t,n,r){var i,o=c.getUpsell(),u=o==="linkedin"&&c.forceReconnect();return o&&b===!0&&t.isKnownEntity===!1&&t.isMachineGenerated===!1?(i={service:o,logo:o==="twitter"?o:"logo-"+o,label:u?strings.str_reauthorize:strings.str_hovercard_get_photos,reconnect:u?"reconnect":""},e.fire("util:ymstats",{name:"hovercard_action",tags:{action:o+"_showUpsell",isCorp:a(NeoConfig.isCorpmail),reconnect:u}}),s(h.upsell_link,i,null,n,strings)):""},profile_photo:function(e,t,n){return e.id?s(h.profile_photo,e,null,null,strings):""},contact_item:function(n,r,a){var f="";return e.Array.each(n,function(e){e.name=o(u(e.name)),f+=s(h.contact_item,e,p,{},strings,i,t)}),f}},l.name&&(l.name=o(u(l.name))),s(h.base,l,p,{},strings,i,t)},_bindContentBoxUI:function(){var t=this,r=t._currTrigger.contactsData[0],i=t.get("boundingBox"),s=t._currTrigger,o=s.node,u,f,l,c;t._clearHandles(),o&&(f=o.ancestor(".thread-item-list"),y.push(e.one("document").on("keydown",e.bind(function(e){e.keyCode!==67&&!e.ctrlKey&&!e.metaKey&&t._hideHoverCard()},t))),y.push(i.on("mouseenter",e.bind(function(e){var t=this;t._setNodeActive(!0),t._clearTimers()},t))),y.push(i.on("mouseleave",e.bind(function(t){var n=this,r=t.target.ancestor(".clipboard");r||(n._clearTimers(),n._timers.hide=e.later(n.get("delay.hide"),n,n._hideHoverCard))},t))),y.push(o.on("mousemove",e.bind(t._onNodeMouseMove,t))),f&&y.push(f.on("scroll",e.bind(t._hideHoverCard,t))),s.cardSize===v[1]&&(u=i.one(".upsell"),y.push(i.one(".more").on("mouseenter",e.bind(function(n){i.all("li."+m).removeClass(m),i.one(".menu-more").setStyle("display","block"),e.fire("util:ymstats",{name:"hovercard_action",tags:{action:"more",isCorp:a(NeoConfig.isCorpmail)}}),t._setupClipBoard()},t),t)),y.push(i.one(".footer").on("mouseleave",function(e){var t=e.target.ancestor(".clipboard");t||i.one(".menu-more").setStyle("display","none")})),y.push(i.one(".menu-more").delegate("mouseenter",e.bind(function(e){i.all("li."+m).removeClass(m)},t),"li")),y.push(i.delegate("click",function(r){l=n.getDataAction(r),c=l.action,r.halt(),t._handleAction(l),c!=="more"&&c!=="upsell-hide"&&t._hideHoverCard(),c!=="more"&&c!=="upsell-connect"&&c!=="upsell-hide"&&e.fire("util:ymstats",{name:"hovercard_action",tags:{action:c,isCorp:a(NeoConfig.isCorpmail)}})},"*[data-action]")),u&&r.id&&y.push(i.one("#upsellImg").on("error",function(e){u.hasClass("reconnect")||u.removeClass("hidden")}))),s.cardSize===v[0]&&y.push(o.on("click",e.bind(t._hideHoverCard,t))))},_handleAction:function(t){var n=this,i=n._currTrigger.node,s=n._currTrigger.contactsData[0],o="click";switch(t.action){case"new-message":if(!i.hasClass("cl")){var u={cbfn:function(e){var t={};return t.to=[{name:s.name,email:s.email}],e.setHeader(t),!0}};e.fire("newMessage",u),n._track(o,"hvrCrdNewMsg")}break;case"add-contact":e.use("contacts-ui-hovercard-addedit",function(e){(new r.ui.HoverCardAddEdit({action:"addContact"
,data:s})).show()}),n._track(o,"hvrCrdAddCntct");break;case"edit-card":e.use("contacts-ui-hovercard-addedit",function(e){(new r.ui.HoverCardAddEdit({action:"editCard",data:s})).show()});break;case"search-msg":e.fire("search:fireSearch",{suggestion:{displayStr:s.email,emailAddresses:[s.email]},typeTag:"hovercard_search_email"}),n._track(o,"hvrCrdSrchMsg");break;case"backyard":e.use("mail-common-corpmail",function(e){r.common.corpmail.showBackyardProfile(s.corpId)}),n._track(o,"hvrCrdLnkBkyrd");break;case"facebook":window.open(s.facebook_url),n._track(o,"hvrCrdLnkFb");break;case"twitter":window.open(s.twitter_url),n._track(o,"hvrCrdLnkTwtr");break;case"linkedin":e.fire("util:ymstats",{name:"hovercard_linkedin_clicked"}),window.open(s.linkedin_url);break;case"flickr":window.open(s.flickr_url);break;case"upsell-connect":n._openUpsell(t.node);break;case"upsell-hide":n._hideUpsell(t.node);break;case"open-img-src":var a=t.node.getAttribute("data-value");n._openImageSrc(a)}},setProfilePhotoHandler:function(){var t=this,n=t._currTrigger.contactsData[0],r=t.get("boundingBox"),i=r.one("#hcardProfileImg"),s={facebook:strings.str_hovercard_facebook_profile,linkedin:strings.str_hovercard_linkedin_profile,twitter:strings.str_hovercard_twitter_profile+" "+t.getTwitterHandle(),corpdir:strings.str_hovercard_backyard_profile,flickr:strings.str_hovercard_flickr_profile},o=function(t){t!==!1&&(n.photoSrc=t,["facebook","twitter","linkedin","flickr","corpdir"].indexOf(t)>-1&&(i.setAttribute("data-value",t),i.setAttribute("title",s[t]),i.setStyle("cursor","pointer"),t==="linkedin"&&r.one(".upsell.reconnect")&&(i.ancestor(".icon-attendee").addClass("reconnect"),r.one(".upsell").removeClass("hidden")))),e.fire("util:ymstats",{name:"hovercard_imgsrc",tags:{src:t,isCorp:a(NeoConfig.isCorpmail)}})};e.Lang.isUndefined(n.photoSrc)?w.photo(n,e.bind(o,t)):o(n.photoSrc)},_openImageSrc:function(t){var n=this,i=n._currTrigger.contactsData[0],s;if(t){switch(t){case"corpdir":e.use("mail-common-corpmail",function(e){r.common.corpmail.showBackyardProfile(i.corpId)});break;case"facebook":window.open(i.facebook_url);break;case"twitter":window.open(i.twitter_url);break;case"linkedin":e.fire("util:ymstats",{name:"hovercard_linkedin_clicked"}),window.open(i.linkedin_url);break;case"flickr":window.open(i.flickr_url)}e.fire("util:ymstats",{name:"hovercard_imgClkSrc",tags:{src:t,isCorp:a(NeoConfig.isCorpmail)}})}},_setupClipBoard:function(){var t=this,n,r=t._currTrigger.contactsData[0],i=t.get("contentBox"),s=t.get("contentBox").all(".clipboard");e.use("swfdetect","comms-ui-clipboard-plugin",function(e){e.SWFDetect.isFlashVersionAtLeast(10,1,0)&&(n=e.comms.ui.ClipBoard,s.each(function(s){s instanceof e.Node&&s.plug(n,{moviepath:NeoConfig.copySwfMoviePath}).on("clipboard:load",function(){var n=this;n.removeClass("disabled"),n.on("mouseenter",function(e){this.hasClass("copy-email")?this.setAttribute("copy",r.email):this.setAttribute("copy",[r.name,r.title,r.email,r.phone].join("\n"))},n),n.on("mouseleave",function(e){n.removeClass(m)},n),n.clipboard.setEvent("click",e.bind(function(e){n.clipboard.hide(),t.hideHoverCard()},n),!0),n.clipboard.setEvent("mouseOver",function(e){i.all("li."+m).removeClass(m),n.addClass(m),n.focus()}),e.on("HoverCard:hideHoverCard",function(){n.clipboard.removeEvent("mouseOver"),n.clipboard.removeEvent("click"),n.clipboard.hide()})})}),e.on("clipboard:error",function(e){s.addClass("disabled")}))})},_openUpsell:function(t){var n=t.getData("value");n&&(c.linkTo(n),e.fire("util:ymstats",{name:"hovercard_action",tags:{action:n+"_openUpsell",isCorp:a(NeoConfig.isCorpmail)}}))},_hideUpsell:function(t){var n=t.getData("value");return e.fire("util:ymstats",{name:"hovercard_action",tag:{action:n+"_hideUpsell",isCorp:a(NeoConfig.isCorpmail),reconnect:t.hasClass("reconnect")}}),t.ancestor(".upsell").remove(),c.hideUpsell(n)},_track:function(t,n){var r,i=t==="view"?"mt:view":"mt:click",s;r=e.mail.Tabs.getActiveTab().get("widget").type;switch(r){case"author":s="cmps";break;case"convpane":case"convlist":s="thrdRd";break;case"messagepane":case"messagelist":s="msgRd"}e.fire(i,{action:s+"_"+n})},getTwitterHandle:function(){var e=this,t=e._currTrigger.contactsData[0],n="";return t&&t.twitter&&(n=t.twitter.indexOf("@")===0?t.twitter:"@"+t.twitter),n}},{OFFSCREEN_XY:[-1e4,-1e4],OFFSET_XY:[0,0],ATTRS:{shim:{value:!1},render:{value:!0},trigger:{value:".hcard"},zIndex:{value:100},delay:{value:{show:100,hide:300,auto:1e3,offscreen:0}},xy:{value:[-1e4,-1e4]},constrain:{value:!0}}}),e.namespace("mail.ui"),e.mail.ui.HoverCard=t},"0.0.1",{requires:["node","widget","widget-position","widget-position-constrain","widget-stack","event-mouseenter","common-utils","comms-utils","contacts-ui-hovercard-datastore","mail-common-connected-accounts","hovercard-ult","isXobnifiedCheck","xobni-contacts-search-api","mail-common-utils-settings","mail-common-utils-features","_shared_module_offscreen_bin_contacts_hovercard","_shared_module_offscreen_bin_contacts_hovercard_mini","hovercard_css"]});
