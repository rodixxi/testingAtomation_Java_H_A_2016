YUI.add("mail-core-net-policies-basic",function(e){var t=function(){this.requests={}};e.mix(t.prototype,{enforce:function(){},add:function(){}}),e.namespace("Mail.Core.Net.Policies").BasicPolicy=t},"1.0.0",{requires:[]});
YUI.add("mail-controller-alertstore",function(e){var t=e.Mail.Core.Net.Helpers.V3RequestHelper,n=new e.Mail.Core.Net.Transport(new e.Mail.Core.Net.Policies.BasicPolicy),r=e.common.Utils,i="reauth-alert",s;s={PasswordExpireType:1,SendFailureType:2,SyncStateType:3,CLIENT_ACTIONABLE_STATE:4002,CLIENT_NOTACTIONABLE_STATE:4003,SERVER_INTERNAL_STATE:5e3,ExpiredAccounts:[],ExpiredAccountsAlertIds:[],ImapInAccountType:"IMAPIN",_alerts:[],listAlerts:function(e){var r=t.getV3RequestUrl("alerts");return n.requestGet(r,e)},checkAlerts:function(){var t={suppressNotification:!0,suppressStat:!1};s.listAlerts(t).then(function(n){var i=n.result.alerts,o=i.length,u=[],a=[],f=e.mail.Controller.ImapIn,l;s._alerts=[];for(l=0;l<o;l++)(i[l].state===s.CLIENT_ACTIONABLE_STATE||i[l].state===s.CLIENT_NOTACTIONABLE_STATE)&&f.getAccountAttribute(i[l].accountId,"type")===s.ImapInAccountType&&s._alerts.push(i[l]);o=s._alerts.length;if(r.features.enabled("reAuthAlerts")){for(l=0;l<o;l++)s._alerts[l].type===s.PasswordExpireType&&(u.push(s._alerts[l].accountId),a.push(s._alerts[l].id));s.ExpiredAccounts=u,s.ExpiredAccountsAlertIds=a,u.length>0&&s.showAlertsOnLeftRail()}r.features.enabled("syncAlerts")&&s.checkSyncProgress()},function(){})},showAlertsOnLeftRail:function(){var t=s.ExpiredAccounts,n=t.length,r=e.one("#accountListnav"),o;r.all(".account-item-li").removeClass(i);for(o=0;o<n;o++)r.one('[data-fid="'+t[o]+'"]').addClass(i),e.fire("util:ymstats",{name:"reauth_leftrail_display"})},checkSyncProgress:function(){var t=s._alerts,n=[],i=e.all(".account-item-li.syncing"),o=i?i._nodes:[],u=o.length,a=r.settings.value("imapSyncPercentage"),f=t.length,l,c,h;for(c=0;c<u;c++)n.push(o[c].getAttribute("data-fid"));if(n.length===0)return;for(c=0;c<f;c++)h=n.indexOf(t[c].accountId),h>-1&&(l=t[c].data.percentage,l>=a?o[h].className=o[h].className.replace("syncing",""):o[h].getElementsByClassName("icon-sync")[0].setAttribute("title",r.substitute(strings.str_nav_left_syncing_percentage_title,{syncing_percentage:l})))},reauthUpdateAlert:function(r){var o=r.id,u=s.ExpiredAccounts.indexOf(o),a,f,l,c,h;if(u===-1)return;a=s.ExpiredAccountsAlertIds[u],f=t.getV3RequestUrl("alerts",{id:a}),l={suppressNotification:!0,suppressStat:!1},c={alert:{state:s.SERVER_INTERNAL_STATE}},h=n.request(f,c,l),e.one('.account-item-li[data-fid="'+o+'"]').removeClass(i),s.ExpiredAccounts.splice(u,1),s.ExpiredAccountsAlertIds.splice(u,1),h.then(function(){e.fire("util:ymstats",{name:"updateAlertSuccess"})},function(){e.fire("util:ymstats",{name:"updateAlertFailure"})})}},e.on("imapin:accountReAuthed",s.reauthUpdateAlert),e.namespace("mail.Controller").AlertStore=s},"1.0.0",{requires:["mail-core-net-policies-basic","mail-core-net-transport","mail-core-net-helpers-v3-request-helper","mail-model-datastore","common-utils","mail-controller-imapin"]});
