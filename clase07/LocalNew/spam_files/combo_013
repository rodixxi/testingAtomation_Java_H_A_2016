YUI.add("mail-ui-messagesview-resize",function(H){H.namespace("mail.MessagesViewResize");var E=H.common.persist.getCookie(),G="pos.vslider",F=function(){};function A(J){var N=this,L=J.cursor||"row-resize",I,M,K;N.id=J.id||"rail-resize-hori";N.drag_node=M=H.one("#"+N.id);N.realParent=I=J.messagesview.get("parentNode")||J.messagesview.get("tabNode");N.inbox=I.one("div.inbox");N.tripane=I.one("div.tripane");N.on=(typeof J.on!==undefined)?J.on:1;N.msgsView=J.messagesview;N.OFFSET_STYLE=N.OFFSET_STYLE||"offsetHeight";N.INBOX_STYLE=N.INBOX_STYLE||"height";N.TRIPANE_STYLE=N.TRIPANE_STYLE||"top";N.DRAG_STYLE=N.DRAG_STYLE||"top";N.COOKIE_NAME=N.COOKIE_NAME||G;N.PREFIX=N.PREFIX||"";N.MIN_PANE=NeoConfig.minBottomPreviewHeight;N.MIN_LIST=N.MIN_LIST||100;N.DEFAULT=NeoConfig.minBottomPreviewHeight;if(!M){N.drag_node=M=H.Node.create('<div onmousedown="return false" unselectable="on" style="position:absolute;z-index:1" id="'+N.id+'"></div>');K=E.get(G);if(K&&parseInt(K,10)<NeoConfig.minBottomPreviewHeight){K=NeoConfig.minBottomPreviewHeight;}M.setStyles(J.styles||{top:K||N.DEFAULT});I.append(M);}(new H.mail.DD({scope:this,start:N.start,end:N.endUp,move:N.moveMouse,node:N.drag_node,cursor:L,disable:H.one("#msg-list")}));N.checkDisplay();}A.prototype={checkDisplay:function(){var N=this,L=E.get(N.COOKIE_NAME)||(N.DEFAULT+""),K,M,J,I;if(L){if(N.PREFIX&&L.charAt(0)===N.PREFIX){L=parseInt(L.substr(1),10);}L=parseInt(L,10);if(L<NeoConfig.minBottomPreviewHeight){L=NeoConfig.minBottomPreviewHeight;}if(N.on){K=H.one("#shellcontent");M=K?K.get(N.OFFSET_STYLE):10000000;if((L+N.MIN_PANE)>M){J=M-N.MIN_PANE;I=J>N.MIN_LIST;if(I){N.inbox.setStyle(N.INBOX_STYLE,J);N.tripane.setStyle(N.TRIPANE_STYLE,J+6);N.drag_node.setStyle(N.DRAG_STYLE,J);E.set(N.COOKIE_NAME,(N.PREFIX+J));N.msgsView.positionToolbarItems(true);}else{if(!H.common.Utils.features.enabled("TripaneNoMinWidth")){N.msgsView.togglePreviewPane(true);N.autoClosed=true;N.on=false;}}}}else{if(N.autoClosed&&NeoConfig.vertPane){K=H.one("#shellcontent");M=K?K.get(N.OFFSET_STYLE):10000000;if((L+N.MIN_PANE)<=M){N.on=true;N.autoClosed=false;N.msgsView.togglePreviewPane(true);}}}}},setDisplay:function(I){this.drag_node.setStyle("display",(I?"block":"none"));this.on=I?1:0;},start:F,endUp:function(){var I=parseInt(this.drag_node.getStyle("top"),10);E.set(G,I);H.fire("recalculateScrollToRepositionSend");H.fire("msgsview:splitterdone");},moveMouse:function(N){var M=this,J=N.pageY,P=H.one("body").get("offsetHeight"),K=H.one("#inboxcontainer").get("offsetTop"),O=H.one("#shellcontent").get("offsetTop"),L=H.one("#main").get("offsetTop")+H.one("#shellinner").get("offsetTop")+K+O,I=J-L,Q=M.MIN_PANE;if(J>(P-Q)){I=P-L-Q;}if(I<=Q){I=Q;}M.drag_node.setStyle("top",I-3);M.inbox.setStyle("height",I-3);M.tripane.setStyle("top",I-3);}};H.namespace("mail.ui").MessagesViewResize=A;function C(K){var I=["nsdate","nssubj","subj","from","to","date","size"];for(var J=0;J<I.length;J++){if(K.lastIndexOf(I[J])>-1){return I[J];}}}function D(K,L){var J=C(K.get("className")),I;if(J){I=Math.round(K.getData("col-right"));E.set("column_resize."+J+".width_pct",(100-(L+I)));E.set("column_resize."+J+".left_pct",L);}}var B={init:function(I){this.element=I;this.resizeableColumns=this.element.all(".flex > div");this.createResizeWidgets();},createResizeWidgets:function(){var J=H.one("div.flex");if(!J){return;}var I=J.get("offsetWidth");this.resizeableColumns.each(function(M,X){var T=this;if(!M.getData("col-right")){var Y,U,Q=M.get("offsetLeft"),V=M.get("offsetWidth");Q=Q>0?Q:0;V=V>0?V:0;Y=Math.round(Q/I*100);U=Math.round((I-(V+Q))/I*100);M.setData("col-left",Y);M.setData("col-right",U);}if(!X){return;}var L=H.Node.create('<div onmousedown="return false" unselectable="on" class="rail-resize" style="border: 3px solid transparent" id="resize-'+M.getAttribute("data-action")+'"></div>');M.append(L);var S=0,W,P,Z,N;var K=function(){var a=M.get("region");N=M.previous();while(N&&!N.getData("col-right")){N=N.previous();}P=N?N.get("region").left+75:75;W=a.left+a.width-75;Z=M.get("parentNode").get("offsetWidth");};var R=function(d){if(!S){S=d.target.startXY[0];}var h,g,b,e,f,c,a=d.target.lastXY[0];if(a<P||a>W){return false;}h=S-a;S=a;g=Math.round(h/Z*100*1000)/1000;b=H.StyleSheet("ColResize");e=Math.round(M.getData("col-left"))-g;c=C(M.get("className"));if(c){M.setData("col-left",e);H.all("div.flex ."+c).setStyles({left:e+"%"});b.set("div div.flex div."+c,{left:e+"%"});}f=Math.round(N.getData("col-right"))+g;c=C(N.get("className"));if(c){N.setData("col-right",f);H.all("div.flex ."+c).setStyle("right",f+"%");b.set("div div.flex div."+c,{right:f+"%"});}};var O=function(){var a=0;S=0;L.setStyle("left",-2);T.resizeableColumns.each(function(b){D(b,a);a+=(100-Math.round(b.getData("col-right")));});N=null;};(new H.mail.DD({scope:this,start:K,move:R,end:O,node:L,cursor:"col-resize"}));},this);}};H.all(".list-header").each(function(I){B.init(I);});H.namespace("mail.ui").MessagesViewColResize=B;H.namespace("test.MsgView.Resize");H.mix(H.test.MsgView.Resize,{retrieveClass:C,persistNode:D});},"1.0.0",{requires:["common-persist-cookie-data","stylesheet","node","common-ui-dd","common-persist-user-data","mail-common-utils-features"]});YUI.add("_shared_module_offscreen_bin_drag_drop",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_drag_drop={base:'<div class="msgDragProxy"> <i></i> <span></span> <b class="counter">{{num_emails_dragging}}</b></div>'};},"1.0.0");YUI.add("mail-ui-messagesview-dd",function(e){e.namespace("mail.MessagesViewDD");var t=NeoConfig,n=10,r="MessagesView",i=e.mail.ui.FolderUtils;e.mail.MessagesViewDD={PREVSUBNAV:"",setDD:function(s){var o=e.one("#storm-listnav"),u=e.one("div#main"),a=!1,f=100,l=e.one("#shellnavigation"),c=e.one("#custom-folders"),h=e.one("#Folders"),p=!1,d={scrollTimer:null,dd:null,pageX:0,pageY:0,clientX:0,clientY:0,timerCB:null,start:function(t,n,r,i,s,o){this.timerCB=t,this.dd=n,this.pageX=r,this.pageY=i,this.clientX=s,this.clientY=o,this.scrollTimer=e.Lang.later(f,this,this.ssHandler,null,!0)},update:function(e){this.pageY=e},ssHandler:function(){this.timerCB(this.dd,this.pageX,this.pageY,this.clientX,this.clientY)},isActive:function(){return this.scrollTimer!==null},hasMoved:function(e,t){return e!=this.clientX||t!=this.clientY},clear:function(){this.scrollTimer&&(this.scrollTimer.cancel(),delete this.scrollTimer,this.scrollTimer=null)}};e.publish("dropMessages",{emitFacade:!0,defaultFn:function(t){var n=t.msgs,r=t.fromFid,s=t.toFid,o=t.theList;e.mail.ui.MessageEvents&&(e.mail.ui.MessageEvents.handleUI({action:"move",fid:s},r,o,n),i.isTrashFid(s)?e.fire("darlaEvent",{action:"dd_msg_to_trash"}):i.isTrashFid(r)&&e.fire("darlaEvent",{action:"dd_msg_to_folder"}))}}),e.publish("dropConvs",{emitFacade:!0,defaultFn:function(t){var n=t.msgs,r=t.fromFid,o=t.toFid,u=t.theList;e.mail.ui.ConvEvents&&(s.handleUI({action:"move",fid:o},r,u,n),i.isTrashFid(o)?e.fire("darlaEvent",{action:"dd_msg_to_trash"}):i.isTrashFid(r)&&e.fire("darlaEvent",{action:"dd_msg_to_folder"}))}});var v=function(n){var o=e.one("body");e.mail.MessagesViewDD.PREVSUBNAV=o.getAttribute("data-open");var u=function(e){function u(o){var u=!0,a=e.common.Utils.substitute(e.ui.Templates._shared_module_offscreen_bin_drag_drop.base,{num_emails_dragging:o.arr.length},null,null,strings);if(t.hasConv)for(var f in o.map){var c=s.msgList.getMsgFid(o.map[f]);if(!i.isDraftFid(c)&&!i.isSentFid(c)){u=!1;break}}else u=!1;n.dd.dragging&&o.arr.length&&!i.isDraftFid(s.fid)&&s.fid!=="%40C%40Chats"&&!u?(n.dd.proxy=e.Node.create(a),e.one("body").prepend(n.dd.proxy),n.dd.proxy.setXY([-100,-100]),n.dd.shellbottom=l.get("winHeight"),n.dd.shelltop=l.getY(),e.fire(r+":dragstart")):n.notDragging=!0}s.hasMsgList?s.msgList.vlist.getSelected(u):u([s.msgPane.get("message")]),p=o.getAttribute("data-open")==="Folders"?!0:!1};d.clear();if(n.target.hasClass("list-view-items")||n.target.getAttribute("draggable")==="false"){n.notDragging=!0;return}a?u(e):(e.use(t.hasConv?"mail-ui-convevents":"mail-ui-messageevents",u),a=!0)},m=function(t,n,r){var o,u=e.mail.MessagesViewDD.currentDrop,a,f;return n.getAttribute("data-fid")&&(o=n.getAttribute("data-fid"),r?a=n.one("a")?n.one("a"):n:a=n.one("i")?n.one("i"):n,t.proxy.one("span").inRegion(a)&&s.fid!==o&&!i.isDraftFid(o)&&!i.isSentFid(o)&&o!=="%40C%40Chats"?(u&&u.removeClass("popping"),n&&n.addClass("popping"),e.mail.MessagesViewDD.currentDrop=n,f=!0):n.hasClass("popping")&&(n.removeClass("popping"),e.mail.MessagesViewDD.currentDrop=null)),f},g=function(e){if(d.isActive()&&!d.hasMoved(e.clientX,e.clientY))return;d.clear(),y(e.dd,e.pageX,e.pageY,e.clientX,e.clientY)},y=function(n,r,i,s,a){var f,v,g,b,w,E,S,x=n.shelltop,T=n.shellbottom;b=v=g=30,n.proxy&&(n.proxy._node&&(n.proxy.setStyle("top",i-10),n.proxy.setStyle("left",r-1)),p||n.proxy.inRegion(h)&&(u.addClass("dragging-message"),p=!0,t.nav&&h.addClass("nav-open")),n.proxy.inRegion(l)?(n.proxy.inRegion(c)||c.one(".listnav-subfolder")&&n.proxy.inRegion(c.one(".listnav-subfolder"))?c.all("li").each(function(e){m(n,e,!1)}):n.proxy.inRegion(o)?o.all("li.sysfolder").each(function(t){var r=m(n,t,!0);r&&(e.fire("navigation:switch",{type:"none"}),p=!1)}):e.mail.MessagesViewDD.currentDrop&&(e.mail.MessagesViewDD.currentDrop.removeClass("popping"),e.mail.MessagesViewDD.currentDrop=null),i<x+b?w=E=!0:i>T-v&&(w=!0,E=!1),w?(E?(f=l.get("scrollTop"),l.set("scrollTop",f-g),S=i):(f=l.get("scrollTop"),l.set("scrollTop",f+g),S=i),d.isActive()||d.start(y,n,r,i,s,a),d.update(S)):d.clear()):e.mail.MessagesViewDD.currentDrop&&(e.mail.MessagesViewDD.currentDrop.removeClass("popping"),e.mail.MessagesViewDD.currentDrop=null,d.clear()))},b=function(i){var o,f,l,c,h=e.mail.MessagesViewDD.PREVSUBNAV;d.clear(),i.dd.proxy&&(i.dd.proxy.remove(!0),e.mail.MessagesViewDD.currentDrop?(e.mail.MessagesViewDD.currentDrop.removeClass("popping"),o=e.mail.MessagesViewDD.currentDrop.getAttribute("data-fid"),c=t.hasConv,l=c?"dropConvs":"dropMessages",f=function(e){s.hasMsgList?e.fire(l,{fromFid:s.fid,toFid:o,theList:s.msgList}):e.fire(l,{fromFid:s.fid,toFid:o,msgs:[s.msgPane.get("message")]})},a?f(e):(e.use(c?"mail-ui-convevents":"mail-ui-messageevents",f),a=!0)):i.dd.originNode&&Math.abs(i.pageX-i.dd.startXY[0])<=n&&Math.abs(i.pageY-i.dd.startXY[1])<=n&&e.one(i.dd.originNode.simulate("click"))),e.mail.MessagesViewDD.currentDrop=null,e.fire(r+":dragend"),u.removeClass("dragging-message"),e.fire("navigation:switch",{type:h}),e.mail.MessagesViewDD.PREVSUBNAV=""};new e.mail.DD({start:v,move:g,end:b,node:e.one("div.list-view-items")})}}},"1.0.0",{requires:["mail-model-datastore","common-utils","node-base","common-ui-dd","_shared_module_offscreen_bin_drag_drop","mail-ui-folder-utils"]});
