YUI.add("mail-ui-foldersview-bind",function(e){function T(t,n){var r=n.one('[data-action="folder-rename"]'),i=n.one('[data-action="folder-remove"]'),s=n.one('[data-action="folder-move"]'),o=e.one(l),u=o.all(".custom a");u.removeClass(g),t.hasClass("papa-folder")?(r.addClass(g),i.addClass(g),s.addClass(g)):(r.removeClass(g),i.removeClass(g),s.removeClass(g)),N(t,n)}function N(e,t){var n=t.one('[data-action="folder-allread"]');r.ui.FolderUtils.get(e.getAttribute("data-fid")).unread>0?n.removeClass(g):n.addClass(g)}function C(){var t=e.one(l),n=t.all(".custom a");n.addClass(g),t.fire("menu:changed")}function k(){var n=t(f),r=t(a).menu,i=r.getContextTarget().ancestor("li"),s=t(l),o,u;i.hasClass("allow-rclick")&&!i.hasClass("filter-on")?n.contains(i)?(s.setAttribute("data-context","usr-folders-v3"),T(i,s),e.use("mail-ui-folder-menu",function(e){var t=s.one(".menu-move-folder"),n=t.ancestor();e.mail.ui.FolderMenu.enhanceMenu({menu:r,root:n,groups:[t],childSelector:"li",displayNameSelector:"a span",toggleSelector:'[data-action="folder-move"]',toggleGroup:n.one("ul"),noShortcuts:!0,context:r.getContextTarget(),rapidPrefix:"cntxt_mv_fldr_mnu"})})):(o=i.get("id"),o==="Folders"?(s.setAttribute("data-ftype",o),s.setAttribute("data-context","folder-title-v3")):(u=i.getAttribute("data-ftype"),s.setAttribute("data-ftype",u),s.setAttribute("data-context","sys-folders-v3"),N(i,s)),C(),e.use("mail-ui-folder-menu",function(e){e.mail.ui.FolderMenu.removeEnhancements(s,s.one(".menu-move-folder"))})):s.setAttribute("data-context","rclick-disabled")}function O(e,t){e&&("show"===t&&!e.hasClass("selected")?e.addClass("cntxtmenu"):"hide"===t&&e.removeClass("cntxtmenu"))}function M(e,t){var n,r=t.keyCode===40?"next":"previous",i,s,o,u,a,f,l,c=function(e){return e.getComputedStyle("display")==="none"||e.get("offsetWidth")<=0||e.get("offsetHeight")<=0||e.hasClass("nav-separator")||e.hasClass("offscreen")||e.hasClass("hidden")};return e?(i=e[r](),i?(c(i)?i=M(i,t):t.keyCode===38&&(i.hasClass("nav-open")||i.hasClass("listnav-container")||i.hasClass("listnav-subfolder"))&&(o=i.one("ul#custom-folders"),o&&(u=o.all("li"),a=o?u.size():0,f=a?u.item(a-1):null,c(f)?i=M(f,t):i=f)),n=i):(s=e.get("parentNode"),s.get("id")==="multitask"?n=s.ancestor("ul").one("#Inbox"):n=M(s,t))):n=null,n}function _(e,t){var n,r={},i=t.keyCode,s,o,u=function(e,n){var r=e.all(n),i=r.size(),s=null;return i&&(s=r.item(i-1).ancestor("li"),s.getComputedStyle("display")==="none"&&(s=M(s,t))),s};return e?(r[e.get("id")]=!0,r.Folders&&i===40&&e.hasClass("nav-open")?o=e.one("#custom-folders").one("li.folder"):r.multitask?(i===38?(s=M(e,t),s&&s.hasClass("nav-open")&&(s=u(s,'a[role="link"]'))):(e.hasClass("nav-open")&&(s=e.one("li.removable")),s||(n=e.ancestor("ul"),s=n&&n.one("#Inbox"))),o=s):r.Inbox&&i===38?(n=e.ancestor("ul"),s=n&&n.one("#multitask"),s&&s.hasClass("nav-open")&&(s=u(s,'a[role="tab"]'),s.hasClass("empty-tabs")&&(s=n.one("#multitask"))),o=s):o=M(e,t)):o=null,o&&(o.get("id")==="multitask"?o=o.one("button"):o.get("tagName").toLowerCase()!=="button"&&o.get("tagName").toLowerCase()!=="a"&&(o=o.one("a[role=link]")||o.one("a[role=tab]"))),o}function R(e){var t="neo.pref.folderState",n=parseInt(i.get(t),10)===0?1:0,r,s;if(e&&e.target.hasClass("icon")){r=e.currentTarget.ancestor("li"),s=r&&r.hasClass("nav-open");if(s&&n===0)return}i.set(t,n)}var t=e.Node.one,n=e.common.Utils,r=e.mail,i=r.persist.MetaData,s=strings.str_nav_inbox,o=NeoConfig.imapIn,u=e.one("body"),a="#storm-listnav",f="#custom-folders",l="#menu-system-folder",c="filtering-search",h="."+c,p=".filter-on",d="no-results",v="data-searchIdx",m="selected",g="disabled",y=t(a),b=t(f),w={"in":"Inbox",chats:"%40C%40Chats",drafts:"Draft",sent:"Sent",folder:"%40B%40Bulk",spam:"%40B%40Bulk",archive:"Archive",trash:"Trash"},E={Inbox:"str_tabs_inbox",Draft:"str_tabs_drafts",Sent:"str_tabs_sent","%40B%40Bulk":"str_tabs_spam","%40C%40Chats":"str_tabs_conversations",Trash:"str_tabs_trash",Archive:"str_tabs_archive"},S=e.Lang,x=function(t,n,r){var i={action:r,args:{}},s={inbox:"folderview_inbox",drafts:"folderview_draft",sent:"folderview_sent",archive:"folderview_archive",trash:"folderview_trash",conversations:"folderview_chat",spam:"folderview_bulk",custom_fldr:"folderview_custom"},o;return r==="sysFldCk"&&(typeof t=="string"&&n==="btn"?(i.args.btn=t.replace("btn-",""),t==="checkmail"&&(o="inbox"),i.action=i.args.btn+"_btn"):(o=E[t]&&E[t].replace("str_tabs_",""),i.args.id=o,i.action=i.args.id+"_fldr")),r==="usr_fldr"&&(o="custom_fldr",i.args.id=t||""),i.spid=s[o]||"",e.fire("mt:click",i),!0},L=function(n){function f(t){var n=u.menu.getContextTarget(),i;e.fire("mt:click",{action:"cntxt_mnu_fldr_v3_itm_"+t.dataAction}),n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i?r.handleFolderActions(t,i):r.handleFolderActions(t))}function c(n){var r=u.menu,o=r.getContextTarget().ancestor("li"),a=t(l),f;i&&i.setNodeFolderMenu(o,a),n.state==="show"&&(a.setAttribute("aria-labelledby",""),f=a.one("a"),f&&f.focus(),e.fire("util:ymstats",{name:"folder_menu_clicked",include:{bucket:!0}}),e.fire("mt:click",{action:"cntxt_mnu_fldr_v3"})),O(o,n.state),n.state==="hide"&&s&&s.focus()}var r=this,i=e.mail.ui.ContextButton,s=n.target,u=t(a);n.preventDefault();if(!u.menu){var h=["common-ui-menu-helper","mail-ui-inboxmenu-base"];o&&h.push("mail-ui-folder-menu"),e.use(h,function(e){e.mail.ui.InboxMenu.insert("menu-system-folder",function(){var r=t(l);e.common.ui.MenuHelper.create(u,{menu:r,isContext:!0,xy:[n.clientX,n.clientY],contextTarget:n.target,setVisibleCbk:k,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(r))}},function(){r.on("menuSelected",f),r.on("menu:state",c)})})})}},A=function(n){function u(t){var n=o.menu.getContextTarget(),i;n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i&&(r.handleFolderActions(t,i),e.fire("mt:click",{action:"cntxt_mnu_sys_fldr_itm_"+t.dataAction})))}var r=this,i=e.mail.ui.ContextButton,s=n.target,o=n.currentTarget;n.preventDefault
(),o.menu||e.use("common-ui-menu-helper",function(e){var r=e.common.ui.MenuHelper;r.createLoadingMenu(y,{isContext:!0,xy:[n.clientX,n.clientY]}),e.use("mail-ui-inboxmenu-base",function(e){e.mail.ui.InboxMenu.insert("menu-system-folder",function(){var r=t(l);e.common.ui.MenuHelper.create(o,{menu:r,isContext:!0,xy:[n.clientX,n.clientY],contextTarget:n.target,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(r))}},function(){r.on("menuSelected",u),r.on("menu:state",function(e){var t=o.menu.getContextTarget().ancestor("li");t.hasClass("sysfolder")||e.preventDefault();if(e.state==="show"){var n=this.one("[data-action=folder-allread]");t&&"%40C%40Chats"===t.getAttribute("data-fid")?(n.addClass("disabled"),n.one("a").set("aria-disabled",!0)):(n.removeClass("disabled"),n.one("a").removeAttribute("aria-disabled"))}else e.state==="hide"&&s&&s.focus();i&&i.setNodeFolderMenu(t,r),O(t,e.state)})})})})}),e.fire("mt:click",{action:"cntxt_mnu_sys_fldr"})},D=function(t){x("checkmail","btn","sysFldCk");var n=t.currentTarget,r=n.getAttribute("data-mboxid");this.checkMail(r),e.fire("darlaEvent",{action:NeoConfig.isSSL?"folderview_inbox_ssl":"folderview_inbox"})},P=function(t){var r=t.currentTarget,i=t.keyCode,s=e.UA.os,o=b.hasClass(c),u="#Folders li",a=t.currentTarget.test(u),f,l,h,g,y,w;o&&(y=b.all(p),l=y.size(),g=b.getAttribute(v)*1,w=function(e,t){y.removeClass(m),y.setAttribute("tabindex","-1"),e&&(e.addClass(m),e.setAttribute("tabIndex","0")),b.setAttribute(v,t)}),s==="macintosh"&&i===8&&(i=46);switch(i){case 13:o&&(l===1?(h=y.item(0),h.hasClass(d)||h.simulate("click")):g>=0&&y.item(g).simulate("click"));break;case 40:a&&g<l-1&&(h=y.item(g+1),h.hasClass(d)||w(h,g+1));break;case 38:a&&g>=0&&(h=y.item(g-1),h&&w(h,g-1));break;case 121:case 77:f=s==="windows"||s==="win";if(f&&t.shiftKey&&i===121||!f&&t.ctrlKey&&t.shiftKey&&t.altKey&&i===77)t.preventDefault(),n.simulateContextMenu(t.target);break;default:o&&(w(null,-1),e.fire("mt:click",{action:"fldr_srch"}))}},H=function(t){var r=t.target,i,s,o,u=!1,a,f=t.keyCode,l,c=n.substitute,h;if(f===38||f===40)t.halt(),i=_(r.ancestor("li"),t),i?i?(r.get("tagName").toLowerCase()!=="button"&&r.setAttribute("tabindex",-1),i.set("tabIndex",0),i.focus()):e.use("common-utils-error",function(e){e.common.Utils.error.report("Anchor not set; listItem markup is '"+i.getHTML()+"'",1,1,1)}):f===38&&r===e.one("#custom-folders a")&&(e.one("#custom-folders-btn").focus(),t.halt());else if(f==37||f==39||f==13)s=r.ancestor("li"),s.hasClass("papa-folder")?(u=!0,o=s.one(".listnav-folder-toggle"),f==37?(o.replaceClass("icon-chevron-down","icon-chevron-right"),s.next().addClass("hidden")):f==39?(o.replaceClass("icon-chevron-right","icon-chevron-down"),s.next().removeClass("hidden")):o.hasClass("icon-chevron-down")?(o.replaceClass("icon-chevron-down","icon-chevron-right"),s.next().addClass("hidden")):(o.replaceClass("icon-chevron-right","icon-chevron-down"),s.next().removeClass("hidden")),l=s.one(".foldername"),h=c(o.hasClass("icon-chevron-down")?strings.str_nav_left_subfolders_expanded_attr:strings.str_nav_left_subfolders_collapsed_attr,{name:n.escapeHtml(l&&l.getHTML())}),s.one(".listnav-folder-toggle").set("title",h),s.one(".listnav-folder-toggle").set("aria-label",h),e.fire("persist:folders")):s.hasClass("openable")&&(u=!0,R(),o=s.one(".listnav-toggle"),f==37?s.removeClass("nav-open"):f==39?s.addClass("nav-open"):(s.toggleClass("nav-open"),a=s.hasClass("nav-open"),r.setAttribute("aria-selected",a),r.set("title",a?strings.str_nav_left_folders_expanded_attr:strings.str_nav_left_folders_collapsed_attr))),u&&t.halt()},B=function(e){var t=n.getDataAction(e);this.handleFolderActions({dataAction:t.action,target:e.target})},j=function(t){var r=t.currentTarget,i=r.one("input.trash"),s;if(r.hasClass("icon-small-delete")||r.hasClass("icon-delete")||i)t.halt(),e.UA.webkit&&t.target.focus(),s=n.getDataAction(t),this.handleFolderActions({dataAction:s.action,target:t.target}),x(t.currentTarget.get("id"),"btn","sysFldCk")},F=function(t){var r=t.currentTarget,i=t.target,o=(i||r).getAttribute("data-action"),u,a,f,l,c,h,p;e.fire("ds:folder:system:switch",r);if(i.hasClass("clicker")){r.hasClass("open")?r.removeClass("open"):r.addClass("open");return}if(o==="folder-empty-spam"||o==="folder-empty-trash")return;i.get("nodeName")!=="INPUT"&&!i.hasClass("trash")&&!i.hasClass("check-mail")&&(t.currentTarget.hasClass("archive")&&x("Archive","folder","sysFldCk"),x(t.currentTarget.get("id"),"folder","sysFldCk")),r.hasClass("in")||r.hasClass("inbox-sub")?(p=i.getAttribute("data-action"),p==="show-accounts"?t.halt():i.hasClass("check-mail")||(u=S.trim(i.getAttribute("data-mboxid")),c={fid:r.getAttribute("data-fid"),name:s,mailboxId:u&&u.length>0?u:"Inbox",smartFolder:t.smartFolder,forceRefresh:t.smartFolder},e.fire("darlaEvent",{action:NeoConfig.isSSL?"folderview_inbox_ssl":"folderview_inbox"}))):t.target.get("type")!=="button"&&(NeoConfig.imapIn?(a=r.get("className").split(" "),l=w[a[0].trim()],f=strings[E[l]],h=r.getAttribute("data-fid")):(a=r.get("className").split(" "),f=strings[E[r.getAttribute("data-fid")]],l=w[a[0].trim()],h=l||a[0]),h&&(c={fid:h,name:f,mailboxId:null,smartFolder:t.smartFolder,forceRefresh:t.smartFolder})),c&&(c.isTrashBtn=t.target.getAttribute("data-action")==="folder-empty-trash",this.set("fid",c),n.features.enabled("fetchMessageListOnHover")&&this.hoverPrefetch&&this.hoverPrefetch.logHoverClickStats(h))},I=function(e){var t=e.currentTarget,r=t.getAttribute("data-fid"),i=e.target;if(i&&i.hasClass("searcher-icon-close")){this.handleFolderActions({dataAction:"folder-search"});return}if(i&&i.hasClass("clicker")){t.hasClass("open")?t.removeClass("open"):t.addClass("open");return}x(r,"folder","usr_fldr"),!o&&this.get("active")&&r===e.fid?b.hasClass(c)||this.handleFolderActions({dataAction:"folder-rename",target:e.currentTarget,actionSource:"activeFolder"}):r&&(this.set("fid",{fid:r,smartFolder:e.smartFolder,forceRefresh:e.smartFolder}),n.features.enabled("fetchMessageListOnHover")&&this.hoverPrefetch&&
this.hoverPrefetch.logHoverClickStats(r))},q=function(n){function o(t){var n=b.menu.getContextTarget(),i;e.fire("mt:click",{action:"cntxt_mnu_fldr_itm_"+t.dataAction}),n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i&&(t.actionSource="contextMenu",r.handleFolderActions(t,i)))}var r=this,i=e.mail.ui.ContextButton,s=n.target;n.preventDefault(),b.menu||e.use("common-ui-menu-helper",function(e){var r=e.common.ui.MenuHelper;r.createLoadingMenu(b,{isContext:!0,xy:[n.clientX,n.clientY]}),e.use("mail-ui-inboxmenu-base",function(e){e.mail.ui.InboxMenu.insert("menu-folder",function(){var u=t("#menu-folder");r.create(b,{menu:u,isContext:!0,xy:[n.clientX,n.clientY],contextTarget:n.target,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(u))}},function(){u.on("menuSelected",o),u.on("menu:state",function(e){var t=b.menu.getContextTarget().ancestor("li"),n,r;i&&i.setNodeFolderMenu(t,u),e.state==="show"&&(n=u.one("[data-action=folder-rename]"),r=u.one("[data-action=folder-remove]"),t.hasClass("papa-folder")?(n.addClass("disabled"),r.addClass("disabled")):(n.removeClass("disabled"),r.removeClass("disabled"))),O(t,e.state),e.state==="hide"&&s&&s.focus()})})})})}),e.fire("mt:click",{action:"cntxt_mnu_fldr"})};e.mix(e.mail.FoldersView,{contextClick:A,folderHilite:O,checkMailClick:D,foldersKeyDown:P,upDownNavigation:H,newFolderClick:B,emptyFolderOnClick:j,sysFoldersClick:F,usrFoldersClick:I,usrFoldersContextClick:q,updateFolderPref:R,contextClickV3:L,deactivateCustomFolderMenuItems:C,showV3contextMenu:k})},"1.0.0",{requires:["mail-controller-folders","mail-persist-meta-data","mail-ui-folder-utils","mail-common-utils-features"]});
