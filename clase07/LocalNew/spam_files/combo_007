YUI.add("mail-ui-favicon-notify",function(e){function p(t){return e.Lang.isArray(t)&&t.length>0}function d(e){if(!r)return;if(!e){if(!s)return;e=s}r.set("href",e)}function v(n,r,i,s){var o=this;r?e.mail.FoldersView.updateTitle():(n===1?e.config.doc.title=strings.str_tabs_compose_fresh:e.config.doc.title=t.ezSub(strings.str_notif_new_msg,{num_new_msgs:String(n)}),s--),f&&f.cancel(),f=null;if(i||s)s||(i=!1),f=e.later(l,null,function(){o.setTitleAndTimer(n,!r,i,s)})}function m(e){var t;if(NeoGV.isWindowFocused||!p(e))return;NeoConfig.hasConvView?t=e.reduce(function(e,t){return e.concat(t.msgs)},[]):t=e;if(!p(t))return;u&&this.setFaviconHref(o),a&&this.setTitleAndTimer(t.length,!1,!0,c)}function g(e){if(!e||typeof e.list=="undefined")return;var t=e.list.getNewMsgs(this.watermark),r=e.list.getMostRecentTimestamp();r&&n.isInboxFid(e.list.fid)&&(this.watermark=r),this.handleNotify(t)}function y(){u&&this.setFaviconHref(s),a&&this.setTitleAndTimer(0,!0)}function b(t){var n=this;if(!u&&!a)return;s=r&&r.get("href"),e.one("window").on("focus",function(){y.call(n)}),this.watermark=t.getMostRecentTimestamp(),t.on("MailList:modelRefresh",this.onListRefresh,this),NeoConfig.multipleAccounts&&e.on("accounts:select",function(){h&&h.detach(),h=t.once("renderComplete",function(){this.watermark=t.getMostRecentTimestamp()},this)},this)}var t=e.common.Utils,n=e.mail.ui.FolderUtils,r=e.one('link[rel="shortcut icon"]'),i,s,o=t.settings.value("faviconWithBadgeUrl"),u=t.features.enabled("faviconNotify"),a=t.features.enabled("titleNotify"),f=null,l=1e3,c=3,h;e.namespace("mail.ui").faviconNotify={init:b,watermark:i,handleNotify:m,setFaviconHref:d,setTitleAndTimer:v,onListRefresh:g}},"1.0.0",{requires:["common-utils","mail-common-utils-features","mail-ui-foldersview-base","mail-ui-folder-utils"]});
